<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="https://gmpg.org/xfn/11">
<link rel="pingback" href="https://www.middlewareinventory.com/xmlrpc.php">

<title>Creating EKS Cluster with Karpenter Auto scaling - Terraform | Kubernetes</title>
<meta name="description" content="Creating EKS Cluster with Karpenter using Terraform. EKS Terraform example. Karpenter Auto ScalingExample. Installing Karpenter Auto Scaling to AWS EKS using Terraform." />
<meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
<link rel="canonical" href="index.html" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Creating EKS Cluster with Karpenter Auto scaling - Terraform | Kubernetes" />
<meta property="og:description" content="Creating EKS Cluster with Karpenter using Terraform. EKS Terraform example. Karpenter Auto ScalingExample. Installing Karpenter Auto Scaling to AWS EKS using Terraform." />
<meta property="og:url" content="https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/" />
<meta property="og:site_name" content="Middleware Inventory" />
<meta property="article:publisher" content="http://www.facebook.com/devopsjunc" />
<meta property="article:published_time" content="2022-02-06T22:36:52+00:00" />
<meta property="article:modified_time" content="2022-04-02T21:22:39+00:00" />
<meta property="og:image" content="../../wp-content/uploads/2022/02/aws-eks-karpenter.jpg" />
<meta property="og:image:width" content="1748" />
<meta property="og:image:height" content="1240" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content="@mwinventory" />
<meta name="twitter:site" content="@mwinventory" />
<script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://www.middlewareinventory.com/#organization","name":"Middleware Inventory","url":"https://www.middlewareinventory.com/","sameAs":["http://www.facebook.com/devopsjunc","https://www.youtube.com/channel/UCRuqBFM6ioWwviNJkgOjeWw","https://twitter.com/mwinventory"],"logo":{"@type":"ImageObject","@id":"https://www.middlewareinventory.com/#logo","inLanguage":"en-US","url":"https://www.middlewareinventory.com/wp-content/uploads/2020/09/Screenshot-2020-09-18-at-3.49.40-AM.jpg","width":300,"height":107,"caption":"Middleware Inventory"},"image":{"@id":"https://www.middlewareinventory.com/#logo"}},{"@type":"WebSite","@id":"https://www.middlewareinventory.com/#website","url":"https://www.middlewareinventory.com/","name":"Devops Junction","description":"An inventory of [i]nformation, Middleware and much more.","publisher":{"@id":"https://www.middlewareinventory.com/#organization"},"potentialAction":[{"@type":"SearchAction","target":"https://www.middlewareinventory.com/?s={search_term_string}","query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"ImageObject","@id":"https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/#primaryimage","inLanguage":"en-US","url":"../../wp-content/uploads/2022/02/aws-eks-karpenter.jpg","width":1748,"height":1240,"caption":"EKS Karpenter Example"},{"@type":"WebPage","@id":"https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/#webpage","url":"https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/","name":"Creating EKS Cluster with Karpenter Auto scaling - Terraform | Kubernetes","isPartOf":{"@id":"https://www.middlewareinventory.com/#website"},"primaryImageOfPage":{"@id":"https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/#primaryimage"},"datePublished":"2022-02-06T22:36:52+00:00","dateModified":"2022-04-02T21:22:39+00:00","description":"Creating EKS Cluster with Karpenter using Terraform. EKS Terraform example. Karpenter Auto ScalingExample. Installing Karpenter Auto Scaling to AWS EKS using Terraform.","inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/"]}]},{"@type":"Article","@id":"https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/#article","isPartOf":{"@id":"https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/#webpage"},"author":{"@id":"https://www.middlewareinventory.com/#/schema/person/050bf13e27b309d29d1bda45c4eb3147"},"headline":"Creating EKS Cluster with Karpenter Auto scaling &#8211; Terraform | Kubernetes","datePublished":"2022-02-06T22:36:52+00:00","dateModified":"2022-04-02T21:22:39+00:00","mainEntityOfPage":{"@id":"https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/#webpage"},"commentCount":0,"publisher":{"@id":"https://www.middlewareinventory.com/#organization"},"image":{"@id":"https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/#primaryimage"},"articleSection":"AWS,Kubernetes","inLanguage":"en-US","potentialAction":[{"@type":"CommentAction","name":"Comment","target":["https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/#respond"]}]},{"@type":"Person","@id":"https://www.middlewareinventory.com/#/schema/person/050bf13e27b309d29d1bda45c4eb3147","name":"Rumen Lishkov","image":{"@type":"ImageObject","@id":"https://www.middlewareinventory.com/#personlogo","inLanguage":"en-US","url":"https://secure.gravatar.com/avatar/c22e4a54d67750291a9892531f94ffb3?s=96&d=mm&r=g","caption":"Rumen Lishkov"}}]}</script>

<link rel='dns-prefetch' href='https://js.stripe.com' />
<link rel='dns-prefetch' href='https://fonts.googleapis.com' />
<link rel='dns-prefetch' href='https://s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Middleware Inventory &raquo; Feed" href="../../feed/index.rss" />
<link rel="alternate" type="application/rss+xml" title="Middleware Inventory &raquo; Comments Feed" href="../../comments/feed/index.rss" />
<link rel="alternate" type="application/rss+xml" title="Middleware Inventory &raquo; Creating EKS Cluster with Karpenter Auto scaling &#8211; Terraform | Kubernetes Comments Feed" href="feed/index.rss" />

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2HY2B3N51X"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-2HY2B3N51X');
</script>

<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/www.middlewareinventory.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.5.6"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,8205,55356,57212],[55357,56424,8203,55356,57212])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel="stylesheet" href="../../wp-content/cache/minify/404f7.css" media="all" />
<style id='ez-toc-inline-css' type='text/css'>div#ez-toc-container p.ez-toc-title {font-size: 120%;}div#ez-toc-container p.ez-toc-title {font-weight: 500;}div#ez-toc-container ul li {font-size: 95%;}div#ez-toc-container {width: 100%;}
</style>
<link rel="stylesheet" href="../../wp-content/cache/minify/f854f.css" media="all" />
<link rel='stylesheet' id='poseidon-default-fonts-css' href='https://fonts.googleapis.com/css?family=Ubuntu%3A400%2C400italic%2C700%2C700italic%7CRaleway%3A400%2C700&amp;subset=latin%2Clatin-ext' type='text/css' media='all' />
<link rel="stylesheet" href="../../wp-content/cache/minify/88e5e.css" media="all" />
<script type='text/javascript' id='monsterinsights-frontend-script-js-extra'>
/* <![CDATA[ */
var monsterinsights_frontend = {"js_events_tracking":"true","download_extensions":"doc,pdf,ppt,zip,xls,docx,pptx,xlsx","inbound_paths":"[{\"path\":\"\\\/go\\\/\",\"label\":\"affiliate\"},{\"path\":\"\\\/recommend\\\/\",\"label\":\"affiliate\"}]","home_url":"https:\/\/www.middlewareinventory.com","hash_tracking":"false"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/1058f.js"></script>
<script type='text/javascript' id='cookie-notice-front-js-extra'>
/* <![CDATA[ */
var cnArgs = {"ajaxurl":"https:\/\/www.middlewareinventory.com\/wp-admin\/admin-ajax.php","hideEffect":"fade","onScroll":"no","onScrollOffset":"100","cookieName":"cookie_notice_accepted","cookieValue":"true","cookieTime":"2592000","cookiePath":"\/","cookieDomain":"","redirection":"","cache":"1","refuse":"yes","revoke_cookies":"0","revoke_cookies_opt":"automatic","secure":"1"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/545b0.js"></script>
<script type='text/javascript' id='email-subscribers-js-extra'>
/* <![CDATA[ */
var es_data = {"messages":{"es_empty_email_notice":"Please enter email address","es_rate_limit_notice":"You need to wait for sometime before subscribing again","es_single_optin_success_message":"Successfully Subscribed.","es_email_exists_notice":"Email Address already exists!","es_unexpected_error_notice":"Oops.. Unexpected error occurred.","es_invalid_email_notice":"Invalid email address","es_try_later_notice":"Please try after some time"},"es_ajax_url":"https:\/\/www.middlewareinventory.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/1de0a.js"></script>
<script type='text/javascript' id='ssb-front-js-js-extra'>
/* <![CDATA[ */
var SSB = {"ajax_url":"https:\/\/www.middlewareinventory.com\/wp-admin\/admin-ajax.php","fb_share_nonce":"9fe2b70daf"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/268e7.js"></script>
<!--[if lt IE 9]>
<script type='text/javascript' src='https://www.middlewareinventory.com/wp-content/themes/poseidon/js/html5shiv.min.js?ver=3.7.3' id='html5shiv-js'></script>
<![endif]-->
<script type='text/javascript' id='poseidon-post-slider-js-extra'>
/* <![CDATA[ */
var poseidon_slider_params = {"animation":"slide","speed":"7000"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/51af3.js"></script>
<script type='text/javascript' id='eio-lazy-load-js-extra'>
/* <![CDATA[ */
var eio_lazy_vars = {"exactdn_domain":"","skip_autoscale":"0"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/28f5b.js"></script>
<link rel="https://api.w.org/" href="../../wp-json/index.json" /><link rel="alternate" type="application/json" href="../../wp-json/wp/v2/posts/7891.json" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../xmlrpc.php-rsd.xml" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://www.middlewareinventory.com/wp-includes/wlwmanifest.xml" />
<meta name="generator" content="WordPress 5.5.6" />
<link rel='shortlink' href='index.html' />
<link rel="alternate" type="application/json+oembed" href="../../wp-json/oembed/1.0/embed-url=https---www.middlewareinventory.com-blog-creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes-.json" />
<link rel="alternate" type="text/xml+oembed" href="../../wp-json/oembed/1.0/embed-url=https---www.middlewareinventory.com-blog-creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes-&amp;format=xml.xml" />
<script>
    document.cookie = "cookie_notice_accepted=true;max-age=" + 3600*24*365 + "; path=/" + ";secure;";
    document.cookie = "cookie_notice_accepted=true;max-age=" + 3600*24*365 + "; path=/";
    if ( ! /(^|;)\s*cca_is_eu=/.test(document.cookie) ) {  // if check prevents reload loop
		  document.cookie = "cca_is_eu=false;max-age=" + 3600*24*364 + "; path=/";
      var ccaURL = window.location.protocol + '//',
      hostname = window.location.host + '/' + window.location.pathname;
			if ( '0' === '1' ) {
        window.location.reload( true );
      }
   }
</script>
<link href='https://fonts.googleapis.com/css?family=Strait:100,200,300,400,500,600,700,800,900&amp;subset=arabic,vietnamese,hebrew,thai,bengali,latin,latin-ext,cyrillic,cyrillic-ext,greek' rel='stylesheet' type='text/css'><style>a.idcore-button,a.idcore-button:visited{font-family:'Strait','arial';font-size:20px;color:#ffffff;font-weight:normal;font-style:normal;text-decoration:none !important;text-transform:uppercase;padding-top:16px;padding-bottom:16px;padding-left:32px;padding-right:32px;background-color:rgba(212, 7, 72, 1);background-image:linear-gradient(to bottom,rgba(255,255,255,.05) 0,rgba(255,255,255,.05) 50%,rgba(0,0,0,.05) 51%,rgba(0,0,0,.05) 100%);border-width:1px;border-style:solid;border-color:#d4150b;border-radius:3px;box-shadow: 2px 2px 0px 0px rgba(68, 68, 68, 0.2);}a.idcore-button:hover,a.idcore-button:focus{font-family:'Strait','arial';font-size:20px;color:#ffffff;font-weight:normal;font-style:normal;text-decoration:none !important;text-transform:uppercase;padding-top:16px;padding-bottom:16px;padding-left:32px;padding-right:32px;background-color:rgba(212, 7, 72, 1);background-image:linear-gradient(to bottom,rgba(255,255,255,.05) 0,rgba(255,255,255,.05) 50%,rgba(0,0,0,.05) 51%,rgba(0,0,0,.05) 100%);border-width:1px;border-style:solid;border-color:#d4150b;border-radius:3px;box-shadow: 2px 2px 0px 0px rgba(68, 68, 68, 0.2);}a.idcore-button:active{font-family:'Strait','arial';font-size:20px;color:#ffffff;font-weight:normal;font-style:normal;text-decoration:none !important;text-transform:uppercase;padding-top:16px;padding-bottom:16px;padding-left:32px;padding-right:32px;background-color:rgba(212, 7, 72, 1);background-image:linear-gradient(to bottom,rgba(255,255,255,.05) 0,rgba(255,255,255,.05) 50%,rgba(0,0,0,.05) 51%,rgba(0,0,0,.05) 100%);border-width:1px;border-style:solid;border-color:#d4150b;border-radius:3px;box-shadow: 2px 2px 0px 0px rgba(68, 68, 68, 0.2);}</style><script>var idcore_ajax_url = "https://www.middlewareinventory.com/wp-admin/admin-ajax.php";</script> <style media="screen">/*inline margin*/
	
	
	
	
	
	
			 /*margin-digbar*/

	
	
	
	
	   div[class*="simplesocialbuttons-float"].simplesocialbuttons.simplesocial-round-icon button{
	 margin: ;
   }
	
	
	
</style>

<meta property="og:title" content="Creating EKS Cluster with Karpenter Auto scaling &#8211; Terraform | Kubernetes - Middleware Inventory" />
<meta property="og:description" content="Kubernetes has been a disruptive change in IT Infrastructure. It had been widely adopted across the industry

Managed Kubernetes are the best choice if you do not want to face the hurdles of setting up K8s from scratch Unless you want to deep learn Kubernetes.

AWS a market leader in Cloud Infrastructure as a service has a perfectly tailored solution for Kubernetes" />
<meta property="og:url" content="https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/" />
<meta property="og:site_name" content="Middleware Inventory" />
<meta property="og:image" content="../../wp-content/uploads/2022/02/aws-eks-karpenter.jpg" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:description" content="Kubernetes has been a disruptive change in IT Infrastructure. It had been widely adopted across the industry

Managed Kubernetes are the best choice if you do not want to face the hurdles of setting up K8s from scratch Unless you want to deep learn Kubernetes.

AWS a market leader in Cloud Infrastructure as a service has a perfectly tailored solution for Kubernetes" />
<meta name="twitter:title" content="Creating EKS Cluster with Karpenter Auto scaling &#8211; Terraform | Kubernetes - Middleware Inventory" />
<meta property="twitter:image" content="../../wp-content/uploads/2022/02/aws-eks-karpenter.jpg" />
<style type='text/css'>.rp4wp-related-posts ul{width:100%;padding:0;margin:0;float:left;}
.rp4wp-related-posts ul>li{list-style:none;padding:0;margin:0;padding-bottom:20px;clear:both;}
.rp4wp-related-posts ul>li>p{margin:0;padding:0;}
.rp4wp-related-post-image{width:35%;padding-right:25px;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;float:left;}</style>
<noscript><style>.lazyload[data-src]{display:none !important;}</style></noscript><style type="text/css" id="sns_global_styles">/* for mobile */
@media screen and (max-width: 480px) {
    #text-23 {
        display:none !important;
    }
	p,li
    {
      font-size: 20px !important;
      color: #333 !important;
      line-height: 1.68 !important;;
    }
    .article-inner
    {
    	padding-right: 5% !important;
    	padding-left: 5% !important;
    }
    ul.related_post li
    {
    	width: 100% !important;
    }
    ul.related_post li a
    {
    	font-size: 20px !important;
    }
    ul.related_post li small {
    font-size: 100%;
    }
  
  #afc_sidebar_4348 
{
  height: 8vh; 
  max-height: 8vh; 
  background-color: transparent;
}
}

/* for Desktop */
@media screen and (min-width: 500px) {
#afc_sidebar_4348 
{
  height: 10vh; 
  max-height: 10vh; 
  background-color: transparent;
}
  #text-23 {
        display:none !important;
    }
	p,li
    {
        font-size: 20px !important;
        color: #333 !important;
        line-height: 1.68 !important;;
    }
    .article-inner
    {
    	padding-right: 5% !important;
    	padding-left: 5% !important;
    }
    ul.related_post li
    {
    	width: 100% !important;
    }
    ul.related_post li small {
    font-size: 100%;
    }
  

}

.es_lablebox {
    padding-bottom: 3px;
    color: steelblue !important;
    font-weight: bold !important;
}
.widget-title span {
    line-height: 2.2;
    color: steelblue !important;
}
.sidey {
	padding: 0;
}
.sumome-contactform 
{
  display: none;
}
code { 
    font-family: courier;
    font-size: 18px;
    padding: 2px;
    background-color: #f1f1f1;
    /*box-shadow: 0 2px 4px 0 rgba(0,0,0,0.16),0 2px 10px 0 rgba(0,0,0,0.12)!important;*/
    
}

.syntaxhighlighter {
    font-size: 14px !important;
}

pre {
 font-family: Menlo, Monaco, Consolas, "Courier New", monospace !important;
}

.black-red-border
{
    border-left: 3px solid;
    background-color: black;
    color: ghostwhite;
    border-left-color: red;
} 
}

#wpdevar_comment_1 span
{
  font-family:  "Open Sans", Helvetica, Arial, sans-serif !important;
  font-size: 20px !important;
  color: #1495b5 !important;
}

#wpdevar_comment_1 
{
  margin-top: 50px;
  margin-bottom: 30px;
}

summary
{
 color: steelblue; 
}

blockquote
{
  border-left-color: #cc0f77 !important;
  border-left-width: 4px !important;
  border-left-style: solid !important;
  background-color: #f5f5f5 !important;
}

.rp4wp-related-post-image{ width: auto !important; }

.main-navigation-menu
{
  float: none !important;
}

.primary-navigation
{
  float: none !important
}

body,html{
  /* font-family: 'Poppins', sans-serif; */
  font-family: "Source Sans Pro","Arial",sans-serif
}

.page-title, .entry-title, .site-title, .main-navigation-menu a, .widget-title
{
  /*font-family: 'Poppins', sans-serif; */
  font-family: "Source Sans Pro","Arial",sans-serif
}

#postfollow {
  background: whitesmoke;
  padding-top: 5%;
  padding-bottom: 5%;
  padding-left: 2%;
}
div#ez-toc-container p.ez-toc-title {
    font-weight: bold;
    font-size: 24px !important;
}
div#ez-toc-container {
    margin-bottom: 15%;
}

</style><link rel="icon" href="../../wp-content/uploads/2017/12/cropped-Screen-Shot-2017-12-22-at-12.16.54-PM-3-32x32.png" sizes="32x32" />
<link rel="icon" href="../../wp-content/uploads/2017/12/cropped-Screen-Shot-2017-12-22-at-12.16.54-PM-3-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="../../wp-content/uploads/2017/12/cropped-Screen-Shot-2017-12-22-at-12.16.54-PM-3-180x180.png" />
<meta name="msapplication-TileImage" content="https://www.middlewareinventory.com/wp-content/uploads/2017/12/cropped-Screen-Shot-2017-12-22-at-12.16.54-PM-3-270x270.png" />
<style type="text/css">article h3
{
    background-color: whitesmoke;
    color: black;
    padding-left: 1%;
    border-left: 10px solid black;
    font-weight: 400;
    font-size: 22px;
}
#precode
{
  background-color: transparent !important;
  color: #00193a !important;
  font-size: 16px;
}
.post-img
{
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
  border: 1px solid lightgray;
}
article h2
{
    background-color: #29558c;
    color: white;
    padding-left: 1%;
    border-left: 15px solid crimson;
    font-weight: 400;
    font-size: 22px;
}
pre
{
  display: block; 
  overflow-x: auto; 
  padding-left: 2em;
  padding-top: 3em;
  padding-bottom: 3em;
  background: #eaeef3 none repeat scroll 0% 0%; 
  color: #00193a;
}
li {
    padding: 2px;
    margin-left: 2%;
}
code
{
  color: black;
}
blockquote {
    padding: 2%;
    background-color: none !important;
}
div.enlighter{
  font-size: 1.2em;  
}
.enlighter-default {
    font-family: Menlo, Monaco, Consolas, "Courier New", monospace !important;
}
</style>
<style type="text/css" id="wp-custom-css">.site-title
{
   font-size: 24px !important;
}		</style>
</head>
<body class="post-template-default single single-post postid-7891 single-format-standard wp-custom-logo cookies-not-set elementor-default">
<div id="page" class="hfeed site">
<a class="skip-link screen-reader-text" href="#content">Skip to content</a>
<div id="header-top" class="header-bar-wrap"></div>
<header id="masthead" class="site-header clearfix" role="banner">
<div class="header-main container clearfix">
<div id="logo" class="site-branding clearfix">
<a href="../../index.html" class="custom-logo-link" rel="home"><img width="300" height="107" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 107'%3E%3C/svg%3E" class="custom-logo lazyload" alt="Middleware Inventory" data-src="../../wp-content/uploads/2020/09/cropped-Screenshot-2020-09-18-at-3.49.40-AM.jpg" loading="lazy" /><noscript><img width="300" height="107" src="../../wp-content/uploads/2020/09/cropped-Screenshot-2020-09-18-at-3.49.40-AM.jpg" class="custom-logo" alt="Middleware Inventory" data-eio="l" /></noscript></a>
<p class="site-title"></p>
</div>
<nav id="main-navigation" class="primary-navigation navigation clearfix" role="navigation">
<ul id="menu-primary-menu" class="main-navigation-menu"><li id="menu-item-172" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-172"><a href="https://airdata.github.io/">About Me</a></li>
<li id="menu-item-3206" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-3206"><a href="../category/middleware/index.html">Middleware</a>
<ul class="sub-menu">
<li id="menu-item-1518" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1518"><a href="../category/weblogic/index.html">weblogic</a></li>
<li id="menu-item-3207" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3207"><a href="../category/was/index.html">WAS</a></li>
<li id="menu-item-3208" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3208"><a href="../category/websphere/index.html">Websphere</a></li>
<li id="menu-item-3209" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3209"><a href="../category/wlst/index.html">wlst</a></li>
<li id="menu-item-3210" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3210"><a href="../category/wsadmin-scripts/index.html">wsadmin scripts</a></li>
<li id="menu-item-3211" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3211"><a href="../category/jms/index.html">JMS</a></li>
<li id="menu-item-3212" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3212"><a href="../category/activemq/index.html">ActiveMQ</a></li>
<li id="menu-item-3213" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3213"><a href="../category/troubleshooting/index.html">Troubleshooting</a></li>
<li id="menu-item-3214" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3214"><a href="../category/apache/index.html">Apache</a></li>
<li id="menu-item-3215" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3215"><a href="../category/best-practice/index.html">Best Practice</a></li>
<li id="menu-item-3222" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3222"><a href="../category/f5-big-ip/index.html">F5-Big-IP</a></li>
</ul>
</li>
<li id="menu-item-3157" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-3157"><a href="../../devops-junction/index.html">Devops</a>
<ul class="sub-menu">
<li id="menu-item-1513" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1513"><a href="../category/ansible/index.html">Ansible</a></li>
<li id="menu-item-3216" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-3216"><a href="../category/aws/index.html">AWS</a></li>
<li id="menu-item-3217" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3217"><a href="../category/docker/index.html">Docker</a></li>
<li id="menu-item-3218" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3218"><a href="../category/packer/index.html">Packer</a></li>
<li id="menu-item-3219" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3219"><a href="../category/splunk/index.html">Splunk</a></li>
<li id="menu-item-3220" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3220"><a href="../category/terraform/index.html">Terraform</a></li>
<li id="menu-item-3221" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3221"><a href="../category/vagrant/index.html">Vagrant</a></li>
<li id="menu-item-3223" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-3223"><a href="../category/kubernetes/index.html">Kubernetes</a></li>
</ul>
</li>
<li id="menu-item-8820" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8820"><a href="../../newsletter/index.html">Newsletter</a></li>
<li id="menu-item-8821" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8821"><a href="https://rumen.free.bg/#contact">Book a Consultation</a></li>
</ul> </nav>
</div>
</header>
<div id="content" class="site-content container clearfix">
<section id="primary" class="content-area">
<main id="main" class="site-main" role="main">

<article id="post-7891" class="post-7891 post type-post status-publish format-standard has-post-thumbnail hentry category-aws category-kubernetes wpautop">
<header class="entry-header">
<h1 class="entry-title">Creating EKS Cluster with Karpenter Auto scaling &#8211; Terraform | Kubernetes</h1>
<div class="entry-meta"><span class="meta-date"> Updated on: <a href="index.html" title="4:06 am" rel="bookmark"><time class="entry-date published updated" datetime="April 3, 2022">April 3, 2022</time></a></span><span class="meta-author"> <span class="author vcard"><a class="url fn n" href="../author/admin/index.html" title="View all posts by Rumen Lishkov" rel="author">Rumen Lishkov</a></span></span></div>
</header>
<div class="entry-content clearfix">
<div class="ss-inline-share-wrapper ss-left-inline-content ss-small-icons ss-with-spacing ss-rounded-icons">
<div class="ss-inline-share-content">
<ul class="ss-social-icons-container">
<li class="">
<a href="#" data-ss-ss-link="https://www.facebook.com/sharer.php?t=Creating%20EKS%20Cluster%20with%20Karpenter%20Auto%20scaling%20%E2%80%93%20Terraform%20%7C%20Kubernetes&u=https%3A%2F%2Fwww.middlewareinventory.com%2Fblog%2Fcreating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes%2F" class="ss-facebook-color" rel="nofollow" data-ss-ss-network-id="facebook" data-ss-ss-post-id="7891" data-ss-ss-location="inline_content" data-ss-ss-permalink="https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/" data-ss-ss-type="share" data-has-api="true">
<span class="ss-share-network-content">
<i class="ss ss-facebook"></i>
<span class="ss-network-count">
0
</span>
</span>
</a>
</li>
<li class="">
<a href="#" data-ss-ss-link="https://twitter.com/intent/tweet?text=Creating+EKS+Cluster+with+Karpenter+Auto+scaling+%E2%80%93+Terraform+%7C+Kubernetes&url=https%3A%2F%2Fwww.middlewareinventory.com%2Fblog%2Fcreating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes%2F" class="ss-twitter-color" rel="nofollow" data-ss-ss-network-id="twitter" data-ss-ss-post-id="7891" data-ss-ss-location="inline_content" data-ss-ss-permalink="https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/" data-ss-ss-type="share">
<span class="ss-share-network-content">
<i class="ss ss-twitter"></i>
</span>
</a>
</li>
<li class="">

<a href="#" data-ss-ss-link="https://www.linkedin.com/shareArticle?title=Creating%20EKS%20Cluster%20with%20Karpenter%20Auto%20scaling%20%E2%80%93%20Terraform%20%7C%20Kubernetes&url=https%3A%2F%2Fwww.middlewareinventory.com%2Fblog%2Fcreating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes%2F&mini=true" class="ss-linkedin-color" rel="nofollow" data-ss-ss-network-id="linkedin" data-ss-ss-post-id="7891" data-ss-ss-location="inline_content" data-ss-ss-permalink="https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/" data-ss-ss-type="share">
<span class="ss-share-network-content">
<i class="ss ss-linkedin"></i>
</span>
</a>
</li>
<li class="">
<a href="#" data-ss-ss-link="mailto:?body=https%3A%2F%2Fwww.middlewareinventory.com%2Fblog%2Fcreating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes%2F&subject=Creating%20EKS%20Cluster%20with%20Karpenter%20Auto%20scaling%20%E2%80%93%20Terraform%20%7C%20Kubernetes" class="ss-envelope-color" rel="nofollow" data-ss-ss-network-id="envelope" data-ss-ss-post-id="7891" data-ss-ss-location="inline_content" data-ss-ss-permalink="https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/" data-ss-ss-type="share">
<span class="ss-share-network-content">
<i class="ss ss-envelope"></i>
</span>
</a>
</li>
<li class="">
<a href="#" data-ss-ss-link="#" class="ss-copy-color" rel="nofollow" data-ss-ss-network-id="copy" data-ss-ss-post-id="7891" data-ss-ss-location="inline_content" data-ss-ss-permalink="https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/" data-ss-ss-type="share">
<span class="ss-share-network-content">
<i class="ss ss-copy"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<p>Kubernetes has been a disruptive change in IT Infrastructure. It had been widely adopted across the industry</p>
<p>Managed Kubernetes are the best choice if you do not want to face the hurdles of setting up K8s from scratch Unless you want to deep learn Kubernetes.</p>
<p>AWS a market leader in Cloud Infrastructure as a service has a perfectly tailored solution for Kubernetes called EKS &#8211; Elastic Kubernetes Services.</p>
<p>Creating EKS Cluster is an easy task and they provide special command-line tools like <code>eksctl</code> to create and manage EKS effortlessly</p>
<p>But Can we create EKS Clusters with <code>eksctl</code> commands for production? What if we want to automate it and customize it and add some IAC(infrastructure as code) standards to it.</p>
<p>When we talk about Infrastructure implementation and automation. Terraform is undeniably a leader and best for multi-cloud solutions and platform-agnostic solutions.</p>
<p>In this article, we are going to see how to create <strong>EKS Cluste</strong>r with <strong>Terraform</strong> with built-in <strong>Karpenter</strong> auto-scaling capability</p>
<p><a href="../../wp-content/uploads/2022/02/aws-eks-karpenter.jpg"><img class="post-img alignnone wp-image-8126 size-full lazyload" src="../../wp-content/ewww/lazy/placeholder-1748x1240.png" alt="EKS Karpenter Example" width="1748" height="1240" data-src="../../wp-content/uploads/2022/02/aws-eks-karpenter.jpg" loading="lazy" data-srcset="../../wp-content/uploads/2022/02/aws-eks-karpenter.jpg 1748w, ../../wp-content/uploads/2022/02/aws-eks-karpenter-300x213.jpg 300w, ../../wp-content/uploads/2022/02/aws-eks-karpenter-1024x726.jpg 1024w, ../../wp-content/uploads/2022/02/aws-eks-karpenter-768x545.jpg 768w, ../../wp-content/uploads/2022/02/aws-eks-karpenter-1536x1090.jpg 1536w, ../../wp-content/uploads/2022/02/aws-eks-karpenter-90x65.jpg 90w" data-sizes="auto" /><noscript><img class="post-img alignnone wp-image-8126 size-full" src="../../wp-content/uploads/2022/02/aws-eks-karpenter.jpg" alt="EKS Karpenter Example" width="1748" height="1240" srcset="../../wp-content/uploads/2022/02/aws-eks-karpenter.jpg 1748w, ../../wp-content/uploads/2022/02/aws-eks-karpenter-300x213.jpg 300w, ../../wp-content/uploads/2022/02/aws-eks-karpenter-1024x726.jpg 1024w, ../../wp-content/uploads/2022/02/aws-eks-karpenter-768x545.jpg 768w, ../../wp-content/uploads/2022/02/aws-eks-karpenter-1536x1090.jpg 1536w, ../../wp-content/uploads/2022/02/aws-eks-karpenter-90x65.jpg 90w" sizes="(max-width: 1748px) 100vw, 1748px" data-eio="l" /></noscript></a></p>
<div id="ez-toc-container" class="counter-hierarchy counter-decimal ez-toc-grey">
<div class="ez-toc-title-container">
<p class="ez-toc-title">Table of Contents</p>
<span class="ez-toc-title-toggle"><a class="ez-toc-pull-right ez-toc-btn ez-toc-btn-xs ez-toc-btn-default ez-toc-toggle"><i class="ez-toc-glyphicon ez-toc-icon-toggle"></i></a></span></div>
<nav><ul class="ez-toc-list"><li><a href="#So_what_is_Karpenter" title="So what is Karpenter">So what is Karpenter</a></li><li><a href="#Prerequisites" title="Prerequisites">Prerequisites</a></li><li><a href="#Configuring_Terraform_Workspace" title="Configuring Terraform Workspace">Configuring Terraform Workspace</a><ul><li><a href="#Set_Environment_variables" title="Set Environment variables">Set Environment variables</a></li><li><a href="#Create_Terraform_files" title="Create Terraform files">Create Terraform files</a></li></ul></li><li><a href="#Terraform_init_and_apply_Creating_EKS" title="Terraform init and apply &#8211; Creating EKS">Terraform init and apply &#8211; Creating EKS</a></li><li><a href="#Creating_Karpenter_Controller_IAM_Role" title="Creating Karpenter Controller IAM Role">Creating Karpenter Controller IAM Role</a></li><li><a href="#Installing_Karpenter_to_EKS_with_Helm_and_Terraform" title="Installing Karpenter to EKS with Helm and Terraform.">Installing Karpenter to EKS with Helm and Terraform.</a><ul><li><a href="#Enable_Spot_instances_in_your_AWS_Account_If_not_used_spot_instances_before" title="Enable Spot instances in your AWS Account ( If not used spot instances before )">Enable Spot instances in your AWS Account ( If not used spot instances before )</a></li></ul></li><li><a href="#Re-initialize_Terraform_and_apply" title="Re-initialize Terraform and apply">Re-initialize Terraform and apply</a></li><li><a href="#Connect_to_your_EKS_using_Kubectl_and_Validate_Karpenter" title="Connect to your EKS using Kubectl and Validate Karpenter">Connect to your EKS using Kubectl and Validate Karpenter</a></li><li><a href="#Deploying_the_Provisioner" title="Deploying the Provisioner">Deploying the Provisioner</a></li><li><a href="#Listing_the_Subnets_and_Security_Groups_by_Tag_to_Validate" title="Listing the Subnets and Security Groups by Tag &#8211; to Validate">Listing the Subnets and Security Groups by Tag &#8211; to Validate</a></li><li><a href="#Now_deploy_an_application_to_EKS_Cluster" title="Now deploy an application to EKS Cluster">Now deploy an application to EKS Cluster</a></li><li><a href="#Scale_our_Deployment_and_Test_the_Karpenter" title="Scale our Deployment and Test the Karpenter">Scale our Deployment and Test the Karpenter</a></li><li><a href="#Conclusion" title="Conclusion">Conclusion</a></li></ul></nav></div>
<h2><span class="ez-toc-section" id="So_what_is_Karpenter"><strong>So what is Karpenter</strong></span></h2>
<p>Karpenter is a cluster auto scaler that takes care of scaling up and down worker nodes in your cluster for AWS EKS. As of Feb 2022 only AWS is supported by Karpenter</p>
<p>It takes care of Compute provisioning for your EKS cluster and enables you to add <code>on-demand</code> and <code>spot</code> instances to your cluster.</p>
<p>If you have exposure to EKS world or any managed Kubernetes, you might have used another product named <a href="https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler"><code>cluster autoscaler</code></a> for the same purpose</p>
<p>While the cluster autoscaler had been solving the purpose and widely accepted. Karpenter comes with various best things to offer.</p>
<p>Here are some of the key items, I can say Karpenter is doing great</p>
<ul>
<li>Creating the right capacity or the computing power based on the number of pods and resources they need. For example. If two pods are pending it can just create <code>t3.medium</code> or small instance automatically. if  twenty pods are pending it can choose the right to compute power like <code>c5.2xlarge</code>  &#8211; Cluster auto scaler cannot do this right.</li>
<li>Implementation of Karpenter is really easy and well documented &#8211; Cluster auto scaler falls behind a little.</li>
<li>Since it adds the right compute power for the job. Karpenter offers a lot of cost-saving compared to the Cluster auto scaler.</li>
</ul>
<p>There are more I can list but these are the ones to be highlighted.</p>
<h2><span class="ez-toc-section" id="Prerequisites"><strong>Prerequisites</strong></span></h2>
<p>You need to install these tools and configure them before proceeding.</p>
<ol>
<li><a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-linux.html">AWS CLI</a></li>
<li><code>kubectl</code> &#8211; <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/">the Kubernetes CLI</a></li>
<li><code>terraform</code> &#8211; <a href="https://learn.hashicorp.com/tutorials/terraform/install-cli">infrastructure-as-code tool made by HashiCorp</a></li>
<li><code>helm</code> &#8211; <a href="https://helm.sh/docs/intro/install/">the package manager for Kubernetes</a></li>
</ol>
<p>Log in to the AWS CLI with a user that has sufficient privileges to create a cluster.</p>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h2><span class="ez-toc-section" id="Configuring_Terraform_Workspace"><strong>Configuring Terraform Workspace</strong></span></h2>
<p>The steps given below are designed for mac/Linux users.  If you are using windows you can use either <a href="https://docs.microsoft.com/en-us/windows/wsl/install">Windows Subsystem for Linux</a> or <code>git bash</code> to be able to run these bash commands.</p>
<h3><span class="ez-toc-section" id="Set_Environment_variables">Set Environment variables</span></h3>
<p>Before starting up, we need to set some environment variables like <code>CLUSTER_NAME</code></p>
<pre>export CLUSTER_NAME=gritfy-eks-karpenter</pre>
<p>AWS CLI is powering our authentication needed for Terraform to access the AWS account and to create Terraform.</p>
<p>So you can set the following variables according to your requirement</p>
<pre>export AWS_DEFAULT_REGION=us-east-2
export AWS_DEFAULT_PROFILE=personal</pre>
<p>If you want to use the same default region configured during the <code>aws configure</code> this may not be needed.</p>
<p>The <code>AWS_DEFAULT_PROFILE</code> is to let terraform know which AWS CLI profile to use for authentication and to connect.  This is needed if you are having multiple <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-profiles.html">AWS Named profiles</a></p>
<p>&nbsp;</p>
<h3><span class="ez-toc-section" id="Create_Terraform_files">Create Terraform files</span></h3>
<p>Create a new directory as a workspace and copy the following <code>.tf</code> files</p>
<p><strong>Variables.tf file</strong></p>
<p>Create a new file named <code>variables.tf</code> and copy the following content to the file</p>
<p>this is to define the variables, that are needed for the project. In case no value is provided, it would prompt during the runtime</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">variable "cluster_name" {
  description = "The name of the cluster"
  type        = string
}</pre>
<p>we can put default values for the variables by using <code>tfvars</code> file but we are not doing that here.</p>
<p>&nbsp;</p>
<p><strong>The main.tf file</strong></p>
<p>Create a new file named <code>main.tf</code>and copy the following content into that file.</p>
<p>It does three things.</p>
<ol>
<li>Creates a  <code>vpc</code> with subnets and the cluster-name would be used as a vpc name.</li>
<li>Creating a Kubernetes cluster using <code>eks</code> module. A version of the cluster is defined as <code>1.21</code></li>
<li>Instance profile creation with policy attachment. It creates a new instance profile in this format <code>KarpenterNodeInstanceProfile-{cluster-name}</code></li>
</ol>
<pre class="EnlighterJSRAW" data-enlighter-language="json" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">module "vpc" {
  source = "terraform-aws-modules/vpc/aws"

  name = var.cluster_name
  cidr = "10.0.0.0/16"

  azs             = ["us-east-2a", "us-east-2b", "us-east-2c"]
  private_subnets = ["10.0.1.0/24", "10.0.2.0/24", "10.0.3.0/24"]
  public_subnets  = ["10.0.101.0/24", "10.0.102.0/24", "10.0.103.0/24"]

  enable_nat_gateway     = true
  single_nat_gateway     = true
  one_nat_gateway_per_az = false

  private_subnet_tags = {
    "kubernetes.io/cluster/${var.cluster_name}" = "owned"
    "karpenter.sh/discovery" = var.cluster_name
  }
}

module "eks" {
  source          = "terraform-aws-modules/eks/aws"
  version         = "&lt;18"

  cluster_version = "1.21"
  cluster_name    = var.cluster_name
  vpc_id          = module.vpc.vpc_id
  subnets         = module.vpc.private_subnets
  enable_irsa     = true

  # Only need one node to get Karpenter up and running
  worker_groups = [
    {
      instance_type = "t3a.medium"
      asg_max_size  = 1
    }
  ]

  tags = {
    "karpenter.sh/discovery" = var.cluster_name
  }
}

# Instance Profile

data "aws_iam_policy" "ssm_managed_instance" {
  arn = "arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore"
}

resource "aws_iam_role_policy_attachment" "karpenter_ssm_policy" {
  role       = module.eks.worker_iam_role_name
  policy_arn = data.aws_iam_policy.ssm_managed_instance.arn
}

resource "aws_iam_instance_profile" "karpenter" {
  name = "KarpenterNodeInstanceProfile-${var.cluster_name}"
  role = module.eks.worker_iam_role_name
}
</pre>
<p><strong>The providers.tf file</strong></p>
<p>To configure the <code>aws</code> provider right and to define the region and the profile to be used.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="json" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">provider "aws" {
  region = "us-east-2"
  profile = "personal"
}</pre>
<p>&nbsp;</p>
<h2><span class="ez-toc-section" id="Terraform_init_and_apply_Creating_EKS">Terraform init and apply &#8211; Creating EKS</span></h2>
<p>Now we have all the files copied in place, now it&#8217;s time to initialize terraform and apply our configuration.</p>
<p>At this point, we assume your directory looks like this</p>
<pre>Karpenter-test|⇒ ls -rlt
total 40
-rw-r--r-- 1 sarav staff 1497 Feb 6 20:03 main.tf
-rw-r--r-- 1 sarav staff 692 Feb 6 20:03 helm.tf
-rw-r--r-- 1 sarav staff 1289 Feb 6 20:03 irsa.tf
-rw-r--r-- 1 sarav staff 92 Feb 6 20:03 variables.tf
-rw-r--r-- 1 sarav staff 64 Feb 6 20:03 providers.tf</pre>
<p>Run <code>terraform init</code></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">Karpenter-test|⇒ terraform init
Initializing modules...
Downloading terraform-aws-modules/eks/aws 17.24.0 for eks...
- eks in .terraform/modules/eks
- eks.fargate in .terraform/modules/eks/modules/fargate
- eks.node_groups in .terraform/modules/eks/modules/node_groups
Downloading terraform-aws-modules/iam/aws 4.7.0 for iam_assumable_role_karpenter...
- iam_assumable_role_karpenter in .terraform/modules/iam_assumable_role_karpenter/modules/iam-assumable-role-with-oidc
Downloading terraform-aws-modules/vpc/aws 3.11.5 for vpc...
- vpc in .terraform/modules/vpc

Initializing the backend...

Initializing provider plugins...
- Finding hashicorp/kubernetes versions matching "&gt;= 1.11.1"...
- Finding hashicorp/cloudinit versions matching "&gt;= 2.0.0"...
- Finding terraform-aws-modules/http versions matching "&gt;= 2.4.1"...
- Finding latest version of hashicorp/helm...
- Finding hashicorp/aws versions matching "&gt;= 2.23.0, &gt;= 3.56.0, &gt;= 3.63.0"...
- Finding hashicorp/local versions matching "&gt;= 1.4.0"...
- Installing hashicorp/kubernetes v2.7.1...
- Installed hashicorp/kubernetes v2.7.1 (signed by HashiCorp)
- Installing hashicorp/cloudinit v2.2.0...
- Installed hashicorp/cloudinit v2.2.0 (signed by HashiCorp)
- Installing terraform-aws-modules/http v2.4.1...
- Installed terraform-aws-modules/http v2.4.1 (self-signed, key ID B2C1C0641B6B0EB7)
- Installing hashicorp/helm v2.4.1...
- Installed hashicorp/helm v2.4.1 (signed by HashiCorp)
- Installing hashicorp/aws v3.74.0...
- Installed hashicorp/aws v3.74.0 (signed by HashiCorp)
- Installing hashicorp/local v2.1.0...
- Installed hashicorp/local v2.1.0 (signed by HashiCorp)

Partner and community providers are signed by their developers.
If you'd like to know more about provider signing, you can read about it here:
https://www.terraform.io/docs/cli/plugins/signing.html

Terraform has created a lock file .terraform.lock.hcl to record the provider
selections it made above. Include this file in your version control repository
so that Terraform can guarantee to make the same selections by default when
you run "terraform init" in the future.

Terraform has been successfully initialized!

You may now begin working with Terraform. Try running "terraform plan" to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.</pre>
<p>Run <code>terraform apply</code> with <code>$CLUSTER_NAME</code></p>
<pre>terraform apply -var cluster_name=$CLUSTER_NAME</pre>
<p><script id="asciicast-za3MUn14UkCOoaebmXGarc6BJ" src="https://asciinema.org/a/za3MUn14UkCOoaebmXGarc6BJ.js" async></script></p>
<p>You might probably get the following error</p>
<p><a href="../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.11.44-PM.png"><img class="post-img alignnone wp-image-8098 size-full lazyload" src="../../wp-content/ewww/lazy/placeholder-1920x400.png" alt="Terraform aws_auth error" width="3840" height="800" data-src="../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.11.44-PM.png" loading="lazy" data-srcset="../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.11.44-PM.png 3840w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.11.44-PM-300x63.png 300w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.11.44-PM-1024x213.png 1024w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.11.44-PM-768x160.png 768w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.11.44-PM-1536x320.png 1536w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.11.44-PM-2048x427.png 2048w" data-sizes="auto" /><noscript><img class="post-img alignnone wp-image-8098 size-full" src="../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.11.44-PM.png" alt="Terraform aws_auth error" width="3840" height="800" srcset="../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.11.44-PM.png 3840w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.11.44-PM-300x63.png 300w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.11.44-PM-1024x213.png 1024w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.11.44-PM-768x160.png 768w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.11.44-PM-1536x320.png 1536w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.11.44-PM-2048x427.png 2048w" sizes="(max-width: 3840px) 100vw, 3840px" data-eio="l" /></noscript></a></p>
<p>This is because of authorization. you can resolve it by setting an environment variable.</p>
<p>The <code>Kubeconfig</code> file should have been created already on the current directory with the cluster name. <code>kubeconfig_{cluster-name}</code></p>
<p><a href="../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.14.30-PM.png"><img class="post-img alignnone wp-image-8099 size-full lazyload" src="../../wp-content/ewww/lazy/placeholder-1920x339.png" alt="Terraform list" width="2276" height="402" data-src="../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.14.30-PM.png" loading="lazy" data-srcset="../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.14.30-PM.png 2276w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.14.30-PM-300x53.png 300w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.14.30-PM-1024x181.png 1024w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.14.30-PM-768x136.png 768w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.14.30-PM-1536x271.png 1536w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.14.30-PM-2048x362.png 2048w" data-sizes="auto" /><noscript><img class="post-img alignnone wp-image-8099 size-full" src="../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.14.30-PM.png" alt="Terraform list" width="2276" height="402" srcset="../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.14.30-PM.png 2276w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.14.30-PM-300x53.png 300w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.14.30-PM-1024x181.png 1024w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.14.30-PM-768x136.png 768w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.14.30-PM-1536x271.png 1536w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-06-at-9.14.30-PM-2048x362.png 2048w" sizes="(max-width: 2276px) 100vw, 2276px" data-eio="l" /></noscript></a></p>
<p>You need to update your <code>KUBECONFIG</code>variable to refer to this file along with <code>KUBE_CONFIG_PATH</code>variable.</p>
<pre>⇒ export KUBECONFIG=${PWD}/kubeconfig_${CLUSTER_NAME}
⇒ export KUBE_CONFIG_PATH=$KUBECONFIG</pre>
<p>After doing this. you can retry and it would be successful this time</p>
<p><script id="asciicast-jHXJNsJjnMf6QYKWaQu0gNQqg" src="https://asciinema.org/a/jHXJNsJjnMf6QYKWaQu0gNQqg.js" async></script></p>
<p>Now we have the cluster ready. Now we need to install Karpenter in this EKS Cluster.</p>
<p>Before we can install the Karpenter using the helm chart, we need to do Create an IAM role to give necessary access to Karpenter for managing the nodes like launching nodes, terminating nodes etc.</p>
<h2><span class="ez-toc-section" id="Creating_Karpenter_Controller_IAM_Role">Creating Karpenter Controller IAM Role</span></h2>
<p>In the same workspace directory, create a new file named <code>irsa.tf</code> and paste the following config</p>
<p>This terraform config does the following things</p>
<ul>
<li>Creating an AWS IAM Role</li>
<li>Attaching a policy</li>
<li>Authorizing the Service Account to assume the role &#8211; <a href="https://docs.aws.amazon.com/emr/latest/EMR-on-EKS-DevelopmentGuide/setting-up-enable-IAM.html">IRSA</a>.( <span style="color: #993300;">I</span>AM <span style="color: #993300;">R</span>oles for <span style="color: #993300;">S</span>ervice <span style="color: #993300;">A</span>ccounts)</li>
</ul>
<p>We will create the ServiceAccount and connect it to this role during the Helm chart install.</p>
<p>Now we are creating an IAM role <code>karpenter-policy-${var.cluster_name}</code>its an assumable role will later be associated with EKS Service Account using IRSA principle</p>
<p><strong>irsa.tf</strong></p>
<pre class="EnlighterJSRAW" data-enlighter-language="json" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">module "iam_assumable_role_karpenter" {
  source                        = "terraform-aws-modules/iam/aws//modules/iam-assumable-role-with-oidc"
  version                       = "4.7.0"
  create_role                   = true
  role_name                     = "karpenter-controller-${var.cluster_name}"
  provider_url                  = module.eks.cluster_oidc_issuer_url
  oidc_fully_qualified_subjects = ["system:serviceaccount:karpenter:karpenter"]
}

resource "aws_iam_role_policy" "karpenter_controller" {
  name = "karpenter-policy-${var.cluster_name}"
  role = module.iam_assumable_role_karpenter.iam_role_name

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Action = [
          "ec2:CreateLaunchTemplate",
          "ec2:CreateFleet",
          "ec2:RunInstances",
          "ec2:CreateTags",
          "iam:PassRole",
          "ec2:TerminateInstances",
          "ec2:DescribeLaunchTemplates",
          "ec2:DescribeInstances",
          "ec2:DescribeSecurityGroups",
          "ec2:DescribeSubnets",
          "ec2:DescribeInstanceTypes",
          "ec2:DescribeInstanceTypeOfferings",
          "ec2:DescribeAvailabilityZones",
          "ssm:GetParameter"
        ]
        Effect   = "Allow"
        Resource = "*"
      },
    ]
  })
}</pre>
<p>Now we have a terraform config file for the Karpenter controller IAM role.  Let us add one more config file to take care of the karpenter installation using helm.</p>
<h2></h2>
<h2><span class="ez-toc-section" id="Installing_Karpenter_to_EKS_with_Helm_and_Terraform">Installing Karpenter to EKS with Helm and Terraform.</span></h2>
<p>using <code>helm_release</code> resource of terraform we are going to release/install karpenter to our cluster.</p>
<p>we are also configuring the following variable to let Karpenter know the IAM role that it can assume</p>
<pre>serviceAccount.annotations.eks.amazonaws.com/role-arn</pre>
<p>For this variable, we will be passing the IAM role we have craeted in the <code>irsa.tf</code> config file</p>
<pre>module.iam_assumable_role_karpenter.iam_role_arn</pre>
<p>&nbsp;</p>
<p>Now, Copy the following config and save it as <code>helm.tf</code> in our workspace directory we have been using so far</p>
<p><strong>helm.tf</strong></p>
<pre class="EnlighterJSRAW" data-enlighter-language="json" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">resource "helm_release" "karpenter" {
  depends_on       = [module.eks.kubeconfig]
  namespace        = "karpenter"
  create_namespace = true

  name       = "karpenter"
  repository = "https://charts.karpenter.sh"
  chart      = "karpenter"
  version    = "v0.6.0"

  set {
    name  = "serviceAccount.annotations.eks\\.amazonaws\\.com/role-arn"
    value = module.iam_assumable_role_karpenter.iam_role_arn
  }

  set {
    name  = "controller.clusterName"
    value = var.cluster_name
  }

  set {
    name  = "controller.clusterEndpoint"
    value = module.eks.cluster_endpoint
  }

  set {
    name  = "aws.defaultInstanceProfile"
    value = aws_iam_instance_profile.karpenter.name
  }
}</pre>
<p>&nbsp;</p>
<p>so far we have added two files named <code>irsa.tf</code> and <code>helm.tf</code> Now your directory should look something like this</p>
<p><a href="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-1.41.59-AM.png"><img class="alignnone size-full wp-image-8108 lazyload" src="../../wp-content/ewww/lazy/placeholder-1920x386.png" alt="" width="2160" height="434" data-src="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-1.41.59-AM.png" loading="lazy" data-srcset="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-1.41.59-AM.png 2160w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-1.41.59-AM-300x60.png 300w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-1.41.59-AM-1024x206.png 1024w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-1.41.59-AM-768x154.png 768w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-1.41.59-AM-1536x309.png 1536w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-1.41.59-AM-2048x411.png 2048w" data-sizes="auto" /><noscript><img class="alignnone size-full wp-image-8108" src="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-1.41.59-AM.png" alt="" width="2160" height="434" srcset="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-1.41.59-AM.png 2160w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-1.41.59-AM-300x60.png 300w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-1.41.59-AM-1024x206.png 1024w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-1.41.59-AM-768x154.png 768w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-1.41.59-AM-1536x309.png 1536w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-1.41.59-AM-2048x411.png 2048w" sizes="(max-width: 2160px) 100vw, 2160px" data-eio="l" /></noscript></a></p>
<p>You can see the new files on the top.</p>
<h3><span class="ez-toc-section" id="Enable_Spot_instances_in_your_AWS_Account_If_not_used_spot_instances_before">Enable Spot instances in your AWS Account ( If not used spot instances before )</span></h3>
<p>Before we move on to apply these configuration. you need to enable Spot instance support if you have not used Spot instances in your AWS account before</p>
<pre tabindex="0"><code class="language-bash" data-lang="bash">aws iam create-service-linked-role --aws-service-name spot.amazonaws.com</code></pre>
<p>If the role has already been successfully created, you will see:</p>
<pre>An error occurred (InvalidInput) when calling the CreateServiceLinkedRole operation: 
Service role name AWSServiceRoleForEC2Spot has been taken in this account, 
please try a different suffix.</pre>
<p>&nbsp;</p>
<h2><span class="ez-toc-section" id="Re-initialize_Terraform_and_apply">Re-initialize Terraform and apply</span></h2>
<p>Since we are adding two new modules with these two new configuration files. we need to reinitialize with <code>terraform init</code> on the same workspace</p>
<blockquote><p>Note*: Re-initialize will not do any changes to your EKS Cluster which has been already created. so no worries</p></blockquote>
<p>Now execute the following commands to initialize and apply</p>
<pre>terraform init
terraform apply -var cluster_name=$CLUSTER_NAME</pre>
<p>&nbsp;</p>
<p>Upon Successful, To verify if the IAM role is created fine. you can use the following command. ( we are using <a href="https://stedolan.github.io/jq/"><strong>jq</strong></a> command for filtering. you must have it installed before using it)</p>
<pre>aws iam list-roles --profile personal|jq '.Roles[] | select(.RoleName == "karpenter-controller-gritfy-eks-karpenter")'</pre>
<p>you would see some output like this</p>
<p><a href="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.05.18-AM.png"><img class="post-img alignnone wp-image-8109 size-full lazyload" src="../../wp-content/ewww/lazy/placeholder-1920x740.png" alt="EKS Karpenter" width="2996" height="1154" data-src="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.05.18-AM.png" loading="lazy" data-srcset="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.05.18-AM.png 2996w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.05.18-AM-300x116.png 300w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.05.18-AM-1024x394.png 1024w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.05.18-AM-768x296.png 768w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.05.18-AM-1536x592.png 1536w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.05.18-AM-2048x789.png 2048w" data-sizes="auto" /><noscript><img class="post-img alignnone wp-image-8109 size-full" src="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.05.18-AM.png" alt="EKS Karpenter" width="2996" height="1154" srcset="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.05.18-AM.png 2996w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.05.18-AM-300x116.png 300w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.05.18-AM-1024x394.png 1024w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.05.18-AM-768x296.png 768w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.05.18-AM-1536x592.png 1536w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.05.18-AM-2048x789.png 2048w" sizes="(max-width: 2996px) 100vw, 2996px" data-eio="l" /></noscript></a></p>
<p>&nbsp;</p>
<h2><span class="ez-toc-section" id="Connect_to_your_EKS_using_Kubectl_and_Validate_Karpenter">Connect to your EKS using Kubectl and Validate Karpenter</span></h2>
<p>Since our EKS cluster is ready and the IAM roles are ready.  You should be able to connect to our EKS cluster using kubectl.</p>
<p>since the <code>KUBECONFIG</code> variable is pointing to the current directory the <code>kubectl</code> would be able to use the context and connect to your EKS cluster with no issues</p>
<p><a href="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.13.46-AM.png"><img class="post-img alignnone wp-image-8110 size-full lazyload" src="../../wp-content/ewww/lazy/placeholder-1920x271.png" alt="EKS Karpenter" width="2268" height="320" data-src="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.13.46-AM.png" loading="lazy" data-srcset="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.13.46-AM.png 2268w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.13.46-AM-300x42.png 300w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.13.46-AM-1024x144.png 1024w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.13.46-AM-768x108.png 768w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.13.46-AM-1536x217.png 1536w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.13.46-AM-2048x289.png 2048w" data-sizes="auto" /><noscript><img class="post-img alignnone wp-image-8110 size-full" src="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.13.46-AM.png" alt="EKS Karpenter" width="2268" height="320" srcset="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.13.46-AM.png 2268w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.13.46-AM-300x42.png 300w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.13.46-AM-1024x144.png 1024w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.13.46-AM-768x108.png 768w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.13.46-AM-1536x217.png 1536w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.13.46-AM-2048x289.png 2048w" sizes="(max-width: 2268px) 100vw, 2268px" data-eio="l" /></noscript></a></p>
<p>Since you are able to connect to EKS cluster already. you should also be able to list the helm release and <code>karpenter</code> installed</p>
<p>use the following command to list the helm releases. It should show our karpetner helm release</p>
<pre>helm list --all-namespaces</pre>
<p><a href="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.15.59-AM.png"><img class="post-img alignnone wp-image-8111 size-full lazyload" src="../../wp-content/ewww/lazy/placeholder-1920x96.png" alt="AWS Karpenter" width="2948" height="148" data-src="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.15.59-AM.png" loading="lazy" data-srcset="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.15.59-AM.png 2948w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.15.59-AM-300x15.png 300w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.15.59-AM-1024x51.png 1024w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.15.59-AM-768x39.png 768w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.15.59-AM-1536x77.png 1536w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.15.59-AM-2048x103.png 2048w" data-sizes="auto" /><noscript><img class="post-img alignnone wp-image-8111 size-full" src="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.15.59-AM.png" alt="AWS Karpenter" width="2948" height="148" srcset="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.15.59-AM.png 2948w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.15.59-AM-300x15.png 300w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.15.59-AM-1024x51.png 1024w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.15.59-AM-768x39.png 768w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.15.59-AM-1536x77.png 1536w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.15.59-AM-2048x103.png 2048w" sizes="(max-width: 2948px) 100vw, 2948px" data-eio="l" /></noscript></a></p>
<p>&nbsp;</p>
<h2><span class="ez-toc-section" id="Deploying_the_Provisioner">Deploying the Provisioner</span></h2>
<p><strong>Provisioner </strong>is to instruct the karpenter what type of machines to launch like <code>spot</code> or <code>on-demand</code> etc.</p>
<p>Also to manage the Subnets and the security groups which are necessary for the karpenter to launch the nodes.</p>
<p>A single Karpenter provisioner is capable of handling many different pod shapes. Karpenter makes scheduling and provisioning decisions based on pod attributes such as labels and affinity. In other words, Karpenter eliminates the need to manage many different node groups.</p>
<p>We are going to create a default provisioner. This provisioner configures instances to connect to your cluster’s endpoint and discovers resources like subnets and security groups using the cluster’s name.</p>
<p>We are going with a simple configuration for our provisioner but you can control or extend your provisioner configuration further. <a href="https://karpenter.sh/v0.6.0/provisioner/">refer provisioner api</a></p>
<pre class="EnlighterJSRAW" data-enlighter-language="yaml" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: karpenter.sh/v1alpha5
kind: Provisioner
metadata:
  name: default
spec:
  requirements:
    - key: karpenter.sh/capacity-type
      operator: In
      values: ["spot"]
  limits:
    resources:
      cpu: 1000
  provider:
    subnetSelector:
      karpenter.sh/discovery: ${CLUSTER_NAME}
    securityGroupSelector:
      karpenter.sh/discovery: ${CLUSTER_NAME}
  ttlSecondsAfterEmpty: 30
EOF</pre>
<p>You can execute this command in your current terminal and it would create a new provisioner and name it <code>default</code></p>
<p>As you can see in the configuration, we are using <code>spot</code> instances for our capacity while you can change it to <code>on-demand</code> or use both.</p>
<p>The <code>limits</code> instructs karpenter to create new nodes when the number of CPUs has reached <code>1000</code> this way you can set a max limit of nodes that can be created by Karpenter.</p>
<p>Another important element is the <code>selector</code>this helps the newly added karpenter nodes to choose the right <code>subnets</code>and <code>security groups</code></p>
<p>You need to handle this carefully if you are trying to set up Karpenter in your existing cluster. Sometimes instead of using selector by tags. you can simply go for defining the actual subnets and security groups yourself. ( its an option)</p>
<p>in our case, we are going to choose the subnets and security groups by the tag</p>
<pre> karpenter.sh/discovery: ${CLUSTER_NAME}</pre>
<p>These tags are defined by us in the <code>main.tf</code> file for the VPC and EKS configuration. You can go back and refer to confirm.</p>
<p>&nbsp;</p>
<h2><span class="ez-toc-section" id="Listing_the_Subnets_and_Security_Groups_by_Tag_to_Validate">Listing the Subnets and Security Groups by Tag &#8211; to Validate</span></h2>
<p>You can try to mimic this behaviour and try to list security groups and subnets having this tag using AWS CLI</p>
<pre># To List Security Groups
aws ec2 describe-security-groups --query "SecurityGroups[? Tags[? (Key=='karpenter.sh/discovery') &amp;&amp; (Value=='$CLUSTER_NAME')]].GroupId"

# To list Subnets
aws ec2 describe-subnets --query "Subnets[? Tags[? (Key=='karpenter.sh/discovery') &amp;&amp; (Value=='$CLUSTER_NAME')]].SubnetId"</pre>
<p>Here is the output of these commands at my end</p>
<p><a href="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.59.58-AM.png"><img class="post-img alignnone wp-image-8113 size-full lazyload" src="../../wp-content/ewww/lazy/placeholder-1920x260.png" alt="AWS Karpenter Terraform" width="3424" height="464" data-src="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.59.58-AM.png" loading="lazy" data-srcset="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.59.58-AM.png 3424w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.59.58-AM-300x41.png 300w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.59.58-AM-1024x139.png 1024w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.59.58-AM-768x104.png 768w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.59.58-AM-1536x208.png 1536w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.59.58-AM-2048x278.png 2048w" data-sizes="auto" /><noscript><img class="post-img alignnone wp-image-8113 size-full" src="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.59.58-AM.png" alt="AWS Karpenter Terraform" width="3424" height="464" srcset="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.59.58-AM.png 3424w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.59.58-AM-300x41.png 300w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.59.58-AM-1024x139.png 1024w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.59.58-AM-768x104.png 768w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.59.58-AM-1536x208.png 1536w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-2.59.58-AM-2048x278.png 2048w" sizes="(max-width: 3424px) 100vw, 3424px" data-eio="l" /></noscript></a></p>
<p>&nbsp;</p>
<h2><span class="ez-toc-section" id="Now_deploy_an_application_to_EKS_Cluster">Now deploy an application to EKS Cluster</span></h2>
<p>Till there are no deployments in our cluster. So let us deploy something.</p>
<p>we are going to deploy our famous <code>aksarav/tomcat8</code> image</p>
<p>This image is covered in detail in our previous articles</p>
<ul>
<li><a href="../deploy-tomcat-kubernetes/index.html">Deploying tomcat to Kubernetes</a></li>
<li><a href="../docker-tomcat-example-dockerfile-sample/index.html">Docker Tomcat Example</a></li>
</ul>
<p>Now let us deploy it.</p>
<p>This single line command would do the deployment. ( you can create a deployment manifest too and use <code>kubectl apply -f</code>)</p>
<pre>kubectl create deployment tomcatinfra --image=saravak/tomcat8</pre>
<p>Here is the quick terminal record</p>
<p><script id="asciicast-Zbl6yocovyY5N5wKbXa1kOBck" src="https://asciinema.org/a/Zbl6yocovyY5N5wKbXa1kOBck.js" async></script></p>
<p>As you might have seen in the terminal capture, we deployed and tested the EKS Cluster and tried to scale the deployment and everything works fine.</p>
<p>Now it&#8217;s a time to test <code>Karpenter</code></p>
<p>&nbsp;</p>
<h2><span class="ez-toc-section" id="Scale_our_Deployment_and_Test_the_Karpenter">Scale our Deployment and Test the Karpenter</span></h2>
<p>Now it&#8217;s time to validate, If Karpenter is able to add nodes and auto-scale in case we have pods in <code>pending</code> state and not scheduled due to capacity</p>
<p>Now we are going to scale our <code>tomcatinfra</code> deployment to higher levels to validate and see how <code>Karpenter</code> manages it</p>
<p>After a short time, we will scale it down to see if it brings down the node count</p>
<p>Here is the complete terminal record that shows the Karpenter doing its magic.</p>
<p><script id="asciicast-6NDtOwQ6P4Q91c4sAmR4qI5sq" src="https://asciinema.org/a/6NDtOwQ6P4Q91c4sAmR4qI5sq.js" async></script></p>
<p>As shown in the terminal record. You can see the Karpenter logs adding and removing nodes based on demand and need.</p>
<p><a href="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-3.38.55-AM.png"><img class="post-img alignnone wp-image-8114 size-full lazyload" src="../../wp-content/ewww/lazy/placeholder-1920x342.png" alt="EKS Karpenter Logs" width="3802" height="678" data-src="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-3.38.55-AM.png" loading="lazy" data-srcset="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-3.38.55-AM.png 3802w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-3.38.55-AM-300x53.png 300w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-3.38.55-AM-1024x183.png 1024w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-3.38.55-AM-768x137.png 768w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-3.38.55-AM-1536x274.png 1536w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-3.38.55-AM-2048x365.png 2048w" data-sizes="auto" /><noscript><img class="post-img alignnone wp-image-8114 size-full" src="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-3.38.55-AM.png" alt="EKS Karpenter Logs" width="3802" height="678" srcset="../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-3.38.55-AM.png 3802w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-3.38.55-AM-300x53.png 300w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-3.38.55-AM-1024x183.png 1024w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-3.38.55-AM-768x137.png 768w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-3.38.55-AM-1536x274.png 1536w, ../../wp-content/uploads/2022/02/Screenshot-2022-02-07-at-3.38.55-AM-2048x365.png 2048w" sizes="(max-width: 3802px) 100vw, 3802px" data-eio="l" /></noscript></a></p>
<p>You might find these kinds of logs during the even of <code>Scaling up Nodes</code></p>
<pre>2022-02-06T21:58:32.568Z INFO controller.provisioning Batched 39 pods in 1.761625115s {"commit": "62c4546", "provisioner": "default"}
2022-02-06T21:58:33.034Z INFO controller.provisioning Computed packing of 1 node(s) for 39 pod(s) with instance type option(s) [c4.xlarge c5.xlarge c5a.xlarge c6i.xlarge c5ad.xlarge c5d.xlarge c5n.xlarge m6i.xlarge m5.xlarge t3a.xlarge m5dn.xlarge t3.xlarge m5d.xlarge m4.xlarge m5zn.xlarge m5a.xlarge m5ad.xlarge m5n.xlarge i3.xlarge r4.xlarge] {"commit": "62c4546", "provisioner": "default"}
2022-02-06T21:58:35.834Z INFO controller.provisioning Launched instance: i-0ad3abd70a5de2d2b, hostname: ip-10-0-3-218.us-east-2.compute.internal, type: c5.xlarge, zone: us-east-2c, capacityType: spot {"commit": "62c4546", "provisioner": "default"}
2022-02-06T21:58:35.909Z INFO controller.provisioning Bound 39 pod(s) to node ip-10-0-3-218.us-east-2.compute.internal {"commit": "62c4546", "provisioner": "default"}</pre>
<p>In case of  <code>Scaling down</code> due to no usage on the node. you can find these kind log messages</p>
<pre>2022-02-06T22:03:11.685Z INFO controller.node Added TTL to empty node {"commit": "62c4546", "node": "ip-10-0-3-218.us-east-2.compute.internal"}
2022-02-06T22:03:41.699Z INFO controller.node Triggering termination after 30s for empty node {"commit": "62c4546", "node": "ip-10-0-3-218.us-east-2.compute.internal"}
2022-02-06T22:03:41.725Z INFO controller.termination Cordoned node {"commit": "62c4546", "node": "ip-10-0-3-218.us-east-2.compute.internal"}
2022-02-06T22:03:41.935Z INFO controller.termination Deleted node {"commit": "62c4546", "node": "ip-10-0-3-218.us-east-2.compute.internal"}</pre>
<p>&nbsp;</p>
<h2><span class="ez-toc-section" id="Conclusion">Conclusion</span></h2>
<p>Hope this article covers Everything you need to know about the Karpenter Setup on EKS.</p>
<p>To Summarize this is what we did so far</p>
<ul>
<li>Created EKS Cluster and VPC using Terraform</li>
<li>Instance Profile Creation and Policy Attachment</li>
<li>Created IAM Roles for Karpenter to Assume roles using IARC</li>
<li>Installed Karpenter with Helm release Terraform.</li>
<li>Created and Deployed a Provisioner</li>
<li>Deployed Sample Application to test EKS Cluster</li>
<li>Scaled the Sample application up and down to validate if Karpenter add and remove nodes.</li>
</ul>
<p>So that&#8217;s all about it.</p>
<p>Hope it helps. Let us know your feedback or queries on comments.</p>
<a href="../../wp-content/uploads/2021/09/DaaS.svg"><img class="post-img lazyload" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1047 415'%3E%3C/svg%3E" alt="gritfy" width="1047" height="415" class="post-img lazyload" data-src="../../wp-content/uploads/2021/09/DaaS.svg" loading="lazy" /><noscript><img class="post-img" src="../../wp-content/uploads/2021/09/DaaS.svg" alt="gritfy" width="1047" height="415" class="alignnone size-full wp-image-6623" data-eio="l" /></noscript></a>
<p>&nbsp;</p>
<p>Cheers<br />
Rumen Lishkov</p>
<div id="postfollow">
<a href='https://ko-fi.com/O4O51FG7C' target='_blank'><img height='46' style='border:0px;height:46px;width: 186px' src='data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==' border='0' alt='Buy Me a Coffee at ko-fi.com' data-src="https://az743702.vo.msecnd.net/cdn/kofi3.png?v=2" loading="lazy" class="lazyload" /><noscript><img height='46' style='border:0px;height:46px;width: 186px' src='https://az743702.vo.msecnd.net/cdn/kofi3.png?v=2' border='0' alt='Buy Me a Coffee at ko-fi.com' data-eio="l" /></noscript></a>
<p>Follow us on<a href="https://www.facebook.com/rumenlishkov">Facebook</a> or<a href="https://www.twitter.com/mwinventory">Twitter</a>
</br>
For more practical videos and tutorials. <a href="https://www.youtube.com/kiss2mark">Subscribe to our channel</a>
</br>
Find me on Linkedin <a href="https://www.linkedin.com/in/rumen-lishkov/">My Profile</a>
</br>
</i>For any Consultation or to hire us <a href="../../cdn-cgi/l/email-protection.html#8de5e8e1e1e2cdeaffe4f9ebf4a3eee2e0"> <span class="__cf_email__" data-cfemail="afc7cac3c3c0efc8ddc6dbc9d681ccc0c2">[email&#160;protected]</span></a>
</br>
If you like this article. Show your Support! <a href="https://ko-fi.com/middlewareinventory">Buy me a Coffee.</a>
</br>
</p>
<p style="color: palevioletred !important;">Signup for Exclusive "Subscriber-only" Content</p>
<div class="emaillist">
<form action="#" method="post" class="es_subscription_form es_shortcode_form" id="es_subscription_form_1657196775" data-source="ig-es">
<div class="es-field-wrap"><label>Name*<br /><input type="text" name="name" class="ig_es_form_field_name" placeholder="" value="" required="required" /></label></div><div class="es-field-wrap"><label>Email*<br /><input class="es_required_field es_txt_email ig_es_form_field_email" type="email" name="email" value="" placeholder="" required="required" /></label></div><input type="hidden" name="lists[]" value="1" /><input type="hidden" name="form_id" value="3" />
<input type="hidden" name="es_email_page" value="7891" />
<input type="hidden" name="es_email_page_url" value="https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/" />
<input type="hidden" name="status" value="Unconfirmed" />
<input type="hidden" name="es-subscribe" id="es-subscribe" value="4af32dc5ca" />
<label style="position:absolute;top:-99999px;left:-99999px;z-index:-99;"><input type="email" name="es_hp_email" class="es_required_field" tabindex="-1" autocomplete="-1" value="" /></label>
<input type="submit" name="submit" class="es_subscription_form_submit es_submit_button es_textbox_button" id="es_subscription_form_submit_1657196775" value="Subscribe" />
<span class="es_spinner_image" id="spinner-image"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Loading" data-src="../../wp-content/plugins/email-subscribers/lite/public/images/spinner.gif" loading="lazy" class="lazyload" /><noscript><img src="../../wp-content/plugins/email-subscribers/lite/public/images/spinner.gif" alt="Loading" data-eio="l" /></noscript></span>
</form>
<span class="es_subscription_message" id="es_subscription_message_1657196775"></span>
</div>
</div>
<hr>
<div class='rp4wp-related-posts'>
<h3>More from Middleware Inventory</h3>
<ul>
<li><div class='rp4wp-related-post-image'>
<a href='../store-terraform-state-terraform-cloud/index.html'><img width="150" height="150" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 150'%3E%3C/svg%3E" class="attachment-thumbnail size-thumbnail wp-post-image lazyload" alt="Terraform remote state cloud" data-src="../../wp-content/uploads/2021/12/terraform-remote-state-150x150.jpg" loading="lazy" /><noscript><img width="150" height="150" src="../../wp-content/uploads/2021/12/terraform-remote-state-150x150.jpg" class="attachment-thumbnail size-thumbnail wp-post-image" alt="Terraform remote state cloud" data-eio="l" /></noscript></a></div>
<div class='rp4wp-related-post-content'>
<a href='../store-terraform-state-terraform-cloud/index.html'>Store terraform state file on Terraform cloud Remote | Devops Junction</a><p>In this article, I am going to discuss how we can keep safe our terraform state file using terraform cloud. As a pioneer/Practioner of Terraform CLI, we hold responsible for Terraform state file which is the source of truth for our infrastructure. What if we lose this state file or&hellip;</p></div>
</li>
<li><div class='rp4wp-related-post-image'>
<a href='../deploy-tomcat-kubernetes/index.html'><img width="150" height="150" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 150'%3E%3C/svg%3E" class="attachment-thumbnail size-thumbnail wp-post-image lazyload" alt="Tomcat Kubernetes" data-src="../../wp-content/uploads/2020/09/Screenshot-2020-09-29-at-8.55.24-PM-150x150.jpg" loading="lazy" /><noscript><img width="150" height="150" src="../../wp-content/uploads/2020/09/Screenshot-2020-09-29-at-8.55.24-PM-150x150.jpg" class="attachment-thumbnail size-thumbnail wp-post-image" alt="Tomcat Kubernetes" data-eio="l" /></noscript></a></div>
<div class='rp4wp-related-post-content'>
<a href='../deploy-tomcat-kubernetes/index.html'>How to Deploy Tomcat on Kubernetes Step by Step</a><p>Overview In this post, we are going to see how to deploy tomcat on Kubernetes.&nbsp; How to Deploy Tomcat based web application into Kubernetes. We are taking Google Cloud - Kubernetes Engine (GKE) for our example and creating our Kubernetes Cluster with 3 nodes You can do all these steps&hellip;</p></div>
</li>
<li><div class='rp4wp-related-post-image'>
<a href='../manage-and-monitor-kubernetes-with-ease-lens-ide/index.html'><img width="150" height="150" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 150'%3E%3C/svg%3E" class="attachment-thumbnail size-thumbnail wp-post-image lazyload" alt="Kubernetes Monitoring" data-src="../../wp-content/uploads/2021/05/Screenshot-2021-05-03-at-1.45.32-AM-150x150.jpg" loading="lazy" /><noscript><img width="150" height="150" src="../../wp-content/uploads/2021/05/Screenshot-2021-05-03-at-1.45.32-AM-150x150.jpg" class="attachment-thumbnail size-thumbnail wp-post-image" alt="Kubernetes Monitoring" data-eio="l" /></noscript></a></div>
<div class='rp4wp-related-post-content'>
<a href='../manage-and-monitor-kubernetes-with-ease-lens-ide/index.html'>Manage and Monitor Kubernetes with ease - Lens IDE</a><p>I came across a wonderful solution for managing and monitoring the Kubernetes cluster and wanted to share my experience in this post with screenshots. While there are a lot of ways to monitor the Kubernetes cluster like setting up Prometheus, Grafana Deamon set and sidecar container strategies etc. All of&hellip;</p></div>
</li>
<li><div class='rp4wp-related-post-image'>
<a href='../terraform-aws-example-ec2/index.html'><img width="150" height="150" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 150'%3E%3C/svg%3E" class="attachment-thumbnail size-thumbnail wp-post-image lazyload" alt="" data-src="../../wp-content/uploads/2020/01/TerraformAWS-1-150x150.png" loading="lazy" /><noscript><img width="150" height="150" src="../../wp-content/uploads/2020/01/TerraformAWS-1-150x150.png" class="attachment-thumbnail size-thumbnail wp-post-image" alt="" data-eio="l" /></noscript></a></div>
<div class='rp4wp-related-post-content'>
<a href='../terraform-aws-example-ec2/index.html'>Terraform AWS Example - Create EC2 instance with Terraform</a><p>Terraform, An outstanding and innovative product from hashicorp and it is a leader in Infrastructure as Code tools Segment.&nbsp; Before I go any further, I think I should set the context. In this article, we are going to learn how to use Terraform to create AWS EC2 instance and create&hellip;</p></div>
</li>
<li><div class='rp4wp-related-post-image'>
<a href='../kubernetes-ingress-example/index.html'><img width="150" height="150" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 150'%3E%3C/svg%3E" class="attachment-thumbnail size-thumbnail wp-post-image lazyload" alt="" data-src="../../wp-content/uploads/2020/02/ting-150x150.png" loading="lazy" /><noscript><img width="150" height="150" src="../../wp-content/uploads/2020/02/ting-150x150.png" class="attachment-thumbnail size-thumbnail wp-post-image" alt="" data-eio="l" /></noscript></a></div>
<div class='rp4wp-related-post-content'>
<a href='../kubernetes-ingress-example/index.html'>Kubernetes Ingress Example on Google Cloud</a><p>Kubernetes Ingress We understand that as per traditional infrastructure setup, in order to load balance the client requests you are required to configure instances for each application you want to balance the load, which makes your configuration lengthy, and when moving this architecture to open source technologies it will be&hellip;</p></div>
</li>
</ul>
</div>
</div>
<footer class="entry-footer">
<nav class="navigation post-navigation" role="navigation" aria-label="Posts">
<h2 class="screen-reader-text">Post navigation</h2>
<div class="nav-links"><div class="nav-previous"><a href="../ansible-pre-tasks-and-post-tasks-example/index.html" rel="prev"><span class="screen-reader-text">Previous Post:</span>Ansible Pre Tasks and Post Tasks Example | Devops Junction</a></div><div class="nav-next"><a href="../ansible-playbook-kafka/index.html" rel="next"><span class="screen-reader-text">Next Post:</span>Ansible Playbook to install KAFKA on Ubuntu &#8211; How to | Devops Junction</a></div></div>
</nav>
</footer>
</article>
<div id="disqus_thread"></div>
</main>
</section>
<section id="secondary" class="sidebar widget-area clearfix" role="complementary">
<aside id="custom_html-18" class="widget_text widget widget_custom_html clearfix"><div class="textwidget custom-html-widget"><script data-cfasync="false" src="../../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3398911159151128" crossorigin="anonymous"></script>


<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></div></aside><aside id="categories-8" class="widget widget_categories clearfix"><div class="widget-header"><h3 class="widget-title">Categories</h3></div>
<ul>
<li class="cat-item cat-item-61"><a href="../category/activemq/index.html">ActiveMQ</a> (4)
</li>
<li class="cat-item cat-item-98"><a href="../category/ansible/index.html">Ansible</a> (65)
</li>
<li class="cat-item cat-item-10"><a href="../category/apache/index.html">Apache</a> (8)
</li>
<li class="cat-item cat-item-234"><a href="../category/aws/index.html">AWS</a> (28)
</li>
<li class="cat-item cat-item-452"><a href="../category/azure/index.html">Azure</a> (1)
</li>
<li class="cat-item cat-item-8"><a href="../category/best-practice/index.html">Best Practice</a> (5)
</li>
<li class="cat-item cat-item-390"><a href="../category/bitbucket/index.html">BitBucket</a> (1)
</li>
<li class="cat-item cat-item-426"><a href="../category/boto/index.html">Boto</a> (1)
</li>
<li class="cat-item cat-item-399"><a href="../category/cloud/index.html" title="Cloud is not only a concept but also a practice of using a network of remote servers hosted on the Internet to store, manage, and process data.">Cloud</a> (1)
</li>
<li class="cat-item cat-item-397"><a href="../category/database/index.html">Database</a> (1)
</li>
<li class="cat-item cat-item-95"><a href="../category/development/index.html">Development</a> (3)
</li>
<li class="cat-item cat-item-152"><a href="../category/docker/index.html">Docker</a> (11)
</li>
<li class="cat-item cat-item-422"><a href="../category/efk/index.html">EFK</a> (1)
</li>
<li class="cat-item cat-item-423"><a href="../category/elastic-search/index.html">Elastic Search</a> (1)
</li>
<li class="cat-item cat-item-59"><a href="../category/f5-big-ip/index.html">F5-Big-IP</a> (6)
</li>
<li class="cat-item cat-item-419"><a href="../category/fluentd/index.html">FluentD</a> (2)
</li>
<li class="cat-item cat-item-424"><a href="../category/gcp-googlecloud/index.html">GCP &#8211; GoogleCloud</a> (1)
</li>
<li class="cat-item cat-item-450"><a href="../category/github-actions/index.html">Github Actions</a> (1)
</li>
<li class="cat-item cat-item-428"><a href="../category/grafana/index.html">Grafana</a> (1)
</li>
<li class="cat-item cat-item-275"><a href="../category/graphite/index.html">Graphite</a> (1)
</li>
<li class="cat-item cat-item-441"><a href="../category/ibm-cloud/index.html">IBM Cloud</a> (1)
</li>
<li class="cat-item cat-item-401"><a href="../category/ibm-websphere/index.html" title="IBM® WebSphere® Application Server provides a range of flexible and secure runtime for Java enterprise applications, lightweight web applications and microservices. You can create new applications and enhance and optimize existing application infrastructure on premises or across any public, private or hybrid cloud. In addition, by utilizing IBM Cloud Private, you can create on-premises cloud capabilities similar to public clouds to accelerate app development. The platform is built on the open source Kubernetes-based container architecture and supports both Docker containers and Cloud Foundry.">IBM Websphere</a> (2)
</li>
<li class="cat-item cat-item-354"><a href="../category/ihs-and-apache/index.html">IHS and Apache</a> (10)
</li>
<li class="cat-item cat-item-353"><a href="../category/iis/index.html">IIS</a> (4)
</li>
<li class="cat-item cat-item-388"><a href="../category/javascript/index.html">JavaScript</a> (3)
</li>
<li class="cat-item cat-item-286"><a href="../category/jenkins/index.html">Jenkins</a> (4)
</li>
<li class="cat-item cat-item-15"><a href="../category/joomla/index.html">Joomla</a> (1)
</li>
<li class="cat-item cat-item-151"><a href="../category/kubernetes/index.html">Kubernetes</a> (16)
</li>
<li class="cat-item cat-item-191"><a href="../category/middleware/index.html">Middleware</a> (3)
</li>
<li class="cat-item cat-item-322"><a href="../category/network-troubleshooting/index.html">Network Troubleshooting</a> (1)
</li>
<li class="cat-item cat-item-413"><a href="../category/networking/index.html">Networking</a> (1)
</li>
<li class="cat-item cat-item-273"><a href="../category/nodejs/index.html">NodeJS</a> (2)
</li>
<li class="cat-item cat-item-396"><a href="../category/office365/index.html">Office365</a> (1)
</li>
<li class="cat-item cat-item-148"><a href="../category/opensource/index.html">OpenSource</a> (2)
</li>
<li class="cat-item cat-item-417"><a href="../category/oracle-db/index.html">Oracle DB</a> (3)
</li>
<li class="cat-item cat-item-404"><a href="../category/oracle-weblogic/index.html" title="WebLogic is a leading Application Server product most widely used for e-commerce online transaction processing (OLTP) platform application, developed to connect users in a distributed computing environment and to facilitate the integration of mainframe applications with distributed corporate data and applications.">Oracle Weblogic</a> (2)
</li>
<li class="cat-item cat-item-232"><a href="../category/packer/index.html">Packer</a> (2)
</li>
<li class="cat-item cat-item-146"><a href="../category/perl/index.html">Perl</a> (1)
</li>
<li class="cat-item cat-item-60"><a href="../category/php/index.html">PHP</a> (1)
</li>
<li class="cat-item cat-item-453"><a href="../category/postgresql/index.html">PostgreSQL</a> (1)
</li>
<li class="cat-item cat-item-343"><a href="../category/powershell/index.html">PowerShell</a> (1)
</li>
<li class="cat-item cat-item-31"><a href="../category/weblogic/problemsolution/index.html">problem/solution</a> (8)
</li>
<li class="cat-item cat-item-427"><a href="../category/prometheus/index.html">Prometheus</a> (1)
</li>
<li class="cat-item cat-item-445"><a href="../category/pulumi/index.html">Pulumi</a> (1)
</li>
<li class="cat-item cat-item-285"><a href="../category/python-flask/index.html">Python Flask</a> (1)
</li>
<li class="cat-item cat-item-22"><a href="../category/python_scripts/index.html">python_scripts</a> (7)
</li>
<li class="cat-item cat-item-446"><a href="../category/redis/index.html">Redis</a> (1)
</li>
<li class="cat-item cat-item-451"><a href="../category/serverless/index.html">Serverless</a> (1)
</li>
<li class="cat-item cat-item-12"><a href="../category/shell-scripting/index.html">Shell Scripting</a> (6)
</li>
<li class="cat-item cat-item-125"><a href="../category/soap-web-services/index.html">SOAP Web Services</a> (1)
</li>
<li class="cat-item cat-item-13"><a href="../category/splunk/index.html">Splunk</a> (1)
</li>
<li class="cat-item cat-item-425"><a href="../category/sre/index.html">SRE</a> (1)
</li>
<li class="cat-item cat-item-274"><a href="../category/statsd/index.html">StatsD</a> (1)
</li>
<li class="cat-item cat-item-233"><a href="../category/terraform/index.html">Terraform</a> (12)
</li>
<li class="cat-item cat-item-35"><a href="../category/tomcat/index.html">tomcat</a> (7)
</li>
<li class="cat-item cat-item-147"><a href="../category/tools/index.html">tools</a> (5)
</li>
<li class="cat-item cat-item-391"><a href="../category/traefik/index.html">Traefik</a> (1)
</li>
<li class="cat-item cat-item-124"><a href="../category/troubleshooting/index.html">Troubleshooting</a> (3)
</li>
<li class="cat-item cat-item-1"><a href="../category/uncategorized/index.html">Uncategorized</a> (5)
</li>
<li class="cat-item cat-item-7"><a href="../category/unix/index.html">Unix</a> (5)
</li>
<li class="cat-item cat-item-99"><a href="../category/vagrant/index.html">Vagrant</a> (4)
</li>
<li class="cat-item cat-item-389"><a href="../category/vuejs/index.html">VueJS</a> (2)
</li>
<li class="cat-item cat-item-356"><a href="../category/vulnerabilities-fixes/index.html">Vulnerabilities &amp; Fixes</a> (21)
</li>
<li class="cat-item cat-item-21"><a href="../category/weblogic/index.html">weblogic</a> (51)
</li>
<li class="cat-item cat-item-9"><a href="../category/webserver/index.html">Webserver</a> (1)
</li>
<li class="cat-item cat-item-92"><a href="../category/websphere/index.html">Websphere</a> (8)
</li>
<li class="cat-item cat-item-321"><a href="../category/windows-server/index.html">Windows Server</a> (5)
</li>
<li class="cat-item cat-item-55"><a href="../category/wlst/index.html">wlst</a> (7)
</li>
<li class="cat-item cat-item-36"><a href="../category/wordpress/index.html">wordpress</a> (2)
</li>
<li class="cat-item cat-item-4"><a href="../category/wsadmin-scripts/index.html">wsadmin scripts</a> (1)
</li>
</ul>
</aside><aside id="media_image-5" class="widget widget_media_image clearfix"><img width="267" height="400" src="../../wp-content/ewww/lazy/placeholder-267x400.png" class="image wp-image-8825  attachment-full size-full lazyload" alt="write for devopsjunction" style="max-width: 100%; height: auto;" data-src="../../wp-content/uploads/2022/07/write-for-us-devopsjunction.png" loading="lazy" data-srcset="../../wp-content/uploads/2022/07/write-for-us-devopsjunction.png 267w, ../../wp-content/uploads/2022/07/write-for-us-devopsjunction-200x300.png 200w" data-sizes="auto" /><noscript><img width="267" height="400" src="../../wp-content/uploads/2022/07/write-for-us-devopsjunction.png" class="image wp-image-8825  attachment-full size-full" alt="write for devopsjunction" style="max-width: 100%; height: auto;" srcset="../../wp-content/uploads/2022/07/write-for-us-devopsjunction.png 267w, ../../wp-content/uploads/2022/07/write-for-us-devopsjunction-200x300.png 200w" sizes="(max-width: 267px) 100vw, 267px" data-eio="l" /></noscript></aside>
</section>
</div>
<div id="footer" class="footer-wrap">
<footer id="colophon" class="site-footer container clearfix" role="contentinfo">
<div id="footer-text" class="site-info">
<span class="credit-link">Powered by <a href="../../index.html" title="Rumen Lishkov">Rumen Lishkov</a> and <a href="https://rumen.free.bg/" title="Studio-1">Studio1 Sofia</a> </span>
</div>
</footer>
</div>
</div>
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@mwinventory" />
<meta name="twitter:creator" content="@mwinventory" />
<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro&amp;display=swap" rel="stylesheet"><div class="simplesocialbuttons simplesocial-round-icon simplesocialbuttons-float-left-center post-7891 post  ssb_counter-activate simplesocialbuttons-slide-bottom-in">
<button class="simplesocial-fb-share" target="_blank" data-href="https://www.facebook.com/sharer/sharer.php?u=https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;"><span class="simplesocialtxt">Facebook </span> <span class="ssb_counter ssb_fbshare_counter">0</span></button>
<button class="simplesocial-twt-share" data-href="https://twitter.com/share?text=Creating+EKS+Cluster+with+Karpenter+Auto+scaling+%E2%80%93+Terraform+%7C+Kubernetes&url=https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/" rel="nofollow" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;"><span class="simplesocialtxt">Twitter</span> <span class="ssb_counter ssb_twitter_counter">0</span></button>
<button target="popup" class="simplesocial-linkedin-share" data-href="https://www.linkedin.com/cws/share?url=https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;"><span class="simplesocialtxt">LinkedIn</span></button>
<button onclick="javascript:window.location.href = this.dataset.href;return false;" class="simplesocial-email-share" data-href="mailto:?subject=Creating+EKS+Cluster+with+Karpenter+Auto+scaling+%E2%80%93+Terraform+%7C+Kubernetes&body=https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/"><span class="simplesocialtxt">Email</span></button>
<button onclick="javascript:window.open(this.dataset.href, '_blank' );return false;" class="simplesocial-whatsapp-share" data-href="https://web.whatsapp.com/send?text=https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/"><span class="simplesocialtxt">WhatsApp</span></button>
</div>
<script type="text/javascript">
		/* MonsterInsights Scroll Tracking */
			if ( typeof(jQuery) !== 'undefined' ) {
				jQuery( document ).ready(function(){
					function monsterinsights_scroll_tracking_load() {
						if ( typeof(__gaTracker) !== 'undefined' && __gaTracker && __gaTracker.hasOwnProperty( "loaded" ) && __gaTracker.loaded == true ) {
							(function(factory) {
								factory(jQuery);
							}(function($) {

								/* Scroll Depth */
								"use strict";
								var defaults = {
									percentage: true
								};

								var $window = $(window),
									cache = [],
									scrollEventBound = false,
									lastPixelDepth = 0;

								/*
								 * Plugin
								 */

								$.scrollDepth = function(options) {

									var startTime = +new Date();

									options = $.extend({}, defaults, options);

									/*
									 * Functions
									 */

									function sendEvent(action, label, scrollDistance, timing) {

										var fieldsArray = {
											hitType       : 'event',
											eventCategory : 'Scroll Depth',
											eventAction   : action,
											eventLabel    : label,
											eventValue    : 1,
											nonInteraction: 1
										};

										if ( 'undefined' === typeof MonsterInsightsObject || 'undefined' === typeof MonsterInsightsObject.sendEvent ) {
											return;
										}

										MonsterInsightsObject.sendEvent( fieldsArray );
										if (arguments.length > 3) {
											fieldsArray = {
												hitType        : 'timing',
												timingCategory : 'Scroll Depth',
												timingVar      : action,
												timingValue    : timing,
												timingLabel    : label,
												nonInteraction: 1
											};
											MonsterInsightsObject.sendEvent( fieldsArray );
										}
									}

									function calculateMarks(docHeight) {
										return {
											'25%' : parseInt(docHeight * 0.25, 10),
											'50%' : parseInt(docHeight * 0.50, 10),
											'75%' : parseInt(docHeight * 0.75, 10),
											/* Cushion to trigger 100% event in iOS */
											'100%': docHeight - 5
										};
									}

									function checkMarks(marks, scrollDistance, timing) {
										/* Check each active mark */
										$.each(marks, function(key, val) {
											if ( $.inArray(key, cache) === -1 && scrollDistance >= val ) {
												sendEvent('Percentage', key, scrollDistance, timing);
												cache.push(key);
											}
										});
									}

									function rounded(scrollDistance) {
										/* Returns String */
										return (Math.floor(scrollDistance/250) * 250).toString();
									}

									function init() {
										bindScrollDepth();
									}

									/*
									 * Public Methods
									 */

									/* Reset Scroll Depth with the originally initialized options */
									$.scrollDepth.reset = function() {
										cache = [];
										lastPixelDepth = 0;
										$window.off('scroll.scrollDepth');
										bindScrollDepth();
									};

									/* Add DOM elements to be tracked */
									$.scrollDepth.addElements = function(elems) {

										if (typeof elems == "undefined" || !$.isArray(elems)) {
											return;
										}

										$.merge(options.elements, elems);

										/* If scroll event has been unbound from window, rebind */
										if (!scrollEventBound) {
											bindScrollDepth();
										}

									};

									/* Remove DOM elements currently tracked */
									$.scrollDepth.removeElements = function(elems) {

										if (typeof elems == "undefined" || !$.isArray(elems)) {
											return;
										}

										$.each(elems, function(index, elem) {

											var inElementsArray = $.inArray(elem, options.elements);
											var inCacheArray = $.inArray(elem, cache);

											if (inElementsArray != -1) {
												options.elements.splice(inElementsArray, 1);
											}

											if (inCacheArray != -1) {
												cache.splice(inCacheArray, 1);
											}

										});

									};

									/*
									 * Throttle function borrowed from:
									 * Underscore.js 1.5.2
									 * http://underscorejs.org
									 * (c) 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
									 * Underscore may be freely distributed under the MIT license.
									 */

									function throttle(func, wait) {
										var context, args, result;
										var timeout = null;
										var previous = 0;
										var later = function() {
											previous = new Date;
											timeout = null;
											result = func.apply(context, args);
										};
										return function() {
											var now = new Date;
											if (!previous) previous = now;
											var remaining = wait - (now - previous);
											context = this;
											args = arguments;
											if (remaining <= 0) {
												clearTimeout(timeout);
												timeout = null;
												previous = now;
												result = func.apply(context, args);
											} else if (!timeout) {
												timeout = setTimeout(later, remaining);
											}
											return result;
										};
									}

									/*
									 * Scroll Event
									 */

									function bindScrollDepth() {

										scrollEventBound = true;

										$window.on('scroll.scrollDepth', throttle(function() {
											/*
											 * We calculate document and window height on each scroll event to
											 * account for dynamic DOM changes.
											 */

											var docHeight = $(document).height(),
												winHeight = window.innerHeight ? window.innerHeight : $window.height(),
												scrollDistance = $window.scrollTop() + winHeight,

												/* Recalculate percentage marks */
												marks = calculateMarks(docHeight),

												/* Timing */
												timing = +new Date - startTime;

											checkMarks(marks, scrollDistance, timing);
										}, 500));

									}

									init();
								};

								/* UMD export */
								return $.scrollDepth;

							}));

							jQuery.scrollDepth();
						} else {
							setTimeout(monsterinsights_scroll_tracking_load, 200);
						}
					}
					monsterinsights_scroll_tracking_load();
				});
			}
		/* End MonsterInsights Scroll Tracking */
		
</script><script type='text/javascript' id='disqus_count-js-extra'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"mwinventory"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/f8767.js"></script>
<script type='text/javascript' id='disqus_embed-js-extra'>
/* <![CDATA[ */
var embedVars = {"disqusConfig":{"integration":"wordpress 3.0.22"},"disqusIdentifier":"7891 https:\/\/www.middlewareinventory.com\/?p=7891","disqusShortname":"mwinventory","disqusTitle":"Creating EKS Cluster with Karpenter Auto scaling \u2013 Terraform | Kubernetes","disqusUrl":"https:\/\/www.middlewareinventory.com\/blog\/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes\/","postId":"7891"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/bccbc.js"></script>
<script type='text/javascript' id='dae-download-js-extra'>
/* <![CDATA[ */
var objDaeDownload = {"ajaxUrl":"https:\/\/www.middlewareinventory.com\/wp-admin\/admin-ajax.php","nonce":"c3faebb42a"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/8510d.js"></script>
<script type='text/javascript' id='socialsnap-js-js-extra'>
/* <![CDATA[ */
var socialsnap_script = {"ajaxurl":"https:\/\/www.middlewareinventory.com\/wp-admin\/admin-ajax.php","on_media_width":"250","on_media_height":"250","nonce":"ad1aa689b7","post_id":"7891"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/fef55.js"></script>
<script type='text/javascript' id='aicp-js-extra'>
/* <![CDATA[ */
var AICP = {"ajaxurl":"https:\/\/www.middlewareinventory.com\/wp-admin\/admin-ajax.php","nonce":"f0b2747bdc","ip":"38.68.134.130","clickLimit":"1","clickCounterCookieExp":"3","banDuration":"7","countryBlockCheck":"No","banCountryList":"RU"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/ff9fe.js"></script>
<script type='text/javascript' src='https://js.stripe.com/v3/?ver=2.03' id='stripe-js'></script>
<script type='text/javascript' id='q2w3_fixed_widget-js-extra'>
/* <![CDATA[ */
var q2w3_sidebar_options = [{"sidebar":"q2w3-default-sidebar","margin_top":10,"margin_bottom":0,"stop_id":"","screen_max_width":1026,"screen_max_height":0,"width_inherit":true,"refresh_interval":1500,"window_load_hook":false,"disable_mo_api":false,"widgets":["text-32"]}];
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/f2bcf.js"></script>
<script type='text/javascript' id='enlighterjs-js-after'>
!function(e,n){if("undefined"!=typeof EnlighterJS){var o={"selectors":{"block":"pre.EnlighterJSRAW","inline":"code.EnlighterJSRAW"},"options":{"indent":4,"ampersandCleanup":true,"linehover":true,"rawcodeDbclick":false,"textOverflow":"break","linenumbers":true,"theme":"enlighter","language":"generic","retainCssClasses":false,"collapse":false,"toolbarOuter":"","toolbarTop":"{BTN_RAW}{BTN_COPY}{BTN_WINDOW}{BTN_WEBSITE}","toolbarBottom":""}};(e.EnlighterJSINIT=function(){EnlighterJS.init(o.selectors.block,o.selectors.inline,o.options)})()}else{(n&&(n.error||n.log)||function(){})("Error: EnlighterJS resources not loaded yet!")}}(window,console);
</script>
<script src="../../wp-content/cache/minify/129c2.js"></script>
<script type='text/javascript' id='ez-toc-js-js-extra'>
/* <![CDATA[ */
var ezTOC = {"smooth_scroll":"1","visibility_hide_by_default":"","width":"100%","scroll_offset":"30"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/0c713.js"></script>
<div id="ss-copy-popup" class="ss-popup-overlay">
<div class="ss-popup">
<div class="ss-popup-heading">
<span>Copy link</span>
<a href="#" id="ss-close-share-networks-modal" class="ss-close-modal" rel="nofollow"><i class="ss ss-close"></i></a>
</div>
<div class="ss-popup-content">
<div class="ss-copy-action">
<input type="text" readonly="readonly" value="https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/" class="ss-copy-action-field" />
<a href="#" class="ss-button" rel="nofollow">Copy<span class="ss-share-network-tooltip">Copied</span></a>
<i class="ss ss-copy"></i>
</div>
<div class="ss-powered-by">Powered by <a href="https://socialsnap.com/?utm_source=WordPress&amp;utm_medium=link&amp;utm_campaign=inthewild" target="_blank" rel="nofollow noopener"><i class="ss ss-socialsnap"></i>Social Snap</a></div>
</div>
</div>
</div>
<script type="text/javascript">
		document.addEventListener("DOMContentLoaded", function() {
			var if_ssb_exist = document.getElementsByClassName( "simplesocialbuttons" ).length > 0;
			if (if_ssb_exist) {
				var ssb_admin_ajax = 'https://www.middlewareinventory.com/wp-admin/admin-ajax.php';
				var ssb_post_id = 7891 ;
				var ssb_post_url = 'https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/';
				var ssb_alternate_post_url = 'https://www.middlewareinventory.com/blog/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/';
				jQuery( document ).ready(function(){
				var is_ssb_used = jQuery('.simplesocialbuttons');
				if( is_ssb_used ) {

					var data = {
					'action': 'ssb_fetch_data',
					'postID': ssb_post_id
				};
					jQuery.post(ssb_admin_ajax, data, function(data, textStatus, xhr) {
						var array = JSON.parse(data);
						jQuery.each( array, function( index, value ){

							if( index == 'total' ){
								jQuery('.ssb_'+ index +'_counter').html(value + '<span>Shares</span>');
							}else{
								jQuery('.ssb_'+ index +'_counter').html(value);
							}
						});

					});
				}
				})

			//ssbPlugin.fetchFacebookShares();
			}
		});

		</script><script type='text/javascript'>function initTwitCount(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://static1.twitcount.com/js/twitcount.js';fjs.parentNode.insertBefore(js,fjs)}}
        var ssb_twit_count_init=!1;addEventListener('mouseover',function(event){if(!ssb_twit_count_init){initTwitCount(document,'script','twitcount_plugins')
        ssb_twit_count_init=!0}})</script> 
<script type="text/javascript">

			var SocialSnapURL 				= window.location.href;
			var SocialSnapShareCacheExpired = 1;
				
			if ( -1 !== SocialSnapURL.indexOf('?ss_cache_refresh') ) {

				SocialSnapShareCacheExpired = true;

			} else {

				var SocialSnapServerTimestamp 	= 1657196776;
				var SocialSnapBrowserTimestamp 	= Date.now();

				if ( ! SocialSnapBrowserTimestamp ) {
					SocialSnapBrowserTimestamp = new Date().getTime();
				}

				SocialSnapBrowserTimestamp = Math.floor( SocialSnapBrowserTimestamp / 1000 );

				SocialSnapShareCacheExpired = SocialSnapShareCacheExpired && ( SocialSnapBrowserTimestamp - SocialSnapServerTimestamp < 60 );
			}

		</script>

<div id="cookie-notice" role="banner" class="cn-bottom bootstrap" style="color: #fff; background-color: #000;"><div class="cookie-notice-container"><span id="cn-notice-text">We use cookies to ensure that we give you the best experience on our website. The Cookies collected are used only to Show customized Ads. We Hope you are fine with it.</span><a href="#" id="cn-accept-cookie" data-cookie-set="accept" class="cn-set-cookie cn-button bootstrap button">Ok</a><a href="../../cookie-policy/index.html" target="_blank" id="cn-more-info" class="cn-more-info cn-button bootstrap button">Privacy policy</a>
</div>
</div>
</body>
</html>
