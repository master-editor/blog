<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="https://gmpg.org/xfn/11">
<link rel="pingback" href="https://www.middlewareinventory.com/xmlrpc.php">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

<title>Terraform Create Multiple EC2 with different Configs - for_each and count together</title>
<meta name="description" content="Terraform Create Multiple EC2 with a different set of configurations. Using Count and for_each together in Terraform example. Terraform for_each example. Terraform count example" />
<meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
<link rel="canonical" href="index.html" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Terraform Create Multiple EC2 with different Configs - for_each and count together" />
<meta property="og:description" content="Terraform Create Multiple EC2 with a different set of configurations. Using Count and for_each together in Terraform example. Terraform for_each example. Terraform count example" />
<meta property="og:url" content="https://airdata.gitlab.io/blog/blog/terraform-create-multiple-ec2-different-config/" />
<meta property="og:site_name" content="Middleware Inventory" />
<meta property="article:publisher" content="https://www.facebook.com/rumenlishkov" />
<meta property="article:published_time" content="2021-09-25T15:05:49+00:00" />
<meta property="article:modified_time" content="2022-11-10T19:18:12+00:00" />
<meta property="og:image" content="../../wp-content/uploads/2021/09/tf-for_each.jpg" />
<meta property="og:image:width" content="1748" />
<meta property="og:image:height" content="1240" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content="@mwinventory" />
<meta name="twitter:site" content="@mwinventory" />
<script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://www.middlewareinventory.com/#organization","name":"Middleware Inventory","url":"https://www.middlewareinventory.com/","sameAs":["https://www.facebook.com/rumenlishkov","https://www.youtube.com/channel/UCRuqBFM6ioWwviNJkgOjeWw","https://twitter.com/mwinventory"],"logo":{"@type":"ImageObject","@id":"https://www.middlewareinventory.com/#logo","inLanguage":"en-US","url":"https://airdata.gitlab.io/blog/wp-content/uploads/2020/09/Screenshot-2020-09-18-at-3.49.40-AM.jpg","width":300,"height":107,"caption":"Middleware Inventory"},"image":{"@id":"https://www.middlewareinventory.com/#logo"}},{"@type":"WebSite","@id":"https://www.middlewareinventory.com/#website","url":"https://www.middlewareinventory.com/","name":"Devops Junction","description":"An inventory of [i]nformation, Middleware and much more.","publisher":{"@id":"https://www.middlewareinventory.com/#organization"},"potentialAction":[{"@type":"SearchAction","target":"https://www.middlewareinventory.com/?s={search_term_string}","query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"ImageObject","@id":"https://airdata.gitlab.io/blog/blog/terraform-create-multiple-ec2-different-config/#primaryimage","inLanguage":"en-US","url":"../../wp-content/uploads/2021/09/tf-for_each.jpg","width":1748,"height":1240,"caption":"terraform for_each"},{"@type":"WebPage","@id":"https://airdata.gitlab.io/blog/blog/terraform-create-multiple-ec2-different-config/#webpage","url":"https://airdata.gitlab.io/blog/blog/terraform-create-multiple-ec2-different-config/","name":"Terraform Create Multiple EC2 with different Configs - for_each and count together","isPartOf":{"@id":"https://www.middlewareinventory.com/#website"},"primaryImageOfPage":{"@id":"https://airdata.gitlab.io/blog/blog/terraform-create-multiple-ec2-different-config/#primaryimage"},"datePublished":"2021-09-25T15:05:49+00:00","dateModified":"2022-11-10T19:18:12+00:00","description":"Terraform Create Multiple EC2 with a different set of configurations. Using Count and for_each together in Terraform example. Terraform for_each example. Terraform count example","inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://airdata.gitlab.io/blog/blog/terraform-create-multiple-ec2-different-config/"]}]},{"@type":"Article","@id":"https://airdata.gitlab.io/blog/blog/terraform-create-multiple-ec2-different-config/#article","isPartOf":{"@id":"https://airdata.gitlab.io/blog/blog/terraform-create-multiple-ec2-different-config/#webpage"},"author":{"@id":"https://www.middlewareinventory.com/#/schema/person/050bf13e27b309d29d1bda45c4eb3147"},"headline":"Terraform Create Multiple EC2 with different Configs &#8211; for_each and count together","datePublished":"2021-09-25T15:05:49+00:00","dateModified":"2022-11-10T19:18:12+00:00","mainEntityOfPage":{"@id":"https://airdata.gitlab.io/blog/blog/terraform-create-multiple-ec2-different-config/#webpage"},"commentCount":0,"publisher":{"@id":"https://www.middlewareinventory.com/#organization"},"image":{"@id":"https://airdata.gitlab.io/blog/blog/terraform-create-multiple-ec2-different-config/#primaryimage"},"keywords":"terraform for-each and count,terraform for-each and count together","articleSection":"DevOps_Beginner,Terraform","inLanguage":"en-US","potentialAction":[{"@type":"CommentAction","name":"Comment","target":["https://airdata.gitlab.io/blog/blog/terraform-create-multiple-ec2-different-config/#respond"]}]},{"@type":"Person","@id":"https://www.middlewareinventory.com/#/schema/person/050bf13e27b309d29d1bda45c4eb3147","name":"Rumen Lishkov","image":{"@type":"ImageObject","@id":"https://www.middlewareinventory.com/#personlogo","inLanguage":"en-US","url":"https://secure.gravatar.com/avatar/c22e4a54d67750291a9892531f94ffb3?s=96&d=mm&r=g","caption":"Rumen Lishkov"}}]}</script>

<link rel='dns-prefetch' href='https://js.stripe.com' />
<link rel='dns-prefetch' href='https://fonts.googleapis.com' />
<link rel='dns-prefetch' href='https://s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Middleware Inventory &raquo; Feed" href="../../feed/index.rss" />
<link rel="alternate" type="application/rss+xml" title="Middleware Inventory &raquo; Comments Feed" href="../../comments/feed/index.rss" />
<link rel="alternate" type="application/rss+xml" title="Middleware Inventory &raquo; Terraform Create Multiple EC2 with different Configs &#8211; for_each and count together Comments Feed" href="feed/index.rss" />
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/www.middlewareinventory.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.5.6"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,8205,55356,57212],[55357,56424,8203,55356,57212])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel="stylesheet" href="../../wp-content/cache/minify/09591.css" media="all" />
<style id='ez-toc-inline-css' type='text/css'>div#ez-toc-container p.ez-toc-title {font-size: 120%;}div#ez-toc-container p.ez-toc-title {font-weight: 500;}div#ez-toc-container ul li {font-size: 95%;}div#ez-toc-container {width: 100%;}
</style>
<link rel="stylesheet" href="../../wp-content/cache/minify/f854f.css" media="all" />
<link rel='stylesheet' id='poseidon-default-fonts-css' href='https://fonts.googleapis.com/css?family=Ubuntu%3A400%2C400italic%2C700%2C700italic%7CRaleway%3A400%2C700&amp;subset=latin%2Clatin-ext' type='text/css' media='all' />
<link rel="stylesheet" href="../../wp-content/cache/minify/551a8.css" media="all" />
<script src="../../wp-content/cache/minify/c7035.js"></script>
<script type='text/javascript' id='cookie-notice-front-js-extra'>
/* <![CDATA[ */
var cnArgs = {"ajaxurl":"https:\/\/www.middlewareinventory.com\/wp-admin\/admin-ajax.php","hideEffect":"fade","onScroll":"no","onScrollOffset":"100","cookieName":"cookie_notice_accepted","cookieValue":"true","cookieTime":"2592000","cookiePath":"\/","cookieDomain":"","redirection":"","cache":"1","refuse":"yes","revoke_cookies":"0","revoke_cookies_opt":"automatic","secure":"1"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/545b0.js"></script>
<script type='text/javascript' id='email-subscribers-js-extra'>
/* <![CDATA[ */
var es_data = {"messages":{"es_empty_email_notice":"Please enter email address","es_rate_limit_notice":"You need to wait for sometime before subscribing again","es_single_optin_success_message":"Successfully Subscribed.","es_email_exists_notice":"Email Address already exists!","es_unexpected_error_notice":"Oops.. Unexpected error occurred.","es_invalid_email_notice":"Invalid email address","es_try_later_notice":"Please try after some time"},"es_ajax_url":"https:\/\/www.middlewareinventory.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/2975f.js"></script>
<!--[if lt IE 9]>
<script type='text/javascript' src='https://airdata.gitlab.io/blog/wp-content/themes/poseidon/js/html5shiv.min.js?ver=3.7.3' id='html5shiv-js'></script>
<![endif]-->
<script type='text/javascript' id='poseidon-post-slider-js-extra'>
/* <![CDATA[ */
var poseidon_slider_params = {"animation":"slide","speed":"7000"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/51af3.js"></script>
<script type='text/javascript' id='eio-lazy-load-js-extra'>
/* <![CDATA[ */
var eio_lazy_vars = {"exactdn_domain":"","skip_autoscale":"0"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/28f5b.js"></script>
<link rel="https://api.w.org/" href="../../wp-json/index.json" /><link rel="alternate" type="application/json" href="../../wp-json/wp/v2/posts/7302.json" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../xmlrpc.php-rsd.xml" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://www.middlewareinventory.com/wp-includes/wlwmanifest.xml" />
<meta name="generator" content="WordPress 5.5.6" />
<link rel='shortlink' href='index.html' />
<link rel="alternate" type="application/json+oembed" href="../../wp-json/oembed/1.0/embed-url=https---www.middlewareinventory.com-blog-terraform-create-multiple-ec2-different-config-.json" />
<link rel="alternate" type="text/xml+oembed" href="../../wp-json/oembed/1.0/embed-url=https---www.middlewareinventory.com-blog-terraform-create-multiple-ec2-different-config-&amp;format=xml.xml" />
<link href='https://fonts.googleapis.com/css?family=Strait:100,200,300,400,500,600,700,800,900&amp;subset=arabic,vietnamese,hebrew,thai,bengali,latin,latin-ext,cyrillic,cyrillic-ext,greek' rel='stylesheet' type='text/css'><style>a.idcore-button,a.idcore-button:visited{font-family:'Strait','arial';font-size:20px;color:#ffffff;font-weight:normal;font-style:normal;text-decoration:none !important;text-transform:uppercase;padding-top:16px;padding-bottom:16px;padding-left:32px;padding-right:32px;background-color:rgba(212, 7, 72, 1);background-image:linear-gradient(to bottom,rgba(255,255,255,.05) 0,rgba(255,255,255,.05) 50%,rgba(0,0,0,.05) 51%,rgba(0,0,0,.05) 100%);border-width:1px;border-style:solid;border-color:#d4150b;border-radius:3px;box-shadow: 2px 2px 0px 0px rgba(68, 68, 68, 0.2);}a.idcore-button:hover,a.idcore-button:focus{font-family:'Strait','arial';font-size:20px;color:#ffffff;font-weight:normal;font-style:normal;text-decoration:none !important;text-transform:uppercase;padding-top:16px;padding-bottom:16px;padding-left:32px;padding-right:32px;background-color:rgba(212, 7, 72, 1);background-image:linear-gradient(to bottom,rgba(255,255,255,.05) 0,rgba(255,255,255,.05) 50%,rgba(0,0,0,.05) 51%,rgba(0,0,0,.05) 100%);border-width:1px;border-style:solid;border-color:#d4150b;border-radius:3px;box-shadow: 2px 2px 0px 0px rgba(68, 68, 68, 0.2);}a.idcore-button:active{font-family:'Strait','arial';font-size:20px;color:#ffffff;font-weight:normal;font-style:normal;text-decoration:none !important;text-transform:uppercase;padding-top:16px;padding-bottom:16px;padding-left:32px;padding-right:32px;background-color:rgba(212, 7, 72, 1);background-image:linear-gradient(to bottom,rgba(255,255,255,.05) 0,rgba(255,255,255,.05) 50%,rgba(0,0,0,.05) 51%,rgba(0,0,0,.05) 100%);border-width:1px;border-style:solid;border-color:#d4150b;border-radius:3px;box-shadow: 2px 2px 0px 0px rgba(68, 68, 68, 0.2);}</style><script>var idcore_ajax_url = "https://www.middlewareinventory.com/wp-admin/admin-ajax.php";</script><style type='text/css'>.rp4wp-related-posts ul{width:100%;padding:0;margin:0;float:left;}
.rp4wp-related-posts ul>li{list-style:none;padding:0;margin:0;padding-bottom:20px;clear:both;}
.rp4wp-related-posts ul>li>p{margin:0;padding:0;}
.rp4wp-related-post-image{width:35%;padding-right:25px;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;float:left;}</style>
<noscript><style>.lazyload[data-src]{display:none !important;}</style></noscript><style type="text/css" id="sns_global_styles">/* for mobile */
@media screen and (max-width: 480px) {
    #text-23 {
        display:none !important;
    }
	p,li
    {
      font-size: 20px !important;
      color: #333 !important;
      line-height: 1.68 !important;;
    }
    .article-inner
    {
    	padding-right: 5% !important;
    	padding-left: 5% !important;
    }
    ul.related_post li
    {
    	width: 100% !important;
    }
    ul.related_post li a
    {
    	font-size: 20px !important;
    }
    ul.related_post li small {
    font-size: 100%;
    }
  
  #afc_sidebar_4348 
{
  height: 8vh; 
  max-height: 8vh; 
  background-color: transparent;
}
}

/* for Desktop */
@media screen and (min-width: 500px) {
#afc_sidebar_4348 
{
  height: 10vh; 
  max-height: 10vh; 
  background-color: transparent;
}
  #text-23 {
        display:none !important;
    }
	p,li
    {
        font-size: 20px !important;
        color: #333 !important;
        line-height: 1.68 !important;;
    }
    .article-inner
    {
    	padding-right: 5% !important;
    	padding-left: 5% !important;
    }
    ul.related_post li
    {
    	width: 100% !important;
    }
    ul.related_post li small {
    font-size: 100%;
    }
  

}

.es_lablebox {
    padding-bottom: 3px;
    color: steelblue !important;
    font-weight: bold !important;
}
.widget-title span {
    line-height: 2.2;
    color: steelblue !important;
}
.sidey {
	padding: 0;
}
.sumome-contactform 
{
  display: none;
}
code { 
    font-family: courier;
    font-size: 18px;
    padding: 2px;
    background-color: #f1f1f1;
    /*box-shadow: 0 2px 4px 0 rgba(0,0,0,0.16),0 2px 10px 0 rgba(0,0,0,0.12)!important;*/
    
}

.syntaxhighlighter {
    font-size: 14px !important;
}

pre {
 font-family: Menlo, Monaco, Consolas, "Courier New", monospace !important;
}

.black-red-border
{
    border-left: 3px solid;
    background-color: black;
    color: ghostwhite;
    border-left-color: red;
} 
}

#wpdevar_comment_1 span
{
  font-family:  "Open Sans", Helvetica, Arial, sans-serif !important;
  font-size: 20px !important;
  color: #1495b5 !important;
}

#wpdevar_comment_1 
{
  margin-top: 50px;
  margin-bottom: 30px;
}

summary
{
 color: steelblue; 
}

blockquote
{
  border-left-color: #cc0f77 !important;
  border-left-width: 4px !important;
  border-left-style: solid !important;
  background-color: #f5f5f5 !important;
}

.rp4wp-related-post-image{ width: auto !important; }

.main-navigation-menu
{
  float: none !important;
}

.primary-navigation
{
  float: none !important
}

body,html{
  /* font-family: 'Poppins', sans-serif; */
  font-family: "Source Sans Pro","Arial",sans-serif
}

.page-title, .entry-title, .site-title, .main-navigation-menu a, .widget-title
{
  /*font-family: 'Poppins', sans-serif; */
  font-family: "Source Sans Pro","Arial",sans-serif
}

#postfollow {
  background: whitesmoke;
  padding-top: 5%;
  padding-bottom: 5%;
  padding-left: 2%;
}
div#ez-toc-container p.ez-toc-title {
    font-weight: bold;
    font-size: 24px !important;
}
div#ez-toc-container {
    margin-bottom: 15%;
}

</style><link rel="icon" href="../../wp-content/uploads/2017/12/cropped-Screen-Shot-2017-12-22-at-12.16.54-PM-3-32x32.png" sizes="32x32" />
<link rel="icon" href="../../wp-content/uploads/2017/12/cropped-Screen-Shot-2017-12-22-at-12.16.54-PM-3-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="../../wp-content/uploads/2017/12/cropped-Screen-Shot-2017-12-22-at-12.16.54-PM-3-180x180.png" />
<meta name="msapplication-TileImage" content="https://airdata.gitlab.io/blog/wp-content/uploads/2017/12/cropped-Screen-Shot-2017-12-22-at-12.16.54-PM-3-270x270.png" />
<style type="text/css">article h3
{
    background-color: whitesmoke;
    color: black;
    padding-left: 1%;
    border-left: 10px solid black;
    font-weight: 400;
    font-size: 22px;
}
#precode
{
  background-color: transparent !important;
  color: #00193a !important;
  font-size: 16px;
}
.post-img
{
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
  border: 1px solid lightgray;
}
pre
{
  display: block; 
  overflow-x: auto; 
  padding-left: 2em;
  padding-top: 3em;
  padding-bottom: 3em;
  background: #eaeef3 none repeat scroll 0% 0%; 
  color: #00193a;
}
li {
    padding: 2px;
    margin-left: 2%;
}
code
{
  color: black;
}
blockquote {
    padding: 2%;
    background-color: none !important;
}
div.enlighter{
  font-size: 1.2em;  
}
.enlighter-default {
    padding-top: 10px;
    padding-bottom: 10px;
    font-family: Menlo, Monaco, Consolas, "Courier New", monospace !important;
}
tr,td,th
{
  border: 2px solid;
}
table  { margin-top:  20px; display: inline-block; overflow: auto; }
</style>
<style type="text/css" id="wp-custom-css">.site-title
{
   font-size: 24px !important;
}		</style>
</head>
<body class="post-template-default single single-post postid-7302 single-format-standard wp-custom-logo cookies-set cookies-accepted et_divi_builder et-pb-theme-poseidon et-db elementor-default">
<div id="page" class="hfeed site">
<a class="skip-link screen-reader-text" href="#content">Skip to content</a>
<div id="header-top" class="header-bar-wrap"></div>
<header id="masthead" class="site-header clearfix" role="banner">
<div class="header-main container clearfix">
<div id="logo" class="site-branding clearfix">
<a href="../../index.html" class="custom-logo-link" rel="home"><img width="160" height="120" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 107'%3E%3C/svg%3E" class="custom-logo lazyload" alt="Middleware Inventory" data-src="../../wp-content/uploads/2020/09/cropped-Screenshot-2020-09-18-at-3.49.40-AM.jpg" loading="lazy" /><noscript><img width="160" height="120" src="../../wp-content/uploads/2020/09/cropped-Screenshot-2020-09-18-at-3.49.40-AM.jpg" class="custom-logo" alt="Middleware Inventory" data-eio="l" /></noscript></a>
<p class="site-title"></p>
</div>
<nav id="main-navigation" class="primary-navigation navigation clearfix" role="navigation">
<ul id="menu-primary-menu" class="main-navigation-menu"><li id="menu-item-172" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-172"><a href="https://airdata.github.io/">About Me</a></li>
<li id="menu-item-3206" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-3206"><a href="../category/middleware/index.html">Middleware</a>
<ul class="sub-menu">
<li id="menu-item-1518" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1518"><a href="../category/weblogic/index.html">weblogic</a></li>
<li id="menu-item-3207" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3207"><a href="../category/was/index.html">WAS</a></li>
<li id="menu-item-3208" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3208"><a href="../category/websphere/index.html">Websphere</a></li>
<li id="menu-item-3209" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3209"><a href="../category/wlst/index.html">wlst</a></li>
<li id="menu-item-3210" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3210"><a href="../category/wsadmin-scripts/index.html">wsadmin scripts</a></li>
<li id="menu-item-3211" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3211"><a href="../category/jms/index.html">JMS</a></li>
<li id="menu-item-3212" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3212"><a href="../category/activemq/index.html">ActiveMQ</a></li>
<li id="menu-item-3213" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3213"><a href="../category/troubleshooting/index.html">Troubleshooting</a></li>
<li id="menu-item-3214" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3214"><a href="../category/apache/index.html">Apache</a></li>
<li id="menu-item-3215" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3215"><a href="../category/best-practice/index.html">Best Practice</a></li>
<li id="menu-item-3222" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3222"><a href="../category/f5-big-ip/index.html">F5-Big-IP</a></li>
</ul>
</li>
<li id="menu-item-3157" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-3157"><a href="../../devops-junction/index.html">Devops</a>
<ul class="sub-menu">
<li id="menu-item-1513" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1513"><a href="../category/ansible/index.html">Ansible</a></li>
<li id="menu-item-3216" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3216"><a href="../category/aws/index.html">AWS</a></li>
<li id="menu-item-3217" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3217"><a href="../category/docker/index.html">Docker</a></li>
<li id="menu-item-3218" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3218"><a href="../category/packer/index.html">Packer</a></li>
<li id="menu-item-3219" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3219"><a href="../category/splunk/index.html">Splunk</a></li>
<li id="menu-item-3220" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-3220"><a href="../category/terraform/index.html">Terraform</a></li>
<li id="menu-item-3221" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3221"><a href="../category/vagrant/index.html">Vagrant</a></li>
<li id="menu-item-3223" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3223"><a href="../category/kubernetes/index.html">Kubernetes</a></li>
</ul>
</li>
<li id="menu-item-8820" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8820"><a href="../../newsletter/index.html">Newsletter</a></li>
<li id="menu-item-8821" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8821"><a href="https://rumen.free.bg/#contact">Book a Consultation</a></li>
</ul> </nav>
</div>
</header>
<div id="content" class="site-content container clearfix">
<section id="primary" class="content-area">
<main id="main" class="site-main" role="main">

<article id="post-7302" class="post-7302 post type-post status-publish format-standard has-post-thumbnail hentry category-devops_beginner category-terraform tag-terraform-for-each-and-count tag-terraform-for-each-and-count-together wpautop">
<header class="entry-header">
<h1 class="entry-title">Terraform Create Multiple EC2 with different Configs &#8211; for_each and count together</h1>
<div class="entry-meta"><span class="meta-date"> Updated on: <a href="index.html" title="8:35 pm" rel="bookmark"><time class="entry-date published updated" datetime="November 11, 2022">November 11, 2022</time></a></span><span class="meta-author"> <span class="author vcard"><a class="url fn n" href="../author/admin/index.html" title="View all posts by Rumen Lishkov" rel="author">Rumen Lishkov</a></span></span></div>
</header>
<div class="entry-content clearfix">
<div class="ss-inline-share-wrapper ss-left-inline-content ss-small-icons ss-with-spacing ss-rounded-icons">
<div class="ss-inline-share-content">
<ul class="ss-social-icons-container">
<li class="">
<a href="#" data-ss-ss-link="https://www.facebook.com/sharer.php?t=Terraform%20Create%20Multiple%20EC2%20with%20different%20Configs%20%E2%80%93%20for_each%20and%20count%20together&u=https%3A%2F%2Fwww.middlewareinventory.com%2Fblog%2Fterraform-create-multiple-ec2-different-config%2F" class="ss-facebook-color" rel="nofollow" data-ss-ss-network-id="facebook" data-ss-ss-post-id="7302" data-ss-ss-location="inline_content" data-ss-ss-permalink="https://airdata.gitlab.io/blog/blog/terraform-create-multiple-ec2-different-config/" data-ss-ss-type="share" data-has-api="true">
<span class="ss-share-network-content">
<i class="ss ss-facebook"></i>
<span class="ss-network-count">
0
</span>
</span>
</a>
</li>
<li class="">
<a href="#" data-ss-ss-link="https://twitter.com/intent/tweet?text=Terraform+Create+Multiple+EC2+with+different+Configs+%E2%80%93+for_each+and+count+together&url=https%3A%2F%2Fwww.middlewareinventory.com%2Fblog%2Fterraform-create-multiple-ec2-different-config%2F" class="ss-twitter-color" rel="nofollow" data-ss-ss-network-id="twitter" data-ss-ss-post-id="7302" data-ss-ss-location="inline_content" data-ss-ss-permalink="https://airdata.gitlab.io/blog/blog/terraform-create-multiple-ec2-different-config/" data-ss-ss-type="share">
<span class="ss-share-network-content">
<i class="ss ss-twitter"></i>
</span>
</a>
</li>
<li class="">
<a href="#" data-ss-ss-link="https://www.linkedin.com/shareArticle?title=Terraform%20Create%20Multiple%20EC2%20with%20different%20Configs%20%E2%80%93%20for_each%20and%20count%20together&url=https%3A%2F%2Fwww.middlewareinventory.com%2Fblog%2Fterraform-create-multiple-ec2-different-config%2F&mini=true" class="ss-linkedin-color" rel="nofollow" data-ss-ss-network-id="linkedin" data-ss-ss-post-id="7302" data-ss-ss-location="inline_content" data-ss-ss-permalink="https://airdata.gitlab.io/blog/blog/terraform-create-multiple-ec2-different-config/" data-ss-ss-type="share">
<span class="ss-share-network-content">
<i class="ss ss-linkedin"></i>
</span>
</a>
</li>
<li class="">
<a href="#" data-ss-ss-link="mailto:?body=https%3A%2F%2Fwww.middlewareinventory.com%2Fblog%2Fterraform-create-multiple-ec2-different-config%2F&subject=Terraform%20Create%20Multiple%20EC2%20with%20different%20Configs%20%E2%80%93%20for_each%20and%20count%20together" class="ss-envelope-color" rel="nofollow" data-ss-ss-network-id="envelope" data-ss-ss-post-id="7302" data-ss-ss-location="inline_content" data-ss-ss-permalink="https://airdata.gitlab.io/blog/blog/terraform-create-multiple-ec2-different-config/" data-ss-ss-type="share">
<span class="ss-share-network-content">
<i class="ss ss-envelope"></i>
</span>
</a>
</li>
<li class="">
<a href="#" data-ss-ss-link="#" class="ss-copy-color" rel="nofollow" data-ss-ss-network-id="copy" data-ss-ss-post-id="7302" data-ss-ss-location="inline_content" data-ss-ss-permalink="https://airdata.gitlab.io/blog/blog/terraform-create-multiple-ec2-different-config/" data-ss-ss-type="share">
<span class="ss-share-network-content">
<i class="ss ss-copy"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<p>Those who have been using Terraform might already know that you can create multiple numbers of the same resources with the help of <code>count</code> or <code>for_each</code></p>
<p>But What if we want to create multiple resources with different configurations at the same time.</p>
<p>For example. we can easily create No of EC2 instances with the same set of configurations like AMI, Subnet, MachineType with the help of <code>count</code></p>
<pre class="EnlighterJSRAW" data-enlighter-language="json" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false" data-enlighter-highlight="4">resource "aws_instance" "web" {
  ami           = "ami-007a18d38016a0f4e"
  instance_type = "t3.medium"
  count = 5
  vpc_security_group_ids = [
    "sg-0d8bdc716e7baee9f"
  ]</pre>
<p>But what if we want multiple resources with a different set of configuration and each resource have to created in a specific amount ( 3, 4 etc)</p>
<p>If you think we can use <code>count</code> and <code>for_each</code> under the resource_block and try it. you would see the following error from Terraform.</p>
<pre class="fs-headline1 ow-break-word mb8 flex--item fl1">The "count" and "for_each" meta-arguments are mutually-exclusive, 
only one should be used to be explicit about the number of resources to be created</pre>
<p>Yes.  you cannot use <code>count</code> and <code>for_each</code> together under the same resource block.</p>
<p>So how to do it is what  We are going to see in this article.</p>
<p><a href="../../wp-content/uploads/2021/09/tf-for_each.jpg"><img class="post-img alignnone wp-image-7342 size-full lazyload" src="../../wp-content/ewww/lazy/placeholder-1748x1240.png" alt="terraform for_each" width="1748" height="1240" data-src="../../wp-content/uploads/2021/09/tf-for_each.jpg" loading="lazy" data-srcset="../../wp-content/uploads/2021/09/tf-for_each.jpg 1748w, ../../wp-content/uploads/2021/09/tf-for_each-300x213.jpg 300w, ../../wp-content/uploads/2021/09/tf-for_each-1024x726.jpg 1024w, ../../wp-content/uploads/2021/09/tf-for_each-768x545.jpg 768w, ../../wp-content/uploads/2021/09/tf-for_each-1536x1090.jpg 1536w, ../../wp-content/uploads/2021/09/tf-for_each-90x65.jpg 90w" data-sizes="auto" /><noscript><img class="post-img alignnone wp-image-7342 size-full" src="../../wp-content/uploads/2021/09/tf-for_each.jpg" alt="terraform for_each" width="1748" height="1240" srcset="../../wp-content/uploads/2021/09/tf-for_each.jpg 1748w, ../../wp-content/uploads/2021/09/tf-for_each-300x213.jpg 300w, ../../wp-content/uploads/2021/09/tf-for_each-1024x726.jpg 1024w, ../../wp-content/uploads/2021/09/tf-for_each-768x545.jpg 768w, ../../wp-content/uploads/2021/09/tf-for_each-1536x1090.jpg 1536w, ../../wp-content/uploads/2021/09/tf-for_each-90x65.jpg 90w" sizes="(max-width: 1748px) 100vw, 1748px" data-eio="l" /></noscript></a></p>
<div id="ez-toc-container" class="counter-hierarchy counter-decimal ez-toc-grey">
<div class="ez-toc-title-container">
<p class="ez-toc-title">Table of Contents</p>
<span class="ez-toc-title-toggle"><a class="ez-toc-pull-right ez-toc-btn ez-toc-btn-xs ez-toc-btn-default ez-toc-toggle"><i class="ez-toc-glyphicon ez-toc-icon-toggle"></i></a></span></div>
<nav><ul class="ez-toc-list"><li><a href="#How_to_use_for-each_and_count_together_in_Terraform" title="How to use for-each and count together in Terraform">How to use for-each and count together in Terraform</a></li><li><a href="#Download_the_Code_to_begin_with" title="Download the Code to begin with">Download the Code to begin with</a></li><li><a href="#A_quick_look_at_the_files_Decoding_the_configuration" title="A quick look at the files &#8211; Decoding the configuration">A quick look at the files &#8211; Decoding the configuration</a><ul><li><a href="#variablestf" title="variables.tf">variables.tf</a></li><li><a href="#devtfvars_A_Snapshot_of_our_Infra_we_are_going_to_create" title="dev.tfvars  &#8211; A Snapshot of our Infra we are going to create
">dev.tfvars  &#8211; A Snapshot of our Infra we are going to create
</a></li><li><a href="#maintf_The_Configuration_that_does_the_magic" title="main.tf &#8211; The Configuration that does the magic">main.tf &#8211; The Configuration that does the magic</a></li><li><a href="#resource_block" title="resource block">resource block</a></li></ul></li><li><a href="#Validation_and_Running_the_Configuration" title="Validation and Running the Configuration">Validation and Running the Configuration</a></li><li><a href="#Validate_the_EC2_instances_are_Launched" title="Validate the EC2 instances are Launched">Validate the EC2 instances are Launched</a></li><li><a href="#Conclusion" title="Conclusion">Conclusion</a></li></ul></nav></div>
<h2><span class="ez-toc-section" id="How_to_use_for-each_and_count_together_in_Terraform">How to use <span style="color: #eb1a74;">for-each </span>and<span style="color: #eb1a74;"> count</span> together in Terraform</span></h2>
<p>As we already know,  The <code>count</code> and <code>for_each</code> are mutually exclusive but we need to use both of them to complete our requirement: <strong>creating multiple resources with different sets of configurations and counts.</strong></p>
<p>So. How to get this done.</p>
<p>Without using Count and for_each together we are going to achieve the same result that we are trying to achieve with the help of the following functions/expression</p>
<ul>
<li><strong>for</strong> &#8211; A loop expression to traverse and create dynamic blocks to match the number of instances with dynamic names for each instance</li>
<li><strong>range </strong>&#8211; used inside for expression to create a dynamic range according to the number set for the <code>count</code> let&#8217;s say no of instances</li>
<li><strong>flatten</strong> &#8211; to convert the nested list to a single list</li>
</ul>
<p>Before we go deep and see how to use each of these expressions to get our requirement completed.</p>
<p>You can download the code from Github and get ready.</p>
<p>&nbsp;</p>
<h2><span class="ez-toc-section" id="Download_the_Code_to_begin_with"><span style="color: #eb1a74;">Download the Code</span> to begin with</span></h2>
<p>Now it&#8217;s time to go practical. Though we will be discussing each segment of the code in detail.  To begin with. you can download/clone the code from this repository</p>
<pre>git clone https://github.com/AKSarav/Terraform-Count-ForEach</pre>
<p>&nbsp;</p>
<h2><span class="ez-toc-section" id="A_quick_look_at_the_files_Decoding_the_configuration">A quick look at the files &#8211; <span style="color: #eb1a74;">Decoding</span> the configuration</span></h2>
<p>After you have downloaded the files or cloned the Git repo. You can see three files</p>
<ul>
<li><strong>main.tf</strong> &#8211; the main Terraform configuration files</li>
<li><strong>variables.tf</strong> &#8211; For declaring and initializing the variables</li>
<li><strong>dev.tfvars </strong>&#8211; A File with variables filled with values.</li>
</ul>
<p>Let us learn more about each files in detail</p>
<p>We can start with the <code>variables.tf</code> file which has a minimal content.</p>
<p>&nbsp;</p>
<h3><span class="ez-toc-section" id="variablestf">variables.tf</span></h3>
<p>the <code>variables.tf</code> file is used to declare the list of variables that we might be using on the terraform code.</p>
<p>If the variable is defined/declared here and not provided with a value. Terraform would throw an error.</p>
<p>If the variables is not declared but used on the Terraform configuration. It would throw an error and ask you to declare it.</p>
<p>So this is basically a way to isolate and document all the variables necessary for the terraform module or configuration to work.</p>
<p>In our case, we are declaring only one variable named <code>configuration</code></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">variable "configuration" {
  description = "The total configuration, List of Objects/Dictionary"
  default = [{}]
}</pre>
<p>&nbsp;</p>
<h3><span class="ez-toc-section" id="devtfvars_A_Snapshot_of_our_Infra_we_are_going_to_create">dev.tfvars  &#8211; A Snapshot of our Infra we are going to create<strong><br />
</strong></span></h3>
<p>this tfvars file is where we provide actual values for the variables we declare.</p>
<p>we can have different <code>tfvars</code> file and launch our terraform with customizations every time we launch using <code>--var-file</code> attribute</p>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>to be precise. you can have different tfvars file for each environment with different sets of values and name them as <code>dev.tfvars, qa.tfvars, prod.tfvars, dr.tfvars</code> etc to cover different environments like dev,QA, prod,dr accordingly</p>
<p>In our case, we are having a single tfvars file named <code>dev.tfvars</code> with the following content</p>
<pre class="EnlighterJSRAW" data-enlighter-language="json" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">configuration = [
  {
    "application_name" : "GritfyApp-dev",
    "ami" : "ami-09e67e426f25ce0d7",
    "no_of_instances" : "2",
    "instance_type" : "t2.medium",
    "subnet_id" : "subnet-0f4f294d8404946eb",
    "vpc_security_group_ids" : ["sg-0d15a4cac0567478c","sg-0d8749c35f7439f3e"]
  },
  {
    "application_name" : "GrityWeb-dev",
    "ami" : "ami-0747bdcabd34c712a",
    "instance_type" : "t2.micro",
    "no_of_instances" : "1"
    "subnet_id" : "subnet-0f4f294d8404946eb"
    "vpc_security_group_ids" : ["sg-0d15a4cac0567478c"]
  },
  {
    "application_name" : "OpsGrit-dev",
    "ami" : "ami-0747bdcabd34c712a",
    "instance_type" : "t3.micro",
    "no_of_instances" : "3"
    "subnet_id" : "subnet-0f4f294d8404946eb"
    "vpc_security_group_ids" : ["sg-0d15a4cac0567478c"]
  }
  
]</pre>
<p>As you can see, we have filled the variable named <code>configuration</code> we have declared earlier on the <code>variables.tf</code> file.</p>
<p>we are going to create 6 EC2 instances for three different applications. thanks to <code>count</code></p>
<p>I have compiled it as a table for you to grasp it real quick.</p>
<table style="width: 100%; border-collapse: collapse; overflow: auto;" border="2">
<tbody>
<tr style="height: 28px; background-color: #54a5de;">
<td style="width: 16.6667%; height: 28px;">Application Name</td>
<td style="width: 16.6667%; height: 28px;"> AMI ID</td>
<td style="width: 16.6667%; height: 28px;">No Of Instances(Count)</td>
<td style="width: 16.6667%; height: 28px;">Instance type</td>
<td style="width: 16.6667%; height: 28px;">subnet_id</td>
<td style="width: 16.6667%; height: 28px;">security_group_ids</td>
</tr>
<tr style="height: 28px;">
<td style="width: 16.6667%; height: 28px;">GritfyApp</td>
<td style="width: 16.6667%; height: 28px;">ami-09e67e426f25ce0d7</td>
<td style="width: 16.6667%; height: 28px;">2</td>
<td style="width: 16.6667%; height: 28px;">t2.medium</td>
<td style="width: 16.6667%; height: 28px; border-style: solid; border: 1px;">subnet-0f4f294d8404946eb</td>
<td style="width: 16.6667%; height: 28px;">sg-0d15a4cac0567478c,sg-0d8749c35f7439f3e</td>
</tr>
<tr style="height: 53px;">
<td style="width: 16.6667%; height: 53px;">GritfyWeb</td>
<td style="width: 16.6667%; height: 53px;">ami-0747bdcabd34c712a</td>
<td style="width: 16.6667%; height: 53px;">1</td>
<td style="width: 16.6667%; height: 53px;">t2.micro</td>
<td style="width: 16.6667%; height: 53px;">subnet-0f4f294d8404946eb</td>
<td style="width: 16.6667%; height: 53px;">sg-0d15a4cac0567478c</td>
</tr>
<tr style="height: 28px;">
<td style="width: 16.6667%; height: 28px;">OpsGrit</td>
<td style="width: 16.6667%; height: 28px;">ami-0747bdcabd34c712a</td>
<td style="width: 16.6667%; height: 28px;">3</td>
<td style="width: 16.6667%; height: 28px;">t3.micro</td>
<td style="width: 16.6667%; height: 28px;">subnet-0f4f294d8404946eb</td>
<td style="width: 16.6667%; height: 28px;">sg-0d15a4cac0567478c</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>As you can see each application has different configurations in terms of count, AMI and instance type and security group</p>
<p>&nbsp;</p>
<h3><span class="ez-toc-section" id="maintf_The_Configuration_that_does_the_magic">main.tf &#8211; The Configuration that does the magic</span></h3>
<p>This is the main configuration file of terraform with all the logic and looping expressions we have talked earlier about.</p>
<p>Let us see what each block on this file is doing, in detail.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">provider "aws" {
  region = "us-east-1"
  profile = "personal"

}

locals {
  serverconfig = [
    for srv in var.configuration : [
      for i in range(1, srv.no_of_instances+1) : {
        instance_name = "${srv.application_name}-${i}"
        instance_type = srv.instance_type
        subnet_id   = srv.subnet_id
        ami = srv.ami
        security_groups = srv.vpc_security_group_ids
      }
    ]
  ]
}

// We need to Flatten it before using it
locals {
  instances = flatten(local.serverconfig)
}

resource "aws_instance" "web" {

  for_each = {for server in local.instances: server.instance_name =&gt;  server}
  
  ami           = each.value.ami
  instance_type = each.value.instance_type
  vpc_security_group_ids = each.value.security_groups
  user_data = &lt;&lt;EOF
#!/bin/bash
echo "Copying the SSH Key to the remote server"
echo -e "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDvhXuMn9FwsrcK/DkgOlZdQFbY9e0+InX2sdHm8ZF7hGOQvg3CTMdBtMHlALnzqsYlS0aN0puzNF7fWAvUawdGjcSYxKEMlO1CaKPYxEgLTPDdiuYm3DNUutNMOLB0KHSJDk1Vb83UEpXm4vZjAWwHQTgoSsyXA57GcV4+IiTOy+iIIiiB7XzTDjt7ePVOW237HJAENlB/txh0qEl4Gn0eNGykg2E00jN8cOfIf/sKuY2kXBRgSjTjr6HArB4an6+aJpNJMWFFLyk47+NOIepaZhJNuXL39y0kGp/KzTlQw45g+ct92CSoCvySGqSUGN85ofPeYfzwB45yVJ9bMrZpY88TG4kLGAFeAg4DHVxUmJQhbjQOBRL8FDadOZuHmawlBUNeqFFtQ1EAad9Z2FWAZ80htaPysE9coA2VXC559VapIs9fsx2nPStKoB8bPP91rArS4Q9tt077+BgPE3d4IK2GRTYsC1TXzrF6hvGGk9zk+nWpZMqDtW5sQxdxl0k=" &gt;&gt; /home/ubuntu/.ssh/authorized_keys

echo "Changing the hostname to ${each.value.instance_name}"
hostname ${each.value.instance_name}
echo "${each.value.instance_name}" &gt; /etc/hostname

EOF
  subnet_id = each.value.subnet_id
  tags = {
    Name = "${each.value.instance_name}"
  }
}

output "instances" {
  value       = "${aws_instance.web}"
  description = "All Machine details"
}
</pre>
<p>&nbsp;</p>
<p><span style="font-size: 18pt; color: #125ba3;"><strong>Provider block</strong></span></p>
<p>the provider block is to tell terraform what Provider to use like <code>AWS GCP</code> etc and additional information to login to the provider API</p>
<p>in our case we are using the <code>AWS CLI</code> <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-profiles.html">Named Profiles.</a></p>
<p>My profile name is <code>personal</code> and the region I have chosen in <code>us-east-1</code></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">provider "aws" {
  region = "us-east-1"
  profile = "personal"
}</pre>
<p>&nbsp;</p>
<p><span style="color: #125ba3; font-size: 18pt;"><strong>locals block</strong></span></p>
<p>As discussed earlier, we cannot directly consume our variable <code>configuration</code>  using <code>for_each</code>  if we do that, Terraform would not let us use <code>count</code> on the same block because both are for loop expressions therefore mutually exclusive to each other.</p>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>Having said that. Now we need to find a way to generate repeated resource blocks somewhere outside but not in the <code>aws_instance</code> resource block.</p>
<p>thats what we are going to do in the locals block.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">locals {
  serverconfig = [
    for srv in var.configuration : [
      for i in range(1, srv.no_of_instances+1) : {
        instance_name = "${srv.application_name}-${i}"
        instance_type = srv.instance_type
        subnet_id   = srv.subnet_id
        ami = srv.ami
        security_groups = srv.vpc_security_group_ids
      }
    ]
  ]
}

// We need to Flatten it before using it
locals {
  instances = flatten(local.serverconfig)
}</pre>
<p>&nbsp;</p>
<p>We have two <code>local</code> variables named <code>serverconfig</code> and <code>instances</code></p>
<ul>
<li><strong>serverconfig</strong> &#8211; is to create a dynamic block of server configuration, in a list of objects <code>[[{}],[{}],[{}]</code> format</li>
<li><strong>instances &#8211;</strong> to turn multiple nested lists into a single flat list  with flatten<code>[{},{},{}]</code></li>
</ul>
<p>I know it must be a little hard to understand but thanks to <code>terraform console</code> which can help us debug what these variables look like during the runtime.</p>
<p>Refer the following Quick video to understand the actual runtime values of these variables.</p>
<p><script id="asciicast-q6SUoYOCs4iaYBLI7zLQ5D9oZ" src="https://asciinema.org/a/q6SUoYOCs4iaYBLI7zLQ5D9oZ.js" async></script></p>
<h3><span class="ez-toc-section" id="resource_block"><span style="color: #125ba3; font-size: 18pt;">resource block</span></span></h3>
<p>Now the resource block is pretty much typical. except we have a <code>for_each</code> loop set based on the <code>local.instances</code> variable we have created using locals block.</p>
<p>As you know the instances block contains the list of objects <code>[{},{},{}]</code> that represents the configuration of different instances we are going to create.</p>
<p>the key logic part is done by this statement</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4">for_each = {for server in local.instances: server.instance_name =&gt; server}</pre>
<p>we are passing the <code>for</code> expression&#8217;s output  into <code>for_each</code></p>
<p>Now to clarify what is the output of our for expression. Let us use <code>terraform console</code> once again</p>
<p>and paste the for expression along with the parenthesis</p>
<p><a href="../../wp-content/uploads/2021/09/TerraformConsole-ForLoop-scaled.jpg"><img class="alignnone wp-image-7319 size-full lazyload" src="../../wp-content/ewww/lazy/placeholder-1920x1391.png" alt="terraform for_each" width="2560" height="1855" data-src="../../wp-content/uploads/2021/09/TerraformConsole-ForLoop-scaled.jpg" loading="lazy" data-srcset="../../wp-content/uploads/2021/09/TerraformConsole-ForLoop-scaled.jpg 2560w, ../../wp-content/uploads/2021/09/TerraformConsole-ForLoop-300x217.jpg 300w, ../../wp-content/uploads/2021/09/TerraformConsole-ForLoop-1024x742.jpg 1024w, ../../wp-content/uploads/2021/09/TerraformConsole-ForLoop-768x556.jpg 768w, ../../wp-content/uploads/2021/09/TerraformConsole-ForLoop-1536x1113.jpg 1536w, ../../wp-content/uploads/2021/09/TerraformConsole-ForLoop-2048x1484.jpg 2048w, ../../wp-content/uploads/2021/09/TerraformConsole-ForLoop-90x65.jpg 90w" data-sizes="auto" /><noscript><img class="alignnone wp-image-7319 size-full" src="../../wp-content/uploads/2021/09/TerraformConsole-ForLoop-scaled.jpg" alt="terraform for_each" width="2560" height="1855" srcset="../../wp-content/uploads/2021/09/TerraformConsole-ForLoop-scaled.jpg 2560w, ../../wp-content/uploads/2021/09/TerraformConsole-ForLoop-300x217.jpg 300w, ../../wp-content/uploads/2021/09/TerraformConsole-ForLoop-1024x742.jpg 1024w, ../../wp-content/uploads/2021/09/TerraformConsole-ForLoop-768x556.jpg 768w, ../../wp-content/uploads/2021/09/TerraformConsole-ForLoop-1536x1113.jpg 1536w, ../../wp-content/uploads/2021/09/TerraformConsole-ForLoop-2048x1484.jpg 2048w, ../../wp-content/uploads/2021/09/TerraformConsole-ForLoop-90x65.jpg 90w" sizes="(max-width: 2560px) 100vw, 2560px" data-eio="l" /></noscript></a></p>
<p>As presented in the image above. you can see that the for expression is creating a list of objects with instance_name added as a key</p>
<pre>{
  instance_name-[0-9] = {
  },
  instance_name-[0-9] = {
  }
}</pre>
<p>So basically it is creating dynamic blocks of instance configuration with customized configurations like <code>ami</code>, <code>name</code>, <code>instance type</code> etc</p>
<p>&nbsp;</p>
<h2><span class="ez-toc-section" id="Validation_and_Running_the_Configuration">Validation and Running the Configuration</span></h2>
<p>If you have just downloaded the code and cloned the repo. you might have to initialize the terraform using the following command</p>
<pre>⇒ terraform init</pre>
<p>now it&#8217;s a time that we validate if we have made any syntax issues on our configuration file using the following command</p>
<pre>⇒ terraform validate
Success! The configuration is valid.</pre>
<p>After the validation is successful we can go ahead and create a plan document</p>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>Since we have a custom <code>tfvars</code> file we need to use the <code>-var-file</code> during the plan and apply</p>
<pre>⇒ terraform plan -var-file=dev.tfvars -out devtfplan.out</pre>
<p>Once you are satisfied with the plan</p>
<p>You can apply the changes using the following command and make sure you use the right <code>out</code> file. in our case its <code>devtfplan.out</code></p>
<pre>⇒ terraform apply "devtfplan.out"</pre>
<p>Sit back and relax. while the Terraform creates all the instances</p>
<p>Here is the Screen record of Terraform <code>plan</code> and <code>apply</code>  execution from my end.</p>
<p><script id="asciicast-JGQIa0WCvsgaigSl5HxKTUqnS" src="https://asciinema.org/a/JGQIa0WCvsgaigSl5HxKTUqnS.js" async></script></p>
<p>&nbsp;</p>
<h2><span class="ez-toc-section" id="Validate_the_EC2_instances_are_Launched">Validate the EC2 instances are Launched</span></h2>
<p>Now head to AWS Management Console and you can see that the EC2 instances are created and waiting for you</p>
<p><a href="../../wp-content/uploads/2021/09/Screenshot-2021-09-25-at-5.35.54-PM.png"><img class="post-img alignnone wp-image-7326 size-full lazyload" src="../../wp-content/ewww/lazy/placeholder-1920x392.png" alt="terraform for_each" width="3098" height="632" data-src="../../wp-content/uploads/2021/09/Screenshot-2021-09-25-at-5.35.54-PM.png" loading="lazy" data-srcset="../../wp-content/uploads/2021/09/Screenshot-2021-09-25-at-5.35.54-PM.png 3098w, ../../wp-content/uploads/2021/09/Screenshot-2021-09-25-at-5.35.54-PM-300x61.png 300w, ../../wp-content/uploads/2021/09/Screenshot-2021-09-25-at-5.35.54-PM-1024x209.png 1024w, ../../wp-content/uploads/2021/09/Screenshot-2021-09-25-at-5.35.54-PM-768x157.png 768w, ../../wp-content/uploads/2021/09/Screenshot-2021-09-25-at-5.35.54-PM-1536x313.png 1536w, ../../wp-content/uploads/2021/09/Screenshot-2021-09-25-at-5.35.54-PM-2048x418.png 2048w" data-sizes="auto" /><noscript><img class="post-img alignnone wp-image-7326 size-full" src="../../wp-content/uploads/2021/09/Screenshot-2021-09-25-at-5.35.54-PM.png" alt="terraform for_each" width="3098" height="632" srcset="../../wp-content/uploads/2021/09/Screenshot-2021-09-25-at-5.35.54-PM.png 3098w, ../../wp-content/uploads/2021/09/Screenshot-2021-09-25-at-5.35.54-PM-300x61.png 300w, ../../wp-content/uploads/2021/09/Screenshot-2021-09-25-at-5.35.54-PM-1024x209.png 1024w, ../../wp-content/uploads/2021/09/Screenshot-2021-09-25-at-5.35.54-PM-768x157.png 768w, ../../wp-content/uploads/2021/09/Screenshot-2021-09-25-at-5.35.54-PM-1536x313.png 1536w, ../../wp-content/uploads/2021/09/Screenshot-2021-09-25-at-5.35.54-PM-2048x418.png 2048w" sizes="(max-width: 3098px) 100vw, 3098px" data-eio="l" /></noscript></a></p>
<p>You can log in to the machines directly as you have copied your <code>SSH</code> to authorized_keys as part of <code>user_data</code></p>
<p>&nbsp;</p>
<h2><span class="ez-toc-section" id="Conclusion">Conclusion</span></h2>
<p>As part of this article, we have covered various sub scenarios like</p>
<ul>
<li>Create multiple EC2 instances with different sets of configuration</li>
<li>How to use Count and For_each together</li>
<li>Debug variables in Terraform and know their values at runtime with Terraform console</li>
<li>How to process a List of dictionaries in terraform using For and For_each.</li>
<li>How to use For and For_each on Terraform resources.</li>
</ul>
<p>Not just for EC2. you can tweak this solution and try it for other AWS resources too.</p>
<p>Hope this helps. If you have any feedback or a better way to do this. Please share it with us in the comments section.</p>
<p>Are you looking for Digital Transformation Partner or DevOps as a Service solution. <a href="https://rumen.free.bg">Try us</a></p>
<a href="../../wp-content/uploads/2021/09/DaaS.svg"><img class="post-img lazyload" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1047 415'%3E%3C/svg%3E" alt="gritfy" width="1047" height="415" class="post-img lazyload" data-src="../../wp-content/uploads/2021/09/DaaS.svg" loading="lazy" /><noscript><img class="post-img" src="../../wp-content/uploads/2021/09/DaaS.svg" alt="gritfy" width="1047" height="415" class="alignnone size-full wp-image-6623" data-eio="l" /></noscript></a>
<p>&nbsp;</p>
<p>Cheers<br />
Rumen Lishkov</p>
<div id="postfollow">
<a href='https://ko-fi.com/O4O51FG7C' target='_blank'><img height='46' style='border:0px;height:46px;width: 186px' src='data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==' border='0' alt='Buy Me a Coffee at ko-fi.com' data-src="https://az743702.vo.msecnd.net/cdn/kofi3.png?v=2" loading="lazy" class="lazyload" /><noscript><img height='46' style='border:0px;height:46px;width: 186px' src='https://az743702.vo.msecnd.net/cdn/kofi3.png?v=2' border='0' alt='Buy Me a Coffee at ko-fi.com' data-eio="l" /></noscript></a>
<p>Follow us on<a href="https://www.facebook.com/rumenlishkov">Facebook</a> or<a href="https://www.twitter.com/mwinventory">Twitter</a>
</br>
For more practical videos and tutorials. <a href="https://www.youtube.com/kiss2mark">Subscribe to our channel</a>
</br>
Follow me on Linkedin <a href="https://www.linkedin.com/comm/mynetwork/discovery-see-all?usecase=PEOPLE_FOLLOWS&amp;followMember=saravakmwinventory">My Profile</a>
</br>
</i>For any Consultation or to hire us <a href="../../cdn-cgi/l/email-protection.html#a9c1ccc5c5c6e9cedbc0ddcfd087cac6c4"> <span class="__cf_email__" data-cfemail="e9818c858586a98e9b809d8f90c78a8684">[email&#160;protected]</span></a>
</br>
If you like this article. Show your Support! <a href="https://ko-fi.com/middlewareinventory">Buy me a Coffee.</a>
</br>
</p>
<p style="color: palevioletred !important;">Signup for Exclusive "Subscriber-only" Content</p>
<div class="emaillist">
<form action="#" method="post" class="es_subscription_form es_shortcode_form" id="es_subscription_form_1668110840" data-source="ig-es">
<div class="es-field-wrap"><label>Name*<br /><input type="text" name="name" class="ig_es_form_field_name" placeholder="" value="" required="required" /></label></div><div class="es-field-wrap"><label>Email*<br /><input class="es_required_field es_txt_email ig_es_form_field_email" type="email" name="email" value="" placeholder="" required="required" /></label></div><input type="hidden" name="lists[]" value="1" /><input type="hidden" name="form_id" value="3" />
<input type="hidden" name="es_email_page" value="7302" />
<input type="hidden" name="es_email_page_url" value="https://airdata.gitlab.io/blog/blog/terraform-create-multiple-ec2-different-config/" />
<input type="hidden" name="status" value="Unconfirmed" />
<input type="hidden" name="es-subscribe" id="es-subscribe" value="bbb2d371ca" />
<label style="position:absolute;top:-99999px;left:-99999px;z-index:-99;"><input type="email" name="es_hp_email" class="es_required_field" tabindex="-1" autocomplete="-1" value="" /></label>
<input type="submit" name="submit" class="es_subscription_form_submit es_submit_button es_textbox_button" id="es_subscription_form_submit_1668110840" value="Subscribe" />
<span class="es_spinner_image" id="spinner-image"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Loading" data-src="../../wp-content/plugins/email-subscribers/lite/public/images/spinner.gif" loading="lazy" class="lazyload" /><noscript><img src="../../wp-content/plugins/email-subscribers/lite/public/images/spinner.gif" alt="Loading" data-eio="l" /></noscript></span>
</form>
<span class="es_subscription_message" id="es_subscription_message_1668110840"></span>
</div>
</div>
<hr>
<div class='rp4wp-related-posts'>
<h3>More from Middleware Inventory</h3>
<ul>
<li><div class='rp4wp-related-post-image'>
<a href='../ansible-aws-ec2/index.html'><img width="150" height="150" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 150'%3E%3C/svg%3E" class="attachment-thumbnail size-thumbnail wp-post-image lazyload" alt="Ansible EC2 Create" data-src="../../wp-content/uploads/2019/12/Screenshot-2019-12-02-at-2.07.39-AM-150x150.png" loading="lazy" /><noscript><img width="150" height="150" src="../../wp-content/uploads/2019/12/Screenshot-2019-12-02-at-2.07.39-AM-150x150.png" class="attachment-thumbnail size-thumbnail wp-post-image" alt="Ansible EC2 Create" data-eio="l" /></noscript></a></div>
<div class='rp4wp-related-post-content'>
<a href='../ansible-aws-ec2/index.html'>Ansible EC2 Example - Create EC2 instance with Ansible</a><p>Infrastructure as Code is getting all attention it deserves and everyone is trying to find their way to the `Completely automated Infrastructure Provisioning &amp; Management` While there are a lot of tools available now in the market starting from Terraform, AWS CloudFormation, Chef, Puppet, Salt Stack There are some differences&hellip;</p></div>
</li>
<li><div class='rp4wp-related-post-image'>
<a href='../terraform-aws-ec2-user_data-example/index.html'><img width="150" height="150" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 150'%3E%3C/svg%3E" class="attachment-thumbnail size-thumbnail wp-post-image lazyload" alt="Terraform EC2 user_data example" data-src="../../wp-content/uploads/2021/09/user_data_tf-150x150.png" loading="lazy" /><noscript><img width="150" height="150" src="../../wp-content/uploads/2021/09/user_data_tf-150x150.png" class="attachment-thumbnail size-thumbnail wp-post-image" alt="Terraform EC2 user_data example" data-eio="l" /></noscript></a></div>
<div class='rp4wp-related-post-content'>
<a href='../terraform-aws-ec2-user_data-example/index.html'>Terraform AWS EC2 user_data example - aws_instance| Devops Junction</a><p>In this article we are going to see how to create AWS EC2 instance with user_data. While launching AWS Ec2 instances we might want to add some customizations to it like adding a key and executing few shell commands or scripts to make sure they are ready to launch your&hellip;</p></div>
</li>
<li><div class='rp4wp-related-post-image'>
<a href='../terraform-aws-example-ec2/index.html'><img width="150" height="150" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 150'%3E%3C/svg%3E" class="attachment-thumbnail size-thumbnail wp-post-image lazyload" alt="" data-src="../../wp-content/uploads/2020/01/TerraformAWS-1-150x150.png" loading="lazy" /><noscript><img width="150" height="150" src="../../wp-content/uploads/2020/01/TerraformAWS-1-150x150.png" class="attachment-thumbnail size-thumbnail wp-post-image" alt="" data-eio="l" /></noscript></a></div>
<div class='rp4wp-related-post-content'>
<a href='../terraform-aws-example-ec2/index.html'>Terraform AWS Example - Create EC2 instance with Terraform</a><p>Terraform, An outstanding and innovative product from hashicorp and it is a leader in Infrastructure as Code tools Segment.  Before I go any further, I think I should set the context. In this article, we are going to learn how to use Terraform to create AWS EC2 instance and create&hellip;</p></div>
</li>
<li><div class='rp4wp-related-post-image'>
<a href='../create-linux-vm-in-gcp-with-terraform-remote-exec/index.html'><img width="150" height="150" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 150'%3E%3C/svg%3E" class="attachment-thumbnail size-thumbnail wp-post-image lazyload" alt="gcp vm terraform" data-src="../../wp-content/uploads/2021/02/gcp-image-150x150.png" loading="lazy" /><noscript><img width="150" height="150" src="../../wp-content/uploads/2021/02/gcp-image-150x150.png" class="attachment-thumbnail size-thumbnail wp-post-image" alt="gcp vm terraform" data-eio="l" /></noscript></a></div>
<div class='rp4wp-related-post-content'>
<a href='../create-linux-vm-in-gcp-with-terraform-remote-exec/index.html'>Terraform google_compute_instance Example - with Remote Exec</a><p>In this article, we are going to see how to create a Linux Virtual machine and provision it using the Terraform remote execution strategy. We are going to be using SSH method to connect to the Virtual machine and provision it on the go by executing some startup Shell script.&hellip;</p></div>
</li>
<li><div class='rp4wp-related-post-image'>
<a href='../ansible-lineinfile-multiple-lines-replace-multiple-lines/index.html'><img width="150" height="150" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 150'%3E%3C/svg%3E" class="attachment-thumbnail size-thumbnail wp-post-image lazyload" alt="ansible lineinfile multiple lines" data-src="../../wp-content/uploads/2019/03/Screen-Shot-2019-03-24-at-2.27.35-PM-150x150.png" loading="lazy" /><noscript><img width="150" height="150" src="../../wp-content/uploads/2019/03/Screen-Shot-2019-03-24-at-2.27.35-PM-150x150.png" class="attachment-thumbnail size-thumbnail wp-post-image" alt="ansible lineinfile multiple lines" data-eio="l" /></noscript></a></div>
<div class='rp4wp-related-post-content'>
<a href='../ansible-lineinfile-multiple-lines-replace-multiple-lines/index.html'>Ansible lineinfile multiple lines - Replace multiple Lines | Devops Junction</a><p>In this post, we are going to see how to use Ansible lineinfile module to replace multiple Lines at the same time. How to use Multiple Regular Expressions or Regex at the same time. How to Match Multiple lines. For this example, we are going to take apache httpd.conf file&hellip;</p></div>
</li>
</ul>
</div>
</div>
<footer class="entry-footer">
<div class="entry-tags clearfix">
<span class="meta-tags">
<a href="../tag/terraform-for-each-and-count/index.html" rel="tag">terraform for-each and count</a><a href="../tag/terraform-for-each-and-count-together/index.html" rel="tag">terraform for-each and count together</a> </span>
</div>
<nav class="navigation post-navigation" role="navigation" aria-label="Posts">
<h2 class="screen-reader-text">Post navigation</h2>
<div class="nav-links"><div class="nav-previous"><a href="../terraform-aws-ec2-user_data-example/index.html" rel="prev"><span class="screen-reader-text">Previous Post:</span>Terraform AWS EC2 user_data example &#8211; aws_instance| Devops Junction</a></div><div class="nav-next"><a href="../ansible-playbook-to-delete-old-log-files-windows/index.html" rel="next"><span class="screen-reader-text">Next Post:</span>Ansible Playbook to Delete OLD Log files &#8211; Windows | Devops Junction</a></div></div>
</nav>
</footer>
</article>
<div id="disqus_thread"></div>
</main>
</section>
<section id="secondary" class="sidebar widget-area clearfix" role="complementary">
<aside id="custom_html-18" class="widget_text widget widget_custom_html clearfix"><div class="textwidget custom-html-widget"><script data-cfasync="false" src="../../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3398911159151128" crossorigin="anonymous"></script>


<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></div></aside><aside id="categories-8" class="widget widget_categories clearfix"><div class="widget-header"><h3 class="widget-title">Categories</h3></div>
<ul>
<li class="cat-item cat-item-61"><a href="../category/activemq/index.html">ActiveMQ</a> (4)
</li>
<li class="cat-item cat-item-98"><a href="../category/ansible/index.html">Ansible</a> (67)
</li>
<li class="cat-item cat-item-10"><a href="../category/apache/index.html">Apache</a> (8)
</li>
<li class="cat-item cat-item-234"><a href="../category/aws/index.html">AWS</a> (31)
</li>
<li class="cat-item cat-item-452"><a href="../category/azure/index.html">Azure</a> (1)
</li>
<li class="cat-item cat-item-8"><a href="../category/best-practice/index.html">Best Practice</a> (5)
</li>
<li class="cat-item cat-item-390"><a href="../category/bitbucket/index.html">BitBucket</a> (1)
</li>
<li class="cat-item cat-item-426"><a href="../category/boto/index.html">Boto</a> (2)
</li>
<li class="cat-item cat-item-399"><a href="../category/cloud/index.html" title="Cloud is not only a concept but also a practice of using a network of remote servers hosted on the Internet to store, manage, and process data.">Cloud</a> (1)
</li>
<li class="cat-item cat-item-397"><a href="../category/database/index.html">Database</a> (1)
</li>
<li class="cat-item cat-item-95"><a href="../category/development/index.html">Development</a> (3)
</li>
<li class="cat-item cat-item-454"><a href="../category/devops_beginner/index.html">DevOps_Beginner</a> (13)
</li>
<li class="cat-item cat-item-152"><a href="../category/docker/index.html">Docker</a> (11)
</li>
<li class="cat-item cat-item-422"><a href="../category/efk/index.html">EFK</a> (1)
</li>
<li class="cat-item cat-item-423"><a href="../category/elastic-search/index.html">Elastic Search</a> (1)
</li>
<li class="cat-item cat-item-59"><a href="../category/f5-big-ip/index.html">F5-Big-IP</a> (6)
</li>
<li class="cat-item cat-item-419"><a href="../category/fluentd/index.html">FluentD</a> (2)
</li>
<li class="cat-item cat-item-424"><a href="../category/gcp-googlecloud/index.html">GCP &#8211; GoogleCloud</a> (1)
</li>
<li class="cat-item cat-item-450"><a href="../category/github-actions/index.html">Github Actions</a> (1)
</li>
<li class="cat-item cat-item-428"><a href="../category/grafana/index.html">Grafana</a> (1)
</li>
<li class="cat-item cat-item-275"><a href="../category/graphite/index.html">Graphite</a> (1)
</li>
<li class="cat-item cat-item-441"><a href="../category/ibm-cloud/index.html">IBM Cloud</a> (1)
</li>
<li class="cat-item cat-item-401"><a href="../category/ibm-websphere/index.html" title="IBM® WebSphere® Application Server provides a range of flexible and secure runtime for Java enterprise applications, lightweight web applications and microservices. You can create new applications and enhance and optimize existing application infrastructure on premises or across any public, private or hybrid cloud. In addition, by utilizing IBM Cloud Private, you can create on-premises cloud capabilities similar to public clouds to accelerate app development. The platform is built on the open source Kubernetes-based container architecture and supports both Docker containers and Cloud Foundry.">IBM Websphere</a> (2)
</li>
<li class="cat-item cat-item-354"><a href="../category/ihs-and-apache/index.html">IHS and Apache</a> (10)
</li>
<li class="cat-item cat-item-353"><a href="../category/iis/index.html">IIS</a> (4)
</li>
<li class="cat-item cat-item-388"><a href="../category/javascript/index.html">JavaScript</a> (3)
</li>
<li class="cat-item cat-item-286"><a href="../category/jenkins/index.html">Jenkins</a> (4)
</li>
<li class="cat-item cat-item-15"><a href="../category/joomla/index.html">Joomla</a> (1)
</li>
<li class="cat-item cat-item-151"><a href="../category/kubernetes/index.html">Kubernetes</a> (24)
</li>
<li class="cat-item cat-item-191"><a href="../category/middleware/index.html">Middleware</a> (3)
</li>
<li class="cat-item cat-item-322"><a href="../category/network-troubleshooting/index.html">Network Troubleshooting</a> (1)
</li>
<li class="cat-item cat-item-413"><a href="../category/networking/index.html">Networking</a> (1)
</li>
<li class="cat-item cat-item-273"><a href="../category/nodejs/index.html">NodeJS</a> (2)
</li>
<li class="cat-item cat-item-396"><a href="../category/office365/index.html">Office365</a> (1)
</li>
<li class="cat-item cat-item-148"><a href="../category/opensource/index.html">OpenSource</a> (2)
</li>
<li class="cat-item cat-item-417"><a href="../category/oracle-db/index.html">Oracle DB</a> (3)
</li>
<li class="cat-item cat-item-404"><a href="../category/oracle-weblogic/index.html" title="WebLogic is a leading Application Server product most widely used for e-commerce online transaction processing (OLTP) platform application, developed to connect users in a distributed computing environment and to facilitate the integration of mainframe applications with distributed corporate data and applications.">Oracle Weblogic</a> (2)
</li>
<li class="cat-item cat-item-232"><a href="../category/packer/index.html">Packer</a> (2)
</li>
<li class="cat-item cat-item-146"><a href="../category/perl/index.html">Perl</a> (1)
</li>
<li class="cat-item cat-item-60"><a href="../category/php/index.html">PHP</a> (1)
</li>
<li class="cat-item cat-item-453"><a href="../category/postgresql/index.html">PostgreSQL</a> (1)
</li>
<li class="cat-item cat-item-343"><a href="../category/powershell/index.html">PowerShell</a> (1)
</li>
<li class="cat-item cat-item-31"><a href="../category/weblogic/problemsolution/index.html">problem/solution</a> (8)
</li>
<li class="cat-item cat-item-427"><a href="../category/prometheus/index.html">Prometheus</a> (1)
</li>
<li class="cat-item cat-item-445"><a href="../category/pulumi/index.html">Pulumi</a> (1)
</li>
<li class="cat-item cat-item-285"><a href="../category/python-flask/index.html">Python Flask</a> (1)
</li>
<li class="cat-item cat-item-22"><a href="../category/python_scripts/index.html">python_scripts</a> (7)
</li>
<li class="cat-item cat-item-446"><a href="../category/redis/index.html">Redis</a> (1)
</li>
<li class="cat-item cat-item-451"><a href="../category/serverless/index.html">Serverless</a> (1)
</li>
<li class="cat-item cat-item-12"><a href="../category/shell-scripting/index.html">Shell Scripting</a> (6)
</li>
<li class="cat-item cat-item-125"><a href="../category/soap-web-services/index.html">SOAP Web Services</a> (1)
</li>
<li class="cat-item cat-item-13"><a href="../category/splunk/index.html">Splunk</a> (1)
</li>
<li class="cat-item cat-item-425"><a href="../category/sre/index.html">SRE</a> (1)
</li>
<li class="cat-item cat-item-274"><a href="../category/statsd/index.html">StatsD</a> (1)
</li>
<li class="cat-item cat-item-233"><a href="../category/terraform/index.html">Terraform</a> (12)
</li>
<li class="cat-item cat-item-35"><a href="../category/tomcat/index.html">tomcat</a> (8)
</li>
<li class="cat-item cat-item-147"><a href="../category/tools/index.html">tools</a> (5)
</li>
<li class="cat-item cat-item-391"><a href="../category/traefik/index.html">Traefik</a> (1)
</li>
<li class="cat-item cat-item-124"><a href="../category/troubleshooting/index.html">Troubleshooting</a> (3)
</li>
<li class="cat-item cat-item-1"><a href="../category/uncategorized/index.html">Uncategorized</a> (9)
</li>
<li class="cat-item cat-item-7"><a href="../category/unix/index.html">Unix</a> (5)
</li>
<li class="cat-item cat-item-99"><a href="../category/vagrant/index.html">Vagrant</a> (4)
</li>
<li class="cat-item cat-item-389"><a href="../category/vuejs/index.html">VueJS</a> (2)
</li>
<li class="cat-item cat-item-356"><a href="../category/vulnerabilities-fixes/index.html">Vulnerabilities &amp; Fixes</a> (21)
</li>
<li class="cat-item cat-item-21"><a href="../category/weblogic/index.html">weblogic</a> (51)
</li>
<li class="cat-item cat-item-9"><a href="../category/webserver/index.html">Webserver</a> (1)
</li>
<li class="cat-item cat-item-92"><a href="../category/websphere/index.html">Websphere</a> (8)
</li>
<li class="cat-item cat-item-321"><a href="../category/windows-server/index.html">Windows Server</a> (5)
</li>
<li class="cat-item cat-item-55"><a href="../category/wlst/index.html">wlst</a> (7)
</li>
<li class="cat-item cat-item-36"><a href="../category/wordpress/index.html">wordpress</a> (2)
</li>
<li class="cat-item cat-item-4"><a href="../category/wsadmin-scripts/index.html">wsadmin scripts</a> (1)
</li>
</ul>
</aside><aside id="media_image-5" class="widget widget_media_image clearfix"><img width="267" height="400" src="../../wp-content/ewww/lazy/placeholder-267x400.png" class="image wp-image-8825  attachment-full size-full lazyload" alt="write for devopsjunction" style="max-width: 75%; height: auto;" data-src="../../wp-content/uploads/2022/07/write-for-us-devopsjunction.png" loading="lazy" data-srcset="../../wp-content/uploads/2022/07/write-for-us-devopsjunction.png 267w, ../../wp-content/uploads/2022/07/write-for-us-devopsjunction-200x300.png 200w" data-sizes="auto" /><noscript><img width="267" height="400" src="../../wp-content/uploads/2022/07/write-for-us-devopsjunction.png" class="image wp-image-8825  attachment-full size-full" alt="write for devopsjunction" style="max-width: 75%; height: auto;" srcset="../../wp-content/uploads/2022/07/write-for-us-devopsjunction.png 267w, ../../wp-content/uploads/2022/07/write-for-us-devopsjunction-200x300.png 200w" sizes="(max-width: 267px) 100vw, 267px" data-eio="l" /></noscript></aside>
</section>
</div>
<div id="footer" class="footer-wrap">
<footer id="colophon" class="site-footer container clearfix" role="contentinfo">
<div id="footer-text" class="site-info">
<span class="credit-link">Powered by <a href="../../index.html" title="Rumen Lishkov">Rumen Lishkov</a> and <a href="https://rumen.free.bg/" title="Studio-1">Studio1 Sofia</a> </span>
</div>
</footer>
</div>
</div>
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@mwinventory" />
<meta name="twitter:creator" content="@mwinventory" />
<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro&amp;display=swap" rel="stylesheet"><script type='text/javascript' id='disqus_count-js-extra'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"mwinventory"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/f8767.js"></script>
<script type='text/javascript' id='disqus_embed-js-extra'>
/* <![CDATA[ */
var embedVars = {"disqusConfig":{"integration":"wordpress 3.0.22"},"disqusIdentifier":"7302 https:\/\/www.middlewareinventory.com\/?p=7302","disqusShortname":"mwinventory","disqusTitle":"Terraform Create Multiple EC2 with different Configs \u2013 for_each and count together","disqusUrl":"https:\/\/www.middlewareinventory.com\/blog\/terraform-create-multiple-ec2-different-config\/","postId":"7302"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/bccbc.js"></script>
<script type='text/javascript' id='dae-download-js-extra'>
/* <![CDATA[ */
var objDaeDownload = {"ajaxUrl":"https:\/\/www.middlewareinventory.com\/wp-admin\/admin-ajax.php","nonce":"ef6e91b292"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/8510d.js"></script>
<script type='text/javascript' id='socialsnap-js-js-extra'>
/* <![CDATA[ */
var socialsnap_script = {"ajaxurl":"https:\/\/www.middlewareinventory.com\/wp-admin\/admin-ajax.php","on_media_width":"250","on_media_height":"250","nonce":"a59fcb65ed","post_id":"7302"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/fef55.js"></script>
<script type='text/javascript' id='aicp-js-extra'>
/* <![CDATA[ */
var AICP = {"ajaxurl":"https:\/\/www.middlewareinventory.com\/wp-admin\/admin-ajax.php","nonce":"c968eefe51","ip":"193.108.73.47","clickLimit":"1","clickCounterCookieExp":"3","banDuration":"7","countryBlockCheck":"No","banCountryList":"RU"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/ff9fe.js"></script>
<script type='text/javascript' src='https://js.stripe.com/v3/?ver=2.03' id='stripe-js'></script>
<script src="../../wp-content/cache/minify/00a3c.js"></script>
<script type='text/javascript' id='divi-builder-custom-script-js-extra'>
/* <![CDATA[ */
var et_builder_utils_params = {"condition":{"diviTheme":false,"extraTheme":false},"scrollLocations":["app","top"],"builderScrollLocations":{"desktop":"app","tablet":"app","phone":"app"},"onloadScrollLocation":"app","builderType":"fe"};
var et_frontend_scripts = {"builderCssContainerPrefix":"#et-boc","builderCssLayoutPrefix":"#et-boc .et-l"};
var et_pb_custom = {"ajaxurl":"https:\/\/www.middlewareinventory.com\/wp-admin\/admin-ajax.php","images_uri":"https:\/\/www.middlewareinventory.com\/wp-content\/themes\/poseidon\/images","builder_images_uri":"https:\/\/www.middlewareinventory.com\/wp-content\/plugins\/divi-builder\/includes\/builder\/images","et_frontend_nonce":"4672157d30","subscription_failed":"Please, check the fields below to make sure you entered the correct information.","et_ab_log_nonce":"fcf8610b63","fill_message":"Please, fill in the following fields:","contact_error_message":"Please, fix the following errors:","invalid":"Invalid email","captcha":"Captcha","prev":"Prev","previous":"Previous","next":"Next","wrong_captcha":"You entered the wrong number in captcha.","wrong_checkbox":"Checkbox","ignore_waypoints":"no","is_divi_theme_used":"","widget_search_selector":".widget_search","ab_tests":[],"is_ab_testing_active":"","page_id":"7302","unique_test_id":"","ab_bounce_rate":"5","is_cache_plugin_active":"no","is_shortcode_tracking":"","tinymce_uri":"https:\/\/www.middlewareinventory.com\/wp-content\/plugins\/divi-builder\/includes\/builder\/frontend-builder\/assets\/vendors","waypoints_options":{"context":[".pum-overlay"]}};
var et_pb_box_shadow_elements = [];
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/2bf13.js"></script>
<script type='text/javascript' id='q2w3_fixed_widget-js-extra'>
/* <![CDATA[ */
var q2w3_sidebar_options = [{"sidebar":"q2w3-default-sidebar","margin_top":10,"margin_bottom":0,"stop_id":"","screen_max_width":1026,"screen_max_height":0,"width_inherit":true,"refresh_interval":1500,"window_load_hook":false,"disable_mo_api":false,"widgets":["text-32"]}];
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/5ee99.js"></script>
<script type='text/javascript' id='enlighterjs-js-after'>
!function(e,n){if("undefined"!=typeof EnlighterJS){var o={"selectors":{"block":"pre.EnlighterJSRAW","inline":"code.EnlighterJSRAW"},"options":{"indent":4,"ampersandCleanup":true,"linehover":true,"rawcodeDbclick":false,"textOverflow":"break","linenumbers":true,"theme":"enlighter","language":"generic","retainCssClasses":false,"collapse":false,"toolbarOuter":"","toolbarTop":"{BTN_RAW}{BTN_COPY}{BTN_WINDOW}{BTN_WEBSITE}","toolbarBottom":""}};(e.EnlighterJSINIT=function(){EnlighterJS.init(o.selectors.block,o.selectors.inline,o.options)})()}else{(n&&(n.error||n.log)||function(){})("Error: EnlighterJS resources not loaded yet!")}}(window,console);
</script>
<script src="../../wp-content/cache/minify/b5030.js"></script>
<script type='text/javascript' id='ez-toc-js-js-extra'>
/* <![CDATA[ */
var ezTOC = {"smooth_scroll":"1","visibility_hide_by_default":"","width":"100%","scroll_offset":"30"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/0c713.js"></script>
<div id="ss-copy-popup" class="ss-popup-overlay">
<div class="ss-popup">
<div class="ss-popup-heading">
<span>Copy link</span>
<a href="#" id="ss-close-share-networks-modal" class="ss-close-modal" rel="nofollow"><i class="ss ss-close"></i></a>
</div>
<div class="ss-popup-content">
<div class="ss-copy-action">
<input type="text" readonly="readonly" value="https://airdata.gitlab.io/blog/blog/terraform-create-multiple-ec2-different-config/" class="ss-copy-action-field" />
<a href="#" class="ss-button" rel="nofollow">Copy<span class="ss-share-network-tooltip">Copied</span></a>
<i class="ss ss-copy"></i>
</div>
<div class="ss-powered-by">Powered by <a href="https://socialsnap.com/?utm_source=WordPress&amp;utm_medium=link&amp;utm_campaign=inthewild" target="_blank" rel="nofollow noopener"><i class="ss ss-socialsnap"></i>Social Snap</a></div>
 </div>
</div>
</div>

<script type="text/javascript">

			var SocialSnapURL 				= window.location.href;
			var SocialSnapShareCacheExpired = 0;
				
			if ( -1 !== SocialSnapURL.indexOf('?ss_cache_refresh') ) {

				SocialSnapShareCacheExpired = true;

			} else {

				var SocialSnapServerTimestamp 	= 1668110840;
				var SocialSnapBrowserTimestamp 	= Date.now();

				if ( ! SocialSnapBrowserTimestamp ) {
					SocialSnapBrowserTimestamp = new Date().getTime();
				}

				SocialSnapBrowserTimestamp = Math.floor( SocialSnapBrowserTimestamp / 1000 );

				SocialSnapShareCacheExpired = SocialSnapShareCacheExpired && ( SocialSnapBrowserTimestamp - SocialSnapServerTimestamp < 60 );
			}

		</script>

<div id="cookie-notice" role="banner" class="cn-bottom bootstrap" style="color: #fff; background-color: #000;"><div class="cookie-notice-container"><span id="cn-notice-text">We use cookies to ensure that we give you the best experience on our website. The Cookies collected are used only to Show customized Ads. We Hope you are fine with it.</span><a href="#" id="cn-accept-cookie" data-cookie-set="accept" class="cn-set-cookie cn-button bootstrap button">Ok</a><a href="#" id="cn-refuse-cookie" data-cookie-set="refuse" class="cn-set-cookie cn-button bootstrap button">No</a><a href="../../cookie-policy/index.html" target="_blank" id="cn-more-info" class="cn-more-info cn-button bootstrap button">Privacy policy</a>
</div>
<div class="cookie-notice-revoke-container"><a href="#" class="cn-revoke-cookie cn-button bootstrap button">Revoke cookies</a></div>
</div>
</body>
</html>
