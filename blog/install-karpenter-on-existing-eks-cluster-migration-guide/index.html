<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="https://gmpg.org/xfn/11">

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

<title>Install Karpenter on Existing EKS Cluster - Autoscaler Migration | Kubernetes</title>
<meta name="description" content="Installing Karpenter on Existing EKS Cluster. Migrating from Cluster Autoscaler to Karpenter step by step. Karpenter EKS setup using Custom Launch template." />
<meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
<link rel="canonical" href="index.html" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Install Karpenter on Existing EKS Cluster - Autoscaler Migration | Kubernetes" />
<meta property="og:description" content="Installing Karpenter on Existing EKS Cluster. Migrating from Cluster Autoscaler to Karpenter step by step. Karpenter EKS setup using Custom Launch template." />
<meta property="og:url" content="https://airdata.gitlab.io/blog/blog/install-karpenter-on-existing-eks-cluster-migration-guide/" />
<meta property="og:site_name" content="Middleware Inventory" />
<meta property="article:publisher" content="https://www.facebook.com/rumenlishkov" />
<meta property="article:published_time" content="2022-09-26T16:46:11+00:00" />
<meta property="article:modified_time" content="2022-09-26T16:51:20+00:00" />
<meta property="og:image" content="../../wp-content/uploads/2022/09/karpenter-ca-migraiton.jpg" />
<meta property="og:image:width" content="1748" />
<meta property="og:image:height" content="1240" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content="@mwinventory" />
<meta name="twitter:site" content="@mwinventory" />
<script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://airdata.gitlab.io/blog/#organization","name":"Middleware Inventory","url":"https://www.middlewareinventory.com/","sameAs":["https://www.facebook.com/rumenlishkov","https://www.youtube.com/channel/UCRuqBFM6ioWwviNJkgOjeWw","https://twitter.com/mwinventory"],"logo":{"@type":"ImageObject","@id":"https://airdata.gitlab.io/blog/#logo","inLanguage":"en-US","url":"https://airdata.gitlab.io/blog/wp-content/uploads/2020/09/Screenshot-2020-09-18-at-3.49.40-AM.jpg","width":300,"height":107,"caption":"Middleware Inventory"},"image":{"@id":"https://airdata.gitlab.io/blog/#logo"}},{"@type":"WebSite","@id":"https://airdata.gitlab.io/blog/#website","url":"https://www.middlewareinventory.com/","name":"Devops Junction","description":"An inventory of [i]nformation, Middleware and much more.","publisher":{"@id":"https://airdata.gitlab.io/blog/#organization"},"potentialAction":[{"@type":"SearchAction","target":"https://www.middlewareinventory.com/?s={search_term_string}","query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"ImageObject","@id":"https://airdata.gitlab.io/blog/blog/install-karpenter-on-existing-eks-cluster-migration-guide/#primaryimage","inLanguage":"en-US","url":"../../wp-content/uploads/2022/09/karpenter-ca-migraiton.jpg","width":1748,"height":1240,"caption":"Karpenter EKS"},{"@type":"WebPage","@id":"https://airdata.gitlab.io/blog/blog/install-karpenter-on-existing-eks-cluster-migration-guide/#webpage","url":"https://airdata.gitlab.io/blog/blog/install-karpenter-on-existing-eks-cluster-migration-guide/","name":"Install Karpenter on Existing EKS Cluster - Autoscaler Migration | Kubernetes","isPartOf":{"@id":"https://airdata.gitlab.io/blog/#website"},"primaryImageOfPage":{"@id":"https://airdata.gitlab.io/blog/blog/install-karpenter-on-existing-eks-cluster-migration-guide/#primaryimage"},"datePublished":"2022-09-26T16:46:11+00:00","dateModified":"2022-09-26T16:51:20+00:00","description":"Installing Karpenter on Existing EKS Cluster. Migrating from Cluster Autoscaler to Karpenter step by step. Karpenter EKS setup using Custom Launch template.","inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://airdata.gitlab.io/blog/blog/install-karpenter-on-existing-eks-cluster-migration-guide/"]}]},{"@type":"Article","@id":"https://airdata.gitlab.io/blog/blog/install-karpenter-on-existing-eks-cluster-migration-guide/#article","isPartOf":{"@id":"https://airdata.gitlab.io/blog/blog/install-karpenter-on-existing-eks-cluster-migration-guide/#webpage"},"author":{"@id":"https://airdata.gitlab.io/blog/#/schema/person/050bf13e27b309d29d1bda45c4eb3147"},"headline":"Install Karpenter on Existing EKS Cluster &#8211; Autoscaler Migration | Kubernetes","datePublished":"2022-09-26T16:46:11+00:00","dateModified":"2022-09-26T16:51:20+00:00","mainEntityOfPage":{"@id":"https://airdata.gitlab.io/blog/blog/install-karpenter-on-existing-eks-cluster-migration-guide/#webpage"},"commentCount":0,"publisher":{"@id":"https://airdata.gitlab.io/blog/#organization"},"image":{"@id":"https://airdata.gitlab.io/blog/blog/install-karpenter-on-existing-eks-cluster-migration-guide/#primaryimage"},"articleSection":"AWS","inLanguage":"en-US","potentialAction":[{"@type":"CommentAction","name":"Comment","target":["https://airdata.gitlab.io/blog/blog/install-karpenter-on-existing-eks-cluster-migration-guide/#respond"]}]},{"@type":"Person","@id":"https://airdata.gitlab.io/blog/#/schema/person/050bf13e27b309d29d1bda45c4eb3147","name":"Rumen Lishkov","image":{"@type":"ImageObject","@id":"https://airdata.gitlab.io/blog/#personlogo","inLanguage":"en-US","url":"https://secure.gravatar.com/avatar/c22e4a54d67750291a9892531f94ffb3?s=96&d=mm&r=g","caption":"Rumen Lishkov"}}]}</script>

<link rel='dns-prefetch' href='https://js.stripe.com' />
<link rel='dns-prefetch' href='https://fonts.googleapis.com' />
<link rel='dns-prefetch' href='https://s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Middleware Inventory &raquo; Feed" href="../../feed/index.rss" />
<link rel="alternate" type="application/rss+xml" title="Middleware Inventory &raquo; Comments Feed" href="../../comments/feed/index.rss" />
<link rel="alternate" type="application/rss+xml" title="Middleware Inventory &raquo; Install Karpenter on Existing EKS Cluster &#8211; Autoscaler Migration | Kubernetes Comments Feed" href="feed/index.rss" />
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/www.middlewareinventory.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.5.6"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,8205,55356,57212],[55357,56424,8203,55356,57212])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel="stylesheet" href="../../wp-content/cache/minify/09591.css" media="all" />
<style id='ez-toc-inline-css' type='text/css'>div#ez-toc-container p.ez-toc-title {font-size: 120%;}div#ez-toc-container p.ez-toc-title {font-weight: 500;}div#ez-toc-container ul li {font-size: 95%;}div#ez-toc-container {width: 100%;}
</style>
<link rel="stylesheet" href="../../wp-content/cache/minify/f854f.css" media="all" />
<link rel='stylesheet' id='poseidon-default-fonts-css' href='https://fonts.googleapis.com/css?family=Ubuntu%3A400%2C400italic%2C700%2C700italic%7CRaleway%3A400%2C700&amp;subset=latin%2Clatin-ext' type='text/css' media='all' />
<link rel="stylesheet" href="../../wp-content/cache/minify/551a8.css" media="all" />
<script src="../../wp-content/cache/minify/c7035.js"></script>
<script type='text/javascript' id='cookie-notice-front-js-extra'>
/* <![CDATA[ */
var cnArgs = {"ajaxurl":"https:\/\/www.middlewareinventory.com\/wp-admin\/admin-ajax.php","hideEffect":"fade","onScroll":"no","onScrollOffset":"100","cookieName":"cookie_notice_accepted","cookieValue":"true","cookieTime":"2592000","cookiePath":"\/","cookieDomain":"","redirection":"","cache":"1","refuse":"yes","revoke_cookies":"0","revoke_cookies_opt":"automatic","secure":"1"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/545b0.js"></script>
<script type='text/javascript' id='email-subscribers-js-extra'>
/* <![CDATA[ */
var es_data = {"messages":{"es_empty_email_notice":"Please enter email address","es_rate_limit_notice":"You need to wait for sometime before subscribing again","es_single_optin_success_message":"Successfully Subscribed.","es_email_exists_notice":"Email Address already exists!","es_unexpected_error_notice":"Oops.. Unexpected error occurred.","es_invalid_email_notice":"Invalid email address","es_try_later_notice":"Please try after some time"},"es_ajax_url":"https:\/\/www.middlewareinventory.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/2975f.js"></script>
<!--[if lt IE 9]>
<script type='text/javascript' src='https://airdata.gitlab.io/blog/wp-content/themes/poseidon/js/html5shiv.min.js?ver=3.7.3' id='html5shiv-js'></script>
<![endif]-->
<script type='text/javascript' id='poseidon-post-slider-js-extra'>
/* <![CDATA[ */
var poseidon_slider_params = {"animation":"slide","speed":"7000"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/51af3.js"></script>
<script type='text/javascript' id='eio-lazy-load-js-extra'>
/* <![CDATA[ */
var eio_lazy_vars = {"exactdn_domain":"","skip_autoscale":"0"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/28f5b.js"></script>
<link rel="https://api.w.org/" href="../../wp-json/index.json" /><link rel="alternate" type="application/json" href="../../wp-json/wp/v2/posts/9057.json" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../xmlrpc.php-rsd.xml" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://www.middlewareinventory.com/wp-includes/wlwmanifest.xml" />
<meta name="generator" content="WordPress 5.5.6" />
<link rel='shortlink' href='index.html' />
<link rel="alternate" type="application/json+oembed" href="../../wp-json/oembed/1.0/embed-url=https---www.middlewareinventory.com-blog-install-karpenter-on-existing-eks-cluster-migration-guide-.json" />
<link rel="alternate" type="text/xml+oembed" href="../../wp-json/oembed/1.0/embed-url=https---www.middlewareinventory.com-blog-install-karpenter-on-existing-eks-cluster-migration-guide-&amp;format=xml.xml" />
<script>
    document.cookie = "cookie_notice_accepted=true;max-age=" + 3600*24*365 + "; path=/" + ";secure;";
    document.cookie = "cookie_notice_accepted=true;max-age=" + 3600*24*365 + "; path=/";
    if ( ! /(^|;)\s*cca_is_eu=/.test(document.cookie) ) {  // if check prevents reload loop
		  document.cookie = "cca_is_eu=false;max-age=" + 3600*24*364 + "; path=/";
      var ccaURL = window.location.protocol + '//',
      hostname = window.location.host + '/' + window.location.pathname;
			if ( '0' === '1' ) {
        window.location.reload( true );
      }
   }
</script>
<link href='https://fonts.googleapis.com/css?family=Strait:100,200,300,400,500,600,700,800,900&amp;subset=arabic,vietnamese,hebrew,thai,bengali,latin,latin-ext,cyrillic,cyrillic-ext,greek' rel='stylesheet' type='text/css'><style>a.idcore-button,a.idcore-button:visited{font-family:'Strait','arial';font-size:20px;color:#ffffff;font-weight:normal;font-style:normal;text-decoration:none !important;text-transform:uppercase;padding-top:16px;padding-bottom:16px;padding-left:32px;padding-right:32px;background-color:rgba(212, 7, 72, 1);background-image:linear-gradient(to bottom,rgba(255,255,255,.05) 0,rgba(255,255,255,.05) 50%,rgba(0,0,0,.05) 51%,rgba(0,0,0,.05) 100%);border-width:1px;border-style:solid;border-color:#d4150b;border-radius:3px;box-shadow: 2px 2px 0px 0px rgba(68, 68, 68, 0.2);}a.idcore-button:hover,a.idcore-button:focus{font-family:'Strait','arial';font-size:20px;color:#ffffff;font-weight:normal;font-style:normal;text-decoration:none !important;text-transform:uppercase;padding-top:16px;padding-bottom:16px;padding-left:32px;padding-right:32px;background-color:rgba(212, 7, 72, 1);background-image:linear-gradient(to bottom,rgba(255,255,255,.05) 0,rgba(255,255,255,.05) 50%,rgba(0,0,0,.05) 51%,rgba(0,0,0,.05) 100%);border-width:1px;border-style:solid;border-color:#d4150b;border-radius:3px;box-shadow: 2px 2px 0px 0px rgba(68, 68, 68, 0.2);}a.idcore-button:active{font-family:'Strait','arial';font-size:20px;color:#ffffff;font-weight:normal;font-style:normal;text-decoration:none !important;text-transform:uppercase;padding-top:16px;padding-bottom:16px;padding-left:32px;padding-right:32px;background-color:rgba(212, 7, 72, 1);background-image:linear-gradient(to bottom,rgba(255,255,255,.05) 0,rgba(255,255,255,.05) 50%,rgba(0,0,0,.05) 51%,rgba(0,0,0,.05) 100%);border-width:1px;border-style:solid;border-color:#d4150b;border-radius:3px;box-shadow: 2px 2px 0px 0px rgba(68, 68, 68, 0.2);}</style><script>var idcore_ajax_url = "https://www.middlewareinventory.com/wp-admin/admin-ajax.php";</script><style type='text/css'>.rp4wp-related-posts ul{width:100%;padding:0;margin:0;float:left;}
.rp4wp-related-posts ul>li{list-style:none;padding:0;margin:0;padding-bottom:20px;clear:both;}
.rp4wp-related-posts ul>li>p{margin:0;padding:0;}
.rp4wp-related-post-image{width:35%;padding-right:25px;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;float:left;}</style>
<noscript><style>.lazyload[data-src]{display:none !important;}</style></noscript><style type="text/css" id="sns_global_styles">/* for mobile */
@media screen and (max-width: 480px) {
    #text-23 {
        display:none !important;
    }
	p,li
    {
      font-size: 20px !important;
      color: #333 !important;
      line-height: 1.68 !important;;
    }
    .article-inner
    {
    	padding-right: 5% !important;
    	padding-left: 5% !important;
    }
    ul.related_post li
    {
    	width: 100% !important;
    }
    ul.related_post li a
    {
    	font-size: 20px !important;
    }
    ul.related_post li small {
    font-size: 100%;
    }
  
  #afc_sidebar_4348 
{
  height: 8vh; 
  max-height: 8vh; 
  background-color: transparent;
}
}

/* for Desktop */
@media screen and (min-width: 500px) {
#afc_sidebar_4348 
{
  height: 10vh; 
  max-height: 10vh; 
  background-color: transparent;
}
  #text-23 {
        display:none !important;
    }
	p,li
    {
        font-size: 20px !important;
        color: #333 !important;
        line-height: 1.68 !important;;
    }
    .article-inner
    {
    	padding-right: 5% !important;
    	padding-left: 5% !important;
    }
    ul.related_post li
    {
    	width: 100% !important;
    }
    ul.related_post li small {
    font-size: 100%;
    }
  

}

.es_lablebox {
    padding-bottom: 3px;
    color: steelblue !important;
    font-weight: bold !important;
}
.widget-title span {
    line-height: 2.2;
    color: steelblue !important;
}
.sidey {
	padding: 0;
}
.sumome-contactform 
{
  display: none;
}
code { 
    font-family: courier;
    font-size: 18px;
    padding: 2px;
    background-color: #f1f1f1;
    /*box-shadow: 0 2px 4px 0 rgba(0,0,0,0.16),0 2px 10px 0 rgba(0,0,0,0.12)!important;*/
    
}

.syntaxhighlighter {
    font-size: 14px !important;
}

pre {
 font-family: Menlo, Monaco, Consolas, "Courier New", monospace !important;
}

.black-red-border
{
    border-left: 3px solid;
    background-color: black;
    color: ghostwhite;
    border-left-color: red;
} 
}

#wpdevar_comment_1 span
{
  font-family:  "Open Sans", Helvetica, Arial, sans-serif !important;
  font-size: 20px !important;
  color: #1495b5 !important;
}

#wpdevar_comment_1 
{
  margin-top: 50px;
  margin-bottom: 30px;
}

summary
{
 color: steelblue; 
}

blockquote
{
  border-left-color: #cc0f77 !important;
  border-left-width: 4px !important;
  border-left-style: solid !important;
  background-color: #f5f5f5 !important;
}

.rp4wp-related-post-image{ width: auto !important; }

.main-navigation-menu
{
  float: none !important;
}

.primary-navigation
{
  float: none !important
}

body,html{
  /* font-family: 'Poppins', sans-serif; */
  font-family: "Source Sans Pro","Arial",sans-serif
}

.page-title, .entry-title, .site-title, .main-navigation-menu a, .widget-title
{
  /*font-family: 'Poppins', sans-serif; */
  font-family: "Source Sans Pro","Arial",sans-serif
}

#postfollow {
  background: whitesmoke;
  padding-top: 5%;
  padding-bottom: 5%;
  padding-left: 2%;
}
div#ez-toc-container p.ez-toc-title {
    font-weight: bold;
    font-size: 24px !important;
}
div#ez-toc-container {
    margin-bottom: 15%;
}

</style><link rel="icon" href="../../wp-content/uploads/2017/12/cropped-Screen-Shot-2017-12-22-at-12.16.54-PM-3-32x32.png" sizes="32x32" />
<link rel="icon" href="../../wp-content/uploads/2017/12/cropped-Screen-Shot-2017-12-22-at-12.16.54-PM-3-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="../../wp-content/uploads/2017/12/cropped-Screen-Shot-2017-12-22-at-12.16.54-PM-3-180x180.png" />
<meta name="msapplication-TileImage" content="https://airdata.gitlab.io/blog/wp-content/uploads/2017/12/cropped-Screen-Shot-2017-12-22-at-12.16.54-PM-3-270x270.png" />
<style type="text/css">article h2
{
    color: black;
}
article h3
{
    background-color: whitesmoke;
    color: black;
    padding-left: 1%;
    border-left: 10px solid black;
    font-weight: 400;
    font-size: 22px;
}
#precode
{
  background-color: transparent !important;
  color: #00193a !important;
  font-size: 16px;
}
.post-img
{
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
  border: 1px solid lightgray;
}
pre
{
  display: block; 
  overflow-x: auto; 
  padding-left: 2em;
  padding-top: 3em;
  padding-bottom: 3em;
  background: #eaeef3 none repeat scroll 0% 0%; 
  color: #00193a;
}
li {
    padding: 2px;
    margin-left: 2%;
}
b,strong{
  color: black;
}
code
{
  color: black;
}
blockquote {
    padding: 2%;
    background-color: none !important;
}
div.enlighter{
  font-size: 1.2em;  
}
.enlighter-default {
    font-family: Menlo, Monaco, Consolas, "Courier New", monospace !important;
    background: #eaeef3 none repeat scroll 0% 0% !important;
}
</style>
<style type="text/css" id="wp-custom-css">.site-title
{
   font-size: 24px !important;
}		</style>
</head>
<body class="post-template-default single single-post postid-9057 single-format-standard wp-custom-logo cookies-set cookies-accepted et_divi_builder et-pb-theme-poseidon et-db elementor-default">
<div id="page" class="hfeed site">
<a class="skip-link screen-reader-text" href="#content">Skip to content</a>
<div id="header-top" class="header-bar-wrap"></div>
<header id="masthead" class="site-header clearfix" role="banner">
<div class="header-main container clearfix">
<div id="logo" class="site-branding clearfix">
<a href="../../index.html" class="custom-logo-link" rel="home"><img width="160" height="120" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 107'%3E%3C/svg%3E" class="custom-logo lazyload" alt="Middleware Inventory" data-src="../../wp-content/uploads/2020/09/cropped-Screenshot-2020-09-18-at-3.49.40-AM.jpg" loading="lazy" /><noscript><img width="160" height="120" src="../../wp-content/uploads/2020/09/cropped-Screenshot-2020-09-18-at-3.49.40-AM.jpg" class="custom-logo" alt="Middleware Inventory" data-eio="l" /></noscript></a>
<p class="site-title"></p>
</div>
<nav id="main-navigation" class="primary-navigation navigation clearfix" role="navigation">
<ul id="menu-primary-menu" class="main-navigation-menu"><li id="menu-item-172" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-172"><a href="https://airdata.github.io/">About Me</a></li>
<li id="menu-item-3206" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-3206"><a href="../category/middleware/index.html">Middleware</a>
<ul class="sub-menu">
<li id="menu-item-1518" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1518"><a href="../category/weblogic/index.html">weblogic</a></li>
<li id="menu-item-3207" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3207"><a href="../category/was/index.html">WAS</a></li>
<li id="menu-item-3208" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3208"><a href="../category/websphere/index.html">Websphere</a></li>
<li id="menu-item-3209" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3209"><a href="../category/wlst/index.html">wlst</a></li>
<li id="menu-item-3210" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3210"><a href="../category/wsadmin-scripts/index.html">wsadmin scripts</a></li>
<li id="menu-item-3211" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3211"><a href="../category/jms/index.html">JMS</a></li>
<li id="menu-item-3212" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3212"><a href="../category/activemq/index.html">ActiveMQ</a></li>
<li id="menu-item-3213" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3213"><a href="../category/troubleshooting/index.html">Troubleshooting</a></li>
<li id="menu-item-3214" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3214"><a href="../category/apache/index.html">Apache</a></li>
<li id="menu-item-3215" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3215"><a href="../category/best-practice/index.html">Best Practice</a></li>
<li id="menu-item-3222" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3222"><a href="../category/f5-big-ip/index.html">F5-Big-IP</a></li>
</ul>
</li>
<li id="menu-item-3157" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-3157"><a href="../../devops-junction/index.html">Devops</a>
<ul class="sub-menu">
<li id="menu-item-1513" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1513"><a href="../category/ansible/index.html">Ansible</a></li>
<li id="menu-item-3216" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-3216"><a href="../category/aws/index.html">AWS</a></li>
<li id="menu-item-3217" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3217"><a href="../category/docker/index.html">Docker</a></li>
<li id="menu-item-3218" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3218"><a href="../category/packer/index.html">Packer</a></li>
<li id="menu-item-3219" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3219"><a href="../category/splunk/index.html">Splunk</a></li>
<li id="menu-item-3220" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3220"><a href="../category/terraform/index.html">Terraform</a></li>
<li id="menu-item-3221" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3221"><a href="../category/vagrant/index.html">Vagrant</a></li>
<li id="menu-item-3223" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3223"><a href="../category/kubernetes/index.html">Kubernetes</a></li>
</ul>
</li>

<li id="menu-item-8821" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8821"><a href="https://rumen.free.bg/#contact">Book a Consultation</a></li>
</ul> </nav>
</div>
</header>
<div id="content" class="site-content container clearfix">
<section id="primary" class="content-area">
<main id="main" class="site-main" role="main">

<article id="post-9057" class="post-9057 post type-post status-publish format-standard has-post-thumbnail hentry category-aws wpautop">
<header class="entry-header">
<h1 class="entry-title">Install Karpenter on Existing EKS Cluster &#8211; Autoscaler Migration | Kubernetes</h1>
<div class="entry-meta"><span class="meta-date"> Updated on: <a href="index.html" title="10:16 pm" rel="bookmark"><time class="entry-date published updated" datetime="September 26, 2022">September 26, 2022</time></a></span><span class="meta-author"> <span class="author vcard"><a class="url fn n" href="../author/admin/index.html" title="View all posts by Rumen Lishkov" rel="author">Rumen Lishkov</a></span></span></div>
</header>
<div class="entry-content clearfix">
<div class="ss-inline-share-wrapper ss-left-inline-content ss-small-icons ss-with-spacing ss-rounded-icons">
<div class="ss-inline-share-content">
<ul class="ss-social-icons-container">
<li class="">
<a href="#" data-ss-ss-link="https://www.facebook.com/sharer.php?t=Install%20Karpenter%20on%20Existing%20EKS%20Cluster%20%E2%80%93%20Autoscaler%20Migration%20%7C%20Kubernetes&u=https%3A%2F%2Fwww.middlewareinventory.com%2Fblog%2Finstall-karpenter-on-existing-eks-cluster-migration-guide%2F" class="ss-facebook-color" rel="nofollow" data-ss-ss-network-id="facebook" data-ss-ss-post-id="9057" data-ss-ss-location="inline_content" data-ss-ss-permalink="https://airdata.gitlab.io/blog/blog/install-karpenter-on-existing-eks-cluster-migration-guide/" data-ss-ss-type="share" data-has-api="true">
<span class="ss-share-network-content">
<i class="ss ss-facebook"></i>
<span class="ss-network-count">
0
</span>
</span>
</a>
</li>
<li class="">
<a href="#" data-ss-ss-link="https://twitter.com/intent/tweet?text=Install+Karpenter+on+Existing+EKS+Cluster+%E2%80%93+Autoscaler+Migration+%7C+Kubernetes&url=https%3A%2F%2Fwww.middlewareinventory.com%2Fblog%2Finstall-karpenter-on-existing-eks-cluster-migration-guide%2F" class="ss-twitter-color" rel="nofollow" data-ss-ss-network-id="twitter" data-ss-ss-post-id="9057" data-ss-ss-location="inline_content" data-ss-ss-permalink="https://airdata.gitlab.io/blog/blog/install-karpenter-on-existing-eks-cluster-migration-guide/" data-ss-ss-type="share">
<span class="ss-share-network-content">
<i class="ss ss-twitter"></i>
</span>
</a>
</li>
<li class="">
<a href="#" data-ss-ss-link="https://www.linkedin.com/shareArticle?title=Install%20Karpenter%20on%20Existing%20EKS%20Cluster%20%E2%80%93%20Autoscaler%20Migration%20%7C%20Kubernetes&url=https%3A%2F%2Fwww.middlewareinventory.com%2Fblog%2Finstall-karpenter-on-existing-eks-cluster-migration-guide%2F&mini=true" class="ss-linkedin-color" rel="nofollow" data-ss-ss-network-id="linkedin" data-ss-ss-post-id="9057" data-ss-ss-location="inline_content" data-ss-ss-permalink="https://airdata.gitlab.io/blog/blog/install-karpenter-on-existing-eks-cluster-migration-guide/" data-ss-ss-type="share">
<span class="ss-share-network-content">
<i class="ss ss-linkedin"></i>
</span>
</a>
</li>
<li class="">
<a href="#" data-ss-ss-link="mailto:?body=https%3A%2F%2Fwww.middlewareinventory.com%2Fblog%2Finstall-karpenter-on-existing-eks-cluster-migration-guide%2F&subject=Install%20Karpenter%20on%20Existing%20EKS%20Cluster%20%E2%80%93%20Autoscaler%20Migration%20%7C%20Kubernetes" class="ss-envelope-color" rel="nofollow" data-ss-ss-network-id="envelope" data-ss-ss-post-id="9057" data-ss-ss-location="inline_content" data-ss-ss-permalink="https://airdata.gitlab.io/blog/blog/install-karpenter-on-existing-eks-cluster-migration-guide/" data-ss-ss-type="share">
<span class="ss-share-network-content">
<i class="ss ss-envelope"></i>
</span>
</a>
</li>
<li class="">
<a href="#" data-ss-ss-link="#" class="ss-copy-color" rel="nofollow" data-ss-ss-network-id="copy" data-ss-ss-post-id="9057" data-ss-ss-location="inline_content" data-ss-ss-permalink="https://airdata.gitlab.io/blog/blog/install-karpenter-on-existing-eks-cluster-migration-guide/" data-ss-ss-type="share">
<span class="ss-share-network-content">
<i class="ss ss-copy"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<p>Karpenter Auto Scaler is fairly advanced and provides a lot of Customization options than its predecessor Cluster Auto Scaler. (CA)</p>
<p><a href="../creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/index.html">In our previous article</a>, we have seen how to install and set up Karpenter Auto Scaler into a new EKS Cluster using Terraform.</p>
<p>In this article, we are going to see how to install and configure the karpenter Auto scaler into an existing EKS Cluster.</p>
<p>This can be also considered as a migration guide from Cluster Auto Scaler to Karpenter</p>
<p><a href="../../wp-content/uploads/2022/09/karpenter-ca-migraiton.jpg"><img class="post-img alignnone wp-image-9076 size-full lazyload" src="../../wp-content/ewww/lazy/placeholder-1748x1240.png" alt="Karpenter EKS" width="1748" height="1240" data-src="../../wp-content/uploads/2022/09/karpenter-ca-migraiton.jpg" loading="lazy" data-srcset="../../wp-content/uploads/2022/09/karpenter-ca-migraiton.jpg 1748w, ../../wp-content/uploads/2022/09/karpenter-ca-migraiton-300x213.jpg 300w, ../../wp-content/uploads/2022/09/karpenter-ca-migraiton-1024x726.jpg 1024w, ../../wp-content/uploads/2022/09/karpenter-ca-migraiton-768x545.jpg 768w, ../../wp-content/uploads/2022/09/karpenter-ca-migraiton-1536x1090.jpg 1536w, ../../wp-content/uploads/2022/09/karpenter-ca-migraiton-400x284.jpg 400w, ../../wp-content/uploads/2022/09/karpenter-ca-migraiton-1080x766.jpg 1080w, ../../wp-content/uploads/2022/09/karpenter-ca-migraiton-90x65.jpg 90w" data-sizes="auto" /><noscript><img class="post-img alignnone wp-image-9076 size-full" src="../../wp-content/uploads/2022/09/karpenter-ca-migraiton.jpg" alt="Karpenter EKS" width="1748" height="1240" srcset="../../wp-content/uploads/2022/09/karpenter-ca-migraiton.jpg 1748w, ../../wp-content/uploads/2022/09/karpenter-ca-migraiton-300x213.jpg 300w, ../../wp-content/uploads/2022/09/karpenter-ca-migraiton-1024x726.jpg 1024w, ../../wp-content/uploads/2022/09/karpenter-ca-migraiton-768x545.jpg 768w, ../../wp-content/uploads/2022/09/karpenter-ca-migraiton-1536x1090.jpg 1536w, ../../wp-content/uploads/2022/09/karpenter-ca-migraiton-400x284.jpg 400w, ../../wp-content/uploads/2022/09/karpenter-ca-migraiton-1080x766.jpg 1080w, ../../wp-content/uploads/2022/09/karpenter-ca-migraiton-90x65.jpg 90w" sizes="(max-width: 1748px) 100vw, 1748px" data-eio="l" /></noscript></a></p>
<div id="ez-toc-container" class="counter-hierarchy counter-decimal ez-toc-grey">
<div class="ez-toc-title-container">
<p class="ez-toc-title">Table of Contents</p>
<span class="ez-toc-title-toggle"><a class="ez-toc-pull-right ez-toc-btn ez-toc-btn-xs ez-toc-btn-default ez-toc-toggle"><i class="ez-toc-glyphicon ez-toc-icon-toggle"></i></a></span></div>
<nav><ul class="ez-toc-list"><li><a href="#Configuring_Environment_Variables" title="Configuring Environment Variables">Configuring Environment Variables</a></li><li><a href="#Launch_the_Cloudformation_template_to_Create_IAM_instance_Role" title="Launch the Cloudformation template to Create IAM instance Role">Launch the Cloudformation template to Create IAM instance Role</a></li><li><a href="#Creating_IAM_Identity_Mapping" title="Creating IAM Identity Mapping">Creating IAM Identity Mapping</a></li><li><a href="#Create_the_KarpenterController_IAM_Role" title="Create the KarpenterController IAM Role">Create the KarpenterController IAM Role</a></li><li><a href="#Install_Karpenter_using_helm_chart" title="Install Karpenter using helm chart">Install Karpenter using helm chart</a></li><li><a href="#What_is_provisioner_in_Karpenter" title="What is provisioner in Karpenter?">What is provisioner in Karpenter?</a></li><li><a href="#Why_do_we_need_a_Customized_Launch_Template" title="Why do we need a Customized Launch Template?">Why do we need a Customized Launch Template?</a></li><li><a href="#Collect_the_Cluster_Data_to_add_it_to_USER_DATA_of_EC2" title="Collect the Cluster Data &#8211; to add it to USER DATA of EC2">Collect the Cluster Data &#8211; to add it to USER DATA of EC2</a><ul><li><a href="#Why_cluster-specific_information_is_needed_for_the_Launch_template" title="Why cluster-specific information is needed?  for the Launch template">Why cluster-specific information is needed?  for the Launch template</a></li><li><a href="#How_to_find_the_Security_groups_associated_with_my_EKS_cluster" title="How to find the Security groups associated with my EKS cluster">How to find the Security groups associated with my EKS cluster</a></li></ul></li><li><a href="#Create_a_Launch_template_with_Terraform" title="Create a Launch template with Terraform">Create a Launch template with Terraform</a></li><li><a href="#TAG_the_Subnets_for_the_Provisioner" title="TAG the Subnets for the Provisioner">TAG the Subnets for the Provisioner</a><ul><li><a href="#How_to_identify_the_Subnets_being_used_in_my_existing_cluster" title="How to identify the Subnets being used in my existing cluster">How to identify the Subnets being used in my existing cluster</a></li></ul></li><li><a href="#Quick_Recap" title="Quick Recap">Quick Recap</a></li><li><a href="#Creating_the_Provisioner" title="Creating the Provisioner">Creating the Provisioner</a></li><li><a href="#Validating_Karpenter_Logs" title="Validating Karpenter Logs">Validating Karpenter Logs</a></li><li><a href="#Remove_Cluster_Auto_Scaler" title="Remove Cluster Auto Scaler">Remove Cluster Auto Scaler</a></li><li><a href="#Conclusion" title="Conclusion">Conclusion</a></li></ul></nav></div>
<h2><span class="ez-toc-section" id="Configuring_Environment_Variables">Configuring Environment Variables</span></h2>
<p>Open your favourite terminal and set the environment variables. I am using Mac OS and iterm2 as my terminal.</p>
<p>You can choose a terminal as per your choice.</p>
<p>Once the Environment variables are set in the terminal,  you must continue to use the same terminal until the end of this post.</p>
<p>If you are opening a new tab or new terminal, You might have to set these Environment variables once again before Proceeding</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">⇒ export KARPENTER_VERSION=v0.16.1
⇒ export CLUSTER_NAME="gritfy-01"
⇒ export AWS_DEFAULT_REGION="us-east-1"
⇒ export AWS_ACCOUNT_ID="$(aws sts get-caller-identity --query Account --output text)"
⇒ export CLUSTER_ENDPOINT="$(aws eks describe-cluster --name ${CLUSTER_NAME} --query "cluster.endpoint" --output text)"
⇒ echo $KARPENTER_VERSION $CLUSTER_NAME $AWS_DEFAULT_REGION $AWS_ACCOUNT_ID $CLUSTER_ENDPOINT
v0.16.1 gritfy-01 us-east-1 75*********3 https://A271E5***************5AC8.gr7.us-east-1.eks.amazonaws.com</pre>
<p>&nbsp;</p>
<h2><span class="ez-toc-section" id="Launch_the_Cloudformation_template_to_Create_IAM_instance_Role">Launch the Cloudformation template to Create IAM instance Role</span></h2>
<p>Now we need to create the IAM instance Role which would be mapped for the EC2 worker nodes once the karpenter provisions them.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">⇒ curl -fsSL https://karpenter.sh/"${KARPENTER_VERSION}"/getting-started/getting-started-with-eksctl/cloudformation.yaml  &gt; $TEMPOUT \
&amp;&amp; aws cloudformation deploy \
  --stack-name "Karpenter-${CLUSTER_NAME}" \
  --template-file "${TEMPOUT}" \
  --capabilities CAPABILITY_NAMED_IAM \
  --parameter-overrides "ClusterName=${CLUSTER_NAME}"</pre>
<p>&nbsp;</p>
<h2><span class="ez-toc-section" id="Creating_IAM_Identity_Mapping">Creating IAM Identity Mapping</span></h2>
<p>This command adds the Karpenter node role to your <code>aws-auth</code> config map, allowing nodes with this role to connect to the cluster.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">⇒ eksctl create iamidentitymapping \
  --username system:node:{{EC2PrivateDNSName}} \
  --cluster "${CLUSTER_NAME}" \
  --arn "arn:aws:iam::${AWS_ACCOUNT_ID}:role/KarpenterNodeRole-${CLUSTER_NAME}" \
  --group system:bootstrappers \
  --group system:nodes
2022-09-05 14:06:51 [ℹ]  adding identity "arn:aws:iam::751115992403:role/KarpenterNodeRole-gritfy-01" to auth ConfigMap</pre>
<p>&nbsp;</p>
<h2 id="create-the-karpentercontroller-iam-role"><span class="ez-toc-section" id="Create_the_KarpenterController_IAM_Role">Create the KarpenterController IAM Role</span></h2>
<p>Karpenter requires permissions like launching instances. This will create an AWS IAM Role, and Kubernetes service account, and associate them using <a href="https://docs.aws.amazon.com/emr/latest/EMR-on-EKS-DevelopmentGuide/setting-up-enable-IAM.html">IRSA</a>.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">⇒ eksctl create iamserviceaccount \
  --cluster "${CLUSTER_NAME}" --name karpenter --namespace karpenter \
  --role-name "${CLUSTER_NAME}-karpenter" \
  --attach-policy-arn "arn:aws:iam::${AWS_ACCOUNT_ID}:policy/KarpenterControllerPolicy-${CLUSTER_NAME}" \
  --role-only \
  --approve
</pre>
<p>If your cluster is not having an IRSA enabled. you might see some errors like this</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">2022-09-05 14:08:50 [!] no IAM OIDC provider associated with cluster, try 'eksctl utils associate-iam-oidc-provider --region=us-east-1 --cluster=gritfy-01'</pre>
<p>in that case,  you can allow the IRSA with the following command</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">⇒ eksctl utils associate-iam-oidc-provider --region=us-east-1 --cluster=gritfy-01 --approve</pre>
<p>now retry the previous command and it would succeed</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">⇒ eksctl utils associate-iam-oidc-provider --region=us-east-1 --cluster=gritfy-01 --approve
2022-09-05 14:09:34 [ℹ]  will create IAM Open ID Connect provider for cluster "gritfy-01" in "us-east-1"
2022-09-05 14:09:36 [✔]  created IAM Open ID Connect provider for cluster "gritfy-01" in "us-east-1"
Kubernetes|⇒ eksctl create iamserviceaccount \
  --cluster "${CLUSTER_NAME}" --name karpenter --namespace karpenter \
  --role-name "${CLUSTER_NAME}-karpenter" \
  --attach-policy-arn "arn:aws:iam::${AWS_ACCOUNT_ID}:policy/KarpenterControllerPolicy-${CLUSTER_NAME}" \
  --role-only \
  --approve
2022-09-05 14:16:26 [ℹ]  1 iamserviceaccount (karpenter/karpenter) was included (based on the include/exclude rules)
2022-09-05 14:16:26 [!]  serviceaccounts that exist in Kubernetes will be excluded, use --override-existing-serviceaccounts to override
2022-09-05 14:16:26 [ℹ]  1 task: { create IAM role for serviceaccount "karpenter/karpenter" }
2022-09-05 14:16:26 [ℹ]  building iamserviceaccount stack "eksctl-gritfy-01-addon-iamserviceaccount-karpenter-karpenter"
2022-09-05 14:16:27 [ℹ]  deploying stack "eksctl-gritfy-01-addon-iamserviceaccount-karpenter-karpenter"
2022-09-05 14:16:27 [ℹ]  waiting for CloudFormation stack "eksctl-gritfy-01-addon-iamserviceaccount-karpenter-karpenter"
2022-09-05 14:16:58 [ℹ]  waiting for CloudFormation stack "eksctl-gritfy-01-addon-iamserviceaccount-karpenter-karpenter"</pre>
<p>&nbsp;</p>
<h2 id="create-the-karpentercontroller-iam-role"><span class="ez-toc-section" id="Install_Karpenter_using_helm_chart">Install Karpenter using helm chart</span></h2>
<p>this command would deploy the helm chart in your cluster.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">helm upgrade --install --namespace karpenter --create-namespace \
  karpenter karpenter/karpenter \
  --version ${KARPENTER_VERSION} \
  --set serviceAccount.annotations."eks\.amazonaws\.com/role-arn"=${KARPENTER_IAM_ROLE_ARN} \
  --set clusterName=${CLUSTER_NAME} \
  --set clusterEndpoint=${CLUSTER_ENDPOINT} \
  --set aws.defaultInstanceProfile=KarpenterNodeInstanceProfile-${CLUSTER_NAME} \
  --wait # for the defaulting webhook to install before creating a Provisioner</pre>
<p>&nbsp;</p>
<p>Once the helm chart is installed successfully you can validate if the <code>Karpenter</code> namespace is ready and it might have launched two pods</p>
<p>You can validate it by issuing the following command</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">⇒ kubectl get pods -n karpenter</pre>
<p>If you use the following command you can see there are two containers in each pod</p>
<p>Note*: This command uses <code>sort</code> and <code>column</code> Linux commands for formatting</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">⇒ kubectl get pods -n karpenter  -o jsonpath='{"PODNAME\tNAMESPACE\tCONTAINERS"}{"\n"}{range .items[*]}{"\n"}{.metadata.name}{"\t"}{.metadata.namespace}{"\t"}{range .spec.containers[*]}{.name}{"=&gt;"}{.image}{","}{end}{end}' |sort|column -t</pre>
<p>If your PODS are up and running, it is a half victory for us</p>
<p>Now we need to create a Provisioner.</p>
<p>&nbsp;</p>
<h2><span class="ez-toc-section" id="What_is_provisioner_in_Karpenter">What is provisioner in Karpenter?</span></h2>
<p>Provisioner is the key differentiator between the legacy <strong>Cluster Auto Scaler</strong> and <strong>Karpenter</strong>.</p>
<p>AWS Karpenter Provides a lot of customization possibilities for designing our worker nodes. Unlike the legacy Cluster Auto Scaler.</p>
<p>In the provisioner definition, we can define what <strong>subnets</strong>, and what <strong>security groups</strong> to be used while launching the EC2 instances</p>
<p>Before we cover some more on the provisioner part. Let us take a quick look on how a simple provisioner definition looks like</p>
<pre class="EnlighterJSRAW" data-enlighter-language="yaml" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">apiVersion: karpenter.sh/v1alpha5
kind: Provisioner
metadata:
  name: default
spec:
  requirements:
    - key: karpenter.sh/capacity-type
      operator: In
      values: ["spot"]
  limits:
    resources:
      cpu: 1000
  provider:
    subnetSelector:
      karpenter.sh/discovery: ${CLUSTER_NAME}
    securityGroupSelector:
      karpenter.sh/discovery: ${CLUSTER_NAME}
  ttlSecondsAfterEmpty: 30
EOF</pre>
<p>&nbsp;</p>
<p>But we are not going to use this provisioner as it would create some default and minimal launch templates and worker nodes for us.</p>
<p>So we are going to customize it further.</p>
<p>As part of our customization, <strong>we need to create our own Launch template</strong></p>
<p>Launch template, as the name suggest helps us to create Multiple EC2 instances with the same configuration ( template)</p>
<p>&nbsp;</p>
<h2><span class="ez-toc-section" id="Why_do_we_need_a_Customized_Launch_Template">Why do we need a Customized Launch Template?</span></h2>
<p>The provisioner can auto-create the launch templates with the default configuration but the problem is that</p>
<p>Let&#8217;s say you want to customize the EC2 instances which are launched as worker nodes and perform some of the listed below tasks</p>
<ul>
<li>Change the Key pair (or) add a key pair with a new worker nodes</li>
<li>Change the Disk Size or add more disks</li>
<li>Customize the Subnet and/or Security group</li>
<li>Adding Special User startup data or scripts</li>
</ul>
<p>Except for local testing or for development purposes. I would encourage you to use your custom launch template</p>
<p>Now let us get some necessary information of the cluster before we create the launch template.</p>
<p>&nbsp;</p>
<h2 id="create-the-karpentercontroller-iam-role"><span class="ez-toc-section" id="Collect_the_Cluster_Data_to_add_it_to_USER_DATA_of_EC2">Collect the Cluster Data &#8211; to add it to USER DATA of EC2</span></h2>
<p>In this step, we are going to collect some configuration data from our EKS cluster.</p>
<p>This data is needed for the Launch template user_data ( startup boot time script) configuration.</p>
<p>user_data contains a list of shell commands  ( shell script) that would be executed during the boot-up / start time of the worker node.</p>
<p>&nbsp;</p>
<h3><span class="ez-toc-section" id="Why_cluster-specific_information_is_needed_for_the_Launch_template"><strong><span style="color: #003366;">Why cluster-specific information is needed?  for the Launch template</span></strong></span></h3>
<p>We have mentioned this cluster-specific information that we are going to collect would be used in creating the proper startup (user_data)</p>
<p>ideal EKS worker node startup script aka user_data would look something like this</p>
<pre class="EnlighterJSRAW" data-enlighter-language="shell" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">#!/bin/bash
set -ex
B64_CLUSTER_CA=LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM1ekNDQWMrZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJeE1UQXdOekUwTXpneE5Gb1hEVE14TVRBd05URTBNemd4TkZvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBS0Q4CmdoQ0JQM2ZaelhhMXgwL3lYa1RSQzlOb3F4cGtTYzFtanZiaFgra0ZmM0crUnEvM3FqNGpwS3hmbytoRjgrQzcKL3hnTjFRNjQ********anR0RW1YQVRSQTdYYkpuMmlnU1pGdTBhWkxiMnAvWjVHKzhkdXVxcm1WMHlHS2ZlQ21CbDNnZnVZCmREUEZCcUY4Z292bHZKc2hlRXA3OGEzSFI4TWx6SUUxaW10NVhzN24rMG9JU05QVWd4US8vZURkK2djOXhHcVYKdFJhZVJCcWJmNm9iajVGalZkbVpOSnowOTJsOVVYSjI3ZitEQUNuTmk0TUVVTWxEUUhFQ2dUY09RcC9ZcDZzQwpEV09wWFhVYW5GOEIwcm51U2MrUWlXVmJCdjZHS1FhUzR1SWFNWG5QYThCMnp4amJQQ0Z1L2YzZmtRT0pVMCtIClAyV2c1bThKclNNWmpWRFB3a2lKbERHTXFCdjZoZlJXbGNRYgotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==

API_SERVER_URL=https://A271E535C*******561C6445AC8.gr7.us-east-1.eks.amazonaws.com

K8S_CLUSTER_DNS_IP=172.20.0.10

/etc/eks/bootstrap.sh gritfy-01 --b64-cluster-ca $B64_CLUSTER_CA --apiserver-endpoint $API_SERVER_URL --dns-cluster-ip $K8S_CLUSTER_DNS_IP</pre>
<p>If you look at the last line of the preceding user_data shell script. you can see we are calling a specific script named <code>/etc/eks/bootstrap.sh</code></p>
<blockquote><p>This script <code>/etc/eks/bootstrap.sh</code> would be available only if you choose the right AMI which can power your EKS cluster.</p>
<p>You can find more about the <a href="https://docs.aws.amazon.com/eks/latest/userguide/eks-optimized-ami.html">EKS optimized AMIs here</a></p></blockquote>
<p>This script is to get the EC2 instance ready to be attached to the Kubernetes eco-system. this installs various tools like</p>
<ul>
<li>Docker/ContinerD ( Container Runtime Engine)</li>
<li>Kubelet</li>
<li>Networking Plugins in CNI</li>
<li>KubeProxy and more.</li>
</ul>
<p>&nbsp;</p>
<p>If you look at the way we are invoking this script you can see we are passing three additional arguments such as</p>
<ul>
<li><code>b64-cluster-ca</code> Base 64 Cluster CA Certificate</li>
<li><code>apiserver-endpoint</code> HTTPS URL of the API Server</li>
<li><code>dns-cluster-ip</code> DNS IP of the Kubernetes ( hope you remember that K8s has its internal IP and DNS)</li>
</ul>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">/etc/eks/bootstrap.sh gritfy-01 --b64-cluster-ca $B64_CLUSTER_CA --apiserver-endpoint $API_SERVER_URL --dns-cluster-ip $K8S_CLUSTER_DNS_IP</pre>
<p>Now, where do we get this information?  we can get this information using <code>aws eks</code> CLI command</p>
<p>For this command to work you must have set up the aws CLI.</p>
<p>If you are new to it, <a href="../aws-cli-ec2/index.html">refer to our exclusive article on aws cli here</a></p>
<p>Here are the commands you might have to use to get different key items</p>
<p><strong>b64-cluster-ca</strong></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">⇒ aws eks describe-cluster --name ${CLUSTER_NAME} --query "cluster.certificateAuthority.data" --output text</pre>
<p><strong>api-server-endpoint</strong></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">⇒ aws eks describe-cluster --name ${CLUSTER_NAME} --query "cluster.endpoint" --output text</pre>
<p><strong>dns-cluster-ip</strong></p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">⇒ aws eks describe-cluster --name ${CLUSTER_NAME} --query "cluster.kubernetesNetworkConfig.serviceIpv4Cidr" --output text</pre>
<p>Once you have got the key items needed you can make a note of them and use them during the Launch template creation in the next step</p>
<p>There is one more item you need to collect which is a security group associated with the existing nodes</p>
<p>&nbsp;</p>
<h3><span class="ez-toc-section" id="How_to_find_the_Security_groups_associated_with_my_EKS_cluster"><span style="color: #003366;">How to find the Security groups associated with my EKS cluster</span></span></h3>
<p>You can find the master security group associated with your EKS cluster from the AWS Admin console itself</p>
<p><span style="color: #003366;">Go to EKS &gt; Clusters &gt; Choose the cluster</span></p>
<p>In the Networking tab, you can find the primary security group and secondary security group.</p>
<p>This Security group is not sufficient at times for the EC2 worker nodes.</p>
<p>Since this is your existing EKS cluster there must be some additional configuration changes done to the node group and the Launch template underneath</p>
<p>so the right way to check the security groups is to refer to the existing worker nodes</p>
<p>you can do this by going here</p>
<p><span style="color: #003366;">Go to EKS &gt; Clusters &gt; Choose your cluster Compute &gt; Click on the existing worker node </span></p>
<p>Once the particular node is open click the <strong>instance_id </strong> it would take you to the EC2 service screen where you can find the security groups associated with your existing worker node</p>
<p>Once you have noted down the security groups. we can move on to creating the Launch template</p>
<p>&nbsp;</p>
<h2><span class="ez-toc-section" id="Create_a_Launch_template_with_Terraform">Create a Launch template with Terraform</span></h2>
<p>We have collected all the data needed now let us create the launch template.</p>
<p>We are going to use <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/launch_template">Terraform</a> to create our launch template</p>
<p>Terraform code for the Launch template creation is available on <a href="https://github.com/AKSarav/EKS_launch_template">my github repository here</a></p>
<p>You can clone the repository using the following command</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">⇒ git clone https://github.com/AKSarav/EKS_launch_template</pre>
<p>Once you have downloaded the code. You can start with <strong>terraform plan</strong></p>
<p>You need to pass the necessary startup argument</p>
<ul>
<li><strong>security_group_ids </strong>security group IDs for the launch template machines</li>
<li><strong>ami_id  </strong>amazon eks optimized ami</li>
<li><strong>disksize </strong>EBS volume size of the worker nodes</li>
<li><strong>lt_name </strong>name to the launch template being created</li>
<li><strong>iam_instance_profile </strong>IAM instance profile name ( IAM role name)</li>
<li><strong>keypair_name </strong>Key Pair name, If do not have already, <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/create-key-pairs.html">create one</a></li>
</ul>
<p>&nbsp;</p>
<p>here is the command, please make sure to update the values after the <code>=</code>sign before trying this at your end</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">⇒ terraform plan -out tfplan.out \
  -var 'security_group_ids=["sg-xxxxxxxxxx", "sg-xxxxxxxxxx"]' \
  -var ami_id=ami-0d78302dd24db83c7 \
  -var disksize=100 \
  -var lt_name=karpenter-lt-eks-qa01 \
  -var iam_instance_profile=KarpenterNodeInstanceProfile-gritfy-01 \
  -var keypair_name=jumphost-gritfy</pre>
<p>&nbsp;</p>
<p>we also have <code>-out</code> to store the output of the plan to <code>tfplan.out</code> file which would be used in the next stage</p>
<p>Always make sure what changes are being done on the plan state so that you would not end up with surprises.</p>
<p>Once you are satisfied with the plan.</p>
<p>Now we can go ahead and execute <strong>terraform apply </strong>command to apply the changes.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">⇒ terraform apply tfplan.out</pre>
<p>here is a glimpse of the execution output for both these commands</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">⇒ terraform plan -out tfplan.out -var ami_id=ami-0d78302dd24db83c7 -var disksize=100 -var lt_name=karpenter-lt-eks-qa01 -var iam_instance_profile=KarpenterNodeInstanceProfile-gritfy-01 -var keypair_name=jumphost-gritfy

Terraform used the selected providers to generate the following execution plan. Resource actions are
indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # aws_launch_template.eks-lt will be created
  + resource "aws_launch_template" "eks-lt" {
      + arn                    = (known after apply)
      + default_version        = (known after apply)
      + ebs_optimized          = "true"
      + id                     = (known after apply)
      + image_id               = "ami-0d78302dd24db83c7"
      + key_name               = "jumphost-pp"
      + latest_version         = (known after apply)
      + name                   = "karpenter-lt-eks-qa01"
      + name_prefix            = (known after apply)
      + tags_all               = (known after apply)
      + user_data              = "IyEvYmluL2Jhc2gKc2V0IC1leApCNjRfQ0xVU1RFUl9DQT1MUzB0TFMxQ1JVZEpUaUJEUlZKVVNVWkpRMEZVUlMwdExTMHRDazFKU1VNMWVrTkRRV01yWjBGM1NVSkJaMGxDUVVSQlRrSm5hM0ZvYTJsSE9YY3dRa0ZSYzBaQlJFRldUVkpOZDBWUldVUldVVkZFUlhkd2NtUlhTbXdLWTIwMWJHUkhWbnBOUWpSWVJGUkplRTFVUVhkT2VrVXdUWHBuZUU1R2IxaEVWRTE0VFZSQmQwNVVSVEJOZW1kNFRrWnZkMFpVUlZSTlFrVkhRVEZWUlFwQmVFMUxZVE5XYVZwWVNuVmFXRkpzWTNwRFEwRlRTWGRFVVZsS1MyOWFTV2gyWTA1QlVVVkNRbEZCUkdkblJWQkJSRU5EUVZGdlEyZG5SVUpCUzBRNENtZG9RMEpRTTJaYWVsaGhNWGd3TDNsWWExUlNRemxPYjNGNGNHdFRZekZ0YW5aaWFGZ3JhMFptTTBjclVuRXZNM0ZxTkdwd1MzaG1ieXRvUmpnclF6Y0tMM2huVGpGUk5qUTVWMWRrY25GeVpGQktMMWRWZEVFNGMxRmxjRkJzWVRka1FUUXdSVVpaYW5SUGQyRnlUWGhFVlVwNFZUWkxNVGRDVG5jMlptaEZVUXA0U0ZvcldWTk1iMFY1Tm01T1ltVm1LMEZJZDJabllVRTFVMEowYTJ0S1dIZFhkWGxpZUV4c1lXRklLMjFrWVZWQ1NXOU9lbmx5VUN0aWJEVTVMeko1Q25Ob1V6UnNVVFZXYkRsNGJuRnZLMlpSVG1Wb04wUm9hbWR4TW14TlRTOUJiRGRNTmtKMU0wVjRLMGc1TkdoeFZHSnpVR295VURJMVJteEdOeTluZW5jS00zUllWVkZyZFZKTWRVZDVVVmxLU0V4Q1lqbGtibmcwTjBwMGFIWjJZeXRZVEdOQloyOTJTbGxOTUV4aVkwVkxlRFJoUVdaek1FWktTWGhxUkdGblpncEZWR2hUYzNJMVQwaHRkalJwWjJRemF6WmpRMEYzUlVGQllVNURUVVZCZDBSbldVUldVakJRUVZGSUwwSkJVVVJCWjB0clRVRTRSMEV4VldSRmQwVkNDaTkzVVVaTlFVMUNRV1k0ZDBoUldVUldVakJQUWtKWlJVWk5lRGhGWWtGeGFVUTBjVVZvTUhCWWVXb3llRlZGZVRSc1JrWk5RVEJIUTFOeFIxTkpZak1LUkZGRlFrTjNWVUZCTkVsQ1FWRkJSM1JXTlZwd2NuWlJTRXRvUlhNM1ltSlJSazVJZG14bFNHeERSMnhOTUVveVRHSlpNSEZqYlVjeGQwZHZVM1JwTWdwVWJUVnlZbU5EYW5SMFJXMVlRVlJTUVRkWVlrcHVNbWxuVTFwR2RUQmhXa3hpTW5BdldqVkhLemhrZFhWeGNtMVdNSGxIUzJabFEyMUNiRE5uWm5WWkNtUkVVRVpDY1VZNFoyOTJiSFpLYzJobFJYQTNPR0V6U0ZJNFRXeDZTVVV4YVcxME5WaHpOMjRyTUc5SlUwNVFWV2Q0VVM4dlpVUmtLMmRqT1hoSGNWWUtkRkpoWlZKQ2NXSm1ObTlpYWpWR2FsWmtiVnBPU25vd09USnNPVlZZU2pJM1ppdEVRVU51VG1rMFRVVlZUV3hFVVVoRlEyZFVZMDlSY0M5WmNEWnpRd3BFVjA5d1dGaFZZVzVHT0VJd2NtNTFVMk1yVVdsWFZtSkNkalpIUzFGaFV6UjFTV0ZOV0c1UVlUaENNbnA0YW1KUVEwWjFMMll6Wm10UlQwcFZNQ3RJQ2xBeVYyYzFiVGhLY2xOTldtcFdSRkIzYTJsS2JFUkhUWEZDZGpab1psSlhiR05SWWdvdExTMHRMVVZPUkNCRFJWSlVTVVpKUTBGVVJTMHRMUzB0Q2c9PQoKQVBJX1NFUlZFUl9VUkw9aHR0cHM6Ly9BMjcxRTUzNUM1MTJCOTJDRThDMkE1NjFDNjQ0NUFDOC5ncjcudXMtZWFzdC0xLmVrcy5hbWF6b25hd3MuY29tCgpLOFNfQ0xVU1RFUl9ETlNfSVA9MTcyLjIwLjAuMTAKCi9ldGMvZWtzL2Jvb3RzdHJhcC5zaCBxYS0wMSAtLWI2NC1jbHVzdGVyLWNhICRCNjRfQ0xVU1RFUl9DQSAtLWFwaXNlcnZlci1lbmRwb2ludCAkQVBJX1NFUlZFUl9VUkwgLS1kbnMtY2x1c3Rlci1pcCAkSzhTX0NMVVNURVJfRE5TX0lQ"
      + vpc_security_group_ids = [
          + "sg-xxxxxxxxxx",
          + "sg-xxxxxxxxxx",
        ]

      + block_device_mappings {
          + device_name = "/dev/sda1"

          + ebs {
              + iops        = (known after apply)
              + throughput  = (known after apply)
              + volume_size = 100
              + volume_type = (known after apply)
            }
        }

      + iam_instance_profile {
          + name = "KarpenterNodeInstanceProfile-gritfy-01"
        }

      + metadata_options {
          + http_endpoint               = (known after apply)
          + http_protocol_ipv6          = (known after apply)
          + http_put_response_hop_limit = (known after apply)
          + http_tokens                 = (known after apply)
          + instance_metadata_tags      = (known after apply)
        }

      + monitoring {
          + enabled = true
        }
    }

Plan: 1 to add, 0 to change, 0 to destroy.

────────────────────────────────────────────────────────────────────────────────────────────────────────────

Saved the plan to: tfplan.out

To perform exactly these actions, run the following command to apply:
    terraform apply "tfplan.out"
launchtemplate|⇒ terraform apply "tfplan.out"
aws_launch_template.eks-lt: Creating...
aws_launch_template.eks-lt: Creation complete after 2s [id=lt-0d56e9c204f8d5694]

Apply complete! Resources: 1 added, 0 changed, 0 destroyed.</pre>
<p>&nbsp;</p>
<p>Remember, we are going to use the launch template name <code>lt_name</code>  within our provisioner.</p>
<p>Now the launch template is ready. we can use this launch template in our provisioner.</p>
<h2></h2>
<h2><span class="ez-toc-section" id="TAG_the_Subnets_for_the_Provisioner">TAG the Subnets for the Provisioner</span></h2>
<p>Now we have the launch template with the necessary information already configured like security_group ids and IAM roles etc.</p>
<p>Now, we need to pass the subnet IDs to Karpenter</p>
<h3><span class="ez-toc-section" id="How_to_identify_the_Subnets_being_used_in_my_existing_cluster"><span style="color: #003366;">How to identify the Subnets being used in my existing cluster</span></span></h3>
<p>You can easily find the subnets of your existing cluster by checking the network settings of the currently running worker machine ( Since its a existing cluster)</p>
<p>We can use the following AWS CLI commands to find out the subnets which are currently being used</p>
<p>First List down the node groups of your existing EKS cluster with the following command</p>
<pre># aws eks list-nodegroups --cluster-name dev-01</pre>
<p>From the result of the previous command choose one of the returned node groups and describe it like below to get to the subnets</p>
<pre>aws eks describe-nodegroup --cluster-name dev-01 --nodegroup-name &lt;nodegroup-name&gt; --query 'nodegroup.subnets' --output text</pre>
<p>Here is the execution output of these commands, when executed at my end</p>
<p><a href="../../wp-content/uploads/2022/09/Screenshot-2022-09-20-at-11.36.04-PM.png"><img class="alignnone size-full wp-image-9068 lazyload" src="../../wp-content/ewww/lazy/placeholder-1920x211.png" alt="" width="3096" height="340" data-src="../../wp-content/uploads/2022/09/Screenshot-2022-09-20-at-11.36.04-PM.png" loading="lazy" data-srcset="../../wp-content/uploads/2022/09/Screenshot-2022-09-20-at-11.36.04-PM.png 3096w, ../../wp-content/uploads/2022/09/Screenshot-2022-09-20-at-11.36.04-PM-300x33.png 300w, ../../wp-content/uploads/2022/09/Screenshot-2022-09-20-at-11.36.04-PM-1024x112.png 1024w, ../../wp-content/uploads/2022/09/Screenshot-2022-09-20-at-11.36.04-PM-768x84.png 768w, ../../wp-content/uploads/2022/09/Screenshot-2022-09-20-at-11.36.04-PM-1536x169.png 1536w, ../../wp-content/uploads/2022/09/Screenshot-2022-09-20-at-11.36.04-PM-2048x225.png 2048w, ../../wp-content/uploads/2022/09/Screenshot-2022-09-20-at-11.36.04-PM-1080x119.png 1080w" data-sizes="auto" /><noscript><img class="alignnone size-full wp-image-9068" src="../../wp-content/uploads/2022/09/Screenshot-2022-09-20-at-11.36.04-PM.png" alt="" width="3096" height="340" srcset="../../wp-content/uploads/2022/09/Screenshot-2022-09-20-at-11.36.04-PM.png 3096w, ../../wp-content/uploads/2022/09/Screenshot-2022-09-20-at-11.36.04-PM-300x33.png 300w, ../../wp-content/uploads/2022/09/Screenshot-2022-09-20-at-11.36.04-PM-1024x112.png 1024w, ../../wp-content/uploads/2022/09/Screenshot-2022-09-20-at-11.36.04-PM-768x84.png 768w, ../../wp-content/uploads/2022/09/Screenshot-2022-09-20-at-11.36.04-PM-1536x169.png 1536w, ../../wp-content/uploads/2022/09/Screenshot-2022-09-20-at-11.36.04-PM-2048x225.png 2048w, ../../wp-content/uploads/2022/09/Screenshot-2022-09-20-at-11.36.04-PM-1080x119.png 1080w" sizes="(max-width: 3096px) 100vw, 3096px" data-eio="l" /></noscript></a></p>
<p>You can tag these subnets manually or choose to tag either few of them based on the free IP availability</p>
<p>Once you have decided on the subnets, you can use the aws cli command to tag them all</p>
<pre class=" language-bash" tabindex="0"><code class=" language-bash" data-lang="bash">aws ec2 create-tags <span class="token punctuation">\</span>
    --tags <span class="token string">"Key=karpenter.sh/discovery,Value=<span class="token variable">${CLUSTER_NAME}</span>"</span> <span class="token punctuation">\</span>
    --resources subnet-ids</code></pre>
<p>Or you can manually tag them on the AWS Management console.</p>
<pre>karpenter.sh/discovery : cluster_name</pre>
<p>Here is the snapshot taken at my end with a similar tag and my cluster name <code>gritfy-01</code></p>
<p><a href="../../wp-content/uploads/2022/09/Screenshot-2022-09-18-at-12.32.32-AM-1.png"><img class="alignnone size-full wp-image-9075 lazyload" src="../../wp-content/ewww/lazy/placeholder-1772x466.png" alt="" width="1772" height="466" data-src="../../wp-content/uploads/2022/09/Screenshot-2022-09-18-at-12.32.32-AM-1.png" loading="lazy" data-srcset="../../wp-content/uploads/2022/09/Screenshot-2022-09-18-at-12.32.32-AM-1.png 1772w, ../../wp-content/uploads/2022/09/Screenshot-2022-09-18-at-12.32.32-AM-1-300x79.png 300w, ../../wp-content/uploads/2022/09/Screenshot-2022-09-18-at-12.32.32-AM-1-1024x269.png 1024w, ../../wp-content/uploads/2022/09/Screenshot-2022-09-18-at-12.32.32-AM-1-768x202.png 768w, ../../wp-content/uploads/2022/09/Screenshot-2022-09-18-at-12.32.32-AM-1-1536x404.png 1536w, ../../wp-content/uploads/2022/09/Screenshot-2022-09-18-at-12.32.32-AM-1-1080x284.png 1080w" data-sizes="auto" /><noscript><img class="alignnone size-full wp-image-9075" src="../../wp-content/uploads/2022/09/Screenshot-2022-09-18-at-12.32.32-AM-1.png" alt="" width="1772" height="466" srcset="../../wp-content/uploads/2022/09/Screenshot-2022-09-18-at-12.32.32-AM-1.png 1772w, ../../wp-content/uploads/2022/09/Screenshot-2022-09-18-at-12.32.32-AM-1-300x79.png 300w, ../../wp-content/uploads/2022/09/Screenshot-2022-09-18-at-12.32.32-AM-1-1024x269.png 1024w, ../../wp-content/uploads/2022/09/Screenshot-2022-09-18-at-12.32.32-AM-1-768x202.png 768w, ../../wp-content/uploads/2022/09/Screenshot-2022-09-18-at-12.32.32-AM-1-1536x404.png 1536w, ../../wp-content/uploads/2022/09/Screenshot-2022-09-18-at-12.32.32-AM-1-1080x284.png 1080w" sizes="(max-width: 1772px) 100vw, 1772px" data-eio="l" /></noscript></a></p>
<p>&nbsp;</p>
<p>You can use the following one-liner shell command to find and tag all the existing subnets of your EKS cluster</p>
<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">for NODEGROUP in $(aws eks list-nodegroups --cluster-name ${CLUSTER_NAME} \
    --query 'nodegroups' --output text); do aws ec2 create-tags \
        --tags "Key=karpenter.sh/discovery,Value=${CLUSTER_NAME}" \
        --resources $(aws eks describe-nodegroup --cluster-name ${CLUSTER_NAME} \
        --nodegroup-name $NODEGROUP --query 'nodegroup.subnets' --output text )
done</pre>
<p>&nbsp;</p>
<h2><span class="ez-toc-section" id="Quick_Recap">Quick Recap</span></h2>
<ul>
<li>We have set environment variables in our terminal with the cluster properties</li>
<li>Created IAM instance role with Cloud Formation Template</li>
<li>Created IAM Identity Mapping &#8211; Adding Entry to aws-auth config map</li>
<li>Service Account creation with IAM role &#8211; <a href="https://docs.aws.amazon.com/emr/latest/EMR-on-EKS-DevelopmentGuide/setting-up-enable-IAM.html">IRSA</a></li>
<li>Installed Karpenter using Helm Chart</li>
<li>Discussed what Karpenter Provisioner is and why we need a Custom Launch template</li>
<li>Collected the Cluster config data and Security group for the Launch template Creation</li>
<li>Created Launch template using Terraform and with the data collected in the previous step</li>
<li>Identify the existing Subnets (or) create new ones and TAG them for the provisioner to find and use it</li>
</ul>
<p>These are the steps we have accomplished so far in our article and now we have everything in order for us to do our final step, creating the provisioner</p>
<p>Unlike the Cluster Auto Scaler, We have a special controller named Karpenter provisioner which takes care of launching the nodes as per demand using our Custom Launch template and the Subnets</p>
<p>with no further ado, let us create our provisioner</p>
<p>&nbsp;</p>
<h2><span class="ez-toc-section" id="Creating_the_Provisioner">Creating the Provisioner</span></h2>
<p>In the beginning, we have seen a default provisioner manifest file, It had minimal configuration required for the provisioner</p>
<p>But we chose to use custom Launch templates as we had reasons.</p>
<p>Now here is our modified provisioner YAML configuration file</p>
<pre class="EnlighterJSRAW" data-enlighter-language="yaml" data-enlighter-theme="bootstrap4" data-enlighter-linenumbers="false">apiVersion: karpenter.sh/v1alpha5
kind: Provisioner
metadata:
  name: default
spec:
  limits:
    resources:
      cpu: 2k
  provider:
    apiVersion: extensions.karpenter.sh/v1alpha1
    kind: AWS
    launchTemplate: karpenter-lt-eks-qa01
    subnetSelector:
      karpenter.sh/discovery: gritfy-01
  requirements:
  - key: karpenter.sh/capacity-type
    operator: In
    values:
    - spot
  - key: kubernetes.io/arch
    operator: In
    values:
    - amd64
  ttlSecondsAfterEmpty: 30</pre>
<p>&nbsp;</p>
<p>Let us decode this file to understand it better</p>
<ul>
<li>kind &#8211;  to define what kind of definition it is, it is a provisioner</li>
<li>metadata.name &#8211; what is the name of provisioner</li>
<li>spec
<ul>
<li>limits.resources.cpu &#8211; maximum number of CPUs Karpenter can create ( you can also use memory in here)</li>
</ul>
</li>
<li>provider
<ul>
<li>apiVersion &#8211; version of the karpeter definition</li>
<li>kind &#8211; AWS provider ( Karpenter have future plans to extend to other cloud providers)</li>
<li><strong>launchTemplate </strong>&#8211; we are defining the name of the launch template we have created earlier in our article</li>
<li><strong>subnetSelector &#8211;</strong> Since we have not hardcoded the subnet into the launch template and tagged them manually, we are defining what <code>tags</code> it should look for to find the right subnet.  If you remember, we tagged the subnets earlier with <code>karpenter.sh/discovery: cluster-name</code></li>
</ul>
</li>
<li>requirements
<ul>
<li><strong>key: karpenter.sh/capacity-type</strong> defining our requirements for the node, should it be spot or on-demand instance etc</li>
<li><strong>key: kubernetes.io/arch </strong>defining what OS architecture that Karpenter can provision like <code>amd</code> or <code>arm</code> remember sometimes if you choose the architecture wrong or use both of them on the same cluster.  Daemonsets and pods with specific OS architecture requirements might fail. you have to choose it right. Mostly it would be <code>amd</code></li>
</ul>
</li>
</ul>
<p>&nbsp;</p>
<blockquote><p> Note*: Provisioner do provide various options to further customize your workload and requirements, <a href="https://karpenter.sh/v0.16.2/provisioner/">Please refer to this provisioner documentation</a> and write your own if you need to use the full potential of Karpenter</p></blockquote>

<p>Now go ahead and apply this provisioner by saving this into some file named <code>yaml</code> or by copying the following <code>heredoc</code> shell command</p>
<pre>$ cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: karpenter.sh/v1alpha5
kind: Provisioner
metadata:
name: default
spec:
limits:
resources:
cpu: 2k
provider:
apiVersion: extensions.karpenter.sh/v1alpha1
kind: AWS
launchTemplate: karpenter-lt-eks-qa01
subnetSelector:
karpenter.sh/discovery: gritfy-01
requirements:
- key: karpenter.sh/capacity-type
operator: In
values:
- spot
- key: kubernetes.io/arch
operator: In
values:
- amd64
ttlSecondsAfterEmpty: 30
EOF</pre>
<p>Now once you have applied it either by yaml file or by the heredoc.</p>
<p>You should see the Karpenter provisioner listed when you execute the following kubectl command</p>
<pre>$ kubectl get provisioner default</pre>
<p>Now your provisioner is ready</p>
<p>Karpenter is now active and ready to begin provisioning nodes. Create some pods using a deployment, and watch Karpenter provision nodes in response.</p>
<h2></h2>
<h2><span class="ez-toc-section" id="Validating_Karpenter_Logs">Validating Karpenter Logs</span></h2>
<p>Now you must be able to see Karpenter pods running in a dedicated namespace called <code>karpenter</code></p>
<p>Check if the pods are running and their names.</p>
<pre>kubectl get pods -n karpenter</pre>
<p>Once you know the karpenter POD names, check the logs</p>
<pre>kubectl logs &lt;pod-name&gt; -n karpenter -c controller</pre>
<p>Remember we spoke earlier that karpenter has a multi-container setup</p>
<ul>
<li>controller &#8211; which controls and manages the scheduling</li>
<li>webhook &#8211; to keep the configuration in Sync with API server</li>
</ul>
<p>here in the preceding command, we are checking controller logs by mentioning <code>-c controller</code> in the kubectl logs command</p>
<p>&nbsp;</p>
<h2 id="remove-cas"><span class="ez-toc-section" id="Remove_Cluster_Auto_Scaler">Remove Cluster Auto Scaler</span></h2>
<p>Now that karpenter is running we can disable the cluster autoscaler. To do that we will scale the number of replicas to zero.</p>
<div class="highlight">
<div class="code-toolbar">
<pre class=" language-bash" tabindex="0"><code class=" language-bash" data-lang="bash">kubectl scale deploy/cluster-autoscaler -n kube-system --replicas<span class="token operator">=</span><span class="token number">0</span></code></pre>
</div>
</div>
<p>To get rid of the instances that were added from the node group we can scale our nodegroup down to a minimum size to support Karpenter and other critical services. We suggest a minimum of 2 nodes for the node group.</p>
<blockquote><p>Note: If your workloads do not have <a href="https://kubernetes.io/docs/tasks/run-application/configure-pdb/">pod disruption budgets</a> set, the following command <strong>will cause workloads to be unavailable.</strong></p></blockquote>
<div class="highlight">
<div class="code-toolbar">
<pre class=" language-bash" tabindex="0"><code class=" language-bash" data-lang="bash">aws eks update-nodegroup-config --cluster-name <span class="token variable">${CLUSTER_NAME}</span> <span class="token punctuation">\</span>
    --nodegroup-name <span class="token variable">${NODEGROUP}</span> <span class="token punctuation">\</span>
    --scaling-config <span class="token string">"minSize=2,maxSize=2,desiredSize=2"</span></code></pre>
</div>
</div>
<p>If you have a lot of nodes or workloads you may want to slowly scale down your node groups by a few instances at a time. It is recommended to watch the transition carefully for workloads that may not have enough replicas running or disruption budgets configured.</p>
<p>&nbsp;</p>
<h2 id="remove-cas"><span class="ez-toc-section" id="Conclusion">Conclusion</span></h2>
<p>In this lengthy article, I have tried to cover my experience and how did I implement Karpenter in our existing EKS cluster and migrated from Cluster Auto Scaler.</p>
<p>If you have any questions or need additional clarifications anywhere, please do reach out to me in the comments. I will try to help.</p>
<p>&nbsp;</p>
<p>Cheers<br />
Rumen Lishkov</p>
<div id="postfollow">
<a href='https://ko-fi.com/O4O51FG7C' target='_blank'><img height='46' style='border:0px;height:46px;width: 186px' src='data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==' border='0' alt='Buy Me a Coffee at ko-fi.com' data-src="https://az743702.vo.msecnd.net/cdn/kofi3.png?v=2" loading="lazy" class="lazyload" /><noscript><img height='46' style='border:0px;height:46px;width: 186px' src='https://az743702.vo.msecnd.net/cdn/kofi3.png?v=2' border='0' alt='Buy Me a Coffee at ko-fi.com' data-eio="l" /></noscript></a>
<p>Follow us on<a href="https://www.facebook.com/rumenlishkov">Facebook</a> or<a href="https://www.twitter.com/mwinventory">Twitter</a>
</br>
For more practical videos and tutorials. <a href="https://www.youtube.com/kiss2mark">Subscribe to our channel</a>
</br>
Follow me on Linkedin <a href="https://www.linkedin.com/comm/mynetwork/discovery-see-all?usecase=PEOPLE_FOLLOWS&amp;followMember=saravakmwinventory">My Profile</a>
</br>
</i>For any Consultation or to hire us <a href="../../cdn-cgi/l/email-protection.html#aac2cfc6c6c5eacdd8c3deccd384c9c5c7"> <span class="__cf_email__" data-cfemail="6c04090000032c0b1e05180a15420f0301">[email&#160;protected]</span></a>
</br>
If you like this article. Show your Support! <a href="https://ko-fi.com/middlewareinventory">Buy me a Coffee.</a>
</br>
</p>
<p style="color: palevioletred !important;">Signup for Exclusive "Subscriber-only" Content</p>
<div class="emaillist">
<form action="#" method="post" class="es_subscription_form es_shortcode_form" id="es_subscription_form_1664211142" data-source="ig-es">
<div class="es-field-wrap"><label>Name*<br /><input type="text" name="name" class="ig_es_form_field_name" placeholder="" value="" required="required" /></label></div><div class="es-field-wrap"><label>Email*<br /><input class="es_required_field es_txt_email ig_es_form_field_email" type="email" name="email" value="" placeholder="" required="required" /></label></div><input type="hidden" name="lists[]" value="1" /><input type="hidden" name="form_id" value="3" />
<input type="hidden" name="es_email_page" value="9057" />
<input type="hidden" name="es_email_page_url" value="https://airdata.gitlab.io/blog/blog/install-karpenter-on-existing-eks-cluster-migration-guide/" />
<input type="hidden" name="status" value="Unconfirmed" />
<input type="hidden" name="es-subscribe" id="es-subscribe" value="1ba54428fb" />
<label style="position:absolute;top:-99999px;left:-99999px;z-index:-99;"><input type="email" name="es_hp_email" class="es_required_field" tabindex="-1" autocomplete="-1" value="" /></label>
<input type="submit" name="submit" class="es_subscription_form_submit es_submit_button es_textbox_button" id="es_subscription_form_submit_1664211142" value="Subscribe" />
<span class="es_spinner_image" id="spinner-image"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Loading" data-src="../../wp-content/plugins/email-subscribers/lite/public/images/spinner.gif" loading="lazy" class="lazyload" /><noscript><img src="../../wp-content/plugins/email-subscribers/lite/public/images/spinner.gif" alt="Loading" data-eio="l" /></noscript></span>
</form>
<span class="es_subscription_message" id="es_subscription_message_1664211142"></span>
</div>
</div>
<hr>
<div class='rp4wp-related-posts'>
<h3>More from Middleware Inventory</h3>
<ul>
<li><div class='rp4wp-related-post-image'>
<a href='../creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/index.html'><img width="150" height="150" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 150'%3E%3C/svg%3E" class="attachment-thumbnail size-thumbnail wp-post-image lazyload" alt="EKS Karpenter Example" data-src="../../wp-content/uploads/2022/02/aws-eks-karpenter-150x150.jpg" loading="lazy" /><noscript><img width="150" height="150" src="../../wp-content/uploads/2022/02/aws-eks-karpenter-150x150.jpg" class="attachment-thumbnail size-thumbnail wp-post-image" alt="EKS Karpenter Example" data-eio="l" /></noscript></a></div>
<div class='rp4wp-related-post-content'>
<a href='../creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes/index.html'>Creating EKS Cluster with Karpenter Auto scaling - Terraform | Kubernetes</a><p>Kubernetes has been a disruptive change in IT Infrastructure. It had been widely adopted across the industry Managed Kubernetes are the best choice if you do not want to face the hurdles of setting up K8s from scratch Unless you want to deep learn Kubernetes. AWS a market leader in&hellip;</p></div>
</li>
<li><div class='rp4wp-related-post-image'>
<a href='../terraform-eks-spot-instances/index.html'><img width="150" height="150" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 150'%3E%3C/svg%3E" class="attachment-thumbnail size-thumbnail wp-post-image lazyload" alt="Terraform eks spot instance" data-src="../../wp-content/uploads/2022/04/Terraform-eks-spot-150x150.png" loading="lazy" /><noscript><img width="150" height="150" src="../../wp-content/uploads/2022/04/Terraform-eks-spot-150x150.png" class="attachment-thumbnail size-thumbnail wp-post-image" alt="Terraform eks spot instance" data-eio="l" /></noscript></a></div>
<div class='rp4wp-related-post-content'>
<a href='../terraform-eks-spot-instances/index.html'>Creating EKS Cluster with SPOT instances - Terraform | Devops Junction</a><p>In this article, we are going to see how to create an EKS Cluster with SPOT and OnDemand instances using Terraform. If you have prior experience with AWS, you might know what is SPOT instances and ondemand instances are.  Let us start with a quick introduction towards SPOT instances. Quick&hellip;</p></div>
</li>
<li><div class='rp4wp-related-post-image'>
<a href='../internal-external-load-balancer-aws-eks/index.html'><img width="150" height="150" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 150'%3E%3C/svg%3E" class="attachment-thumbnail size-thumbnail wp-post-image lazyload" alt="EKS Create Internal LB" data-src="../../wp-content/uploads/2022/04/eks-create-internal-lb-150x150.jpg" loading="lazy" /><noscript><img width="150" height="150" src="../../wp-content/uploads/2022/04/eks-create-internal-lb-150x150.jpg" class="attachment-thumbnail size-thumbnail wp-post-image" alt="EKS Create Internal LB" data-eio="l" /></noscript></a></div>
<div class='rp4wp-related-post-content'>
<a href='../internal-external-load-balancer-aws-eks/index.html'>Creating Internal and External Load Balancers from EKS - Kubernetes</a><p>In this article, we are going to see how to create internal and external load balancers using the Kubernetes service on EKS When we think about making an application or deployment available externally or internally over a Domain name We think of Kubernetes Ingress but that's not the only way to&hellip;</p></div>
</li>
<li><div class='rp4wp-related-post-image'>
<a href='../kubernetes-restart-daemonset-kubectl-devops-junction/index.html'><img width="150" height="150" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 150'%3E%3C/svg%3E" class="attachment-thumbnail size-thumbnail wp-post-image lazyload" alt="" data-src="../../wp-content/uploads/2022/04/kubernetes-tricks-150x150.png" loading="lazy" /><noscript><img width="150" height="150" src="../../wp-content/uploads/2022/04/kubernetes-tricks-150x150.png" class="attachment-thumbnail size-thumbnail wp-post-image" alt="" data-eio="l" /></noscript></a></div>
<div class='rp4wp-related-post-content'>
<a href='../kubernetes-restart-daemonset-kubectl-devops-junction/index.html'>Kubernetes restart daemonset - kubectl | Devops Junction</a><p>In this quick article, let us learn how to restart the Kubernetes DaemonSet and all the pods created by the DaemonSet. Before we move on to the objective, here are some basics. real quick. DaemonSet is to deploy a specific application/feature to your Kubernetes cluster and to make sure it&hellip;</p></div>
</li>
<li><div class='rp4wp-related-post-image'>
<a href='../deploy-tomcat-kubernetes/index.html'><img width="150" height="150" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 150'%3E%3C/svg%3E" class="attachment-thumbnail size-thumbnail wp-post-image lazyload" alt="Tomcat Kubernetes" data-src="../../wp-content/uploads/2020/09/Screenshot-2020-09-29-at-8.55.24-PM-150x150.jpg" loading="lazy" /><noscript><img width="150" height="150" src="../../wp-content/uploads/2020/09/Screenshot-2020-09-29-at-8.55.24-PM-150x150.jpg" class="attachment-thumbnail size-thumbnail wp-post-image" alt="Tomcat Kubernetes" data-eio="l" /></noscript></a></div>
<div class='rp4wp-related-post-content'>
<a href='../deploy-tomcat-kubernetes/index.html'>How to Deploy Tomcat on Kubernetes Step by Step</a><p>Overview In this post, we are going to see how to deploy tomcat on Kubernetes.  How to Deploy Tomcat based web application into Kubernetes. We are taking Google Cloud - Kubernetes Engine (GKE) for our example and creating our Kubernetes Cluster with 3 nodes You can do all these steps&hellip;</p></div>
</li>
</ul>
</div>
</div>
<footer class="entry-footer">
<nav class="navigation post-navigation" role="navigation" aria-label="Posts">
<h2 class="screen-reader-text">Post navigation</h2>
<div class="nav-links"><div class="nav-previous"><a href="../kubectl-get-containers-in-pod-how-to-list-containers-in-pod-devops-junction/index.html" rel="prev"><span class="screen-reader-text">Previous Post:</span>Kubectl Get containers in pod &#8211; How to list containers in POD | Devops Junction</a></div></div>
</nav>
</footer>
</article>
<div id="disqus_thread"></div>
</main>
</section>
<section id="secondary" class="sidebar widget-area clearfix" role="complementary">
<aside id="custom_html-18" class="widget_text widget widget_custom_html clearfix"><div class="textwidget custom-html-widget"><script data-cfasync="false" src="../../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3398911159151128" crossorigin="anonymous"></script>


<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></div></aside><aside id="categories-8" class="widget widget_categories clearfix"><div class="widget-header"><h3 class="widget-title">Categories</h3></div>
<ul>
<li class="cat-item cat-item-61"><a href="../category/activemq/index.html">ActiveMQ</a> (4)
</li>
<li class="cat-item cat-item-98"><a href="../category/ansible/index.html">Ansible</a> (65)
</li>
<li class="cat-item cat-item-10"><a href="../category/apache/index.html">Apache</a> (8)
</li>
<li class="cat-item cat-item-234"><a href="../category/aws/index.html">AWS</a> (31)
</li>
<li class="cat-item cat-item-452"><a href="../category/azure/index.html">Azure</a> (1)
</li>
<li class="cat-item cat-item-8"><a href="../category/best-practice/index.html">Best Practice</a> (5)
</li>
<li class="cat-item cat-item-390"><a href="../category/bitbucket/index.html">BitBucket</a> (1)
</li>
<li class="cat-item cat-item-426"><a href="../category/boto/index.html">Boto</a> (2)
</li>
<li class="cat-item cat-item-399"><a href="../category/cloud/index.html" title="Cloud is not only a concept but also a practice of using a network of remote servers hosted on the Internet to store, manage, and process data.">Cloud</a> (1)
</li>
<li class="cat-item cat-item-397"><a href="../category/database/index.html">Database</a> (1)
</li>
<li class="cat-item cat-item-95"><a href="../category/development/index.html">Development</a> (3)
</li>
<li class="cat-item cat-item-152"><a href="../category/docker/index.html">Docker</a> (11)
</li>
<li class="cat-item cat-item-422"><a href="../category/efk/index.html">EFK</a> (1)
</li>
<li class="cat-item cat-item-423"><a href="../category/elastic-search/index.html">Elastic Search</a> (1)
</li>
<li class="cat-item cat-item-59"><a href="../category/f5-big-ip/index.html">F5-Big-IP</a> (6)
</li>
<li class="cat-item cat-item-419"><a href="../category/fluentd/index.html">FluentD</a> (2)
</li>
<li class="cat-item cat-item-424"><a href="../category/gcp-googlecloud/index.html">GCP &#8211; GoogleCloud</a> (1)
</li>
<li class="cat-item cat-item-450"><a href="../category/github-actions/index.html">Github Actions</a> (1)
</li>
<li class="cat-item cat-item-428"><a href="../category/grafana/index.html">Grafana</a> (1)
</li>
<li class="cat-item cat-item-275"><a href="../category/graphite/index.html">Graphite</a> (1)
</li>
<li class="cat-item cat-item-441"><a href="../category/ibm-cloud/index.html">IBM Cloud</a> (1)
</li>
<li class="cat-item cat-item-401"><a href="../category/ibm-websphere/index.html" title="IBM® WebSphere® Application Server provides a range of flexible and secure runtime for Java enterprise applications, lightweight web applications and microservices. You can create new applications and enhance and optimize existing application infrastructure on premises or across any public, private or hybrid cloud. In addition, by utilizing IBM Cloud Private, you can create on-premises cloud capabilities similar to public clouds to accelerate app development. The platform is built on the open source Kubernetes-based container architecture and supports both Docker containers and Cloud Foundry.">IBM Websphere</a> (2)
</li>
<li class="cat-item cat-item-354"><a href="../category/ihs-and-apache/index.html">IHS and Apache</a> (10)
</li>
<li class="cat-item cat-item-353"><a href="../category/iis/index.html">IIS</a> (4)
</li>
<li class="cat-item cat-item-388"><a href="../category/javascript/index.html">JavaScript</a> (3)
</li>
<li class="cat-item cat-item-286"><a href="../category/jenkins/index.html">Jenkins</a> (4)
</li>
<li class="cat-item cat-item-15"><a href="../category/joomla/index.html">Joomla</a> (1)
</li>
<li class="cat-item cat-item-151"><a href="../category/kubernetes/index.html">Kubernetes</a> (19)
</li>
<li class="cat-item cat-item-191"><a href="../category/middleware/index.html">Middleware</a> (3)
</li>
<li class="cat-item cat-item-322"><a href="../category/network-troubleshooting/index.html">Network Troubleshooting</a> (1)
</li>
<li class="cat-item cat-item-413"><a href="../category/networking/index.html">Networking</a> (1)
</li>
<li class="cat-item cat-item-273"><a href="../category/nodejs/index.html">NodeJS</a> (2)
</li>
<li class="cat-item cat-item-396"><a href="../category/office365/index.html">Office365</a> (1)
</li>
<li class="cat-item cat-item-148"><a href="../category/opensource/index.html">OpenSource</a> (2)
</li>
<li class="cat-item cat-item-417"><a href="../category/oracle-db/index.html">Oracle DB</a> (3)
</li>
<li class="cat-item cat-item-404"><a href="../category/oracle-weblogic/index.html" title="WebLogic is a leading Application Server product most widely used for e-commerce online transaction processing (OLTP) platform application, developed to connect users in a distributed computing environment and to facilitate the integration of mainframe applications with distributed corporate data and applications.">Oracle Weblogic</a> (2)
</li>
<li class="cat-item cat-item-232"><a href="../category/packer/index.html">Packer</a> (2)
</li>
<li class="cat-item cat-item-146"><a href="../category/perl/index.html">Perl</a> (1)
</li>
<li class="cat-item cat-item-60"><a href="../category/php/index.html">PHP</a> (1)
</li>
<li class="cat-item cat-item-453"><a href="../category/postgresql/index.html">PostgreSQL</a> (1)
</li>
<li class="cat-item cat-item-343"><a href="../category/powershell/index.html">PowerShell</a> (1)
</li>
<li class="cat-item cat-item-31"><a href="../category/weblogic/problemsolution/index.html">problem/solution</a> (8)
</li>
<li class="cat-item cat-item-427"><a href="../category/prometheus/index.html">Prometheus</a> (1)
</li>
<li class="cat-item cat-item-445"><a href="../category/pulumi/index.html">Pulumi</a> (1)
</li>
<li class="cat-item cat-item-285"><a href="../category/python-flask/index.html">Python Flask</a> (1)
</li>
<li class="cat-item cat-item-22"><a href="../category/python_scripts/index.html">python_scripts</a> (7)
</li>
<li class="cat-item cat-item-446"><a href="../category/redis/index.html">Redis</a> (1)
</li>
<li class="cat-item cat-item-451"><a href="../category/serverless/index.html">Serverless</a> (1)
</li>
<li class="cat-item cat-item-12"><a href="../category/shell-scripting/index.html">Shell Scripting</a> (6)
</li>
<li class="cat-item cat-item-125"><a href="../category/soap-web-services/index.html">SOAP Web Services</a> (1)
</li>
<li class="cat-item cat-item-13"><a href="../category/splunk/index.html">Splunk</a> (1)
</li>
<li class="cat-item cat-item-425"><a href="../category/sre/index.html">SRE</a> (1)
</li>
<li class="cat-item cat-item-274"><a href="../category/statsd/index.html">StatsD</a> (1)
</li>
<li class="cat-item cat-item-233"><a href="../category/terraform/index.html">Terraform</a> (12)
</li>
<li class="cat-item cat-item-35"><a href="../category/tomcat/index.html">tomcat</a> (7)
</li>
<li class="cat-item cat-item-147"><a href="../category/tools/index.html">tools</a> (5)
</li>
<li class="cat-item cat-item-391"><a href="../category/traefik/index.html">Traefik</a> (1)
</li>
<li class="cat-item cat-item-124"><a href="../category/troubleshooting/index.html">Troubleshooting</a> (3)
</li>
<li class="cat-item cat-item-1"><a href="../category/uncategorized/index.html">Uncategorized</a> (9)
</li>
<li class="cat-item cat-item-7"><a href="../category/unix/index.html">Unix</a> (5)
</li>
<li class="cat-item cat-item-99"><a href="../category/vagrant/index.html">Vagrant</a> (4)
</li>
<li class="cat-item cat-item-389"><a href="../category/vuejs/index.html">VueJS</a> (2)
</li>
<li class="cat-item cat-item-356"><a href="../category/vulnerabilities-fixes/index.html">Vulnerabilities &amp; Fixes</a> (21)
</li>
<li class="cat-item cat-item-21"><a href="../category/weblogic/index.html">weblogic</a> (51)
</li>
<li class="cat-item cat-item-9"><a href="../category/webserver/index.html">Webserver</a> (1)
</li>
<li class="cat-item cat-item-92"><a href="../category/websphere/index.html">Websphere</a> (8)
</li>
<li class="cat-item cat-item-321"><a href="../category/windows-server/index.html">Windows Server</a> (5)
</li>
<li class="cat-item cat-item-55"><a href="../category/wlst/index.html">wlst</a> (7)
</li>
<li class="cat-item cat-item-36"><a href="../category/wordpress/index.html">wordpress</a> (2)
</li>
<li class="cat-item cat-item-4"><a href="../category/wsadmin-scripts/index.html">wsadmin scripts</a> (1)
</li>
</ul>
</aside><aside id="media_image-5" class="widget widget_media_image clearfix"><img width="267" height="400" src="../../wp-content/ewww/lazy/placeholder-267x400.png" class="image wp-image-8825  attachment-full size-full lazyload" alt="write for devopsjunction" style="max-width: 75%; height: auto;" data-src="../../wp-content/uploads/2022/07/write-for-us-devopsjunction.png" loading="lazy" data-srcset="../../wp-content/uploads/2022/07/write-for-us-devopsjunction.png 267w, ../../wp-content/uploads/2022/07/write-for-us-devopsjunction-200x300.png 200w" data-sizes="auto" /><noscript><img width="267" height="400" src="../../wp-content/uploads/2022/07/write-for-us-devopsjunction.png" class="image wp-image-8825  attachment-full size-full" alt="write for devopsjunction" style="max-width: 75%; height: auto;" srcset="../../wp-content/uploads/2022/07/write-for-us-devopsjunction.png 267w, ../../wp-content/uploads/2022/07/write-for-us-devopsjunction-200x300.png 200w" sizes="(max-width: 267px) 100vw, 267px" data-eio="l" /></noscript></aside>
</section>
</div>
<div id="footer" class="footer-wrap">
<footer id="colophon" class="site-footer container clearfix" role="contentinfo">
<div id="footer-text" class="site-info">
<span class="credit-link">Powered by <a href="../../index.html" title="Rumen Lishkov">Rumen Lishkov</a> and <a href="https://rumen.free.bg/" title="Studio-1">Studio1 Sofia</a> </span>
</div>
</footer>
</div>
</div>
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@mwinventory" />
<meta name="twitter:creator" content="@mwinventory" />
<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro&amp;display=swap" rel="stylesheet"><script type='text/javascript' id='disqus_count-js-extra'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"mwinventory"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/f8767.js"></script>
<script type='text/javascript' id='disqus_embed-js-extra'>
/* <![CDATA[ */
var embedVars = {"disqusConfig":{"integration":"wordpress 3.0.22"},"disqusIdentifier":"9057 https:\/\/www.middlewareinventory.com\/?p=9057","disqusShortname":"mwinventory","disqusTitle":"Install Karpenter on Existing EKS Cluster \u2013 Autoscaler Migration | Kubernetes","disqusUrl":"https:\/\/www.middlewareinventory.com\/blog\/install-karpenter-on-existing-eks-cluster-migration-guide\/","postId":"9057"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/bccbc.js"></script>
<script type='text/javascript' id='dae-download-js-extra'>
/* <![CDATA[ */
var objDaeDownload = {"ajaxUrl":"https:\/\/www.middlewareinventory.com\/wp-admin\/admin-ajax.php","nonce":"e19c30bf6e"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/8510d.js"></script>
<script type='text/javascript' id='socialsnap-js-js-extra'>
/* <![CDATA[ */
var socialsnap_script = {"ajaxurl":"https:\/\/www.middlewareinventory.com\/wp-admin\/admin-ajax.php","on_media_width":"250","on_media_height":"250","nonce":"d9b9712fc2","post_id":"9057"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/fef55.js"></script>
<script type='text/javascript' id='aicp-js-extra'>
/* <![CDATA[ */
var AICP = {"ajaxurl":"https:\/\/www.middlewareinventory.com\/wp-admin\/admin-ajax.php","nonce":"a832d89685","ip":"49.206.117.149","clickLimit":"1","clickCounterCookieExp":"3","banDuration":"7","countryBlockCheck":"No","banCountryList":"RU"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/ff9fe.js"></script>
<script type='text/javascript' src='https://js.stripe.com/v3/?ver=2.03' id='stripe-js'></script>
<script src="../../wp-content/cache/minify/00a3c.js"></script>
<script type='text/javascript' id='divi-builder-custom-script-js-extra'>
/* <![CDATA[ */
var et_builder_utils_params = {"condition":{"diviTheme":false,"extraTheme":false},"scrollLocations":["app","top"],"builderScrollLocations":{"desktop":"app","tablet":"app","phone":"app"},"onloadScrollLocation":"app","builderType":"fe"};
var et_frontend_scripts = {"builderCssContainerPrefix":"#et-boc","builderCssLayoutPrefix":"#et-boc .et-l"};
var et_pb_custom = {"ajaxurl":"https:\/\/www.middlewareinventory.com\/wp-admin\/admin-ajax.php","images_uri":"https:\/\/www.middlewareinventory.com\/wp-content\/themes\/poseidon\/images","builder_images_uri":"https:\/\/www.middlewareinventory.com\/wp-content\/plugins\/divi-builder\/includes\/builder\/images","et_frontend_nonce":"4d44a2faf3","subscription_failed":"Please, check the fields below to make sure you entered the correct information.","et_ab_log_nonce":"9529923cda","fill_message":"Please, fill in the following fields:","contact_error_message":"Please, fix the following errors:","invalid":"Invalid email","captcha":"Captcha","prev":"Prev","previous":"Previous","next":"Next","wrong_captcha":"You entered the wrong number in captcha.","wrong_checkbox":"Checkbox","ignore_waypoints":"no","is_divi_theme_used":"","widget_search_selector":".widget_search","ab_tests":[],"is_ab_testing_active":"","page_id":"9057","unique_test_id":"","ab_bounce_rate":"5","is_cache_plugin_active":"no","is_shortcode_tracking":"","tinymce_uri":"https:\/\/www.middlewareinventory.com\/wp-content\/plugins\/divi-builder\/includes\/builder\/frontend-builder\/assets\/vendors","waypoints_options":{"context":[".pum-overlay"]}};
var et_pb_box_shadow_elements = [];
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/2bf13.js"></script>
<script type='text/javascript' id='q2w3_fixed_widget-js-extra'>
/* <![CDATA[ */
var q2w3_sidebar_options = [{"sidebar":"q2w3-default-sidebar","margin_top":10,"margin_bottom":0,"stop_id":"","screen_max_width":1026,"screen_max_height":0,"width_inherit":true,"refresh_interval":1500,"window_load_hook":false,"disable_mo_api":false,"widgets":["text-32"]}];
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/5ee99.js"></script>
<script type='text/javascript' id='enlighterjs-js-after'>
!function(e,n){if("undefined"!=typeof EnlighterJS){var o={"selectors":{"block":"pre.EnlighterJSRAW","inline":"code.EnlighterJSRAW"},"options":{"indent":4,"ampersandCleanup":true,"linehover":true,"rawcodeDbclick":false,"textOverflow":"break","linenumbers":true,"theme":"enlighter","language":"generic","retainCssClasses":false,"collapse":false,"toolbarOuter":"","toolbarTop":"{BTN_RAW}{BTN_COPY}{BTN_WINDOW}{BTN_WEBSITE}","toolbarBottom":""}};(e.EnlighterJSINIT=function(){EnlighterJS.init(o.selectors.block,o.selectors.inline,o.options)})()}else{(n&&(n.error||n.log)||function(){})("Error: EnlighterJS resources not loaded yet!")}}(window,console);
</script>
<script src="../../wp-content/cache/minify/b5030.js"></script>
<script type='text/javascript' id='ez-toc-js-js-extra'>
/* <![CDATA[ */
var ezTOC = {"smooth_scroll":"1","visibility_hide_by_default":"","width":"100%","scroll_offset":"0"};
/* ]]> */
</script>
<script src="../../wp-content/cache/minify/0c713.js"></script>
<div id="ss-copy-popup" class="ss-popup-overlay">
<div class="ss-popup">
<div class="ss-popup-heading">
<span>Copy link</span>
<a href="#" id="ss-close-share-networks-modal" class="ss-close-modal" rel="nofollow"><i class="ss ss-close"></i></a>
</div>
 <div class="ss-popup-content">
<div class="ss-copy-action">
<input type="text" readonly="readonly" value="https://airdata.gitlab.io/blog/blog/install-karpenter-on-existing-eks-cluster-migration-guide/" class="ss-copy-action-field" />
<a href="#" class="ss-button" rel="nofollow">Copy<span class="ss-share-network-tooltip">Copied</span></a>
<i class="ss ss-copy"></i>
</div>
<div class="ss-powered-by">Powered by <a href="https://socialsnap.com/?utm_source=WordPress&amp;utm_medium=link&amp;utm_campaign=inthewild" target="_blank" rel="nofollow noopener"><i class="ss ss-socialsnap"></i>Social Snap</a></div>
</div>
</div>
</div>

<script type="text/javascript">

			var SocialSnapURL 				= window.location.href;
			var SocialSnapShareCacheExpired = 0;
				
			if ( -1 !== SocialSnapURL.indexOf('?ss_cache_refresh') ) {

				SocialSnapShareCacheExpired = true;

			} else {

				var SocialSnapServerTimestamp 	= 1664211142;
				var SocialSnapBrowserTimestamp 	= Date.now();

				if ( ! SocialSnapBrowserTimestamp ) {
					SocialSnapBrowserTimestamp = new Date().getTime();
				}

				SocialSnapBrowserTimestamp = Math.floor( SocialSnapBrowserTimestamp / 1000 );

				SocialSnapShareCacheExpired = SocialSnapShareCacheExpired && ( SocialSnapBrowserTimestamp - SocialSnapServerTimestamp < 60 );
			}

		</script>

<div id="cookie-notice" role="banner" class="cn-bottom bootstrap" style="color: #fff; background-color: #000;"><div class="cookie-notice-container"><span id="cn-notice-text">We use cookies to ensure that we give you the best experience on our website. The Cookies collected are used only to Show customized Ads. We Hope you are fine with it.</span><a href="#" id="cn-accept-cookie" data-cookie-set="accept" class="cn-set-cookie cn-button bootstrap button">Ok</a><a href="../../cookie-policy/index.html" target="_blank" id="cn-more-info" class="cn-more-info cn-button bootstrap button">Privacy policy</a>
</div>
</div>
</body>
</html>
