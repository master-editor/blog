{"id":3911,"date":"2019-06-03T09:13:54","date_gmt":"2019-06-03T03:43:54","guid":{"rendered":"https:\/\/www.middlewareinventory.com\/?p=3911"},"modified":"2022-06-19T11:27:47","modified_gmt":"2022-06-19T05:57:47","slug":"build-packer-aws-image-example","status":"publish","type":"post","link":"https:\/\/www.middlewareinventory.com\/blog\/build-packer-aws-image-example\/","title":{"rendered":"Packer Build &#8211; Create and Build Packer Templates and Images for AWS"},"content":{"rendered":"<p><span style=\"font-size: 14pt;\"><strong>Infrastructure as Code<\/strong><\/span> is a Brilliant Concept in DevOps and Packer and Terraform are two major technologies\/products in this segment. Thanks to <a href=\"https:\/\/www.hashicorp.com\/\">HashiCorp<\/a><\/p>\n<p>Imagine that you need to create an AWS EC2 instance for your company or for learning purpose with your AWS free tier account.<\/p>\n<p>How do you do that?<\/p>\n<p>Probably Logging into the AWS console would your choice. But do you know it is really not a Good Practice to create AWS images from Console.\u00a0 In fact, you should not log in to AWS console often. It is a poor security practice.<\/p>\n<p>Programmatic Approach is the Only Solution.\u00a0 AWS CLI is there which can help create EC2 instances and AMI(Amazon Machine Image) but the learning curve of AWS CLI is little complex and it is not robust ( according to me at least)<\/p>\n<h2><\/h2>\n<h2>Why Packer over AWS CLI<\/h2>\n<p>Let us pretend that you are going to a Jungle for trekking like Bear Grylls.\u00a0 Would you prefer taking a <a href=\"https:\/\/en.wikipedia.org\/wiki\/Swiss_Army_knife\">Swiss Army Knife<\/a> [All in one tool] or multiple separate tools for each Single-task?<\/p>\n<p>If you ask me, I would say the Swiss Army Knife would be my option to reduce some load in my back bag.<\/p>\n<p>Packer is like the Swiss Army Knife here. With Packer, you can build Images for multiple technologies and cloud providers like AWS, Azure, Docker, Digital Ocean etc.<\/p>\n<p>So you learn a Single Technology [Packer]\u00a0 and Create Images across multiple Cloud Providers and Container technologies. Is not that Nice.<\/p>\n<p>With Packer and Terraform On Board, you can easily achieve Infrastructure as Code and DevOps practices in your Organization.<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/PackerAWS.png\"><img class=\"alignnone size-full wp-image-3926\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/PackerAWS.png\" alt=\"\" width=\"1074\" height=\"674\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/PackerAWS.png 1074w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/PackerAWS-300x188.png 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/PackerAWS-768x482.png 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/PackerAWS-1024x643.png 1024w\" sizes=\"(max-width: 1074px) 100vw, 1074px\" \/><\/a><\/p>\n<h2>The Objective<\/h2>\n<p>The Objective of this post is to talk about the Packer image creation (for aws) with an example template Step by Step.<\/p>\n<p>We are going to build an Amazon Machine Image using Packer. Come&#8217;s lets Packer Build.<\/p>\n<p>We are Going to Perform the following Steps as part of this post<\/p>\n<ol>\n<li>Setup your AWS Programmatic Access using Key and Secret<\/li>\n<li>Install Packer<\/li>\n<li>Choose the AMI Base Image [ Amazon Machine Image] from AWS Console<\/li>\n<li>Create a Security Group to Allow SSH and HTTP\/HTTPS requests<\/li>\n<li>Create SSH KeyPair &#8211; For Team to use it while Logging in via SSH<\/li>\n<li>Create a Sample Packer AWS (or) AMI Image Creation Template<\/li>\n<li>Validate the Packer Template<\/li>\n<li>Export your AWS Key and Secret<\/li>\n<li>Run the Packer Template and Create The AMI Image<\/li>\n<\/ol>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<h3>Step1: Get your Programmatic Access \/ Create Access Key and Secret from AWS<\/h3>\n<div>Login to AWS Console, In the services, go to IAM and perform the following Steps<\/div>\n<div><\/div>\n<p><strong>Add new user and key in the UserName<\/strong><\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/AWS_UserCreation_Screen1.png\"><img class=\"alignnone size-full wp-image-3920\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/AWS_UserCreation_Screen1.png\" alt=\"\" width=\"1055\" height=\"528\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/AWS_UserCreation_Screen1.png 1055w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/AWS_UserCreation_Screen1-300x150.png 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/AWS_UserCreation_Screen1-768x384.png 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/AWS_UserCreation_Screen1-1024x512.png 1024w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/AWS_UserCreation_Screen1-840x420.png 840w\" sizes=\"(max-width: 1055px) 100vw, 1055px\" \/><\/a><\/p>\n<p><strong>Attach Existing Policies and Select Admin<\/strong><\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/AWS_User_Creation_Screen2.png\"><img class=\"alignnone size-full wp-image-3921\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/AWS_User_Creation_Screen2.png\" alt=\"\" width=\"1032\" height=\"378\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/AWS_User_Creation_Screen2.png 1032w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/AWS_User_Creation_Screen2-300x110.png 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/AWS_User_Creation_Screen2-768x281.png 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/AWS_User_Creation_Screen2-1024x375.png 1024w\" sizes=\"(max-width: 1032px) 100vw, 1032px\" \/><\/a><\/p>\n<p>Let the Values be Default Click Next till you see the following Screen<\/p>\n<p>Completion<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/03\/Screen-Shot-2019-03-31-at-2.20.07-AM.png\"><img class=\"size-full wp-image-3140\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/03\/Screen-Shot-2019-03-31-at-2.20.07-AM.png\" sizes=\"(max-width: 996px) 100vw, 996px\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/03\/Screen-Shot-2019-03-31-at-2.20.07-AM.png 996w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/03\/Screen-Shot-2019-03-31-at-2.20.07-AM-300x116.png 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/03\/Screen-Shot-2019-03-31-at-2.20.07-AM-768x297.png 768w\" alt=\"\" width=\"996\" height=\"385\" \/><\/a><\/p>\n<figure id=\"attachment_3140\" class=\"wp-caption alignleft\"><figcaption class=\"wp-caption-text\">API key creation Successful Message Banner<\/figcaption><\/figure>\n<p>&nbsp;<\/p>\n<h3>Step2: Install Packer<\/h3>\n<ol>\n<li>\n<div>Download Packer\u00a0<a href=\"https:\/\/www.packer.io\/downloads.html\">https:\/\/www.packer.io\/downloads.html<\/a><\/div>\n<\/li>\n<li>\n<div>Unzip the downloaded file and there will be a Single File named packer<\/div>\n<\/li>\n<li>I have installed the packer in\u00a0<code>\/apps\/packer<\/code><\/li>\n<li>Let us add this path into the<code>\u00a0$PATH<\/code>\u00a0variable and\u00a0<code>BASH_PROFILE<\/code>\u00a0file as well for better convenience and to call packer any location without having to refer the full path of the packer.<\/li>\n<li>Add the \/apps\/packer at the end of the\u00a0<code>export PATH=*<\/code>\u00a0line\n<pre><span class=\"s1\">export<\/span><span class=\"s2\"><b> PATH=<\/b><\/span><span class=\"s3\">\/usr\/<\/span><span class=\"s1\">local<\/span><span class=\"s3\">\/Cellar\/openssl\/<\/span><span class=\"s4\">1<\/span><span class=\"s3\">.<\/span><span class=\"s4\">0<\/span><span class=\"s3\">.2p\/bin:<\/span><span class=\"s5\">$PATH<span class=\"s3\">:\/apps\/packer\/<\/span><\/span><\/pre>\n<\/li>\n<li>To validate if it is working just type\u00a0<code>packer -version<\/code><\/li>\n<\/ol>\n<p>&nbsp;<\/p>\n<h3>Step3:\u00a0 How to Choose the AMI Base Image for Packer<\/h3>\n<p>Before we build the Packer Template file we need to be ready with the AMI name and Since AMI is specific to the region. The AMI image worked on the us-east region may not work with the us-west region.<\/p>\n<p>So you need to validate the AMI [ your base image] before you run the Packer Template [JSON file]<\/p>\n<p>To Select the Base Image [AMI] and to get the name of and the owner of the image. you need to go to AWS Console or Have access to AWS CLI.<\/p>\n<p>Let us show you how to choose the AMI image from AWS Console<\/p>\n<p>Login to AWS Console and Click on <strong>AMI\u00a0<\/strong>on the left<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/Screen-Shot-2019-06-02-at-6.26.20-PM.png\"><img class=\"alignnone size-full wp-image-3913\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/Screen-Shot-2019-06-02-at-6.26.20-PM.png\" alt=\"\" width=\"1302\" height=\"490\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/Screen-Shot-2019-06-02-at-6.26.20-PM.png 1302w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/Screen-Shot-2019-06-02-at-6.26.20-PM-300x113.png 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/Screen-Shot-2019-06-02-at-6.26.20-PM-768x289.png 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/Screen-Shot-2019-06-02-at-6.26.20-PM-1024x385.png 1024w\" sizes=\"(max-width: 1302px) 100vw, 1302px\" \/><\/a><\/p>\n<p>On the AMI Page. Choose Public Images on the left Search bar drop down.<\/p>\n<p>Use the Filters Like Platform, Architecture etc to choose the Image you want.\u00a0 Copy the <strong>AMI Name<\/strong> and <strong>Owner<\/strong><\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/Screen-Shot-2019-06-02-at-6.38.27-PM.png\"><img class=\"alignnone size-full wp-image-3915\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/Screen-Shot-2019-06-02-at-6.38.27-PM.png\" alt=\"\" width=\"1221\" height=\"677\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/Screen-Shot-2019-06-02-at-6.38.27-PM.png 1221w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/Screen-Shot-2019-06-02-at-6.38.27-PM-300x166.png 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/Screen-Shot-2019-06-02-at-6.38.27-PM-768x426.png 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/Screen-Shot-2019-06-02-at-6.38.27-PM-1024x568.png 1024w\" sizes=\"(max-width: 1221px) 100vw, 1221px\" \/><\/a><\/p>\n<p>From the Base Image we selected, we are going to Create our Packer Image<\/p>\n<p>I am going with <strong>Ubuntu 16 Xenial<\/strong> for this post<\/p>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<h3>Step4: Create a Security Group to Allow SSH and HTTP\/HTTPS requests<\/h3>\n<p>On the AWS console, Right Panel Click on the Security Groups and Click on <strong>Create Security Group<\/strong> button.<\/p>\n<p>On the Modal Fill the Port details. Since we are going to build Tomcat I am allowing access to <code>8080<\/code> and <code>8443<\/code> and SSH.<\/p>\n<p>For additional Security, I am Choosing <code>My IP<\/code> as the accepted Source for SSH so that only My Public IP would only be allowed to SSH.<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/Screen-Shot-2019-06-03-at-5.51.20-AM.png\"><img class=\"alignnone size-full wp-image-3918\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/Screen-Shot-2019-06-03-at-5.51.20-AM.png\" alt=\"\" width=\"1440\" height=\"747\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/Screen-Shot-2019-06-03-at-5.51.20-AM.png 1440w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/Screen-Shot-2019-06-03-at-5.51.20-AM-300x156.png 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/Screen-Shot-2019-06-03-at-5.51.20-AM-768x398.png 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/Screen-Shot-2019-06-03-at-5.51.20-AM-1024x531.png 1024w\" sizes=\"(max-width: 1440px) 100vw, 1440px\" \/><\/a><\/p>\n<p>After creating, On the Security Groups List. Copy the <strong>Security Group ID\u00a0<\/strong>we need it for our Packer Template<\/p>\n<p>&nbsp;<\/p>\n<h3>Step5: Create SSH Key Pair<\/h3>\n<p>On the AWS Console Right Panel choose the Key Pairs Option and click on the &#8220;Create Key Pair&#8221; Button<\/p>\n<p>Enter some Name and Click on Create.\u00a0 The download of a Pem file would initiate<\/p>\n<p>Secure the Downloaded <strong>*.pem\u00a0<\/strong>file really really Safe. Whoever has access to this <code>pem<\/code> file can access your AWS resources.<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/Screen-Shot-2019-06-03-at-6.11.30-AM.png\"><img class=\"alignnone size-full wp-image-3919\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/Screen-Shot-2019-06-03-at-6.11.30-AM.png\" alt=\"\" width=\"1295\" height=\"553\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/Screen-Shot-2019-06-03-at-6.11.30-AM.png 1295w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/Screen-Shot-2019-06-03-at-6.11.30-AM-300x128.png 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/Screen-Shot-2019-06-03-at-6.11.30-AM-768x328.png 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/Screen-Shot-2019-06-03-at-6.11.30-AM-1024x437.png 1024w\" sizes=\"(max-width: 1295px) 100vw, 1295px\" \/><\/a><\/p>\n<p>Remember the name of this KeyPair we need this name for our Packer Template.<\/p>\n<p>Save this file in a location where you are going to keep the JSON file for easy access and reference.<\/p>\n<blockquote><p>It may be necassary that you have to change the permission of this pem file and set very minimal permission, Otherwise you will get error while you are trying to login to EC2 using this pem file.<\/p>\n<p><code>chmod 400 KeyPair.pem<\/code><\/p>\n<p>The preceding command would do that.<\/p><\/blockquote>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<h3>Step6:\u00a0 Create a Packer Image Template JSON file &#8211; Example<\/h3>\n<p>Now let us write a Packer Image Template file. For this post, we will install <strong>Tomcat8<\/strong> and <strong>OpenJDK8<\/strong> on <strong>Ubuntu 16 Xenial<\/strong> image<\/p>\n<p>Now you have to use the Security Group ID and Key Pair Name we have Just created, Inside the template along with few other options.<\/p>\n<p>Make Sure you replace them with yours before trying it out.<\/p>\n<p>Here is Packer Template file with my configuration<\/p>\n<p>You can see the KeyPair and Security Groups we have created are being referred along with the Base Image Info.<\/p>\n<p>The Key file (pem) we have downloaded in the previous step and this JSON file are kept in the same directory.<\/p>\n<p>Save this file as <code>tomcat8_ojdk8.json<\/code> in the same directory where you saved the Key file ( let&#8217;s call it as a workspace) in my case, it is\u00a0<code><span class=\"s1\">\/apps\/packer\/tomcat8_ojdk8<\/span><\/code><\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; background: #23241f; color: #f8f8f2;\">{\r\n    <span class=\"hljs-attr\" style=\"color: #f92672;\">\"variables\"<\/span>: {\r\n        <span class=\"hljs-attr\" style=\"color: #f92672;\">\"aws_access_key\"<\/span>: <span class=\"hljs-string\" style=\"color: #e6db74;\">\"{{env `AWS_ACCESS_KEY_ID`}}\"<\/span>,\r\n        <span class=\"hljs-attr\" style=\"color: #f92672;\">\"aws_secret_key\"<\/span>: <span class=\"hljs-string\" style=\"color: #e6db74;\">\"{{env `AWS_SECRET_ACCESS_KEY`}}\"<\/span>\r\n    },\r\n    <span class=\"hljs-attr\" style=\"color: #f92672;\">\"builders\"<\/span>: [\r\n        {\r\n            <span class=\"hljs-attr\" style=\"color: #f92672;\">\"access_key\"<\/span>: <span class=\"hljs-string\" style=\"color: #e6db74;\">\"{{user `aws_access_key`}}\"<\/span>,\r\n            <span class=\"hljs-attr\" style=\"color: #f92672;\">\"ami_name\"<\/span>: <span class=\"hljs-string\" style=\"color: #e6db74;\">\"Tomcat8_OJDK8_AMI\"<\/span>,\r\n            <span class=\"hljs-attr\" style=\"color: #f92672;\">\"instance_type\"<\/span>: <span class=\"hljs-string\" style=\"color: #e6db74;\">\"t3.micro\"<\/span>,\r\n            <span class=\"hljs-attr\" style=\"color: #f92672;\">\"region\"<\/span>: <span class=\"hljs-string\" style=\"color: #e6db74;\">\"ap-south-1\"<\/span>,\r\n            <span class=\"hljs-attr\" style=\"color: #f92672;\">\"secret_key\"<\/span>: <span class=\"hljs-string\" style=\"color: #e6db74;\">\"{{user `aws_secret_key`}}\"<\/span>,\r\n            <span class=\"hljs-attr\" style=\"color: #f92672;\">\"security_group_id\"<\/span>:<span class=\"hljs-string\" style=\"color: #e6db74;\">\"sg-04cce0d3e58f065a0\"<\/span>,\r\n            <span class=\"hljs-attr\" style=\"color: #f92672;\">\"ssh_keypair_name\"<\/span>:<span class=\"hljs-string\" style=\"color: #e6db74;\">\"SaravMacKeyPair\"<\/span>,\r\n            <span class=\"hljs-attr\" style=\"color: #f92672;\">\"ssh_private_key_file\"<\/span>:<span class=\"hljs-string\" style=\"color: #e6db74;\">\"SaravMacKeyPair.pem\"<\/span>,\r\n            <span class=\"hljs-attr\" style=\"color: #f92672;\">\"associate_public_ip_address\"<\/span>:<span class=\"hljs-string\" style=\"color: #e6db74;\">\"true\"<\/span>,\r\n            <span class=\"hljs-attr\" style=\"color: #f92672;\">\"source_ami_filter\"<\/span>: {\r\n              <span class=\"hljs-attr\" style=\"color: #f92672;\">\"filters\"<\/span>: {\r\n              <span class=\"hljs-attr\" style=\"color: #f92672;\">\"virtualization-type\"<\/span>: <span class=\"hljs-string\" style=\"color: #e6db74;\">\"hvm\"<\/span>,\r\n              <span class=\"hljs-attr\" style=\"color: #f92672;\">\"name\"<\/span>: <span class=\"hljs-string\" style=\"color: #e6db74;\">\"ubuntu\/images\/*ubuntu-xenial-16.04-amd64-server-*\"<\/span>,\r\n              <span class=\"hljs-attr\" style=\"color: #f92672;\">\"root-device-type\"<\/span>: <span class=\"hljs-string\" style=\"color: #e6db74;\">\"ebs\"<\/span>\r\n              },\r\n              <span class=\"hljs-attr\" style=\"color: #f92672;\">\"owners\"<\/span>: [<span class=\"hljs-string\" style=\"color: #e6db74;\">\"099720109477\"<\/span>],\r\n              <span class=\"hljs-attr\" style=\"color: #f92672;\">\"most_recent\"<\/span>: <span class=\"hljs-literal\" style=\"color: #ae81ff;\">true<\/span>\r\n            },\r\n            <span class=\"hljs-attr\" style=\"color: #f92672;\">\"ssh_username\"<\/span>: <span class=\"hljs-string\" style=\"color: #e6db74;\">\"ubuntu\"<\/span>,\r\n            <span class=\"hljs-attr\" style=\"color: #f92672;\">\"type\"<\/span>: <span class=\"hljs-string\" style=\"color: #e6db74;\">\"amazon-ebs\"<\/span>\r\n        }\r\n    ],\r\n    <span class=\"hljs-attr\" style=\"color: #f92672;\">\"provisioners\"<\/span>: [\r\n        {\r\n            <span class=\"hljs-attr\" style=\"color: #f92672;\">\"type\"<\/span>: <span class=\"hljs-string\" style=\"color: #e6db74;\">\"shell\"<\/span>,\r\n            <span class=\"hljs-attr\" style=\"color: #f92672;\">\"inline\"<\/span>:[\r\n                <span class=\"hljs-string\" style=\"color: #e6db74;\">\"sudo add-apt-repository ppa:openjdk-r\/ppa\"<\/span>,\r\n                <span class=\"hljs-string\" style=\"color: #e6db74;\">\"sudo apt-get update\"<\/span>,\r\n                <span class=\"hljs-string\" style=\"color: #e6db74;\">\"sudo apt-get install -y openjdk-8-jdk\"<\/span>,\r\n                <span class=\"hljs-string\" style=\"color: #e6db74;\">\"java -version\"<\/span>,\r\n                <span class=\"hljs-string\" style=\"color: #e6db74;\">\"sudo apt-get install -y tomcat8\"<\/span>\r\n            ]\r\n        }\r\n    ]\r\n}<\/pre>\n<p>&nbsp;<\/p>\n<h3>Step7:\u00a0 Validate the Packer Image Template JSON file<\/h3>\n<p>Go to the WorkSpace where you have saved the Packer Template file (JSON), Now you can execute packer validate followed by the JSON file name.<\/p>\n<p>If No Syntax errors found, Packer would report &#8220;Template Validated Successfully&#8221;<\/p>\n<p>Here are the Command Snippets as it was executed in my Local Machine<\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; background: #232323; color: #e6e1dc;\">aksarav@middlewareinventory:\/apps\/packer\/tomcat8_ojdk8 $ pwd\r\n\/apps\/packer\/tomcat8_ojdk8\r\naksarav@middlewareinventory:\/apps\/packer\/tomcat8_ojdk8 $ ls -lrt\r\ntotal <span class=\"hljs-number\" style=\"color: #a5c261;\">8<\/span>\r\n-rw-r--r &#8211;  <span class=\"hljs-number\" style=\"color: #a5c261;\">1<\/span> aksarav  wheel  <span class=\"hljs-number\" style=\"color: #a5c261;\">1458<\/span> Jun  <span class=\"hljs-number\" style=\"color: #a5c261;\">3<\/span> <span class=\"hljs-number\" style=\"color: #a5c261;\">06<\/span>:<span class=\"hljs-number\" style=\"color: #a5c261;\">35<\/span> tomcat8_ojdk8.json\r\naksarav@middlewareinventory:\/apps\/packer\/tomcat8_ojdk8 $ <span style=\"color: #ffff00;\">packer validate tomcat8_ojdk8.json<\/span> \r\nTemplate validated successfully.\r\n<\/pre>\n<p>You can see the last line where I have used packer validate command and Packer reporting the Success Message.<\/p>\n<p>&nbsp;<\/p>\n<h3>Step8: Export AWS Key ID and Secret Key<\/h3>\n<p>Before you run the packer build. You must export the <code>AWS_ACCESS_KEY_ID<\/code> and <code>AWS_SECRET_ACCESS_KEY<\/code> into the environment variable.<\/p>\n<p>If you scroll back and Look at the first line of our JSON file, we are trying to get these values from the <code>env<\/code> [Environment Variable]<\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; background: #232323; color: #e6e1dc;\">$ export AWS_ACCESS_KEY_ID=<span class=\"hljs-string\" style=\"color: #a5c261;\">\"anaccesskey\"<\/span>\r\n$ export AWS_SECRET_ACCESS_KEY=<span class=\"hljs-string\" style=\"color: #a5c261;\">\"asecretkey\"<\/span><\/pre>\n<p>&nbsp;<\/p>\n<h3>Step9:\u00a0 Packer Build &#8211; Run the Packer Image Template and Create AMI<\/h3>\n<p>Finally, It is a time to build our AMI<\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; background: #232323; color: #e6e1dc;\">packer build tomcat8_ojdk8.json<\/pre>\n<p>Here is the Small ScreenCast of me executing this command and building the AMI<\/p>\n<p><script id=\"asciicast-bZgDQq905D8yLyYaP7fwAfl4s\" src=\"https:\/\/asciinema.org\/a\/bZgDQq905D8yLyYaP7fwAfl4s.js\" async><\/script><br \/>\nWhoohoo!.. we have Successfully Created the Packer AWS AMI Image using Packer Template.<\/p>\n<blockquote><p>Now this Image can be used to build an EC2 instance when ever there is a need.<\/p><\/blockquote>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<h3>How to Create EC2 instance from this AMI image using Terraform<\/h3>\n<p>I already wrote an article with step by step instructions on how to create packer image and provision EC2 instance using that AMI image.<\/p>\n<p>Refer this link to know how to create Packer Image and build EC2 instance with Terraform<\/p>\n<blockquote class=\"wp-embedded-content\" data-secret=\"QGXVqoHLzG\"><p><a href=\"https:\/\/www.middlewareinventory.com\/blog\/packer-aws-terraform-example\/\">Packer AWS Example with Terraform<\/a><\/p><\/blockquote>\n<p><iframe class=\"wp-embedded-content\" sandbox=\"allow-scripts\" security=\"restricted\" style=\"position: absolute; clip: rect(1px, 1px, 1px, 1px);\" title=\"&#8220;Packer AWS Example with Terraform&#8221; &#8212; Middleware Inventory\" src=\"https:\/\/www.middlewareinventory.com\/blog\/packer-aws-terraform-example\/embed\/#?secret=QGXVqoHLzG\" data-secret=\"QGXVqoHLzG\" width=\"600\" height=\"338\" frameborder=\"0\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\"><\/iframe><\/p>\n<p>Hope it helps.<\/p>\n<p>Rate this article [ratings]<\/p>\n<p>Cheers,<br \/>\nRumen Lishkov<br \/>\n<div id=\"postfollow\">\r\n<a href='https:\/\/ko-fi.com\/O4O51FG7C' target='_blank'><img height='46' style='border:0px;height:46px;width: 186px' src='https:\/\/az743702.vo.msecnd.net\/cdn\/kofi3.png?v=2' border='0' alt='Buy Me a Coffee at ko-fi.com' \/><\/a>\r\n<p>Follow us on<a href=\"http:\/\/www.facebook.com\/middlewareinventory\">Facebook<\/a> or<a href=\"http:\/\/www.twitter.com\/mwinventory\">Twitter<\/a>\r\n<\/br>\r\nFor more practical videos and tutorials. <a href=\"https:\/\/www.youtube.com\/channel\/UCRuqBFM6ioWwviNJkgOjeWw?sub_confirmation=1\">Subscribe to our channel<\/a>\r\n<\/br>\r\nFollow me on Linkedin <a href=\"https:\/\/www.linkedin.com\/comm\/mynetwork\/discovery-see-all?usecase=PEOPLE_FOLLOWS&followMember=saravakmwinventory\">My Profile<\/a>\r\n<\/br>\r\n<\/i>For any Consultation or to hire us <a href=\"mailto:rumenlishkoff@gmail.com\"> rumenlishkoff@gmail.com<\/a>\r\n<\/br>\r\nIf you like this article. Show your Support! <a href=\"https:\/\/ko-fi.com\/middlewareinventory\">Buy me a Coffee.<\/a>\r\n<\/br>\r\n<\/p>\r\n<p style=\"color: palevioletred !important;\">Signup for Exclusive \"Subscriber-only\" Content<\/p>\r\n\n\t\t<div class=\"emaillist\">\n\t\t\t<form action=\"#\" method=\"post\" class=\"es_subscription_form es_shortcode_form\" id=\"es_subscription_form_1670577586\" data-source=\"ig-es\">\n\t\t\t\t\t\t\t\t<div class=\"es-field-wrap\"><label>Name*<br \/><input type=\"text\" name=\"name\" class=\"ig_es_form_field_name\" placeholder=\"\" value=\"\" required=\"required\" \/><\/label><\/div><div class=\"es-field-wrap\"><label>Email*<br \/><input class=\"es_required_field es_txt_email ig_es_form_field_email\" type=\"email\" name=\"email\" value=\"\" placeholder=\"\" required=\"required\" \/><\/label><\/div><input type=\"hidden\" name=\"lists[]\" value=\"1\" \/><input type=\"hidden\" name=\"form_id\" value=\"3\" \/>\n\t\t\t\t<input type=\"hidden\" name=\"es_email_page\" value=\"3911\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"es_email_page_url\" value=\"https:\/\/www.middlewareinventory.com\/blog\/build-packer-aws-image-example\/\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"status\" value=\"Unconfirmed\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"es-subscribe\" id=\"es-subscribe\" value=\"7aebfb1a9b\"\/>\n\t\t\t\t<label style=\"position:absolute;top:-99999px;left:-99999px;z-index:-99;\"><input type=\"email\" name=\"es_hp_email\" class=\"es_required_field\" tabindex=\"-1\" autocomplete=\"-1\" value=\"\"\/><\/label>\n\t\t\t\t\t\t\t\t<input type=\"submit\" name=\"submit\" class=\"es_subscription_form_submit es_submit_button es_textbox_button\" id=\"es_subscription_form_submit_1670577586\" value=\"Subscribe\"\/>\n\n\t\t\t\t\n\t\t\t\t<span class=\"es_spinner_image\" id=\"spinner-image\"><img src=\"https:\/\/www.middlewareinventory.com\/wp-content\/plugins\/email-subscribers\/lite\/public\/images\/spinner.gif\" alt=\"Loading\"\/><\/span>\n\n\t\t\t<\/form>\n\n\t\t\t<span class=\"es_subscription_message\" id=\"es_subscription_message_1670577586\"><\/span>\n\t\t<\/div>\n\n\t\t\r\n<\/div>\r\n<hr><\/p>\n","protected":false},"excerpt":{"rendered":"<p>Infrastructure as Code is a Brilliant Concept in DevOps and Packer and Terraform are two major technologies\/products in this segment. Thanks to HashiCorp Imagine that you need to create an AWS EC2 instance for your company or for learning purpose with your AWS free tier account. How do you do[&#8230;]<\/p>\n","protected":false},"author":1,"featured_media":3926,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"_et_pb_use_builder":"","_et_pb_old_content":"","_et_gb_content_width":""},"categories":[234,232],"tags":[281,280,277,284,279,283,278,282],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v14.9 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>Packer Build - Create and Build Packer Templates and Images for AWS<\/title>\n<meta name=\"description\" content=\"packer build example, Build and Deploy Packer Images into AWS, Example Packer Build Image for AWS to provision Softwares like Tomcat and Java. Packer Image sample. The Packer Build command example. How to create packer image, write packer template, How to provision AWS EC2 instance and Amazon Machine Images with Packer\" \/>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/www.middlewareinventory.com\/blog\/build-packer-aws-image-example\/\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"Packer Build - Create and Build Packer Templates and Images for AWS\" \/>\n<meta property=\"og:description\" content=\"packer build example, Build and Deploy Packer Images into AWS, Example Packer Build Image for AWS to provision Softwares like Tomcat and Java. Packer Image sample. The Packer Build command example. How to create packer image, write packer template, How to provision AWS EC2 instance and Amazon Machine Images with Packer\" \/>\n<meta property=\"og:url\" content=\"https:\/\/www.middlewareinventory.com\/blog\/build-packer-aws-image-example\/\" \/>\n<meta property=\"og:site_name\" content=\"Middleware Inventory\" \/>\n<meta property=\"article:publisher\" content=\"http:\/\/www.facebook.com\/devopsjunc\" \/>\n<meta property=\"article:published_time\" content=\"2019-06-03T03:43:54+00:00\" \/>\n<meta property=\"article:modified_time\" content=\"2022-06-19T05:57:47+00:00\" \/>\n<meta property=\"og:image\" content=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/PackerAWS.png\" \/>\n\t<meta property=\"og:image:width\" content=\"1074\" \/>\n\t<meta property=\"og:image:height\" content=\"674\" \/>\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\n<meta name=\"twitter:creator\" content=\"@mwinventory\" \/>\n<meta name=\"twitter:site\" content=\"@mwinventory\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"Organization\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\",\"name\":\"Middleware Inventory\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"sameAs\":[\"http:\/\/www.facebook.com\/devopsjunc\",\"https:\/\/www.youtube.com\/channel\/UCRuqBFM6ioWwviNJkgOjeWw\",\"https:\/\/twitter.com\/mwinventory\"],\"logo\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/09\/Screenshot-2020-09-18-at-3.49.40-AM.jpg\",\"width\":300,\"height\":107,\"caption\":\"Middleware Inventory\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\"}},{\"@type\":\"WebSite\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"name\":\"Devops Junction\",\"description\":\"An inventory of [i]nformation, Middleware and much more.\",\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":\"https:\/\/www.middlewareinventory.com\/?s={search_term_string}\",\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/build-packer-aws-image-example\/#primaryimage\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/06\/PackerAWS.png\",\"width\":1074,\"height\":674},{\"@type\":\"WebPage\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/build-packer-aws-image-example\/#webpage\",\"url\":\"https:\/\/www.middlewareinventory.com\/blog\/build-packer-aws-image-example\/\",\"name\":\"Packer Build - Create and Build Packer Templates and Images for AWS\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\"},\"primaryImageOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/build-packer-aws-image-example\/#primaryimage\"},\"datePublished\":\"2019-06-03T03:43:54+00:00\",\"dateModified\":\"2022-06-19T05:57:47+00:00\",\"description\":\"packer build example, Build and Deploy Packer Images into AWS, Example Packer Build Image for AWS to provision Softwares like Tomcat and Java. Packer Image sample. The Packer Build command example. How to create packer image, write packer template, How to provision AWS EC2 instance and Amazon Machine Images with Packer\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/www.middlewareinventory.com\/blog\/build-packer-aws-image-example\/\"]}]},{\"@type\":\"Article\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/build-packer-aws-image-example\/#article\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/build-packer-aws-image-example\/#webpage\"},\"author\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\"},\"headline\":\"Packer Build &#8211; Create and Build Packer Templates and Images for AWS\",\"datePublished\":\"2019-06-03T03:43:54+00:00\",\"dateModified\":\"2022-06-19T05:57:47+00:00\",\"mainEntityOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/build-packer-aws-image-example\/#webpage\"},\"commentCount\":0,\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/build-packer-aws-image-example\/#primaryimage\"},\"keywords\":\"packer AMI,packer and aws,packer build,Packer Build Example,packer image,packer JSON sample,packer template,packer template example\",\"articleSection\":\"AWS,Packer\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"CommentAction\",\"name\":\"Comment\",\"target\":[\"https:\/\/www.middlewareinventory.com\/blog\/build-packer-aws-image-example\/#respond\"]}]},{\"@type\":\"Person\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\",\"name\":\"Rumen Lishkov\",\"image\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#personlogo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/secure.gravatar.com\/avatar\/c22e4a54d67750291a9892531f94ffb3?s=96&d=mm&r=g\",\"caption\":\"Rumen Lishkov\"}}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","_links":{"self":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/3911"}],"collection":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/comments?post=3911"}],"version-history":[{"count":12,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/3911\/revisions"}],"predecessor-version":[{"id":3938,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/3911\/revisions\/3938"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media\/3926"}],"wp:attachment":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media?parent=3911"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/categories?post=3911"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/tags?post=3911"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}