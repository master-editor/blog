{"id":8136,"date":"2022-02-12T20:44:37","date_gmt":"2022-02-12T15:14:37","guid":{"rendered":"https:\/\/www.middlewareinventory.com\/?p=8136"},"modified":"2022-02-15T10:30:49","modified_gmt":"2022-02-15T05:00:49","slug":"ansible-playbook-kafka","status":"publish","type":"post","link":"https:\/\/www.middlewareinventory.com\/blog\/ansible-playbook-kafka\/","title":{"rendered":"Ansible Playbook to install KAFKA on Ubuntu &#8211; How to | Devops Junction"},"content":{"rendered":"<p>In this article, we are going to see how to install Kafka on ubuntu with Ansible.\u00a0 We created a simple playbook to download and install Kafka and start it.<\/p>\n<p>Here is the list of tasks the playbook is designed to do<\/p>\n<ul>\n<li>Perform apt update<\/li>\n<li>Install JRE needed for <strong>Kafka<\/strong> and <strong>Zookeeper<\/strong><\/li>\n<li>Create a User and Group for Kafka<\/li>\n<li>Create a directory to install Kafka<\/li>\n<li>Download <strong>Kafka<\/strong> and Unarchive<\/li>\n<li>Update the Log Path<\/li>\n<li>Update the Heap Size of the Kafka<\/li>\n<li>Create a Service &#8211; systemctl file for Kafka and Zookeeper<\/li>\n<li>Enabling the Service for Stratup<\/li>\n<\/ul>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/02\/Ansible-Kafka.jpg\"><img class=\"post-img alignnone wp-image-8143 size-full\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/02\/Ansible-Kafka.jpg\" alt=\"Ansible Kafka \" width=\"1748\" height=\"1240\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/02\/Ansible-Kafka.jpg 1748w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/02\/Ansible-Kafka-300x213.jpg 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/02\/Ansible-Kafka-1024x726.jpg 1024w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/02\/Ansible-Kafka-768x545.jpg 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/02\/Ansible-Kafka-1536x1090.jpg 1536w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/02\/Ansible-Kafka-90x65.jpg 90w\" sizes=\"(max-width: 1748px) 100vw, 1748px\" \/><\/a><\/p>\n<h2>Ansible Playbook to install Apache Kafka on Ubuntu<\/h2>\n<p>Since I have already listed the tasks this playbook is doing. I do not want to cover this in detail.<\/p>\n<p>There are various modules used in this playbook. We have dedicated examples for each of these modules<a href=\"https:\/\/www.middlewareinventory.com\/blog\/ansible-playbook-example\/\">\u00a0in here<\/a><\/p>\n<ul>\n<li>apt &#8211; to install packages in ubuntu<\/li>\n<li>group &#8211; to create a user group<\/li>\n<li>user &#8211; to create a user<\/li>\n<li>file &#8211; to create installation directory<\/li>\n<li>unarchive &#8211; to download and extract the zip distribution of Kafka<\/li>\n<li>shell &#8211; to move files to the right directory before starting a service<\/li>\n<li>lineinfile &#8211; to update the heapsize<\/li>\n<li>copy &#8211; to create a service file in \/etc\/systemd<\/li>\n<li>systemd &#8211; to enable and start the services<\/li>\n<li>wait_for &#8211; to validate if Kafka and Zookeeper is up and running and the port is open<\/li>\n<\/ul>\n<p>&nbsp;<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\" data-enlighter-theme=\"bootstrap4\" data-enlighter-linenumbers=\"false\">- name: Installing Kafka on Ubuntu\r\n  hosts: testserver\r\n  vars: \r\n    - installation_dir : \/opt\/kafka\r\n  tasks:\r\n    - name: Install JRE after apt update\r\n      become: yes\r\n      apt:\r\n        name: \r\n          - default-jre\r\n        state: present\r\n        update_cache: yes\r\n\r\n    - name: Create a group \r\n      become: yes\r\n      group:\r\n        name: kafka\r\n        state: present\r\n\r\n    - name: Create an user \r\n      become: yes\r\n      user:\r\n        name: kafka\r\n        state: present\r\n        group: kafka\r\n\r\n    - name: Create a Directory \/opt\/kafka\r\n      become: yes\r\n      file:\r\n        path: \"{{installation_dir}}\"\r\n        state: directory\r\n        mode: 0755\r\n        owner: kafka\r\n        group: kafka\r\n\r\n    - name: Download Kafka and Unzip \r\n      become: yes\r\n      become_user: kafka\r\n      unarchive:\r\n        src: https:\/\/dlcdn.apache.org\/kafka\/3.1.0\/kafka_2.13-3.1.0.tgz\r\n        dest: \"{{installation_dir}}\"\r\n        mode: 0755\r\n        remote_src: yes\r\n\r\n    - name: Move all the files to parent Directory\r\n      become: yes\r\n      become_user: kafka\r\n      shell:\r\n        mv {{installation_dir}}\/kafka_*\/* {{installation_dir}}\/.\r\n\r\n    - name: Update the log path\r\n      become: yes\r\n      become_user: kafka\r\n      replace:\r\n        path: \"{{installation_dir}}\/config\/server.properties\"\r\n        regexp: 'log.dirs=(.+)'\r\n        replace: 'log.dirs={{installation_dir}}\/logs'\r\n        backup: yes\r\n\r\n    - name: Update the Java Heap Size for Kafka\r\n      become: yes\r\n      become_user: kafka\r\n      replace:\r\n        path: \"{{installation_dir}}\/bin\/kafka-server-start.sh\"\r\n        regexp: 'export KAFKA_HEAP_OPTS=(\".+\")'\r\n        replace: 'export KAFKA_HEAP_OPTS=\"-Xmx520M -Xms520M\"'\r\n        backup: yes\r\n    \r\n\r\n    - name: Create a Service file for ZooKeeper with Copy module\r\n      become: yes\r\n      copy:\r\n        dest: \/etc\/systemd\/system\/zookeeper.service\r\n        content: |\r\n          [Unit]\r\n          Requires=network.target remote-fs.target\r\n          After=network.target remote-fs.target\r\n\r\n          [Service]\r\n          Type=simple\r\n          User=kafka\r\n          ExecStart={{installation_dir}}\/bin\/zookeeper-server-start.sh {{installation_dir}}\/config\/zookeeper.properties\r\n          ExecStop={{installation_dir}}\/bin\/zookeeper-server-stop.sh\r\n          Restart=on-abnormal\r\n\r\n          [Install]\r\n          WantedBy=multi-user.target\r\n        mode: 0755\r\n      \r\n    - name: Create a Service file for Kafka with Copy module\r\n      become: yes\r\n      copy:\r\n        dest: \/etc\/systemd\/system\/kafka.service\r\n        content: |\r\n          [Unit]\r\n          Requires=zookeeper.service\r\n          After=zookeeper.service\r\n\r\n          [Service]\r\n          Type=simple\r\n          User=kafka\r\n          ExecStart=\/bin\/sh -c '{{installation_dir}}\/bin\/kafka-server-start.sh {{installation_dir}}\/config\/server.properties &gt; {{installation_dir}}\/kafkaservice.log 2&gt;&amp;1'\r\n          ExecStop={{installation_dir}}\/bin\/kafka-server-stop.sh\r\n          Restart=on-abnormal\r\n\r\n          [Install]\r\n          WantedBy=multi-user.target\r\n        mode: 0755\r\n\r\n    - name: Start Services\r\n      tags: startservices\r\n      become: yes\r\n      systemd:\r\n        name: '{{item}}'\r\n        state: started\r\n        enabled: yes\r\n      with_items:\r\n        - \"kafka\"\r\n        - \"zookeeper\"\r\n    \r\n    - name: Validating if zookeeper is up and listening on port 2181\r\n      wait_for:\r\n        host: localhost\r\n        port: 2181\r\n        delay: 10\r\n        timeout: 30\r\n        state: started\r\n        msg: \"Zookeeper not seem to be running\"\r\n\r\n    - name: Validating if Kafka is up and listening on port 2181\r\n      wait_for:\r\n        host: localhost\r\n        port: 9092\r\n        delay: 10\r\n        timeout: 30\r\n        state: started\r\n        msg: \"Zookeeper not seem to be running\"\r\n<\/pre>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<p>You can get the same version of this playbook from my <a href=\"https:\/\/gist.github.com\/AKSarav\/9116cc7928b9d936bf0b6a12253c49ac\">gist.github.com too here<\/a><\/p>\n<h2>Terminal Record &#8211; Execution Output and Validation<\/h2>\n<p>In this terminal record, we have recorded the execution of the playbook and the resulting configuration by logging into the server.<\/p>\n<p>Also, we tried to create a new topic and publish\/consume messages using the Kafka built-in scripts.<\/p>\n<p><script id=\"asciicast-buDmSNzO6H2JPdoHfAirQPJyL\" src=\"https:\/\/asciinema.org\/a\/buDmSNzO6H2JPdoHfAirQPJyL.js\" async><\/script><\/p>\n<p>&nbsp;<\/p>\n<p>Cheers<br \/>\nRumen Lishkov<\/p>\n<div id=\"postfollow\">\r\n<a href='https:\/\/ko-fi.com\/O4O51FG7C' target='_blank'><img height='46' style='border:0px;height:46px;width: 186px' src='https:\/\/az743702.vo.msecnd.net\/cdn\/kofi3.png?v=2' border='0' alt='Buy Me a Coffee at ko-fi.com' \/><\/a>\r\n<p>Follow us on<a href=\"http:\/\/www.facebook.com\/middlewareinventory\">Facebook<\/a> or<a href=\"http:\/\/www.twitter.com\/mwinventory\">Twitter<\/a>\r\n<\/br>\r\nFor more practical videos and tutorials. <a href=\"https:\/\/www.youtube.com\/channel\/UCRuqBFM6ioWwviNJkgOjeWw?sub_confirmation=1\">Subscribe to our channel<\/a>\r\n<\/br>\r\nFollow me on Linkedin <a href=\"https:\/\/www.linkedin.com\/comm\/mynetwork\/discovery-see-all?usecase=PEOPLE_FOLLOWS&followMember=saravakmwinventory\">My Profile<\/a>\r\n<\/br>\r\n<\/i>For any Consultation or to hire us <a href=\"mailto:rumenlishkoff@gmail.com\"> rumenlishkoff@gmail.com<\/a>\r\n<\/br>\r\nIf you like this article. Show your Support! <a href=\"https:\/\/ko-fi.com\/middlewareinventory\">Buy me a Coffee.<\/a>\r\n<\/br>\r\n<\/p>\r\n<p style=\"color: palevioletred !important;\">Signup for Exclusive \"Subscriber-only\" Content<\/p>\r\n\n\t\t<div class=\"emaillist\">\n\t\t\t<form action=\"#\" method=\"post\" class=\"es_subscription_form es_shortcode_form\" id=\"es_subscription_form_1670577413\" data-source=\"ig-es\">\n\t\t\t\t\t\t\t\t<div class=\"es-field-wrap\"><label>Name*<br \/><input type=\"text\" name=\"name\" class=\"ig_es_form_field_name\" placeholder=\"\" value=\"\" required=\"required\" \/><\/label><\/div><div class=\"es-field-wrap\"><label>Email*<br \/><input class=\"es_required_field es_txt_email ig_es_form_field_email\" type=\"email\" name=\"email\" value=\"\" placeholder=\"\" required=\"required\" \/><\/label><\/div><input type=\"hidden\" name=\"lists[]\" value=\"1\" \/><input type=\"hidden\" name=\"form_id\" value=\"3\" \/>\n\t\t\t\t<input type=\"hidden\" name=\"es_email_page\" value=\"8136\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"es_email_page_url\" value=\"https:\/\/www.middlewareinventory.com\/blog\/ansible-playbook-kafka\/\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"status\" value=\"Unconfirmed\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"es-subscribe\" id=\"es-subscribe\" value=\"7aebfb1a9b\"\/>\n\t\t\t\t<label style=\"position:absolute;top:-99999px;left:-99999px;z-index:-99;\"><input type=\"email\" name=\"es_hp_email\" class=\"es_required_field\" tabindex=\"-1\" autocomplete=\"-1\" value=\"\"\/><\/label>\n\t\t\t\t\t\t\t\t<input type=\"submit\" name=\"submit\" class=\"es_subscription_form_submit es_submit_button es_textbox_button\" id=\"es_subscription_form_submit_1670577413\" value=\"Subscribe\"\/>\n\n\t\t\t\t\n\t\t\t\t<span class=\"es_spinner_image\" id=\"spinner-image\"><img src=\"https:\/\/www.middlewareinventory.com\/wp-content\/plugins\/email-subscribers\/lite\/public\/images\/spinner.gif\" alt=\"Loading\"\/><\/span>\n\n\t\t\t<\/form>\n\n\t\t\t<span class=\"es_subscription_message\" id=\"es_subscription_message_1670577413\"><\/span>\n\t\t<\/div>\n\n\t\t\r\n<\/div>\r\n<hr>\n","protected":false},"excerpt":{"rendered":"<p>In this article, we are going to see how to install Kafka on ubuntu with Ansible.\u00a0 We created a simple playbook to download and install Kafka and start it. Here is the list of tasks the playbook is designed to do Perform apt update Install JRE needed for Kafka and[&#8230;]<\/p>\n","protected":false},"author":1,"featured_media":8143,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"_et_pb_use_builder":"","_et_pb_old_content":"","_et_gb_content_width":""},"categories":[98],"tags":[],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v14.9 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>Ansible Playbook to install KAFKA on Ubuntu - How to | Devops Junction<\/title>\n<meta name=\"description\" content=\"Ansible Kafka example. Install Kafka with Ansible on Ubuntu. Ansible Playbook to install ZooKeeper and Kafka. Kafka installation on Ubuntu how to. Ansible Kafka on Ubuntu\" \/>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/www.middlewareinventory.com\/blog\/ansible-playbook-kafka\/\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"Ansible Playbook to install KAFKA on Ubuntu - How to | Devops Junction\" \/>\n<meta property=\"og:description\" content=\"Ansible Kafka example. Install Kafka with Ansible on Ubuntu. Ansible Playbook to install ZooKeeper and Kafka. Kafka installation on Ubuntu how to. Ansible Kafka on Ubuntu\" \/>\n<meta property=\"og:url\" content=\"https:\/\/www.middlewareinventory.com\/blog\/ansible-playbook-kafka\/\" \/>\n<meta property=\"og:site_name\" content=\"Middleware Inventory\" \/>\n<meta property=\"article:publisher\" content=\"http:\/\/www.facebook.com\/devopsjunc\" \/>\n<meta property=\"article:published_time\" content=\"2022-02-12T15:14:37+00:00\" \/>\n<meta property=\"article:modified_time\" content=\"2022-02-15T05:00:49+00:00\" \/>\n<meta property=\"og:image\" content=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/02\/Ansible-Kafka.jpg\" \/>\n\t<meta property=\"og:image:width\" content=\"1748\" \/>\n\t<meta property=\"og:image:height\" content=\"1240\" \/>\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\n<meta name=\"twitter:creator\" content=\"@mwinventory\" \/>\n<meta name=\"twitter:site\" content=\"@mwinventory\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"Organization\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\",\"name\":\"Middleware Inventory\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"sameAs\":[\"http:\/\/www.facebook.com\/devopsjunc\",\"https:\/\/www.youtube.com\/channel\/UCRuqBFM6ioWwviNJkgOjeWw\",\"https:\/\/twitter.com\/mwinventory\"],\"logo\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/09\/Screenshot-2020-09-18-at-3.49.40-AM.jpg\",\"width\":300,\"height\":107,\"caption\":\"Middleware Inventory\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\"}},{\"@type\":\"WebSite\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"name\":\"Devops Junction\",\"description\":\"An inventory of [i]nformation, Middleware and much more.\",\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":\"https:\/\/www.middlewareinventory.com\/?s={search_term_string}\",\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-playbook-kafka\/#primaryimage\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/02\/Ansible-Kafka.jpg\",\"width\":1748,\"height\":1240,\"caption\":\"Ansible Kafka\"},{\"@type\":\"WebPage\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-playbook-kafka\/#webpage\",\"url\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-playbook-kafka\/\",\"name\":\"Ansible Playbook to install KAFKA on Ubuntu - How to | Devops Junction\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\"},\"primaryImageOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-playbook-kafka\/#primaryimage\"},\"datePublished\":\"2022-02-12T15:14:37+00:00\",\"dateModified\":\"2022-02-15T05:00:49+00:00\",\"description\":\"Ansible Kafka example. Install Kafka with Ansible on Ubuntu. Ansible Playbook to install ZooKeeper and Kafka. Kafka installation on Ubuntu how to. Ansible Kafka on Ubuntu\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/www.middlewareinventory.com\/blog\/ansible-playbook-kafka\/\"]}]},{\"@type\":\"Article\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-playbook-kafka\/#article\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-playbook-kafka\/#webpage\"},\"author\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\"},\"headline\":\"Ansible Playbook to install KAFKA on Ubuntu &#8211; How to | Devops Junction\",\"datePublished\":\"2022-02-12T15:14:37+00:00\",\"dateModified\":\"2022-02-15T05:00:49+00:00\",\"mainEntityOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-playbook-kafka\/#webpage\"},\"commentCount\":0,\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-playbook-kafka\/#primaryimage\"},\"articleSection\":\"Ansible\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"CommentAction\",\"name\":\"Comment\",\"target\":[\"https:\/\/www.middlewareinventory.com\/blog\/ansible-playbook-kafka\/#respond\"]}]},{\"@type\":\"Person\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\",\"name\":\"Rumen Lishkov\",\"image\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#personlogo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/secure.gravatar.com\/avatar\/c22e4a54d67750291a9892531f94ffb3?s=96&d=mm&r=g\",\"caption\":\"Rumen Lishkov\"}}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","_links":{"self":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/8136"}],"collection":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/comments?post=8136"}],"version-history":[{"count":5,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/8136\/revisions"}],"predecessor-version":[{"id":8177,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/8136\/revisions\/8177"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media\/8143"}],"wp:attachment":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media?parent=8136"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/categories?post=8136"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/tags?post=8136"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}