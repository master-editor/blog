{"id":8276,"date":"2022-04-04T01:18:11","date_gmt":"2022-04-03T19:48:11","guid":{"rendered":"https:\/\/www.middlewareinventory.com\/?p=8276"},"modified":"2022-04-04T01:25:14","modified_gmt":"2022-04-03T19:55:14","slug":"terraform-eks-spot-instances","status":"publish","type":"post","link":"https:\/\/www.middlewareinventory.com\/blog\/terraform-eks-spot-instances\/","title":{"rendered":"Creating EKS Cluster with SPOT instances &#8211; Terraform | Devops Junction"},"content":{"rendered":"<p>In this article, we are going to see how to create an EKS Cluster with SPOT and OnDemand instances using Terraform.<\/p>\n<p>If you have prior experience with AWS, you might know what is SPOT instances and ondemand instances are.\u00a0 Let us start with a quick introduction towards SPOT instances.<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Terraform-eks-spot.png\"><img class=\"post-img alignnone wp-image-8285 size-full\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Terraform-eks-spot.png\" alt=\"Terraform eks spot instance\" width=\"1748\" height=\"1240\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Terraform-eks-spot.png 1748w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Terraform-eks-spot-300x213.png 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Terraform-eks-spot-1024x726.png 1024w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Terraform-eks-spot-768x545.png 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Terraform-eks-spot-1536x1090.png 1536w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Terraform-eks-spot-90x65.png 90w\" sizes=\"(max-width: 1748px) 100vw, 1748px\" \/><\/a><\/p>\n<h2><\/h2>\n<h2>Quick Introduction to <span style=\"color: #e81787;\">AWS SPOT<\/span> instances<\/h2>\n<p>AWS Provides the unused\/unoccupied EC2 instances for up to a 90% cheap rate in the name of SPOT instances.<\/p>\n<p>While these instances are just like the Default <code>OnDemand<\/code> EC2 instances, their availability is not guaranteed.\u00a0 SPOT instances can be reallocated anytime to other users so your application availability would be affected.<\/p>\n<p>This is suitable for Highly Scalable workloads primarily in DEV and QA environments. Not recommended for Production.<\/p>\n<p>When one Spot instance gets reallocated we always get a new SPOT instance to take cover.<\/p>\n<p>SPOT instances work perfectly with EKS and you can use SPOT instances to scale your production application when there is a demand. once the usage has come down you can shutdown those instances.<\/p>\n<p>You can use the following methods to provision and deprovision nodes<\/p>\n<ul>\n<li>Cluster AutoScaler<\/li>\n<li>Karpenter<\/li>\n<\/ul>\n<p>I have written a dedicated article on how to use Karpenter for cluster autoscaling. <a href=\"https:\/\/www.middlewareinventory.com\/blog\/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes\/\">read the article here<\/a><\/p>\n<p>Now you know about the SPOT instances I hope. Let us move on to our objective<\/p>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<p>&nbsp;<\/p>\n<h2>Objective<\/h2>\n<p>Our objective for this article is to create a <strong>VPC with necassary subnets<\/strong> and a <strong>EKS Cluster with two managed worker groups<\/strong>. One with OnDemand instances another with SPOT instances<\/p>\n<p>To schedule our application workload to the right nodes. we are adding a nodeselector during the creation itself<\/p>\n<p>For <strong>Spot<\/strong> instance we are adding the following Label<\/p>\n<div>\n<pre>\"--node-labels=node.kubernetes.io\/lifecycle=spot\"<\/pre>\n<\/div>\n<p>For <strong>OnDemand<\/strong> instances, using the following label<\/p>\n<div>\n<pre>\"--node-labels=node.kubernetes.io\/lifecycle=ondemand\"<\/pre>\n<\/div>\n<p>this lets us schedule the important workloads to the on-demand instances and scalable workloads and temporary pods to spot instances.<\/p>\n<p><strong><span style=\"color: #ed1367;\">Note*: <\/span><\/strong>EKS <strong>WorkerGroups<\/strong> and <strong>NodeGroups<\/strong> are different. we have talked about it later in this article.<\/p>\n<p>&nbsp;<\/p>\n<h2>Download the Terraform Code from <span style=\"color: #e81787;\">Github<\/span><\/h2>\n<p>All the necessary Terraform code for this article is available in my GitHub repository.<\/p>\n<p>You can clone my repository and begin to make changes<\/p>\n<p><a href=\"https:\/\/github.com\/AKSarav\/TerraformEKS-SPOT\">https:\/\/github.com\/AKSarav\/TerraformEKS-SPOT<\/a><\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-04-at-12.41.01-AM.png\" target=\"_blank\" rel=\"https:\/\/github.com\/AKSarav\/TerraformEKS-SPOT noopener noreferrer\"><img class=\"post-img alignnone wp-image-8283 size-full\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-04-at-12.41.01-AM.png\" alt=\"terraform eks spot\" width=\"1864\" height=\"704\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-04-at-12.41.01-AM.png 1864w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-04-at-12.41.01-AM-300x113.png 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-04-at-12.41.01-AM-1024x387.png 1024w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-04-at-12.41.01-AM-768x290.png 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-04-at-12.41.01-AM-1536x580.png 1536w\" sizes=\"(max-width: 1864px) 100vw, 1864px\" \/><\/a><\/p>\n<p>&nbsp;<\/p>\n<p><span style=\"color: #003366;\"><strong>Quick note:\u00a0<\/strong><\/span><\/p>\n<p>We are using the following modules in our terraform config ( why to reinvent the wheel when you can be efficient )<\/p>\n<ul>\n<li>terraform-aws-modules\/vpc\/aws -3.2.0<\/li>\n<li>\n<div>\n<div>terraform-aws-modules\/eks\/aws &#8211; 18<\/div>\n<\/div>\n<\/li>\n<\/ul>\n<p>we are referring to these modules directly in our tf files using module and source. so no manual intervention required there.<\/p>\n<p>&nbsp;<\/p>\n<h2>Customize the <span style=\"color: #ed1367;\">Terraform<\/span> Configuration<\/h2>\n<p>Once you have downloaded the code from the Github, Now you can make further customizations<\/p>\n<p>Here is the quick snapshot to validate the list of files once downloaded<\/p>\n<p>The code can be modified to suit your need.\u00a0 Here are few things you can consider changing<\/p>\n<ul>\n<li>Cluster name<\/li>\n<li>Number of instances<\/li>\n<li>Instance type and capacity ( t2.small, t3.small etc)<\/li>\n<\/ul>\n<p>We are using the clustername as the VPC name to keep things simple and to find out easily which VPC belongs to EKS.<\/p>\n<p>&nbsp;<\/p>\n<h3><strong><span style=\"color: #003366;\">Updating the Provider configuration ( AWS Profile )<\/span><\/strong><\/h3>\n<p>For Terraform to connect to AWS, you need to either pass the AWS Key and secret or let terraform use the AWS CLI installed locally.<\/p>\n<p>If you are managing multiple AWS accounts using AWS CLI, you must be multiple having named profiles. In my case, I am using a profile named <code>personal<\/code><\/p>\n<p>This is the content of my <code>providers.tf<\/code> file<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\" data-enlighter-theme=\"bootstrap4\" data-enlighter-linenumbers=\"false\">provider \"kubernetes\" {\r\n  host                   = data.aws_eks_cluster.cluster.endpoint\r\n  token                  = data.aws_eks_cluster_auth.cluster.token\r\n  cluster_ca_certificate = base64decode(data.aws_eks_cluster.cluster.certificate_authority.0.data)\r\n}\r\n\r\nprovider \"aws\" {\r\n  region = \"us-east-2\"\r\n  profile = \"personal\"\r\n}<\/pre>\n<p>You can see that I am using <strong>us-east-2<\/strong> as my region and <strong>personal<\/strong> as my aws cli profile<\/p>\n<p>Update it to suit your setup.<\/p>\n<p>New to AWS CLI. <a href=\"https:\/\/docs.aws.amazon.com\/cli\/latest\/userguide\/cli-configure-profiles.html\">learn what is named profile from here<\/a><\/p>\n<p>If you are completely new to AWS and Terraform and trying to create your first AWS setup with Terraform. Please go through the following article to learn some basics<\/p>\n<blockquote class=\"wp-embedded-content\" data-secret=\"uY6BR2p60W\"><p><a href=\"https:\/\/www.middlewareinventory.com\/blog\/terraform-aws-example-ec2\/\">Terraform AWS Example &#8211; Create EC2 instance with Terraform<\/a><\/p><\/blockquote>\n<p><iframe class=\"wp-embedded-content\" sandbox=\"allow-scripts\" security=\"restricted\" style=\"position: absolute; clip: rect(1px, 1px, 1px, 1px);\" title=\"&#8220;Terraform AWS Example &#8211; Create EC2 instance with Terraform&#8221; &#8212; Middleware Inventory\" src=\"https:\/\/www.middlewareinventory.com\/blog\/terraform-aws-example-ec2\/embed\/#?secret=uY6BR2p60W\" data-secret=\"uY6BR2p60W\" width=\"600\" height=\"338\" frameborder=\"0\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\"><\/iframe><\/p>\n<p>&nbsp;<\/p>\n<h3><strong><span style=\"color: #003366;\">Updating the Cluster Name<\/span><\/strong><\/h3>\n<p>You need to update the <code>variables.tf<\/code> file with the cluster name of your choice. I have used <code>GritfyEKS<\/code> as the name<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"json\" data-enlighter-theme=\"bootstrap4\" data-enlighter-linenumbers=\"false\">variable \"clustername\"{\r\n    default = \"GritfyEKS\"\r\n    description = \"Gritfy  EKS Cluster\"\r\n}<\/pre>\n<p>&nbsp;<\/p>\n<h3><strong><span style=\"color: #003366;\">Updating the Worker Group configuration<\/span><\/strong><\/h3>\n<p>In the same variables.tf file you can find more elements to update<\/p>\n<ul>\n<li><strong>spot_instance_types<\/strong> &#8211; list of instances that can be used while creating Spot instances<\/li>\n<li><strong>ondemand_instance_type<\/strong> &#8211; A single instance type to use for creating ondemand workergroup<\/li>\n<li><strong>spot_max_size<\/strong> &#8211; Maximum number of SPOT instances that can be created<\/li>\n<li><strong>spot_desired_size<\/strong> &#8211; How many spot instances are to be created at the beginning<\/li>\n<li><strong>ondemand_desired_size<\/strong> &#8211; how many on-demand instances to create at first<\/li>\n<\/ul>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\" data-enlighter-theme=\"bootstrap4\" data-enlighter-linenumbers=\"false\">variable \"spot_instance_types\"{\r\n    default = [\"t3.small\",\"t2.small\"]\r\n    description = \"List of instance types for SPOT instance selection\"\r\n}\r\nvariable \"ondemand_instance_type\"{\r\n    default = \"t3.medium\"\r\n    description = \"On Demand instance type\"\r\n}\r\nvariable \"spot_max_size\"{\r\n    default = 2\r\n    description = \"How many SPOT instance can be created max\"\r\n}\r\nvariable \"spot_desired_size\"{\r\n    default = 2\r\n    description = \"How many SPOT instance should be running at all times\"\r\n}\r\nvariable \"ondemand_desired_size\"{\r\n    default = 2\r\n    description = \"How many OnDemand instances should be running at all times\"\r\n}\r\n<\/pre>\n<p>&nbsp;<\/p>\n<p>Once you are done with all these three things. we are good to go and start.<\/p>\n<p>If you have the right privileges in AWS. you should not be having any issues along the way. In case of any support do let us know in the comments<\/p>\n<p>&nbsp;<\/p>\n<h2>EKS <span style=\"color: #ed1367;\">Worker<\/span> Group vs <span style=\"color: #ed1367;\">NodeGroup<\/span> ( The Difference )<\/h2>\n<p>This terraform configuration is designed to worker group instead of nodegroup.<\/p>\n<p>EKS supports two types of instance groups.<\/p>\n<ul>\n<li><strong>WorkerGroups<\/strong> &#8211; Self Managed Group of EC2 instances, where the patching and upgrade has to be done by the DevOps Engineer with caution<\/li>\n<li><strong>NodeGroups<\/strong> &#8211; AWS Managed Group of EC2 instances, where the patching and upgrade can be done with a single click from the AWS console.<\/li>\n<\/ul>\n<p>If you are going for production you can choose to go with <code>NodeGroups<\/code> and the terraform configuration would be different for the same. This is called EKS <strong>Managed Node Group<\/strong><\/p>\n<p>In this article, <strong>Our Terraform code is designed with WorkerGroup<\/strong> it means that the EC2 instances created and attached with EKS should be managed by us.<\/p>\n<p>&nbsp;<\/p>\n<h2>Terraform <span style=\"color: #ed1367;\">init<\/span> and <span style=\"color: #ed1367;\">Apply<\/span><\/h2>\n<p>Once you have made the necessary changes. Now you can go for Initializing your Terraform<\/p>\n<p>This installs the necessary modules and the providers.<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-03-at-6.28.06-PM.png\"><img class=\"post-img alignnone wp-image-8277 size-full\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-03-at-6.28.06-PM.png\" alt=\"Terraform EKS SPOT\" width=\"2350\" height=\"1890\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-03-at-6.28.06-PM.png 2350w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-03-at-6.28.06-PM-300x241.png 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-03-at-6.28.06-PM-1024x824.png 1024w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-03-at-6.28.06-PM-768x618.png 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-03-at-6.28.06-PM-1536x1235.png 1536w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-03-at-6.28.06-PM-2048x1647.png 2048w\" sizes=\"(max-width: 2350px) 100vw, 2350px\" \/><\/a><\/p>\n<p>Once the Initialization complete, you can go for the <code>plan<\/code> and <code>apply<\/code><\/p>\n<pre>terraform plan -out tfplan.out\r\nterraform apply tfplan.out<\/pre>\n<p>Upon completion of your Terraform execution. You would have your EKS Cluster ready with 3 nodes.<\/p>\n<div style=\"width: 840px;\" class=\"wp-video\"><!--[if lt IE 9]><script>document.createElement('video');<\/script><![endif]-->\n<video class=\"wp-video-shortcode\" id=\"video-8276-1\" width=\"840\" height=\"473\" preload=\"metadata\" controls=\"controls\"><source type=\"video\/mp4\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screen-Recording-2022-04-03-at-9.33.03-PM.mp4?_=1\" \/><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screen-Recording-2022-04-03-at-9.33.03-PM.mp4\">https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screen-Recording-2022-04-03-at-9.33.03-PM.mp4<\/a><\/video><\/div>\n<p>Before executing the kubectl command. you can use the KUBECONFIG file created by default during the terraform run<\/p>\n<pre>export KUBECONFIG=${PWD}\/kubeconfig_&lt;YourClusterName&gt;<\/pre>\n<p>When you set this KUBECONFIG variable, kubectl would start referring to the local kubeconfig file created during the terraform run<\/p>\n<p>Make sure you replace your cluster name after <code>kubeconfig_<\/code><\/p>\n<p>The second thing to do is to set the default AWS region and the profile ( if you are using multiple AWS CLI profiles)<\/p>\n<p>If you are not having any <a href=\"https:\/\/docs.aws.amazon.com\/cli\/latest\/userguide\/cli-configure-profiles.html\">named profiles<\/a> in AWS CLI. you may not have to do the <code>AWS_DEFAULT_PROFILE<\/code>export since we have set the region as <code>us-east-2<\/code>in <strong>providers.tf\u00a0<\/strong>file<\/p>\n<p>you need to set your AWS_DEFAULT_REGION to the same. this is not needed if you have configured your default region to the same region.<\/p>\n<pre>export AWS_DEFAULT_REGION=us-east-2\r\nexport AWS_DEFAULT_PROFILE=personal<\/pre>\n<p>&nbsp;<\/p>\n<h2><span style=\"color: #ed1367;\">Validate<\/span> the Nodes and the EKS <span style=\"color: #ed1367;\">Cluster<\/span><\/h2>\n<p>If you have used the right AWS Profile and Region as same as the ones mentioned on the <code>providers.tf<\/code> file and have exported the <code>KUBE_CONFIG<\/code> right<\/p>\n<p>you should now be able to list the nodes and connect successfully to your cluster<\/p>\n<p>Now execute the <code>kubectl get nodes<\/code> command to validate if the nodes are created and you are able to see them<\/p>\n<p>Also to make sure if the nodes having the right labels respective to their instance type. Try to use the following command<\/p>\n<pre>kubectl get nodes -o json|jq -C '.items[] | .metadata.name,.metadata.labels'<\/pre>\n<p>This would show the nodes and their labels and you can see the <code>instance_type<\/code> and the other relative labels<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-03-at-11.56.52-PM.png\"><img class=\"post-img alignnone wp-image-8280 size-full\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-03-at-11.56.52-PM.png\" alt=\"terraform eks\" width=\"1992\" height=\"2160\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-03-at-11.56.52-PM.png 1992w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-03-at-11.56.52-PM-277x300.png 277w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-03-at-11.56.52-PM-944x1024.png 944w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-03-at-11.56.52-PM-768x833.png 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-03-at-11.56.52-PM-1417x1536.png 1417w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-03-at-11.56.52-PM-1889x2048.png 1889w\" sizes=\"(max-width: 1992px) 100vw, 1992px\" \/><\/a><\/p>\n<p>You can revalidate this info by logging to aws console or using <code>aws cli<\/code> as well.<\/p>\n<p>&nbsp;<\/p>\n<h2>Conclusion<\/h2>\n<p>In this article, we have learned how to create EKS Cluster with <strong>SPOT<\/strong> and an <strong>on-demand<\/strong> worker group of EC2 instances.<\/p>\n<p>We also learn a few more other things<\/p>\n<ul>\n<li>Difference between <strong>workergroup<\/strong> and <strong>nodegroup<\/strong><\/li>\n<li>Adding Label to the node during the EKS Cluster creation<\/li>\n<li>Listing the nodes with labels using kubectl<\/li>\n<li>How to use AWS DEFAULT variables to choose the AWSCLI profile and region<\/li>\n<\/ul>\n<p>Hope this article helps you. If you have any questions please do reach out to us on the comments section<\/p>\n<p>For any professional support for individuals or for your organization. reach us at <a href=\"mailto:rumenlishkoff@gmail.com\">rumenlishkoff@gmail.com<\/a><\/p>\n<a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2021\/09\/DaaS.svg\"><img class=\"post-img\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2021\/09\/DaaS.svg\" alt=\"gritfy\" width=\"1047\" height=\"415\" class=\"alignnone size-full wp-image-6623\" \/><\/a>\n<p>&nbsp;<\/p>\n<p>Cheers<br \/>\nRumen Lishkov<\/p>\n<div id=\"postfollow\">\r\n<a href='https:\/\/ko-fi.com\/O4O51FG7C' target='_blank'><img height='46' style='border:0px;height:46px;width: 186px' src='https:\/\/az743702.vo.msecnd.net\/cdn\/kofi3.png?v=2' border='0' alt='Buy Me a Coffee at ko-fi.com' \/><\/a>\r\n<p>Follow us on<a href=\"http:\/\/www.facebook.com\/middlewareinventory\">Facebook<\/a> or<a href=\"http:\/\/www.twitter.com\/mwinventory\">Twitter<\/a>\r\n<\/br>\r\nFor more practical videos and tutorials. <a href=\"https:\/\/www.youtube.com\/channel\/UCRuqBFM6ioWwviNJkgOjeWw?sub_confirmation=1\">Subscribe to our channel<\/a>\r\n<\/br>\r\nFollow me on Linkedin <a href=\"https:\/\/www.linkedin.com\/comm\/mynetwork\/discovery-see-all?usecase=PEOPLE_FOLLOWS&followMember=saravakmwinventory\">My Profile<\/a>\r\n<\/br>\r\n<\/i>For any Consultation or to hire us <a href=\"mailto:rumenlishkoff@gmail.com\"> rumenlishkoff@gmail.com<\/a>\r\n<\/br>\r\nIf you like this article. Show your Support! <a href=\"https:\/\/ko-fi.com\/middlewareinventory\">Buy me a Coffee.<\/a>\r\n<\/br>\r\n<\/p>\r\n<p style=\"color: palevioletred !important;\">Signup for Exclusive \"Subscriber-only\" Content<\/p>\r\n\n\t\t<div class=\"emaillist\">\n\t\t\t<form action=\"#\" method=\"post\" class=\"es_subscription_form es_shortcode_form\" id=\"es_subscription_form_1670577607\" data-source=\"ig-es\">\n\t\t\t\t\t\t\t\t<div class=\"es-field-wrap\"><label>Name*<br \/><input type=\"text\" name=\"name\" class=\"ig_es_form_field_name\" placeholder=\"\" value=\"\" required=\"required\" \/><\/label><\/div><div class=\"es-field-wrap\"><label>Email*<br \/><input class=\"es_required_field es_txt_email ig_es_form_field_email\" type=\"email\" name=\"email\" value=\"\" placeholder=\"\" required=\"required\" \/><\/label><\/div><input type=\"hidden\" name=\"lists[]\" value=\"1\" \/><input type=\"hidden\" name=\"form_id\" value=\"3\" \/>\n\t\t\t\t<input type=\"hidden\" name=\"es_email_page\" value=\"8276\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"es_email_page_url\" value=\"https:\/\/www.middlewareinventory.com\/blog\/terraform-eks-spot-instances\/\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"status\" value=\"Unconfirmed\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"es-subscribe\" id=\"es-subscribe\" value=\"7aebfb1a9b\"\/>\n\t\t\t\t<label style=\"position:absolute;top:-99999px;left:-99999px;z-index:-99;\"><input type=\"email\" name=\"es_hp_email\" class=\"es_required_field\" tabindex=\"-1\" autocomplete=\"-1\" value=\"\"\/><\/label>\n\t\t\t\t\t\t\t\t<input type=\"submit\" name=\"submit\" class=\"es_subscription_form_submit es_submit_button es_textbox_button\" id=\"es_subscription_form_submit_1670577607\" value=\"Subscribe\"\/>\n\n\t\t\t\t\n\t\t\t\t<span class=\"es_spinner_image\" id=\"spinner-image\"><img src=\"https:\/\/www.middlewareinventory.com\/wp-content\/plugins\/email-subscribers\/lite\/public\/images\/spinner.gif\" alt=\"Loading\"\/><\/span>\n\n\t\t\t<\/form>\n\n\t\t\t<span class=\"es_subscription_message\" id=\"es_subscription_message_1670577607\"><\/span>\n\t\t<\/div>\n\n\t\t\r\n<\/div>\r\n<hr>\n","protected":false},"excerpt":{"rendered":"<p>In this article, we are going to see how to create an EKS Cluster with SPOT and OnDemand instances using Terraform. If you have prior experience with AWS, you might know what is SPOT instances and ondemand instances are.\u00a0 Let us start with a quick introduction towards SPOT instances. Quick[&#8230;]<\/p>\n","protected":false},"author":1,"featured_media":8285,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"_et_pb_use_builder":"","_et_pb_old_content":"","_et_gb_content_width":""},"categories":[233],"tags":[],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v14.9 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>Creating EKS Cluster with SPOT instances - Terraform | Devops Junction<\/title>\n<meta name=\"description\" content=\"How to create EKS Cluster with SPOT instances using Terraform. Terraform EKS SPOT instances example code. How to create EKS Cluster with SPOT instances and labels.\" \/>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/www.middlewareinventory.com\/blog\/terraform-eks-spot-instances\/\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"Creating EKS Cluster with SPOT instances - Terraform | Devops Junction\" \/>\n<meta property=\"og:description\" content=\"How to create EKS Cluster with SPOT instances using Terraform. Terraform EKS SPOT instances example code. How to create EKS Cluster with SPOT instances and labels.\" \/>\n<meta property=\"og:url\" content=\"https:\/\/www.middlewareinventory.com\/blog\/terraform-eks-spot-instances\/\" \/>\n<meta property=\"og:site_name\" content=\"Middleware Inventory\" \/>\n<meta property=\"article:publisher\" content=\"http:\/\/www.facebook.com\/devopsjunc\" \/>\n<meta property=\"article:published_time\" content=\"2022-04-03T19:48:11+00:00\" \/>\n<meta property=\"article:modified_time\" content=\"2022-04-03T19:55:14+00:00\" \/>\n<meta property=\"og:image\" content=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Terraform-eks-spot.png\" \/>\n\t<meta property=\"og:image:width\" content=\"1748\" \/>\n\t<meta property=\"og:image:height\" content=\"1240\" \/>\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\n<meta name=\"twitter:creator\" content=\"@mwinventory\" \/>\n<meta name=\"twitter:site\" content=\"@mwinventory\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"Organization\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\",\"name\":\"Middleware Inventory\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"sameAs\":[\"http:\/\/www.facebook.com\/devopsjunc\",\"https:\/\/www.youtube.com\/channel\/UCRuqBFM6ioWwviNJkgOjeWw\",\"https:\/\/twitter.com\/mwinventory\"],\"logo\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/09\/Screenshot-2020-09-18-at-3.49.40-AM.jpg\",\"width\":300,\"height\":107,\"caption\":\"Middleware Inventory\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\"}},{\"@type\":\"WebSite\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"name\":\"Devops Junction\",\"description\":\"An inventory of [i]nformation, Middleware and much more.\",\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":\"https:\/\/www.middlewareinventory.com\/?s={search_term_string}\",\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/terraform-eks-spot-instances\/#primaryimage\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Terraform-eks-spot.png\",\"width\":1748,\"height\":1240,\"caption\":\"Terraform eks spot instance\"},{\"@type\":\"WebPage\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/terraform-eks-spot-instances\/#webpage\",\"url\":\"https:\/\/www.middlewareinventory.com\/blog\/terraform-eks-spot-instances\/\",\"name\":\"Creating EKS Cluster with SPOT instances - Terraform | Devops Junction\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\"},\"primaryImageOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/terraform-eks-spot-instances\/#primaryimage\"},\"datePublished\":\"2022-04-03T19:48:11+00:00\",\"dateModified\":\"2022-04-03T19:55:14+00:00\",\"description\":\"How to create EKS Cluster with SPOT instances using Terraform. Terraform EKS SPOT instances example code. How to create EKS Cluster with SPOT instances and labels.\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/www.middlewareinventory.com\/blog\/terraform-eks-spot-instances\/\"]}]},{\"@type\":\"Article\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/terraform-eks-spot-instances\/#article\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/terraform-eks-spot-instances\/#webpage\"},\"author\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\"},\"headline\":\"Creating EKS Cluster with SPOT instances &#8211; Terraform | Devops Junction\",\"datePublished\":\"2022-04-03T19:48:11+00:00\",\"dateModified\":\"2022-04-03T19:55:14+00:00\",\"mainEntityOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/terraform-eks-spot-instances\/#webpage\"},\"commentCount\":0,\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/terraform-eks-spot-instances\/#primaryimage\"},\"articleSection\":\"Terraform\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"CommentAction\",\"name\":\"Comment\",\"target\":[\"https:\/\/www.middlewareinventory.com\/blog\/terraform-eks-spot-instances\/#respond\"]}]},{\"@type\":\"Person\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\",\"name\":\"Rumen Lishkov\",\"image\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#personlogo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/secure.gravatar.com\/avatar\/c22e4a54d67750291a9892531f94ffb3?s=96&d=mm&r=g\",\"caption\":\"Rumen Lishkov\"}}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","_links":{"self":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/8276"}],"collection":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/comments?post=8276"}],"version-history":[{"count":5,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/8276\/revisions"}],"predecessor-version":[{"id":8295,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/8276\/revisions\/8295"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media\/8285"}],"wp:attachment":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media?parent=8276"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/categories?post=8276"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/tags?post=8276"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}