{"id":9185,"date":"2022-10-15T01:44:07","date_gmt":"2022-10-14T20:14:07","guid":{"rendered":"https:\/\/www.middlewareinventory.com\/?p=9185"},"modified":"2022-10-15T12:19:09","modified_gmt":"2022-10-15T06:49:09","slug":"kubectl-delete-stuck-what-to-do","status":"publish","type":"post","link":"https:\/\/www.middlewareinventory.com\/blog\/kubectl-delete-stuck-what-to-do\/","title":{"rendered":"kubectl delete stuck &#8211; what to do and why this happen| Devops Junction"},"content":{"rendered":"<p>In this article, we are going to see what to do when your <code>kubectl delete<\/code> command stuck.<\/p>\n<p>When you are trying to delete Kubernetes resources such as<\/p>\n<ul>\n<li>pod<\/li>\n<li>job<\/li>\n<li>ingress<\/li>\n<li>PVC &#8211; Persistent Volume Claim<\/li>\n<li>PV &#8211; Persistent Volume<\/li>\n<\/ul>\n<p>you might notice sometimes that your <code>kubectl delete pod|job|ingress|pvc<\/code> is stuck.<\/p>\n<p>the resource would not be actually deleted. Let us learn why this happens and how to solve it.<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/10\/kubectl-delete-stuck.jpg\"><img class=\"post-img alignnone wp-image-9186 size-full\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/10\/kubectl-delete-stuck.jpg\" alt=\"kubectl delete stuck\" width=\"1748\" height=\"1240\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/10\/kubectl-delete-stuck.jpg 1748w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/10\/kubectl-delete-stuck-300x213.jpg 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/10\/kubectl-delete-stuck-1024x726.jpg 1024w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/10\/kubectl-delete-stuck-768x545.jpg 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/10\/kubectl-delete-stuck-1536x1090.jpg 1536w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/10\/kubectl-delete-stuck-400x284.jpg 400w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/10\/kubectl-delete-stuck-1080x766.jpg 1080w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/10\/kubectl-delete-stuck-90x65.jpg 90w\" sizes=\"(max-width: 1748px) 100vw, 1748px\" \/><\/a><\/p>\n<h3>What to do when your kubectl delete stuck<\/h3>\n<p class=\"p3\">When you kubectl delete command stuck, You can execute the following command and you can see your <code>kubectl delete<\/code> command\/task would be now completed ( if it was stuck at deleting)<\/p>\n<p>&nbsp;<\/p>\n<pre class=\"p1\"><span class=\"s1\">kubectl <\/span><span class=\"s2\">patch <\/span>&lt;pod|job|ingress|pvc&gt; &lt;name-of-resource&gt; \\\r\n-p '{\"metadata\":{\"finalizers\":[]}}' &#8211; type=merge<\/pre>\n<p>The preceding command is to simply patch the corresponding resource you are trying to delete and which is stuck.<\/p>\n<p>But remember this is a workaround only. To understand the underlying reason why it stuck. continue to read.<\/p>\n<p>If you are trying to delete an ingress you need to just use the following command<\/p>\n<pre>kubectl patch ingress nameofingress -p '{\"metadata\":{\"finalizers\":[]}}' &#8211; type=merge<\/pre>\n<p>If you are trying to delete a Persistent Volume Claim and it is stuck you can patch that resource like this<\/p>\n<pre>kubectl patch pvc nameofpvc -p '{\"metadata\":{\"finalizers\":[]}}' &#8211; type=merge<\/pre>\n<p>similarly, you can frame your command for other resources like Persistent Volumes and even pods.<\/p>\n<p>Now let us see why this works and what this is all about<\/p>\n<p>&nbsp;<\/p>\n<h3>How it works \/ What are we doing<\/h3>\n<p>Kubernetes has its own way of managing memory and resources so does its own Garbage Collection System.<\/p>\n<p>Unless you are new to computers and programming, you might have heard the word Garbage Collection or simply GC already<\/p>\n<p>It is a systematic way to remove unused\/unutilized space.\u00a0 Programming Languages like Java\/GO and the Servers built on them all have this process to ensure the memory is managed optimally.<\/p>\n<p>Now, Kubernetes being the modern solution, It does manage its resources and perform Garbage collections when the resources are deleted and in various other contexts too.<\/p>\n<p>Now coming back to our <code>Kubectl delete<\/code> and why we are talking about <code>Garbage Collection<\/code><\/p>\n<p>Kubernetes adds a special tag or annotation to the resource called <code>Finalizers<\/code> when it creates resources which have multiple dependencies<\/p>\n<p>This is how Kubernetes documentation defines Finalizer<\/p>\n<blockquote><p>Finalizers are namespaced keys that tell Kubernetes to wait until specific conditions are met before it fully deletes resources marked for deletion. Finalizers alert\u00a0<a class=\"glossary-tooltip\" title=\"\" href=\"https:\/\/kubernetes.io\/docs\/concepts\/architecture\/controller\/\" target=\"_blank\" rel=\"noopener noreferrer\" data-toggle=\"tooltip\" data-placement=\"top\" aria-label=\"controllers\" data-original-title=\"A control loop that watches the shared state of the cluster through the apiserver and makes changes attempting to move the current state towards the desired state.\">controllers<\/a>\u00a0to clean up resources the deleted object owned.<\/p><\/blockquote>\n<p>Simply put, Finalizers are the keys to tell Kubernetes API\u00a0 that there are few resources to be deleted or taken care of before this particular resource is deleted.<\/p>\n<p>For example. When you are trying to delete a <strong>Persistent Volume\u00a0<\/strong>the associated persistent volume claims and the pods bound to it would be affected so you must follow the proper order<\/p>\n<p>When you are trying to delete an <strong>Ingress\u00a0<\/strong>it might be associated with some infrastructure items like Load Balancers and TargetGroups which needs to be deleted first before ingress is let go.<\/p>\n<p>In case we are not deleting them in the right order. we would have lot of unused items in our infrastructure and in the Kubernetes cluster too.<\/p>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<h3>But why Finalizers now ?\u00a0 How it is related to what we did<\/h3>\n<p>If you look at the command once again you can see that we are simply patching or updating the finalizers with an empty array or list<\/p>\n<pre>-p '{\"metadata\":{\"finalizers\":[]}}' &#8211; type=merge<\/pre>\n<p>By doing this, we are simply resetting the finalizers or emptying it<\/p>\n<p>If we do that, Kubernetes API would ignore the dependencies as it is and continue with the deletion<\/p>\n<p>But of course, at the cost of leaving the dependency resource stranded,<\/p>\n<p>This should be manually cleaned up later or it would be there for a decade in your Infrastructure and you would be paying for it.<\/p>\n<p>I remember this famous meme. Hope you can relate to it.<\/p>\n<p><img class=\"\" src=\"https:\/\/pbs.twimg.com\/media\/FQLGLNLXMAQxN1j.jpg:large\" alt=\"Hutch (Sociosploit) on Twitter: &quot;No joke. I learned this lesson the hard way\u2014 don't forget to power down your AWS GPU password cracker. The P3.16xLarge runs at $17,625 for the month \ud83d\ude2c. #\" width=\"529\" height=\"522\" \/><\/p>\n<p>&nbsp;<\/p>\n<h3>What is the recommended way when your kubectl delete is stuck<\/h3>\n<p>In most cases, we run out of patience with our <code>kubectl delete<\/code>\u00a0 and go for the <code>kubectl patch<\/code>\u00a0solution we gave earlier.<\/p>\n<p>But we need to understand that it has some final clean-ups to do and it takes time.<\/p>\n<p>for example, When you delete ingress, you need to delete the target group and the load balancer etc before we can delete the ingress object on Kubernetes.<\/p>\n<p>So the <strong>first recommendation<\/strong> I can give is to wait for a while. When you really feel that it has taken a more than few minutes.<\/p>\n<p><strong>the second best recommendation <\/strong>is really simple and we do it in real life too, when things are stuck, we just have to find out why and unstuck\/clear it.<\/p>\n<p>that&#8217;s what we need to do in this context too. Find why it is taking time and check the logs of the resource to look for any clues<\/p>\n<pre>kubernetes describe &lt;pvc|pv|ingress|job&gt; name-of-the-resource<\/pre>\n<p>In most cases, you would find out why it fails from the log itself.<\/p>\n<p>If you find no errors and everything seems perfect it is still blocked.<\/p>\n<p>You know, just kill it with <code>kubectl patch<\/code>\u00a0 Life is too short to spend on a single task anyway \ud83d\ude00<\/p>\n<p>Hope this article helps<\/p>\n<p>Cheers<br \/>\nRumen Lishkov<\/p>\n<div id=\"postfollow\">\r\n<a href='https:\/\/ko-fi.com\/O4O51FG7C' target='_blank'><img height='46' style='border:0px;height:46px;width: 186px' src='https:\/\/az743702.vo.msecnd.net\/cdn\/kofi3.png?v=2' border='0' alt='Buy Me a Coffee at ko-fi.com' \/><\/a>\r\n<p>Follow us on<a href=\"http:\/\/www.facebook.com\/middlewareinventory\">Facebook<\/a> or<a href=\"http:\/\/www.twitter.com\/mwinventory\">Twitter<\/a>\r\n<\/br>\r\nFor more practical videos and tutorials. <a href=\"https:\/\/www.youtube.com\/channel\/UCRuqBFM6ioWwviNJkgOjeWw?sub_confirmation=1\">Subscribe to our channel<\/a>\r\n<\/br>\r\nFollow me on Linkedin <a href=\"https:\/\/www.linkedin.com\/comm\/mynetwork\/discovery-see-all?usecase=PEOPLE_FOLLOWS&followMember=saravakmwinventory\">My Profile<\/a>\r\n<\/br>\r\n<\/i>For any Consultation or to hire us <a href=\"mailto:rumenlishkoff@gmail.com\"> rumenlishkoff@gmail.com<\/a>\r\n<\/br>\r\nIf you like this article. Show your Support! <a href=\"https:\/\/ko-fi.com\/middlewareinventory\">Buy me a Coffee.<\/a>\r\n<\/br>\r\n<\/p>\r\n<p style=\"color: palevioletred !important;\">Signup for Exclusive \"Subscriber-only\" Content<\/p>\r\n\n\t\t<div class=\"emaillist\">\n\t\t\t<form action=\"#\" method=\"post\" class=\"es_subscription_form es_shortcode_form\" id=\"es_subscription_form_1670577176\" data-source=\"ig-es\">\n\t\t\t\t\t\t\t\t<div class=\"es-field-wrap\"><label>Name*<br \/><input type=\"text\" name=\"name\" class=\"ig_es_form_field_name\" placeholder=\"\" value=\"\" required=\"required\" \/><\/label><\/div><div class=\"es-field-wrap\"><label>Email*<br \/><input class=\"es_required_field es_txt_email ig_es_form_field_email\" type=\"email\" name=\"email\" value=\"\" placeholder=\"\" required=\"required\" \/><\/label><\/div><input type=\"hidden\" name=\"lists[]\" value=\"1\" \/><input type=\"hidden\" name=\"form_id\" value=\"3\" \/>\n\t\t\t\t<input type=\"hidden\" name=\"es_email_page\" value=\"9185\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"es_email_page_url\" value=\"https:\/\/www.middlewareinventory.com\/blog\/kubectl-delete-stuck-what-to-do\/\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"status\" value=\"Unconfirmed\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"es-subscribe\" id=\"es-subscribe\" value=\"7aebfb1a9b\"\/>\n\t\t\t\t<label style=\"position:absolute;top:-99999px;left:-99999px;z-index:-99;\"><input type=\"email\" name=\"es_hp_email\" class=\"es_required_field\" tabindex=\"-1\" autocomplete=\"-1\" value=\"\"\/><\/label>\n\t\t\t\t\t\t\t\t<input type=\"submit\" name=\"submit\" class=\"es_subscription_form_submit es_submit_button es_textbox_button\" id=\"es_subscription_form_submit_1670577176\" value=\"Subscribe\"\/>\n\n\t\t\t\t\n\t\t\t\t<span class=\"es_spinner_image\" id=\"spinner-image\"><img src=\"https:\/\/www.middlewareinventory.com\/wp-content\/plugins\/email-subscribers\/lite\/public\/images\/spinner.gif\" alt=\"Loading\"\/><\/span>\n\n\t\t\t<\/form>\n\n\t\t\t<span class=\"es_subscription_message\" id=\"es_subscription_message_1670577176\"><\/span>\n\t\t<\/div>\n\n\t\t\r\n<\/div>\r\n<hr>\n","protected":false},"excerpt":{"rendered":"<p>In this article, we are going to see what to do when your kubectl delete command stuck. When you are trying to delete Kubernetes resources such as pod job ingress PVC &#8211; Persistent Volume Claim PV &#8211; Persistent Volume you might notice sometimes that your kubectl delete pod|job|ingress|pvc is stuck.[&#8230;]<\/p>\n","protected":false},"author":1,"featured_media":9186,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"_et_pb_use_builder":"","_et_pb_old_content":"","_et_gb_content_width":""},"categories":[151],"tags":[],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v14.9 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>kubectl delete stuck - what to do and why this happen| Devops Junction<\/title>\n<meta name=\"description\" content=\"kubectl delete stuck - what to do and why it happens and how to solve it. Kubectl patch finalizers to unstuck kubectl delete command. Ingress, PVC, PV, Pod and Job for all resources.\" \/>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/www.middlewareinventory.com\/blog\/kubectl-delete-stuck-what-to-do\/\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"kubectl delete stuck - what to do and why this happen| Devops Junction\" \/>\n<meta property=\"og:description\" content=\"kubectl delete stuck - what to do and why it happens and how to solve it. Kubectl patch finalizers to unstuck kubectl delete command. Ingress, PVC, PV, Pod and Job for all resources.\" \/>\n<meta property=\"og:url\" content=\"https:\/\/www.middlewareinventory.com\/blog\/kubectl-delete-stuck-what-to-do\/\" \/>\n<meta property=\"og:site_name\" content=\"Middleware Inventory\" \/>\n<meta property=\"article:publisher\" content=\"http:\/\/www.facebook.com\/devopsjunc\" \/>\n<meta property=\"article:published_time\" content=\"2022-10-14T20:14:07+00:00\" \/>\n<meta property=\"article:modified_time\" content=\"2022-10-15T06:49:09+00:00\" \/>\n<meta property=\"og:image\" content=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/10\/kubectl-delete-stuck.jpg\" \/>\n\t<meta property=\"og:image:width\" content=\"1748\" \/>\n\t<meta property=\"og:image:height\" content=\"1240\" \/>\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\n<meta name=\"twitter:creator\" content=\"@mwinventory\" \/>\n<meta name=\"twitter:site\" content=\"@mwinventory\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"Organization\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\",\"name\":\"Middleware Inventory\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"sameAs\":[\"http:\/\/www.facebook.com\/devopsjunc\",\"https:\/\/www.youtube.com\/channel\/UCRuqBFM6ioWwviNJkgOjeWw\",\"https:\/\/twitter.com\/mwinventory\"],\"logo\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/09\/Screenshot-2020-09-18-at-3.49.40-AM.jpg\",\"width\":300,\"height\":107,\"caption\":\"Middleware Inventory\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\"}},{\"@type\":\"WebSite\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"name\":\"Devops Junction\",\"description\":\"An inventory of [i]nformation, Middleware and much more.\",\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":\"https:\/\/www.middlewareinventory.com\/?s={search_term_string}\",\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/kubectl-delete-stuck-what-to-do\/#primaryimage\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/10\/kubectl-delete-stuck.jpg\",\"width\":1748,\"height\":1240,\"caption\":\"kubectl delete stuck\"},{\"@type\":\"WebPage\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/kubectl-delete-stuck-what-to-do\/#webpage\",\"url\":\"https:\/\/www.middlewareinventory.com\/blog\/kubectl-delete-stuck-what-to-do\/\",\"name\":\"kubectl delete stuck - what to do and why this happen| Devops Junction\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\"},\"primaryImageOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/kubectl-delete-stuck-what-to-do\/#primaryimage\"},\"datePublished\":\"2022-10-14T20:14:07+00:00\",\"dateModified\":\"2022-10-15T06:49:09+00:00\",\"description\":\"kubectl delete stuck - what to do and why it happens and how to solve it. Kubectl patch finalizers to unstuck kubectl delete command. Ingress, PVC, PV, Pod and Job for all resources.\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/www.middlewareinventory.com\/blog\/kubectl-delete-stuck-what-to-do\/\"]}]},{\"@type\":\"Article\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/kubectl-delete-stuck-what-to-do\/#article\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/kubectl-delete-stuck-what-to-do\/#webpage\"},\"author\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\"},\"headline\":\"kubectl delete stuck &#8211; what to do and why this happen| Devops Junction\",\"datePublished\":\"2022-10-14T20:14:07+00:00\",\"dateModified\":\"2022-10-15T06:49:09+00:00\",\"mainEntityOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/kubectl-delete-stuck-what-to-do\/#webpage\"},\"commentCount\":0,\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/kubectl-delete-stuck-what-to-do\/#primaryimage\"},\"articleSection\":\"Kubernetes\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"CommentAction\",\"name\":\"Comment\",\"target\":[\"https:\/\/www.middlewareinventory.com\/blog\/kubectl-delete-stuck-what-to-do\/#respond\"]}]},{\"@type\":\"Person\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\",\"name\":\"Rumen Lishkov\",\"image\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#personlogo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/secure.gravatar.com\/avatar\/c22e4a54d67750291a9892531f94ffb3?s=96&d=mm&r=g\",\"caption\":\"Rumen Lishkov\"}}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","_links":{"self":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/9185"}],"collection":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/comments?post=9185"}],"version-history":[{"count":4,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/9185\/revisions"}],"predecessor-version":[{"id":9195,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/9185\/revisions\/9195"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media\/9186"}],"wp:attachment":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media?parent=9185"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/categories?post=9185"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/tags?post=9185"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}