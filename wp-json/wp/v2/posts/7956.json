{"id":7956,"date":"2022-01-15T20:28:49","date_gmt":"2022-01-15T14:58:49","guid":{"rendered":"https:\/\/www.middlewareinventory.com\/?p=7956"},"modified":"2022-01-18T00:31:57","modified_gmt":"2022-01-17T19:01:57","slug":"ansible-copy-examples","status":"publish","type":"post","link":"https:\/\/www.middlewareinventory.com\/blog\/ansible-copy-examples\/","title":{"rendered":"Ansible Copy Examples &#8211; How to copy files and directories with Ansible"},"content":{"rendered":"<p>In this article, we are going to see practical examples of Ansible copy. We will be seeing various examples of ansible copy<\/p>\n<p>To keep things simple we have created the playbook that you can test in your <code>localhost<\/code> itself, In other words, ansible control machine<\/p>\n<p>you can change the hosts variable to a valid remote host group if you would like to try on the remote machines.<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/01\/AnsibleCopy.jpg\"><img class=\"alignnone size-full wp-image-7971\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/01\/AnsibleCopy.jpg\" alt=\"Ansible Copy\" width=\"1748\" height=\"1240\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/01\/AnsibleCopy.jpg 1748w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/01\/AnsibleCopy-300x213.jpg 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/01\/AnsibleCopy-1024x726.jpg 1024w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/01\/AnsibleCopy-768x545.jpg 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/01\/AnsibleCopy-1536x1090.jpg 1536w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/01\/AnsibleCopy-90x65.jpg 90w\" sizes=\"(max-width: 1748px) 100vw, 1748px\" \/><\/a><\/p>\n<h2>Ansible Copy Module<\/h2>\n<p>The\u00a0<code>copy<\/code> module executes a simple copy on the file or directory on the local or on the remote machine.<\/p>\n<p>You can use an ansible copy for the following requirements<\/p>\n<ul>\n<li>To copy files from a local source to a local destination<\/li>\n<li>To copy files from a remote source to a remote destination (remote_src)<\/li>\n<li>To copy files from a local source to a remote destination<\/li>\n<\/ul>\n<p>You can use the <code>fetch<\/code> module to copy files from the remote source to local on the other hand.<\/p>\n<p>We will be seeing various examples of Ansible copy in this article. we have <a href=\"https:\/\/www.middlewareinventory.com\/blog\/ansible-copy-file-or-directory-local-to-remote\/\">one more article on Ansible copy<\/a> for you to read and explore.<\/p>\n<h1><\/h1>\n<h2>Quick Syntax of Ansible Copy<\/h2>\n<p>&nbsp;<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"yaml\" data-enlighter-theme=\"bootstrap4\" data-enlighter-linenumbers=\"false\"># copy_file.yml\r\n\r\n- name: copy files to destination\r\n  hosts: localhost\r\n  connection: local\r\n  tasks:\r\n    - name: copy src.txt as dest.txt in the same dir \r\n      copy:\r\n        src: files\/src.txt\r\n        dest: files\/dest.txt\r\n      tags:\r\n        - simple_copy<\/pre>\n<p>&nbsp;<\/p>\n<p>The preceding playbook consists of a single play. The assumptions to execute the above playbook are,<\/p>\n<ol>\n<li>There exists a <code>files<\/code> directory in the same location as the playbook<\/li>\n<li>There exists a file <code>src.txt<\/code> inside the above <code>files<\/code> directory.<\/li>\n<\/ol>\n<p>The play consists of a task that uses the copy module to copy the \u201csrc\u201d to its \u201cdest\u201d.<\/p>\n<p>By default, the ansible copy module <strong>does a force copy<\/strong> to the destination and overwrites the existing file when present.<\/p>\n<p>Just copy the above playbook and run it in <a href=\"http:\/\/localhost\">localhost<\/a> by following the below commands in order<\/p>\n<pre>sseshadr@SSESHADR-M-24FK copy_module % mkdir -p files\r\nsseshadr@SSESHADR-M-24FK copy_module % echo \"adding a new line to files\/src.txt\" &gt;&gt; files\/src.txt \r\nsseshadr@SSESHADR-M-24FK copy_module % \r\nsseshadr@SSESHADR-M-24FK copy_module % ansible-playbook copy_file.yml &#8211; tags \"simple_copy\" -v    \r\nNo config file found; using defaults\r\n[WARNING]: No inventory was parsed, only implicit localhost is available\r\n[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match 'all'\r\n\r\nPLAY [copy files to destination] *****************************************************************************************************************\r\n\r\nTASK [Gathering Facts] ***************************************************************************************************************************\r\nok: [localhost]\r\n\r\nTASK [force copy src.txt as dest.txt in the same dir] ********************************************************************************************\r\nchanged: [localhost] =&gt; {\"changed\": true, \"checksum\": \"f292ebaaaa1651f4875e13ea6346b48b9f817421\", \"dest\": \"files\/dest.txt\", \"gid\": 20, \"group\": \"staff\", \"md5sum\": \"85cfe9b0250baed542831184c0a4c4d5\", \"mode\": \"0644\", \"owner\": \"sseshadr\", \"size\": 65, \"src\": \"\/Users\/sseshadr\/.ansible\/tmp\/ansible-tmp-1641913099.0320861-74874-262311856787358\/source\", \"state\": \"file\", \"uid\": 501}\r\n\r\nPLAY RECAP ***************************************************************************************************************************************\r\nlocalhost                  : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \r\n\r\nsseshadr@SSESHADR-M-24FK copy_module % ls -l files\/dest.txt \r\n-rw-r--r &#8211;  1 sseshadr  staff  65 Jan 11 20:28 files\/dest.txt\r\n<\/pre>\n<p>The file src.txt was copied successfully as \u201cfiles\/dest.txt\u201d as we can see from the output of the copy task, <code>changed: true<\/code><\/p>\n<p>&nbsp;<\/p>\n<h2>How to disable Force Copy of Ansible Copy<\/h2>\n<p>If the force copy has to be disabled, i.e., ignore the copy task if the file is already present, then use the option <code>force: no<\/code> in the copy-module as shown below.<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"yaml\" data-enlighter-theme=\"bootstrap4\" data-enlighter-linenumbers=\"false\"># copy_file.yml\r\n\r\n- name: copy files to destination\r\n  hosts: localhost\r\n  connection: local\r\n  tasks:\r\n    - name: no force copy src.txt as dest.txt in the same dir \r\n      copy:\r\n        src: files\/src.txt\r\n        dest: files\/dest.txt\r\n        force: no\r\n      tags:\r\n        - simple_copy_no_force<code class=\"language-yaml\">\r\n<\/code><\/pre>\n<p>&nbsp;<\/p>\n<p>The output of the preceding playbook is given below<\/p>\n<pre>sseshadr@SSESHADR-M-24FK copy_module % ls -l files\/dest.txt \r\n-rw-r--r &#8211;  1 sseshadr  staff  65 Jan 11 20:28 files\/dest.txt\r\nsseshadr@SSESHADR-M-24FK copy_module % \r\nsseshadr@SSESHADR-M-24FK copy_module % date\r\nTue Jan 11 20:35:31 IST 2022\r\nsseshadr@SSESHADR-M-24FK copy_module % \r\nsseshadr@SSESHADR-M-24FK copy_module % ansible-playbook copy_file.yml &#8211; tags \"simple_copy_no_force\" -v\r\nNo config file found; using defaults\r\n[WARNING]: No inventory was parsed, only implicit localhost is available\r\n[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match 'all'\r\n\r\nPLAY [copy files to destination] *****************************************************************************************************************\r\n\r\nTASK [Gathering Facts] ***************************************************************************************************************************\r\nok: [localhost]\r\n\r\nTASK [dont force copy src.txt as dest.txt in the same dir] ***************************************************************************************\r\nok: [localhost] =&gt; {\"changed\": false, \"dest\": \"files\/dest.txt\", \"src\": \"\/Users\/sseshadr\/ansible-test\/module_test\/copy_module\/files\/src.txt\"}\r\n\r\nPLAY RECAP ***************************************************************************************************************************************\r\nlocalhost                  : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \r\n\r\nsseshadr@SSESHADR-M-24FK copy_module % \r\nsseshadr@SSESHADR-M-24FK copy_module % ls -l files\/dest.txt                                           \r\n-rw-r--r &#8211;  1 sseshadr  staff  65 Jan 11 20:28 files\/dest.txt\r\n<\/pre>\n<p>We can see that the last modified time of the dest.txt is unchanged and the file was not overwritten by src.txt even though it had a new line since we had disabled force copy in our playbook.<\/p>\n<h1><\/h1>\n<h2>Overwrite and backup the original file<\/h2>\n<p>What if the copied file contains a few mistakes but the copy module had overwritten the previous version? No worries, we have the option in the ansible copy module to take a backup of the previous version of the destination file. So it&#8217;s now easy to revert the copy.<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"yaml\" data-enlighter-theme=\"bootstrap4\" data-enlighter-linenumbers=\"false\"># copy_file.yml\r\n\r\n- name: copy files to destination\r\n  hosts: localhost\r\n  connection: local\r\n  tasks:\r\n    - name: copy src.txt to files\/backup_test and create a backup of src.txt\r\n      copy:\r\n        src: files\/src.txt\r\n        dest: files\/backup_test\/\r\n        backup: yes \r\n      tags:\r\n        - backup<\/pre>\n<p>&nbsp;<\/p>\n<p>In this example, we would be copying <code>files\/src.txt<\/code> to <code>files\/backup_test<\/code> directory.<\/p>\n<p>The destination filename would also be <code>src.txt<\/code>.<\/p>\n<p>To demonstrate this example, the copy was already run once and we would be re-running the same play by adding an extra line to the source file. Only then we would be getting a backup of the original destination file.<\/p>\n<pre>sseshadr@SSESHADR-M-24FK copy_module % echo \"creating a new line in src.txt\" &gt;&gt; files\/src.txt\r\nsseshadr@SSESHADR-M-24FK copy_module %                                                       \r\nsseshadr@SSESHADR-M-24FK copy_module % ansible-playbook copy_file.yml &#8211; tags \"backup\" -v     \r\nNo config file found; using defaults\r\n[WARNING]: No inventory was parsed, only implicit localhost is available\r\n[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match 'all'\r\n\r\nPLAY [copy files to destination] *****************************************************************************************************************\r\n\r\nTASK [Gathering Facts] ***************************************************************************************************************************\r\nok: [localhost]\r\n\r\nTASK [copy src.txt to files\/backup_test and create a backup of src.txt] **************************************************************************\r\nchanged: [localhost] =&gt; {\"backup_file\": \"files\/backup_test\/src.txt.77306.2022-01-11@20:45:03~\", \"changed\": true, \"checksum\": \"e2a8f9574b6e1b7e39a0c8abdff02b7edc076d28\", \"dest\": \"files\/backup_test\/src.txt\", \"gid\": 20, \"group\": \"staff\", \"md5sum\": \"5a4cf003863bec14f92c132143e6d217\", \"mode\": \"0644\", \"owner\": \"sseshadr\", \"size\": 242, \"src\": \"\/Users\/sseshadr\/.ansible\/tmp\/ansible-tmp-1641914102.470293-77281-75182788946002\/source\", \"state\": \"file\", \"uid\": 501}\r\n\r\nPLAY RECAP ***************************************************************************************************************************************\r\nlocalhost                  : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \r\n\r\nsseshadr@SSESHADR-M-24FK copy_module % ls -l files\/backup_test                               \r\ntotal 16\r\n-rw-r--r &#8211;  1 sseshadr  staff  242 Jan 11 20:45 src.txt\r\n-rw-r--r &#8211;  1 sseshadr  staff  211 Jan 11 20:44 src.txt.77306.2022-01-11@20:45:03~\r\n<\/pre>\n<p>As we can see the latest files\/src.txt got copied as files\/backup_test\/src.txt and a backup of the previous version was also created as \u201csrc.txt.77306.2022-01-11@20:45:03~\u201d. We can use this file to revert back to the previous version if something nasty happened due to the copy.<\/p>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<h2>Copying file to a non-existing directory<\/h2>\n<p>If the destination directory does not exist, the <code>copy<\/code> module takes care of creating it and copying the file to the new directory with the same name as the source file name.<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"yaml\" data-enlighter-theme=\"bootstrap4\"># copy_file.yml\r\n\r\n- name: copy files to destination\r\n  hosts: localhost\r\n  connection: local\r\n  tasks:\r\n    - name: copy src.txt to a non existing directory\r\n      copy:\r\n        src: files\/src.txt\r\n        dest: files\/not_dir\/\r\n      tags:\r\n        - dir_not_exist<\/pre>\n<p>Output of the preceding playbook is given below.<\/p>\n<pre>sseshadr@SSESHADR-M-24FK copy_module % ls files\/not_dir\r\nls: files\/not_dir: No such file or directory\r\nsseshadr@SSESHADR-M-24FK copy_module % ansible-playbook copy_file.yml &#8211; tags \"dir_not_exist\" -v \r\nNo config file found; using defaults\r\n[WARNING]: No inventory was parsed, only implicit localhost is available\r\n[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match 'all'\r\n\r\nPLAY [copy files to destination] *****************************************************************************************************************\r\n\r\nTASK [Gathering Facts] ***************************************************************************************************************************\r\nok: [localhost]\r\n\r\nTASK [copy src.txt to a non existing directory] **************************************************************************************************\r\nchanged: [localhost] =&gt; {\"changed\": true, \"checksum\": \"e2a8f9574b6e1b7e39a0c8abdff02b7edc076d28\", \"dest\": \"files\/not_dir\/src.txt\", \"gid\": 20, \"group\": \"staff\", \"md5sum\": \"5a4cf003863bec14f92c132143e6d217\", \"mode\": \"0644\", \"owner\": \"sseshadr\", \"size\": 242, \"src\": \"\/Users\/sseshadr\/.ansible\/tmp\/ansible-tmp-1641915480.656468-80209-40624732707130\/source\", \"state\": \"file\", \"uid\": 501}\r\n\r\nPLAY RECAP ***************************************************************************************************************************************\r\nlocalhost                  : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \r\n\r\nsseshadr@SSESHADR-M-24FK copy_module % ls files\/not_dir \r\nsrc.txt\r\n<\/pre>\n<h1><\/h1>\n<h2>Copy entire directory<\/h2>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"yaml\" data-enlighter-theme=\"bootstrap4\" data-enlighter-linenumbers=\"false\"># copy_dir.yml\r\n\r\n- name: copy module for directories\r\n  hosts: localhost\r\n  connection: local\r\n  tasks:\r\n    - name: copy dir1 to \/tmp\r\n      copy:\r\n        src: dir1\r\n        dest: \/tmp\/\r\n        directory_mode:\r\n      tags:\r\n        - parentdir<\/pre>\n<p>&nbsp;<\/p>\n<p>The preceding play assumes that there is a directory <code>dir1<\/code> in the same location as the playbook. On running the above play, the entire directory <code>dir1<\/code> and its contents will be recursively copied to the destination <code>\/tmp<\/code> as <code>\/tmp\/dir1<\/code><\/p>\n<pre>sseshadr@SSESHADR-M-24FK copy_module % mkdir dir1 &amp;&amp; mkdir -p dir1\/inner_dir1 &amp;&amp; touch dir1\/outer_file &amp;&amp; touch dir1\/inner_dir1\/inner_file\r\n\r\nsseshadr@SSESHADR-M-24FK copy_module % ls -Rl dir1 \r\ntotal 0\r\ndrwxr-xr-x  3 sseshadr  staff  96 Jan 11 21:14 inner_dir1\r\n-rw-r--r &#8211;  1 sseshadr  staff   0 Jan 11 21:14 outer_file\r\n\r\ndir1\/inner_dir1:\r\ntotal 0\r\n-rw-r--r &#8211;  1 sseshadr  staff  0 Jan 11 21:14 inner_file\r\n\r\nsseshadr@SSESHADR-M-24FK copy_module % ansible-playbook copy_dir.yml &#8211; tags \"parentdir\" -v\r\nNo config file found; using defaults\r\n[WARNING]: No inventory was parsed, only implicit localhost is available\r\n[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match 'all'\r\n\r\nPLAY [copy module for directories] ***************************************************************************************************************\r\n\r\nTASK [Gathering Facts] ***************************************************************************************************************************\r\nok: [localhost]\r\n\r\nTASK [copy dir1 to \/tmp] *************************************************************************************************************************\r\nchanged: [localhost] =&gt; {\"changed\": true, \"dest\": \"\/tmp\/\", \"src\": \"\/Users\/sseshadr\/ansible-test\/module_test\/copy_module\/dir1\"}\r\n\r\nPLAY RECAP ***************************************************************************************************************************************\r\nlocalhost                  : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \r\n\r\nsseshadr@SSESHADR-M-24FK copy_module % ls -Rl \/tmp\/dir1 \r\ntotal 0\r\ndrwxr-xr-x  3 sseshadr  wheel  96 Jan 11 21:14 inner_dir1\r\n-rw-r--r &#8211;  1 sseshadr  staff   0 Jan 11 21:14 outer_file\r\n\r\n\/tmp\/dir1\/inner_dir1:\r\ntotal 0\r\n-rw-r--r &#8211;  1 sseshadr  staff  0 Jan 11 21:14 inner_file\r\n<\/pre>\n<p>As we can see from the above output, the entire directory was copied recursively to the destination.<\/p>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<h2>Ansible Copy only directory contents<\/h2>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\">- name: copy module for directories\r\n  hosts: localhost\r\n  connection: local\r\n  tasks:    \r\n    - name: copy contents of dir1 to \/tmp\/dir1_contents\r\n      copy:\r\n        src: dir1\/\r\n        dest: \/tmp\/dir1_contents\/\r\n        directory_mode:\r\n      tags:\r\n        - dircontent<\/pre>\n<p>&nbsp;<\/p>\n<p>If only the contents of the directory need to be copied leaving out the outer directory, then src should end with a forward slash <code>\/<\/code> which represents the contents of the src directory (in our case, contents of dir1)<\/p>\n<pre>sseshadr@SSESHADR-M-24FK copy_module % ansible-playbook copy_dir.yml &#8211; tags \"dircontent\" -v \r\nNo config file found; using defaults\r\n[WARNING]: No inventory was parsed, only implicit localhost is available\r\n[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match 'all'\r\n\r\nPLAY [copy module for directories] ***************************************************************************************************************\r\n\r\nTASK [Gathering Facts] ***************************************************************************************************************************\r\nok: [localhost]\r\n\r\nTASK [copy contents of dir1 to \/tmp\/dir1_contents] ***********************************************************************************************\r\nchanged: [localhost] =&gt; {\"changed\": true, \"dest\": \"\/tmp\/dir1_contents\/\", \"src\": \"\/Users\/sseshadr\/ansible-test\/module_test\/copy_module\/dir1\/\"}\r\n\r\nPLAY RECAP ***************************************************************************************************************************************\r\nlocalhost                  : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \r\n\r\nsseshadr@SSESHADR-M-24FK copy_module % ls -Rl \/tmp\/dir1_contents \r\ntotal 0\r\ndrwxr-xr-x  3 sseshadr  wheel  96 Jan 11 21:20 inner_dir1\r\n-rw-r--r &#8211;  1 sseshadr  staff   0 Jan 11 21:20 outer_file\r\n\r\n\/tmp\/dir1_contents\/inner_dir1:\r\ntotal 0\r\n-rw-r--r &#8211;  1 sseshadr  staff  0 Jan 11 21:20 inner_file\r\n<\/pre>\n<p>We can see that the outer directory <code>dir1<\/code> was left and only its contents were copied to <code>\/tmp\/dir1_contents<\/code><\/p>\n<h1><\/h1>\n<h2>Ansible Copy raw content to file<\/h2>\n<p>Not just files, ansible copy module can also write content to a destination file.<\/p>\n<p>This feature of the ansible copy module is very useful if we want to dump some string content or \u201cAnsible variables\u201d into a file (say a dict).<\/p>\n<p>Instead of the <code>src<\/code> option, we have to use the <code>content<\/code> argument and pass the necessary content to be written as the destination file.<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"yaml\" data-enlighter-theme=\"bootstrap4\">#copy_file.yml\r\n\r\n- name: copy files to destination\r\n  hosts: localhost\r\n  connection: local\r\n  vars:\r\n    somedict:\r\n      key1: value1\r\n      key2: value2\r\n  tasks:\r\n    - name: copy content to content_dest.txt\r\n      copy:\r\n        content: |\r\n          Hello from ansible.\r\n          This is a sample file.\r\n          This is a sample dict,\r\n          {{ somedict }}\r\n        dest: files\/content_dest.txt\r\n      tags:\r\n        - content<\/pre>\n<p>&nbsp;<\/p>\n<pre>sseshadr@SSESHADR-M-24FK copy_module % ansible-playbook copy_file.yml &#8211; tags \"content\" -v \r\nNo config file found; using defaults\r\n[WARNING]: No inventory was parsed, only implicit localhost is available\r\n[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match 'all'\r\n\r\nPLAY [copy files to destination] *****************************************************************************************************************\r\n\r\nTASK [Gathering Facts] ***************************************************************************************************************************\r\nok: [localhost]\r\n\r\nTASK [copy content to content_dest.txt] **********************************************************************************************************\r\nchanged: [localhost] =&gt; {\"changed\": true, \"checksum\": \"783f59cb4d9068edf70494178913ff64426d2bea\", \"dest\": \"files\/content_dest.txt\", \"gid\": 20, \"group\": \"staff\", \"md5sum\": \"fb94495fdebe48ba727186eddc14d5af\", \"mode\": \"0644\", \"owner\": \"sseshadr\", \"size\": 103, \"src\": \"\/Users\/sseshadr\/.ansible\/tmp\/ansible-tmp-1641916547.4278688-82599-191762476043983\/source\", \"state\": \"file\", \"uid\": 501}\r\n\r\nPLAY RECAP ***************************************************************************************************************************************\r\nlocalhost                  : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \r\n\r\nsseshadr@SSESHADR-M-24FK copy_module % cat files\/content_dest.txt \r\nHello from ansible.\r\nThis is a sample file.\r\nThis is a sample dict,\r\n{'key1': 'value1', 'key2': 'value2'}\r\n<\/pre>\n<h1><\/h1>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<h2>How to Verify if the copy is successful<\/h2>\n<p>So far we have trusted the copy-module to have successfully copied our source file to the destination.<\/p>\n<p>What if we would like to know if the copy was TRULY successful indeed. Normally calculating the checksum of a file is a good technique to verify if two files are identical and there is no loss or corruption of data during the copy.<\/p>\n<p>So we will look into the ways to verify the result of the copy-module by comparing the checksums of the source and destination file.<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"yaml\" data-enlighter-theme=\"bootstrap4\">- name: copy files to destination\r\n  hosts: localhost\r\n  connection: local\r\n  tasks:\r\n    - block:\r\n      - name: get properties of src.txt\r\n        stat:\r\n          path: files\/src.txt\r\n          checksum_algorithm: sha1\r\n        register: src_info\r\n\r\n      - name: copy src.txt to dest.txt\r\n        copy:\r\n          src: files\/src.txt\r\n          dest: files\/dest.txt\r\n          force: yes\r\n          checksum:\r\n        register: copy_out\r\n\r\n      - name: Fail if copy was a failure\r\n        fail:\r\n          msg: \"Copy failed!\"\r\n        when: src_info.stat.checksum != copy_out.checksum\r\n\r\n      - name: Print Copy successful\r\n        debug:\r\n          msg: \"Copy Successful!\"\r\n\r\n      tags:\r\n        - checksum<\/pre>\n<p>&nbsp;<\/p>\n<p>The <code>stat<\/code> module can be used to find the initial checksum of the source file before copying. After copying, the copy-module itself returns a dict that contains the checksum of the destination file (SHA1 checksum).<\/p>\n<p>Since the copy-module returns a \u201cSHA1 checksum\u201d, we can also calculate the \u201cSHA1 checksum\u201d of the source file by passing it as an argument to the stat module.<\/p>\n<p>In the end, both the checksum values are compared to see if they are equal.<\/p>\n<pre>sseshadr@SSESHADR-M-24FK copy_module % ansible-playbook copy_file.yml &#8211; tags \"checksum\" -v\r\nNo config file found; using defaults\r\n[WARNING]: No inventory was parsed, only implicit localhost is available\r\n[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match 'all'\r\n\r\nPLAY [copy files to destination] *****************************************************************************************************************\r\n\r\nTASK [Gathering Facts] ***************************************************************************************************************************\r\nok: [localhost]\r\n\r\nTASK [get properties of src.txt] *****************************************************************************************************************\r\nok: [localhost] =&gt; {\"changed\": false, \"stat\": {\"atime\": 1641914093.9985154, \"attr_flags\": \"\", \"attributes\": [], \"birthtime\": 1641913076.4996405, \"block_size\": 4096, \"blocks\": 8, \"charset\": \"us-ascii\", \"checksum\": \"e2a8f9574b6e1b7e39a0c8abdff02b7edc076d28\", \"ctime\": 1641914092.7721033, \"dev\": 16777220, \"device_type\": 0, \"executable\": false, \"exists\": true, \"flags\": 0, \"generation\": 0, \"gid\": 20, \"gr_name\": \"staff\", \"inode\": 13512847, \"isblk\": false, \"ischr\": false, \"isdir\": false, \"isfifo\": false, \"isgid\": false, \"islnk\": false, \"isreg\": true, \"issock\": false, \"isuid\": false, \"mimetype\": \"text\/plain\", \"mode\": \"0644\", \"mtime\": 1641914092.7721033, \"nlink\": 1, \"path\": \"files\/src.txt\", \"pw_name\": \"sseshadr\", \"readable\": true, \"rgrp\": true, \"roth\": true, \"rusr\": true, \"size\": 242, \"uid\": 501, \"version\": null, \"wgrp\": false, \"woth\": false, \"writeable\": true, \"wusr\": true, \"xgrp\": false, \"xoth\": false, \"xusr\": false}}\r\n\r\nTASK [copy src.txt to dest.txt] ******************************************************************************************************************\r\nok: [localhost] =&gt; {\"changed\": false, \"checksum\": \"e2a8f9574b6e1b7e39a0c8abdff02b7edc076d28\", \"dest\": \"files\/dest.txt\", \"gid\": 20, \"group\": \"staff\", \"mode\": \"0644\", \"owner\": \"sseshadr\", \"path\": \"files\/dest.txt\", \"size\": 242, \"state\": \"file\", \"uid\": 501}\r\n\r\nTASK [Fail if copy was a failure] ****************************************************************************************************************\r\nskipping: [localhost] =&gt; {\"changed\": false, \"skip_reason\": \"Conditional result was False\"}\r\n\r\nTASK [Print Copy successful] *********************************************************************************************************************\r\nok: [localhost] =&gt; {\r\n    \"msg\": \"Copy Successful!\"\r\n}\r\n\r\nPLAY RECAP ***************************************************************************************************************************************\r\nlocalhost                  : ok=4    changed=0    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0\r\n<\/pre>\n<p>The copy was successful as the checksums values are the same before and after copy!<\/p>\n<p>Cheers<br \/>\nSudarshan Seshadri<\/p>\n","protected":false},"excerpt":{"rendered":"<p>In this article, we are going to see practical examples of Ansible copy. We will be seeing various examples of ansible copy To keep things simple we have created the playbook that you can test in your localhost itself, In other words, ansible control machine you can change the hosts[&#8230;]<\/p>\n","protected":false},"author":1,"featured_media":7971,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"_et_pb_use_builder":"","_et_pb_old_content":"","_et_gb_content_width":""},"categories":[98],"tags":[],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v14.9 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>Ansible Copy Examples - How to copy files and directories with Ansible<\/title>\n<meta name=\"description\" content=\"Ansible Copy module examples. Use cases of the Ansible Copy module. How to use copy files and directories with Ansible. Ansible remote_src example\" \/>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/www.middlewareinventory.com\/blog\/ansible-copy-examples\/\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"Ansible Copy Examples - How to copy files and directories with Ansible\" \/>\n<meta property=\"og:description\" content=\"Ansible Copy module examples. Use cases of the Ansible Copy module. How to use copy files and directories with Ansible. Ansible remote_src example\" \/>\n<meta property=\"og:url\" content=\"https:\/\/www.middlewareinventory.com\/blog\/ansible-copy-examples\/\" \/>\n<meta property=\"og:site_name\" content=\"Middleware Inventory\" \/>\n<meta property=\"article:publisher\" content=\"http:\/\/www.facebook.com\/devopsjunc\" \/>\n<meta property=\"article:published_time\" content=\"2022-01-15T14:58:49+00:00\" \/>\n<meta property=\"article:modified_time\" content=\"2022-01-17T19:01:57+00:00\" \/>\n<meta property=\"og:image\" content=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/01\/AnsibleCopy.jpg\" \/>\n\t<meta property=\"og:image:width\" content=\"1748\" \/>\n\t<meta property=\"og:image:height\" content=\"1240\" \/>\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\n<meta name=\"twitter:creator\" content=\"@mwinventory\" \/>\n<meta name=\"twitter:site\" content=\"@mwinventory\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"Organization\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\",\"name\":\"Middleware Inventory\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"sameAs\":[\"http:\/\/www.facebook.com\/devopsjunc\",\"https:\/\/www.youtube.com\/channel\/UCRuqBFM6ioWwviNJkgOjeWw\",\"https:\/\/twitter.com\/mwinventory\"],\"logo\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/09\/Screenshot-2020-09-18-at-3.49.40-AM.jpg\",\"width\":300,\"height\":107,\"caption\":\"Middleware Inventory\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\"}},{\"@type\":\"WebSite\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"name\":\"Devops Junction\",\"description\":\"An inventory of [i]nformation, Middleware and much more.\",\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":\"https:\/\/www.middlewareinventory.com\/?s={search_term_string}\",\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-copy-examples\/#primaryimage\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/01\/AnsibleCopy.jpg\",\"width\":1748,\"height\":1240,\"caption\":\"Ansible Copy\"},{\"@type\":\"WebPage\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-copy-examples\/#webpage\",\"url\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-copy-examples\/\",\"name\":\"Ansible Copy Examples - How to copy files and directories with Ansible\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\"},\"primaryImageOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-copy-examples\/#primaryimage\"},\"datePublished\":\"2022-01-15T14:58:49+00:00\",\"dateModified\":\"2022-01-17T19:01:57+00:00\",\"description\":\"Ansible Copy module examples. Use cases of the Ansible Copy module. How to use copy files and directories with Ansible. Ansible remote_src example\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/www.middlewareinventory.com\/blog\/ansible-copy-examples\/\"]}]},{\"@type\":\"Article\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-copy-examples\/#article\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-copy-examples\/#webpage\"},\"author\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\"},\"headline\":\"Ansible Copy Examples &#8211; How to copy files and directories with Ansible\",\"datePublished\":\"2022-01-15T14:58:49+00:00\",\"dateModified\":\"2022-01-17T19:01:57+00:00\",\"mainEntityOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-copy-examples\/#webpage\"},\"commentCount\":0,\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-copy-examples\/#primaryimage\"},\"articleSection\":\"Ansible\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"CommentAction\",\"name\":\"Comment\",\"target\":[\"https:\/\/www.middlewareinventory.com\/blog\/ansible-copy-examples\/#respond\"]}]},{\"@type\":\"Person\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\",\"name\":\"Rumen Lishkov\",\"image\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#personlogo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/secure.gravatar.com\/avatar\/c22e4a54d67750291a9892531f94ffb3?s=96&d=mm&r=g\",\"caption\":\"Rumen Lishkov\"}}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","_links":{"self":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/7956"}],"collection":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/comments?post=7956"}],"version-history":[{"count":5,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/7956\/revisions"}],"predecessor-version":[{"id":7976,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/7956\/revisions\/7976"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media\/7971"}],"wp:attachment":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media?parent=7956"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/categories?post=7956"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/tags?post=7956"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}