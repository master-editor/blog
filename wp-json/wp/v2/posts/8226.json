{"id":8226,"date":"2022-04-06T02:08:42","date_gmt":"2022-04-05T20:38:42","guid":{"rendered":"https:\/\/www.middlewareinventory.com\/?p=8226"},"modified":"2022-11-22T23:29:37","modified_gmt":"2022-11-22T17:59:37","slug":"internal-external-load-balancer-aws-eks","status":"publish","type":"post","link":"https:\/\/www.middlewareinventory.com\/blog\/internal-external-load-balancer-aws-eks\/","title":{"rendered":"AWS EKS Load Balancer from Kubernetes Service | Devops Junction"},"content":{"rendered":"<p>In this article, we are going to see how to create <span style=\"color: #eb057f;\">internal<\/span> and <span style=\"color: #eb057f;\">external<\/span> load balancers using the Kubernetes <strong>service<\/strong> on EKS<\/p>\n<p>When we think about making an application or deployment available externally or internally over a Domain name<\/p>\n<p>We think of <a href=\"https:\/\/www.middlewareinventory.com\/blog\/kubernetes-ingress-example\/\">Kubernetes Ingress<\/a>\u00a0but that&#8217;s not the only way to expose your service.<\/p>\n<p>There are three ways to make service available externally ( Irrespective of External or Internal Load balancer )<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/eks-create-internal-lb.jpg\"><img class=\"post-img alignnone wp-image-8306 size-full\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/eks-create-internal-lb.jpg\" alt=\"eks load balancer\" width=\"1748\" height=\"1240\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/eks-create-internal-lb.jpg 1748w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/eks-create-internal-lb-300x213.jpg 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/eks-create-internal-lb-1024x726.jpg 1024w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/eks-create-internal-lb-768x545.jpg 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/eks-create-internal-lb-1536x1090.jpg 1536w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/eks-create-internal-lb-90x65.jpg 90w\" sizes=\"(max-width: 1748px) 100vw, 1748px\" \/><\/a><\/p>\n<p>&nbsp;<\/p>\n<h2>Three Ways to expose a Service <span style=\"color: #003366;\"><span style=\"color: #eb107a;\">through AWS Load Balancer\u00a0<\/span><\/span><\/h2>\n<p>&nbsp;<\/p>\n<h3><strong>Setting the Service type to <span style=\"color: #eb107a;\">Nodeport<\/span><\/strong><\/h3>\n<p>services that need to be exposed to the outside world can be configured with the node port. In this method, each cluster node opens a port on the node itself (hence this name was given ) and redirects traffic received on that port to the underlying service<\/p>\n<p>You can add the selective machines\/nodes into a Target group of existing or new Load Balancers.<\/p>\n<p>The target group would be using NodePort as the target port<\/p>\n<h3><\/h3>\n<p>&nbsp;<\/p>\n<h3><strong>Setting the Service type to <span style=\"color: #eb107a;\">Loadbalancer <\/span>( Discussed in this article )<\/strong><\/h3>\n<p>an extension of the NodePort type\u2014This makes the service accessible through a dedicated load balancer, provisioned from the cloud infrastructure Kubernetes is running on.<\/p>\n<p>The load balancer redirects traffic to the node port across all the nodes. Clients connect to the service through the load balancer\u2019s IP.<\/p>\n<p>In this type Load Balancer Creation and Targetgroup creation would all be done automatically.<\/p>\n<p>In the case of EKS\u00a0 <code>Cluster LB Controller<\/code> would take care of that job. Which needs to be manually installed and set up.<\/p>\n<p>&nbsp;<\/p>\n<h3><strong>Creating an <span style=\"color: #eb107a;\">Ingress<\/span> resource ( Not covered in this article )<\/strong><\/h3>\n<p>A radically different mechanism for exposing multiple services through a single IP address. It operates at the HTTP level (network layer 7) and can thus offer more features than layer 4 services can.\u00a0 that&#8217;s what we are going to see in this article. It is more like AWS\u00a0 Application Load Balancers.<\/p>\n<p>We are not going to cover Ingress in this article. we have a dedicated article for K8s ingress. you can refer<\/p>\n<blockquote class=\"wp-embedded-content\" data-secret=\"EHoDnL4BkH\"><p><a href=\"https:\/\/www.middlewareinventory.com\/blog\/kubernetes-ingress-example\/\">Kubernetes Ingress Example on Google Cloud<\/a><\/p><\/blockquote>\n<p><iframe class=\"wp-embedded-content\" sandbox=\"allow-scripts\" security=\"restricted\" style=\"position: absolute; clip: rect(1px, 1px, 1px, 1px);\" title=\"&#8220;Kubernetes Ingress Example on Google Cloud&#8221; &#8212; Middleware Inventory\" src=\"https:\/\/www.middlewareinventory.com\/blog\/kubernetes-ingress-example\/embed\/#?secret=EHoDnL4BkH\" data-secret=\"EHoDnL4BkH\" width=\"600\" height=\"338\" frameborder=\"0\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\"><\/iframe><\/p>\n<blockquote><p>\u00a0In this article we are going to use only Service and with a type of Load Balancer.<\/p><\/blockquote>\n<p>Setting the Service type to <code>LoadBalancer<\/code> does not automatically create the load balancer for you.<\/p>\n<p>For EKS to be able to create a Load Balancer, it needs to have certain configurations and Service accounts created.<\/p>\n<p>To facilitate EKS to create and manage AWS Load Balancers. we need to deploy an additional controller named <a href=\"https:\/\/docs.aws.amazon.com\/eks\/latest\/userguide\/aws-load-balancer-controller.html\">AWS LB Controller<\/a> which was earlier known as AWS Ingress controller.<\/p>\n<p>&nbsp;<\/p>\n<h2><span style=\"color: #003366;\"><span style=\"color: #000000;\">Installing<\/span> <span style=\"color: #ed1878;\">AWS LB Controller<\/span> <span style=\"color: #000000;\">add on to EKS<\/span><\/span><\/h2>\n<p>Here are the quick installation and configuration steps to install AWS LB Controller on your EKS Cluster.<\/p>\n<p>We presume you have installed EKS Cluster already.<\/p>\n<p>if you have not created it yet. Refer to <a href=\"https:\/\/www.middlewareinventory.com\/blog\/creating-eks-cluster-with-karpenter-auto-scaling-terraform-kubernetes\/\">this article to create EKS Cluster to Karpenter Autoscaling &#8211; Terraform<\/a><\/p>\n<p>To manage your existing EKS Cluster, AWS provides a CLI named <code>eksctl<\/code>which you can <a href=\"https:\/\/eksctl.io\/\">download\/install<\/a> from here.<\/p>\n<p><strong>eksctl<\/strong> can make use of your <strong>awscli<\/strong> profiles for authentication and to communicate to your AWS account.<\/p>\n<h3><\/h3>\n<h3>Enabling OIDC in our EKS Cluster<\/h3>\n<p>let us begin with enabling OpenID Connect<strong>(OIDC)<\/strong> in our EKS Cluster. this lets our IAM roles be associated directly with Kubernetes service accounts.<\/p>\n<p>It is a new feature where you can associate IAM roles with your Kubernetes Service accounts directly. <a href=\"https:\/\/docs.aws.amazon.com\/eks\/latest\/userguide\/iam-roles-for-service-accounts.html\">Read more about it here<\/a><\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\" data-enlighter-theme=\"bootstrap4\" data-enlighter-linenumbers=\"false\">\u21d2 eksctl utils associate-iam-oidc-provider \\\r\n    &#8211; region us-east-2 \\\r\n    &#8211; cluster gritfyeks \\\r\n    &#8211; approve\r\n<\/pre>\n<p>&nbsp;<\/p>\n<h3>Creating IAM Policy<\/h3>\n<p>Once we have enabled the OIDC in our EKS cluster. we can go ahead and download the <code>iam_policy<\/code>configuration needed to be created.<\/p>\n<p>You can directly download it using <code>curl<\/code><\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\" data-enlighter-theme=\"bootstrap4\" data-enlighter-linenumbers=\"false\">\u21d2 curl -o iam_policy.json https:\/\/raw.githubusercontent.com\/kubernetes-sigs\/aws-load-balancer-controller\/v2.2.0\/docs\/install\/iam_policy.json\r\n<\/pre>\n<p>Content of the <code>iam_policy.json<\/code> file <a href=\"https:\/\/gist.github.com\/AKSarav\/4506ba82df274f689e4266af28f40fd8\">available in Github<\/a> if you would like to directly copy<\/p>\n<p>Now you can use this json file to create your iam policy using <code>aws iam create-policy<\/code>command<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\" data-enlighter-theme=\"bootstrap4\" data-enlighter-linenumbers=\"false\">\u21d2 aws iam create-policy \\\r\n    &#8211; policy-name AWSLoadBalancerControllerIAMPolicy \\\r\n    &#8211; policy-document file:\/\/iam_policy.json<\/pre>\n<p>&nbsp;<\/p>\n<h3>Creating IAM Service Account and Attach the Policy<\/h3>\n<p>Now it&#8217;s time to create an <code>iamserviceaccount<\/code> in our EKS cluster.\u00a0 we are going to use <code>eksctl<\/code> for the same.<\/p>\n<p>you need to update the <code>cluster<\/code>name and region before trying this out<\/p>\n<p>this creates a service account named <code>aws-load-balancer-controller<\/code>in kube-system namespace and this service, account is associated with IAM policy we created earlier.<\/p>\n<p>You might have to just change the following things before running the command<\/p>\n<ul>\n<li>ClusterName<\/li>\n<li>Policy ARN &#8211; ( Just AWS Account Number is enough)<\/li>\n<li>AWS account Region<\/li>\n<\/ul>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\" data-enlighter-theme=\"bootstrap4\" data-enlighter-linenumbers=\"false\">\u21d2 eksctl create iamserviceaccount \\\r\n--cluster ${YOUR_CLUSTER_NAME} &#8211; region ${YOUR_AWS_REGION} \\\r\n--namespace kube-system \\\r\n--name aws-load-balancer-controller \\\r\n--attach-policy-arn arn:aws:iam::${YOUR_AWS_ACCOUNT_NUMBER}:policy\/AWSLoadBalancerControllerIAMPolicy \\\r\n--override-existing-serviceaccounts \\\r\n--approve\r\n<\/pre>\n<p>Now we have the necessary service accounts and OIDC in place. Now we can go ahead and deploy the <strong>aws-load-balancer-controller\u00a0<\/strong>using helm<\/p>\n<p>&nbsp;<\/p>\n<h3>Installing AWS load balancer controller in EKS with Helm<\/h3>\n<p>If you do not have <a href=\"https:\/\/helm.sh\/\">helm<\/a> installed in your local system. Please install it before continuing. you can find more information about helm <a href=\"https:\/\/helm.sh\/\">here<\/a><\/p>\n<p>Let us begin with adding the necessary charts and repository to helm<\/p>\n<pre># helm repo add eks https:\/\/aws.github.io\/eks-charts\r\n# helm repo update<\/pre>\n<p>Once you have executed the <code>helm repo add<\/code> and \u00a0<code><\/code><code>helm repo update<\/code><\/p>\n<p>you are good to install the aws-load-balancer-controller<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\" data-enlighter-theme=\"bootstrap4\" data-enlighter-linenumbers=\"false\">\u21d2 helm install aws-load-balancer-controller eks\/aws-load-balancer-controller \\\r\n  -n kube-system \\\r\n  &#8211; set clusterName=${Your Cluster Name} \\\r\n  &#8211; set serviceAccount.create=false \\\r\n  &#8211; set serviceAccount.name=aws-load-balancer-controller<\/pre>\n<p>Once the helm chart is successfully deployed. we can verify by listing the <code>aws-load-balancer-controller<\/code> deployment on the <code>kube-system<\/code> namespace<\/p>\n<pre>\u21d2 kubectl get deployments aws-load-balancer-controller -n kube-system\r\nNAME READY UP-TO-DATE AVAILABLE AGE\r\naws-load-balancer-controller 2\/2 2 2 56s<\/pre>\n<p>Once you have validated that the deployment is present and LIVE. Now we can move on to the next phase of this article.<\/p>\n<p>We are going to deploy and test some sample applications in our EKS Cluster.<\/p>\n<p>This is the Image or Application we are going to deploy.<\/p>\n<blockquote class=\"wp-embedded-content\" data-secret=\"8APSMhODz8\"><p><a href=\"https:\/\/www.middlewareinventory.com\/blog\/docker-tomcat-example-dockerfile-sample\/\">Docker Tomcat Example &#8211; Dockerfile for Tomcat, Docker Tomcat Image<\/a><\/p><\/blockquote>\n<p><iframe class=\"wp-embedded-content\" sandbox=\"allow-scripts\" security=\"restricted\" style=\"position: absolute; clip: rect(1px, 1px, 1px, 1px);\" title=\"&#8220;Docker Tomcat Example &#8211; Dockerfile for Tomcat, Docker Tomcat Image&#8221; &#8212; Middleware Inventory\" src=\"https:\/\/www.middlewareinventory.com\/blog\/docker-tomcat-example-dockerfile-sample\/embed\/#?secret=8APSMhODz8\" data-secret=\"8APSMhODz8\" width=\"600\" height=\"338\" frameborder=\"0\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\"><\/iframe><\/p>\n<p>&nbsp;<\/p>\n<h2>Creating a new <span style=\"color: #ed1878;\">deployment<\/span> in EKS Cluster<\/h2>\n<p>To test the load balancer we. need to first deploy some applications to the Kubernetes cluster.<\/p>\n<p>I have taken our famous <code>aksarav\/tomcat8<\/code> image and deployed it to the cluster with the following single line command<\/p>\n<pre>\u21d2 kubectl create deployment tomcatinfra &#8211; image=saravak\/tomcat8\r\ndeployment.apps\/tomcatinfra created<\/pre>\n<p>But in real-time you would ideally be creating a deployment with YAML with much more customizations<\/p>\n<p>Since our objective is to test the load balancer with EKS am fastening this with single line deployment creation<\/p>\n<p>Now the deployment is created. The next stage is where the Load Balancer is going to be created.<\/p>\n<p>&nbsp;<\/p>\n<h2>Creating AWS <span style=\"color: #ed1878;\">EKS Load Balancer<\/span> External &#8211; from K8s Service<\/h2>\n<p>Now we need to expose our application as a service.\u00a0 \u00a0To keep things simple we are going to use one-liner commands for this<\/p>\n<pre>\u21d2 kubectl expose deployment tomcatinfra &#8211; port=80 &#8211; target-port=8080 &#8211; type LoadBalancer \r\n  service\/tomcatinfra exposed<\/pre>\n<p>when you run the <code>kubectl expose<\/code> command with your deployment name and the port.\u00a0 Service would be auto-created<\/p>\n<p>Here is the YAML file of the service, if you do not want to use the one-liner command<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"yaml\" data-enlighter-theme=\"bootstrap4\" data-enlighter-linenumbers=\"false\">apiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: tomcatappsvc\r\nspec:\r\n  ipFamilies:\r\n  - IPv4\r\n  ipFamilyPolicy: SingleStack\r\n  ports:\r\n  - name: http\r\n    port: 80\r\n    targetPort: 8080\r\n  selector:\r\n    app: tomcatinfra\r\n  type: LoadBalancer<\/pre>\n<p>&nbsp;<\/p>\n<p>As you can see, We are also defining what type of service has to be created using <code>--type LoadBalancer<\/code> in both formats<\/p>\n<p>If all configurations are in place and done right. You would be able to see that a new\u00a0 Load Balancer is created<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/03\/Screenshot-2022-03-29-at-12.52.42-AM.png\"><img class=\"alignnone wp-image-8269 size-full\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/03\/Screenshot-2022-03-29-at-12.52.42-AM.png\" alt=\"eks load balancer\" width=\"3326\" height=\"332\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/03\/Screenshot-2022-03-29-at-12.52.42-AM.png 3326w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/03\/Screenshot-2022-03-29-at-12.52.42-AM-300x30.png 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/03\/Screenshot-2022-03-29-at-12.52.42-AM-1024x102.png 1024w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/03\/Screenshot-2022-03-29-at-12.52.42-AM-768x77.png 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/03\/Screenshot-2022-03-29-at-12.52.42-AM-1536x153.png 1536w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/03\/Screenshot-2022-03-29-at-12.52.42-AM-2048x204.png 2048w\" sizes=\"(max-width: 3326px) 100vw, 3326px\" \/><\/a><\/p>\n<blockquote><p>By default when you expose a service. it would become a publicaly available load balancer. In order to make it private we need to special annotations. Will get there.<\/p><\/blockquote>\n<p>For now, we have tested how to create an External Load Balancer with <code>aws-load-balancer-controller<\/code> and expose our deployment as a service<\/p>\n<p>Now let us access our application to validate if it is accessible<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/03\/Screenshot-2022-03-29-at-1.02.49-AM.png\"><img class=\"alignnone wp-image-8271 size-full\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/03\/Screenshot-2022-03-29-at-1.02.49-AM.png\" alt=\"EKS Load Balancer\" width=\"2834\" height=\"1480\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/03\/Screenshot-2022-03-29-at-1.02.49-AM.png 2834w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/03\/Screenshot-2022-03-29-at-1.02.49-AM-300x157.png 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/03\/Screenshot-2022-03-29-at-1.02.49-AM-1024x535.png 1024w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/03\/Screenshot-2022-03-29-at-1.02.49-AM-768x401.png 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/03\/Screenshot-2022-03-29-at-1.02.49-AM-1536x802.png 1536w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/03\/Screenshot-2022-03-29-at-1.02.49-AM-2048x1070.png 2048w\" sizes=\"(max-width: 2834px) 100vw, 2834px\" \/><\/a><\/p>\n<p>&nbsp;<\/p>\n<h2>Creating AWS EKS<span style=\"color: #ed1878;\">\u00a0Load Balancer<\/span> Internal &#8211; from K8s Service<\/h2>\n<p>We have seen how to create an external load balancer with service. we have used a one-liner command to expose our deployment.<\/p>\n<p>It has created the External Load Balancer automatically.<\/p>\n<p>Now we are going to see how to create Internal Load Balancer with Service.<\/p>\n<p>By default when you create a service it would expose the load balancer to the public. but this can be controlled using certain <code>annotations<\/code><\/p>\n<p>Let us take a look at the YAML file we are going to use to create our service.<\/p>\n<p>As Classic Load Balancer is going to be deprecated shortly by AWS. I have chosen NLB. So we are now going to create internal network load balancer with EKS<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"yaml\" data-enlighter-theme=\"bootstrap4\" data-enlighter-linenumbers=\"false\">apiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  annotations:\r\n    service.beta.kubernetes.io\/aws-load-balancer-internal: \"true\"\r\n    service.beta.kubernetes.io\/aws-load-balancer-scheme: internal\r\n    service.beta.kubernetes.io\/aws-load-balancer-type: nlb\r\nspec:\r\n  ipFamilies:\r\n  - IPv4\r\n  ipFamilyPolicy: SingleStack\r\n  ports:\r\n  - name: http\r\n    port: 80\r\n    targetPort: 8080\r\n  selector:\r\n    app: tomcatinfra\r\n  type: LoadBalancer<\/pre>\n<p>Our deployment is still the same as we have used in the last example.<\/p>\n<pre>kubectl create deployment tomcatinfra &#8211; image=saravak\/tomcat8<\/pre>\n<p>This is a simple Tomcat Application that exposes a port <code>8080<\/code> in our service that&#8217;s the target port and our Service Load balancer is going to listen on port <code>80<\/code><\/p>\n<p>TargetPort should always point to the application exposed port. <code>80 =&gt; 8080<\/code><\/p>\n<p>Now let us create the service using this YAML file and validate.<\/p>\n<pre>kubectl apply -f internalservice.yml<\/pre>\n<p>here is a quick video record of me applying this YAML file in my\u00a0 EKS cluster.<\/p>\n<p><a href=\"https:\/\/asciinema.org\/a\/ou7DsZozHeFTQ9FA9xC0FA3x4\" target=\"_blank\" rel=\"noopener noreferrer\"><img src=\"https:\/\/asciinema.org\/a\/ou7DsZozHeFTQ9FA9xC0FA3x4.svg\" \/><\/a><\/p>\n<p>As you have seen in the screen record the internal Load Balancer was created.<\/p>\n<p>Here are some more screenshots I have taken from the AWS console for the Load Balancer<\/p>\n<p>As you can see a new network Load Balancer has been created and the schema is set to <code>internal<\/code><\/p>\n<p>It means we have successfully created an internal load balancer using LB Controller<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-05-at-2.48.45-AM.png\"><img class=\"post-img alignnone wp-image-8299 size-full\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-05-at-2.48.45-AM.png\" alt=\"eks load balancer\" width=\"3840\" height=\"2004\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-05-at-2.48.45-AM.png 3840w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-05-at-2.48.45-AM-300x157.png 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-05-at-2.48.45-AM-1024x534.png 1024w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-05-at-2.48.45-AM-768x401.png 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-05-at-2.48.45-AM-1536x802.png 1536w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-05-at-2.48.45-AM-2048x1069.png 2048w\" sizes=\"(max-width: 3840px) 100vw, 3840px\" \/><\/a><\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-05-at-2.50.51-AM.png\"><img class=\"post-img alignnone wp-image-8300 size-full\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-05-at-2.50.51-AM.png\" alt=\"eks load balancer\" width=\"3322\" height=\"1642\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-05-at-2.50.51-AM.png 3322w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-05-at-2.50.51-AM-300x148.png 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-05-at-2.50.51-AM-1024x506.png 1024w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-05-at-2.50.51-AM-768x380.png 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-05-at-2.50.51-AM-1536x759.png 1536w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-05-at-2.50.51-AM-2048x1012.png 2048w\" sizes=\"(max-width: 3322px) 100vw, 3322px\" \/><\/a><\/p>\n<p>Since this is an internal load balancer, you have to be present within the VPC internal network to be able to access this.<\/p>\n<p>If you have VPN servers. that&#8217;s the best way to connect to the internal network<\/p>\n<p>Otherwise, you can launch a machine on the VPC and try to access it from there. that&#8217;s what am going to do<\/p>\n<p>I launched a new Windows server on the same VPC we have created manually and going to test this Load balancer from there<\/p>\n<p>You can see that the URL is available and accessible from the windows server launched on the same VPC but not externally.<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-05-at-3.31.54-AM-scaled.jpg\"><img class=\"post-img alignnone wp-image-8301 size-full\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-05-at-3.31.54-AM-scaled.jpg\" alt=\"eks load balancer\" width=\"2560\" height=\"1068\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-05-at-3.31.54-AM-scaled.jpg 2560w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-05-at-3.31.54-AM-300x125.jpg 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-05-at-3.31.54-AM-1024x427.jpg 1024w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-05-at-3.31.54-AM-768x320.jpg 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-05-at-3.31.54-AM-1536x641.jpg 1536w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/Screenshot-2022-04-05-at-3.31.54-AM-2048x854.jpg 2048w\" sizes=\"(max-width: 2560px) 100vw, 2560px\" \/><\/a><\/p>\n<p>The only difference between the external load balancer creation and internal load balancer creation is the annotation we are setting.<\/p>\n<p>There are more Annotations available which you can explore List of <a href=\"https:\/\/kubernetes-sigs.github.io\/aws-load-balancer-controller\/v2.3\/guide\/service\/annotations\/\">EKS Load Balancer Annotations\u00a0<\/a><\/p>\n<h2><\/h2>\n<h3>More Annotations to Customize the LoadBalancer Creation<\/h3>\n<p>We have used only a few annotations which are necessary for making the LB an internal Load Balancer.<\/p>\n<p>I know there are more options to configure\/customize during the LB creation and there are more annotations available as well.<\/p>\n<p>Here are some things you can customize and control using Annotations.<\/p>\n<ul>\n<li>Healthcheck attributes<\/li>\n<li>Enabling Access log<\/li>\n<li>Adding SSL Certificate and TLS Listener to your NLB<\/li>\n<\/ul>\n<p><a href=\"https:\/\/kubernetes-sigs.github.io\/aws-load-balancer-controller\/v2.3\/guide\/service\/annotations\/\">Find the complete list of LoadBalancer Annotations for EKS here\u00a0<\/a><\/p>\n<p>&nbsp;<\/p>\n<h2>Conclusion<\/h2>\n<p>In this article, we have seen how to create Internal and external load balancers using\u00a0 LB Controller on EKS.<\/p>\n<p>We also have installed the LB Controller on our EKS Cluster and deployed a sample application and exposed it as a service and created an internal network load balancer and external Load balancer.<\/p>\n<p>We also validated the internal NLB with a machine created and available on the local VPC.<\/p>\n<p>If you have any questions. please do let me know on the comments section<\/p>\n<p>For any professional support\u00a0 reach us at <a href=\"mailto:rumenlishkoff@gmail.com\">rumenlishkoff@gmail.com<\/a><\/p>\n<a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2021\/09\/DaaS.svg\"><img class=\"post-img\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2021\/09\/DaaS.svg\" alt=\"gritfy\" width=\"1047\" height=\"415\" class=\"alignnone size-full wp-image-6623\" \/><\/a>\n<p>&nbsp;<\/p>\n<p>Thanks<br \/>\nSarav<\/p>\n<div id=\"postfollow\">\r\n<a href='https:\/\/ko-fi.com\/O4O51FG7C' target='_blank'><img height='46' style='border:0px;height:46px;width: 186px' src='https:\/\/az743702.vo.msecnd.net\/cdn\/kofi3.png?v=2' border='0' alt='Buy Me a Coffee at ko-fi.com' \/><\/a>\r\n<p>Follow us on<a href=\"http:\/\/www.facebook.com\/middlewareinventory\">Facebook<\/a> or<a href=\"http:\/\/www.twitter.com\/mwinventory\">Twitter<\/a>\r\n<\/br>\r\nFor more practical videos and tutorials. <a href=\"https:\/\/www.youtube.com\/channel\/UCRuqBFM6ioWwviNJkgOjeWw?sub_confirmation=1\">Subscribe to our channel<\/a>\r\n<\/br>\r\nFollow me on Linkedin <a href=\"https:\/\/www.linkedin.com\/comm\/mynetwork\/discovery-see-all?usecase=PEOPLE_FOLLOWS&followMember=saravakmwinventory\">My Profile<\/a>\r\n<\/br>\r\n<\/i>For any Consultation or to hire us <a href=\"mailto:rumenlishkoff@gmail.com\"> rumenlishkoff@gmail.com<\/a>\r\n<\/br>\r\nIf you like this article. Show your Support! <a href=\"https:\/\/ko-fi.com\/middlewareinventory\">Buy me a Coffee.<\/a>\r\n<\/br>\r\n<\/p>\r\n<p style=\"color: palevioletred !important;\">Signup for Exclusive \"Subscriber-only\" Content<\/p>\r\n\n\t\t<div class=\"emaillist\">\n\t\t\t<form action=\"#\" method=\"post\" class=\"es_subscription_form es_shortcode_form\" id=\"es_subscription_form_1670577422\" data-source=\"ig-es\">\n\t\t\t\t\t\t\t\t<div class=\"es-field-wrap\"><label>Name*<br \/><input type=\"text\" name=\"name\" class=\"ig_es_form_field_name\" placeholder=\"\" value=\"\" required=\"required\" \/><\/label><\/div><div class=\"es-field-wrap\"><label>Email*<br \/><input class=\"es_required_field es_txt_email ig_es_form_field_email\" type=\"email\" name=\"email\" value=\"\" placeholder=\"\" required=\"required\" \/><\/label><\/div><input type=\"hidden\" name=\"lists[]\" value=\"1\" \/><input type=\"hidden\" name=\"form_id\" value=\"3\" \/>\n\t\t\t\t<input type=\"hidden\" name=\"es_email_page\" value=\"8226\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"es_email_page_url\" value=\"https:\/\/www.middlewareinventory.com\/blog\/internal-external-load-balancer-aws-eks\/\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"status\" value=\"Unconfirmed\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"es-subscribe\" id=\"es-subscribe\" value=\"7aebfb1a9b\"\/>\n\t\t\t\t<label style=\"position:absolute;top:-99999px;left:-99999px;z-index:-99;\"><input type=\"email\" name=\"es_hp_email\" class=\"es_required_field\" tabindex=\"-1\" autocomplete=\"-1\" value=\"\"\/><\/label>\n\t\t\t\t\t\t\t\t<input type=\"submit\" name=\"submit\" class=\"es_subscription_form_submit es_submit_button es_textbox_button\" id=\"es_subscription_form_submit_1670577422\" value=\"Subscribe\"\/>\n\n\t\t\t\t\n\t\t\t\t<span class=\"es_spinner_image\" id=\"spinner-image\"><img src=\"https:\/\/www.middlewareinventory.com\/wp-content\/plugins\/email-subscribers\/lite\/public\/images\/spinner.gif\" alt=\"Loading\"\/><\/span>\n\n\t\t\t<\/form>\n\n\t\t\t<span class=\"es_subscription_message\" id=\"es_subscription_message_1670577422\"><\/span>\n\t\t<\/div>\n\n\t\t\r\n<\/div>\r\n<hr>\n","protected":false},"excerpt":{"rendered":"<p>In this article, we are going to see how to create internal and external load balancers using the Kubernetes service on EKS When we think about making an application or deployment available externally or internally over a Domain name We think of Kubernetes Ingress\u00a0but that&#8217;s not the only way to[&#8230;]<\/p>\n","protected":false},"author":1,"featured_media":8306,"comment_status":"closed","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"_et_pb_use_builder":"","_et_pb_old_content":"","_et_gb_content_width":""},"categories":[234,151],"tags":[],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v14.9 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>AWS EKS Load Balancer from Kubernetes Service | Devops Junction<\/title>\n<meta name=\"description\" content=\"AWS EKS Create Internal or External Load Balancer using Kubernetes Service file. AWS EKS Load Balancer example. EKS LoadBalancer example. AWS LB Controller example.\" \/>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/www.middlewareinventory.com\/blog\/internal-external-load-balancer-aws-eks\/\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"AWS EKS Load Balancer from Kubernetes Service | Devops Junction\" \/>\n<meta property=\"og:description\" content=\"AWS EKS Create Internal or External Load Balancer using Kubernetes Service file. AWS EKS Load Balancer example. EKS LoadBalancer example. AWS LB Controller example.\" \/>\n<meta property=\"og:url\" content=\"https:\/\/www.middlewareinventory.com\/blog\/internal-external-load-balancer-aws-eks\/\" \/>\n<meta property=\"og:site_name\" content=\"Middleware Inventory\" \/>\n<meta property=\"article:publisher\" content=\"http:\/\/www.facebook.com\/devopsjunc\" \/>\n<meta property=\"article:published_time\" content=\"2022-04-05T20:38:42+00:00\" \/>\n<meta property=\"article:modified_time\" content=\"2022-11-22T17:59:37+00:00\" \/>\n<meta property=\"og:image\" content=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/eks-create-internal-lb.jpg\" \/>\n\t<meta property=\"og:image:width\" content=\"1748\" \/>\n\t<meta property=\"og:image:height\" content=\"1240\" \/>\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\n<meta name=\"twitter:creator\" content=\"@mwinventory\" \/>\n<meta name=\"twitter:site\" content=\"@mwinventory\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"Organization\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\",\"name\":\"Middleware Inventory\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"sameAs\":[\"http:\/\/www.facebook.com\/devopsjunc\",\"https:\/\/www.youtube.com\/channel\/UCRuqBFM6ioWwviNJkgOjeWw\",\"https:\/\/twitter.com\/mwinventory\"],\"logo\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/09\/Screenshot-2020-09-18-at-3.49.40-AM.jpg\",\"width\":300,\"height\":107,\"caption\":\"Middleware Inventory\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\"}},{\"@type\":\"WebSite\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"name\":\"Devops Junction\",\"description\":\"An inventory of [i]nformation, Middleware and much more.\",\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":\"https:\/\/www.middlewareinventory.com\/?s={search_term_string}\",\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/internal-external-load-balancer-aws-eks\/#primaryimage\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/04\/eks-create-internal-lb.jpg\",\"width\":1748,\"height\":1240,\"caption\":\"EKS Create Internal LB\"},{\"@type\":\"WebPage\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/internal-external-load-balancer-aws-eks\/#webpage\",\"url\":\"https:\/\/www.middlewareinventory.com\/blog\/internal-external-load-balancer-aws-eks\/\",\"name\":\"AWS EKS Load Balancer from Kubernetes Service | Devops Junction\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\"},\"primaryImageOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/internal-external-load-balancer-aws-eks\/#primaryimage\"},\"datePublished\":\"2022-04-05T20:38:42+00:00\",\"dateModified\":\"2022-11-22T17:59:37+00:00\",\"description\":\"AWS EKS Create Internal or External Load Balancer using Kubernetes Service file. AWS EKS Load Balancer example. EKS LoadBalancer example. AWS LB Controller example.\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/www.middlewareinventory.com\/blog\/internal-external-load-balancer-aws-eks\/\"]}]},{\"@type\":\"Article\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/internal-external-load-balancer-aws-eks\/#article\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/internal-external-load-balancer-aws-eks\/#webpage\"},\"author\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\"},\"headline\":\"AWS EKS Load Balancer from Kubernetes Service | Devops Junction\",\"datePublished\":\"2022-04-05T20:38:42+00:00\",\"dateModified\":\"2022-11-22T17:59:37+00:00\",\"mainEntityOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/internal-external-load-balancer-aws-eks\/#webpage\"},\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/internal-external-load-balancer-aws-eks\/#primaryimage\"},\"articleSection\":\"AWS,Kubernetes\",\"inLanguage\":\"en-US\"},{\"@type\":\"Person\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\",\"name\":\"Rumen Lishkov\",\"image\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#personlogo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/secure.gravatar.com\/avatar\/c22e4a54d67750291a9892531f94ffb3?s=96&d=mm&r=g\",\"caption\":\"Rumen Lishkov\"}}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","_links":{"self":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/8226"}],"collection":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/comments?post=8226"}],"version-history":[{"count":5,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/8226\/revisions"}],"predecessor-version":[{"id":9367,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/8226\/revisions\/9367"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media\/8306"}],"wp:attachment":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media?parent=8226"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/categories?post=8226"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/tags?post=8226"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}