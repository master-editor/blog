{"id":9373,"date":"2022-11-29T00:02:40","date_gmt":"2022-11-28T18:32:40","guid":{"rendered":"https:\/\/www.middlewareinventory.com\/?p=9373"},"modified":"2022-11-29T00:02:40","modified_gmt":"2022-11-28T18:32:40","slug":"kubernetes-namespace-user","status":"publish","type":"post","link":"https:\/\/www.middlewareinventory.com\/blog\/kubernetes-namespace-user\/","title":{"rendered":"How to limit user to a specific Namespace &#8211; Kubernetes RBAC | Devops Junction"},"content":{"rendered":"<p>Kubernetes RBAC is a vast subject and it continuously evolves as I pen down this article.<\/p>\n<p>In this article let us see some basics of Kubernetes RBAC and move to our objective How to restrict the access of <strong>users<\/strong> or <strong>groups<\/strong> to a specific namespace.<\/p>\n<p>Kubernetes RBAC is powered by four key resources as<\/p>\n<ul>\n<li><strong>Role<\/strong> (or) <strong>Cluster Role<\/strong> &#8211; Define what can be done<\/li>\n<li><strong>Role Binding<\/strong> (or) <strong>Cluster Role binding<\/strong>. &#8211; Define who can do it<\/li>\n<\/ul>\n<p>While the Role and Role binding are bound to a single namespace. Cluster Role and Cluster Role Binding are for the entire cluster. ( that&#8217;s why there is a <code>cluster<\/code> as a prefix)<\/p>\n<p>The following image is self-explanatory and depict the role and role binding clearly.<\/p>\n<figure id=\"attachment_9374\" aria-describedby=\"caption-attachment-9374\" style=\"width: 590px\" class=\"wp-caption alignnone\"><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/11\/k8s-rbac.jpeg\"><img class=\"post-img wp-image-9374 size-full\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/11\/k8s-rbac.jpeg\" alt=\"kubernetes rbac\" width=\"590\" height=\"282\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/11\/k8s-rbac.jpeg 590w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/11\/k8s-rbac-300x143.jpeg 300w\" sizes=\"(max-width: 590px) 100vw, 590px\" \/><\/a><figcaption id=\"caption-attachment-9374\" class=\"wp-caption-text\">Credits to Mark Luksa<\/figcaption><\/figure>\n<p>&nbsp;<\/p>\n<p>The same image is applicable for Cluster and Cluster Role binding too. except that it is for cluster scope.<\/p>\n<p><strong>But our objective for this article is to talk about how to limit a user or group to a specific namespace.<\/strong><\/p>\n<p>when we say namespace, we should think about roles and role binding as they are limited to namespace only.<\/p>\n<p>In case it should be for multiple namespaces or any other cluster resources. it should cluster role and cluster role binding.<\/p>\n<p>So now we are going to do the following things to create a user with limited permission to a specific namespace.<\/p>\n<ul>\n<li>role &#8211; to define what the user can do on the namespace<\/li>\n<li>role binding &#8211; to bind the user to the role<\/li>\n<li>group (auto-created &#8211; if not already exist)<\/li>\n<li>update the user with a group name ( I am using EKS so I have to update <code>aws-auth<\/code> configmap)<\/li>\n<\/ul>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/11\/Screenshot-2022-11-27-at-2.29.11-PM-scaled.jpg\"><img class=\"alignnone size-full wp-image-9380\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/11\/Screenshot-2022-11-27-at-2.29.11-PM-scaled.jpg\" alt=\"kubernetes namespace user\" width=\"2560\" height=\"1470\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/11\/Screenshot-2022-11-27-at-2.29.11-PM-scaled.jpg 2560w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/11\/Screenshot-2022-11-27-at-2.29.11-PM-300x172.jpg 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/11\/Screenshot-2022-11-27-at-2.29.11-PM-1024x588.jpg 1024w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/11\/Screenshot-2022-11-27-at-2.29.11-PM-768x441.jpg 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/11\/Screenshot-2022-11-27-at-2.29.11-PM-1536x882.jpg 1536w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/11\/Screenshot-2022-11-27-at-2.29.11-PM-2048x1176.jpg 2048w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/11\/Screenshot-2022-11-27-at-2.29.11-PM-1080x620.jpg 1080w\" sizes=\"(max-width: 2560px) 100vw, 2560px\" \/><\/a><\/p>\n<p>the preceding diagram explains what we are going to do and the code changes necessary.<\/p>\n<p>The source code of these YAML files is given below.<\/p>\n<p>&nbsp;<\/p>\n<h3>YAML files for creating a role, role binding and a group<\/h3>\n<p>here is the configuration YAML file for creating the role with full access to the namespace.<\/p>\n<p>we are also defining the namespace as <code>app1<\/code>within the configuration file<\/p>\n<p><strong>role.yaml<\/strong><\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"yaml\" data-enlighter-theme=\"bootstrap4\" data-enlighter-linenumbers=\"false\">apiVersion: rbac.authorization.k8s.io\/v1\r\nkind: Role\r\nmetadata:\r\n  name: NameSpaceApp1-FullAccess\r\n  namespace: app1\r\nrules:\r\n- apiGroups:\r\n  - '*'\r\n  resources:\r\n  - '*'\r\n  verbs:\r\n  - get\r\n  - list\r\n  - watch\r\n  - create\r\n  - update\r\n  - patch\r\n  - delete<\/pre>\n<p>Here is the configuration file for the role binding<\/p>\n<p><strong>role-binding.yaml<\/strong><\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\">apiVersion: rbac.authorization.k8s.io\/v1\r\nkind: RoleBinding\r\nmetadata:\r\n  name: app1-user-access\r\n  namespace: app1\r\nroleRef:\r\n  apiGroup: rbac.authorization.k8s.io\r\n  kind: Role\r\n  name: NameSpaceApp1-FullAccess\r\nsubjects:\r\n- apiGroup: rbac.authorization.k8s.io\r\n  kind: Group\r\n  name: app1-ns-group<\/pre>\n<p>You can see that role binding takes care of connecting the role to a subject.<\/p>\n<ul>\n<li><strong>group<\/strong> &#8211;\u00a0 you can see we are defining the group as a subject <code>app1-ns-group<\/code><\/li>\n<li><strong>role\u00a0<\/strong>&#8211; name of the role to bind to the subject<\/li>\n<\/ul>\n<p>Now the role binding has mapped the group to the user.<\/p>\n<p>In Kubernetes, <strong>user<\/strong> and <strong>group<\/strong> information are not stored anywhere, it all comes from the authentication plugin. In the case of EKS, AWS IAM is the authentication plugin<\/p>\n<p>the AWS IAM authentication plugin uses a configmap\u00a0named <code>aws-auth<\/code> where you have to add the user with their IAM arn and their username also the groups.<\/p>\n<p>Now you can map the group name `app1-ns-group` we have used in our role-binding definition<\/p>\n<p>Here is a glimpse of my <strong>aws-auth<\/strong> file<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\" data-enlighter-theme=\"bootstrap4\" data-enlighter-linenumbers=\"false\">- userarn: arn:aws:iam::***********:user\/sarav\r\n  username: sarav\r\n  groups:\r\n    - system:masters\r\n- userarn: arn:aws:iam::***********:user\/readonlyuser\r\n  username: readonlyuser\r\n  groups:\r\n    - app1-ns-group\r\n\r\n<\/pre>\n<p>As I have mentioned earlier, neither the user nor the group are managed or stored in Kubernetes.<\/p>\n<p>It means you cannot list them with <code>kubectl get user<\/code> or <code>kubectl get group<\/code> as Kubernetes would not be aware of it<\/p>\n<p>to read more about how IAM works with Kubernetes w EKS refer to the following link <a href=\"https:\/\/docs.aws.amazon.com\/eks\/latest\/userguide\/add-user-role.html\">https:\/\/docs.aws.amazon.com\/eks\/latest\/userguide\/add-user-role.html<\/a><\/p>\n<h3>How to validate the role and user binding<\/h3>\n<p>Now we have created or updated different objects\/resources in Kubernetes. how to view their binding to make sure they are bound properly<\/p>\n<p>You can use an opensource project called <a href=\"https:\/\/github.com\/FairwindsOps\/rbac-lookup\">rbac-lookup<\/a><\/p>\n<p>once you have installed <strong>rbac-lookup<\/strong> tool, you can simply list your subject (group\/user) to know their binding<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\"># rbac-lookup app1-ns-group -o wide<\/pre>\n<p>&nbsp;<\/p>\n<h3>Learn further about Kubernetes RBAC<\/h3>\n<p>there are various tools and articles available to understand and master Kubernetes RBAC most of them are collected in a single website <code>rbac.dev<\/code><\/p>\n<p>follow this link<a href=\"https:\/\/rbac.dev\"> rbac.dev<\/a> and learn more about Kubernetes RBAC and the tools available<\/p>\n<p>&nbsp;<\/p>\n<p>Cheers<br \/>\nRumen Lishkov<\/p>\n<div id=\"postfollow\">\r\n<a href='https:\/\/ko-fi.com\/O4O51FG7C' target='_blank'><img height='46' style='border:0px;height:46px;width: 186px' src='https:\/\/az743702.vo.msecnd.net\/cdn\/kofi3.png?v=2' border='0' alt='Buy Me a Coffee at ko-fi.com' \/><\/a>\r\n<p>Follow us on<a href=\"http:\/\/www.facebook.com\/middlewareinventory\">Facebook<\/a> or<a href=\"http:\/\/www.twitter.com\/mwinventory\">Twitter<\/a>\r\n<\/br>\r\nFor more practical videos and tutorials. <a href=\"https:\/\/www.youtube.com\/channel\/UCRuqBFM6ioWwviNJkgOjeWw?sub_confirmation=1\">Subscribe to our channel<\/a>\r\n<\/br>\r\nFollow me on Linkedin <a href=\"https:\/\/www.linkedin.com\/comm\/mynetwork\/discovery-see-all?usecase=PEOPLE_FOLLOWS&followMember=saravakmwinventory\">My Profile<\/a>\r\n<\/br>\r\n<\/i>For any Consultation or to hire us <a href=\"mailto:rumenlishkoff@gmail.com\"> rumenlishkoff@gmail.com<\/a>\r\n<\/br>\r\nIf you like this article. Show your Support! <a href=\"https:\/\/ko-fi.com\/middlewareinventory\">Buy me a Coffee.<\/a>\r\n<\/br>\r\n<\/p>\r\n<p style=\"color: palevioletred !important;\">Signup for Exclusive \"Subscriber-only\" Content<\/p>\r\n\n\t\t<div class=\"emaillist\">\n\t\t\t<form action=\"#\" method=\"post\" class=\"es_subscription_form es_shortcode_form\" id=\"es_subscription_form_1670577126\" data-source=\"ig-es\">\n\t\t\t\t\t\t\t\t<div class=\"es-field-wrap\"><label>Name*<br \/><input type=\"text\" name=\"name\" class=\"ig_es_form_field_name\" placeholder=\"\" value=\"\" required=\"required\" \/><\/label><\/div><div class=\"es-field-wrap\"><label>Email*<br \/><input class=\"es_required_field es_txt_email ig_es_form_field_email\" type=\"email\" name=\"email\" value=\"\" placeholder=\"\" required=\"required\" \/><\/label><\/div><input type=\"hidden\" name=\"lists[]\" value=\"1\" \/><input type=\"hidden\" name=\"form_id\" value=\"3\" \/>\n\t\t\t\t<input type=\"hidden\" name=\"es_email_page\" value=\"9373\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"es_email_page_url\" value=\"https:\/\/www.middlewareinventory.com\/blog\/kubernetes-namespace-user\/\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"status\" value=\"Unconfirmed\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"es-subscribe\" id=\"es-subscribe\" value=\"7aebfb1a9b\"\/>\n\t\t\t\t<label style=\"position:absolute;top:-99999px;left:-99999px;z-index:-99;\"><input type=\"email\" name=\"es_hp_email\" class=\"es_required_field\" tabindex=\"-1\" autocomplete=\"-1\" value=\"\"\/><\/label>\n\t\t\t\t\t\t\t\t<input type=\"submit\" name=\"submit\" class=\"es_subscription_form_submit es_submit_button es_textbox_button\" id=\"es_subscription_form_submit_1670577126\" value=\"Subscribe\"\/>\n\n\t\t\t\t\n\t\t\t\t<span class=\"es_spinner_image\" id=\"spinner-image\"><img src=\"https:\/\/www.middlewareinventory.com\/wp-content\/plugins\/email-subscribers\/lite\/public\/images\/spinner.gif\" alt=\"Loading\"\/><\/span>\n\n\t\t\t<\/form>\n\n\t\t\t<span class=\"es_subscription_message\" id=\"es_subscription_message_1670577126\"><\/span>\n\t\t<\/div>\n\n\t\t\r\n<\/div>\r\n<hr>\n","protected":false},"excerpt":{"rendered":"<p>Kubernetes RBAC is a vast subject and it continuously evolves as I pen down this article. In this article let us see some basics of Kubernetes RBAC and move to our objective How to restrict the access of users or groups to a specific namespace. Kubernetes RBAC is powered by[&#8230;]<\/p>\n","protected":false},"author":1,"featured_media":9380,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"_et_pb_use_builder":"","_et_pb_old_content":"","_et_gb_content_width":""},"categories":[151],"tags":[],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v14.9 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>How to limit user to a specific Namespace - Kubernetes RBAC | Devops Junction<\/title>\n<meta name=\"description\" content=\"How to create a Kubernetes user or group with only a single namespace access. how to limit a user to a single namespace with role and role binding. Kubernetes user and group with namespace access AWS EKS example\" \/>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/www.middlewareinventory.com\/blog\/kubernetes-namespace-user\/\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"How to limit user to a specific Namespace - Kubernetes RBAC | Devops Junction\" \/>\n<meta property=\"og:description\" content=\"How to create a Kubernetes user or group with only a single namespace access. how to limit a user to a single namespace with role and role binding. Kubernetes user and group with namespace access AWS EKS example\" \/>\n<meta property=\"og:url\" content=\"https:\/\/www.middlewareinventory.com\/blog\/kubernetes-namespace-user\/\" \/>\n<meta property=\"og:site_name\" content=\"Middleware Inventory\" \/>\n<meta property=\"article:publisher\" content=\"http:\/\/www.facebook.com\/devopsjunc\" \/>\n<meta property=\"article:published_time\" content=\"2022-11-28T18:32:40+00:00\" \/>\n<meta property=\"og:image\" content=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/11\/Screenshot-2022-11-27-at-2.29.11-PM-scaled.jpg\" \/>\n\t<meta property=\"og:image:width\" content=\"2560\" \/>\n\t<meta property=\"og:image:height\" content=\"1470\" \/>\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\n<meta name=\"twitter:creator\" content=\"@mwinventory\" \/>\n<meta name=\"twitter:site\" content=\"@mwinventory\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"Organization\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\",\"name\":\"Middleware Inventory\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"sameAs\":[\"http:\/\/www.facebook.com\/devopsjunc\",\"https:\/\/www.youtube.com\/channel\/UCRuqBFM6ioWwviNJkgOjeWw\",\"https:\/\/twitter.com\/mwinventory\"],\"logo\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/09\/Screenshot-2020-09-18-at-3.49.40-AM.jpg\",\"width\":300,\"height\":107,\"caption\":\"Middleware Inventory\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\"}},{\"@type\":\"WebSite\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"name\":\"Devops Junction\",\"description\":\"An inventory of [i]nformation, Middleware and much more.\",\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":\"https:\/\/www.middlewareinventory.com\/?s={search_term_string}\",\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/kubernetes-namespace-user\/#primaryimage\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2022\/11\/Screenshot-2022-11-27-at-2.29.11-PM-scaled.jpg\",\"width\":2560,\"height\":1470,\"caption\":\"kubernetes namespace user\"},{\"@type\":\"WebPage\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/kubernetes-namespace-user\/#webpage\",\"url\":\"https:\/\/www.middlewareinventory.com\/blog\/kubernetes-namespace-user\/\",\"name\":\"How to limit user to a specific Namespace - Kubernetes RBAC | Devops Junction\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\"},\"primaryImageOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/kubernetes-namespace-user\/#primaryimage\"},\"datePublished\":\"2022-11-28T18:32:40+00:00\",\"dateModified\":\"2022-11-28T18:32:40+00:00\",\"description\":\"How to create a Kubernetes user or group with only a single namespace access. how to limit a user to a single namespace with role and role binding. Kubernetes user and group with namespace access AWS EKS example\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/www.middlewareinventory.com\/blog\/kubernetes-namespace-user\/\"]}]},{\"@type\":\"Article\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/kubernetes-namespace-user\/#article\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/kubernetes-namespace-user\/#webpage\"},\"author\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\"},\"headline\":\"How to limit user to a specific Namespace &#8211; Kubernetes RBAC | Devops Junction\",\"datePublished\":\"2022-11-28T18:32:40+00:00\",\"dateModified\":\"2022-11-28T18:32:40+00:00\",\"mainEntityOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/kubernetes-namespace-user\/#webpage\"},\"commentCount\":0,\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/kubernetes-namespace-user\/#primaryimage\"},\"articleSection\":\"Kubernetes\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"CommentAction\",\"name\":\"Comment\",\"target\":[\"https:\/\/www.middlewareinventory.com\/blog\/kubernetes-namespace-user\/#respond\"]}]},{\"@type\":\"Person\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\",\"name\":\"Rumen Lishkov\",\"image\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#personlogo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/secure.gravatar.com\/avatar\/c22e4a54d67750291a9892531f94ffb3?s=96&d=mm&r=g\",\"caption\":\"Rumen Lishkov\"}}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","_links":{"self":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/9373"}],"collection":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/comments?post=9373"}],"version-history":[{"count":2,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/9373\/revisions"}],"predecessor-version":[{"id":9386,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/9373\/revisions\/9386"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media\/9380"}],"wp:attachment":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media?parent=9373"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/categories?post=9373"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/tags?post=9373"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}