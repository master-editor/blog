{"id":1388,"date":"2018-07-02T02:27:22","date_gmt":"2018-07-01T20:57:22","guid":{"rendered":"http:\/\/www.middlewareinventory.com\/?p=1388"},"modified":"2018-07-21T01:05:30","modified_gmt":"2018-07-20T19:35:30","slug":"vagrant-private-key-ansible-ssh-permission-denied-resolve-how","status":"publish","type":"post","link":"https:\/\/www.middlewareinventory.com\/blog\/vagrant-private-key-ansible-ssh-permission-denied-resolve-how\/","title":{"rendered":"Vagrant Private key &#8211; Ansible SSH Permission Denied &#8211; How to resolve."},"content":{"rendered":"<p>While building VMs with Vagrant and trying to run ansible-playbook with them over SSH connection.\u00a0 We get exceptions like <strong>Failed to connect to the host via ssh: Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password<\/strong><\/p>\n<p>The execution and the error would like something similar to the below.<\/p>\n<pre class=\"brush: java; title: ; notranslate\" title=\"\">\r\naksarav@mwinventory.in:~\/VirtualBox VMs\/vagrantVM$ ansible app -m ping -i ansible_hosts \r\n192.168.60.4 | UNREACHABLE! =&gt; {\r\n&quot;changed&quot;: false, \r\n&quot;msg&quot;: &quot;Failed to connect to the host via ssh: Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password).\\r\\n&quot;, \r\n&quot;unreachable&quot;: true\r\n}\r\n<\/pre>\n<p>This post presumes that you are using the Vagrant&#8217;s private key for ansible SSH authentication.<\/p>\n<p>&nbsp;<\/p>\n<h2>The Problem \/ The Scenario:<\/h2>\n<p>Here I am using the vagrant private key with ansible and passing it as a <code>ansible_ssh_private_key_file<\/code> variable<\/p>\n<p>A Snap of my <code>ansible_hosts<\/code> file shows my variable declaration<\/p>\n<pre class=\"brush: java; title: ; notranslate\" title=\"\">\r\n[multi:vars]\r\nansible_ssh_user=vagrant\r\nansible_ssh_private_key_file=~\/.vagrant.d\/insecure_private_key\r\nansible_ssh_common_args='-o StrictHostKeyChecking=no'\r\n<\/pre>\n<p>Though you would be able to directly SSH to the VM using the private_key. You would not be able to SSH with ansible.<\/p>\n<pre class=\"brush: java; title: ; notranslate\" title=\"\">aksarav@mwinventory.in:~\/VirtualBox VMs\/vagrantVM$ ssh -i ~\/.vagrant.d\/insecure_private_key vagrant@192.168.60.4\r\nDevelopment Environment\r\n[vagrant@mwiapp01 ~]$ <\/pre>\n<p>ansible <strong>ad-hoc<\/strong> commands (or) <strong>playbook<\/strong> will fail with the error. when executed with <code>-vvv<\/code> option in ansible. you could see the detailed info similar to this<\/p>\n<pre class=\"brush: java; title: ; notranslate\" title=\"\">aksarav@mwinventory.in:~\/VirtualBox VMs\/vagrantVM$ ansible app -m ping -i ansible_hosts -vvv\r\nansible 2.5.0\r\nconfig file = None\r\nconfigured module search path = [u'\/Users\/aksarav\/.ansible\/plugins\/modules', u'\/usr\/share\/ansible\/plugins\/modules']\r\nansible python module location = \/usr\/local\/Cellar\/ansible\/2.5.0\/libexec\/lib\/python2.7\/site-packages\/ansible\r\nexecutable location = \/usr\/local\/bin\/ansible\r\npython version = 2.7.14 (default, Mar 22 2018, 15:04:47) [GCC 4.2.1 Compatible Apple LLVM 9.0.0 (clang-900.0.39.2)]\r\nNo config file found; using defaults\r\nParsed \/Users\/aksarav\/VirtualBox VMs\/vagrantVM\/ansible_hosts inventory source with ini plugin\r\nMETA: ran handlers\r\nUsing module file \/usr\/local\/Cellar\/ansible\/2.5.0\/libexec\/lib\/python2.7\/site-packages\/ansible\/modules\/system\/ping.py\r\n&lt;192.168.60.4&gt; ESTABLISH SSH CONNECTION FOR USER: vagrant\r\n&lt;192.168.60.4&gt; SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o 'IdentityFile=&quot;\/Users\/aksarav\/.vagrant.d\/insecure_private_key&quot;' -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o User=vagrant -o ConnectTimeout=10 -o StrictHostKeyChecking=no -o ControlPath=\/Users\/aksarav\/.ansible\/cp\/1dc5e4da79 192.168.60.4 '\/bin\/sh -c '&quot;'&quot;'echo ~ &amp;&amp; sleep 0'&quot;'&quot;''\r\n&lt;192.168.60.4&gt; (255, '', 'Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password).\\r\\n')\r\n192.168.60.4 | UNREACHABLE! =&gt; {\r\n&quot;changed&quot;: false, \r\n&quot;msg&quot;: &quot;Failed to connect to the host via ssh: Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password).\\r\\n&quot;, \r\n&quot;unreachable&quot;: true\r\n}\r\n<\/pre>\n<h2><strong>Resolution<\/strong><\/h2>\n<p>Now we have our private-key of vagrant. Let us create a SSH public Key and copy it over to VMs.<\/p>\n<p>Execute the following command in the order it is given to accomplish.<\/p>\n<blockquote><p>ssh-keygen -y -f ~\/.vagrant.d\/insecure_private_key<\/p>\n<p>ssh-keygen -y -f ~\/.vagrant.d\/insecure_private_key &gt; ~\/.vagrant.d\/vagrant.pub<\/p>\n<p>ssh-copy-id -f -i ~\/.vagrant.d\/vagrant.pub vagrant@192.168.60.4<\/p><\/blockquote>\n<p>&nbsp;<\/p>\n<h2><strong>Execution Result<\/strong><\/h2>\n<pre class=\"brush: java; title: ; notranslate\" title=\"\">\r\naksarav@mwinventory.in:~\/VirtualBox VMs\/vagrantVM$ ssh-keygen -y -f ~\/.vagrant.d\/insecure_private_key \r\nssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr+kz4TjGYe7gHzIw+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoPkcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+GPXQ2MWZWFYbAGjyiYJnAmCP3NOTd0jMZEnDkbUvxhMmBYSdETk1rRgm+R4LOzFUGaHqHDLKLX+FIPKcF96hrucXzcWyLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQ==\r\n\r\naksarav@mwinventory.in:~\/VirtualBox VMs\/vagrantVM$ ssh-keygen -y -f ~\/.vagrant.d\/insecure_private_key &gt; ~\/.vagrant.d\/vagrant.pub\r\n\r\naksarav@mwinventory.in:~\/VirtualBox VMs\/vagrantVM$ ssh-copy-id -f -i ~\/.vagrant.d\/vagrant.pub vagrant@192.168.60.4\r\n\/usr\/bin\/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;\/Users\/aksarav\/.vagrant.d\/vagrant.pub&quot;\r\n\r\nNumber of key(s) added: 1\r\n\r\nNow try logging into the machine, with: &quot;ssh 'vagrant@192.168.60.4'&quot;\r\nand check to make sure that only the key(s) you wanted were added.\r\n\r\n\r\n<\/pre>\n<p>&nbsp;<\/p>\n<h2>Validation<\/h2>\n<pre class=\"brush: java; title: ; notranslate\" title=\"\">\r\naksarav@mwinventory.in:~\/VirtualBox VMs\/vagrantVM$ ansible app -m ping -i ansible_hosts\r\n192.168.60.4 | SUCCESS =&gt; {\r\n&quot;changed&quot;: false, \r\n&quot;ping&quot;: &quot;pong&quot;\r\n}\r\n<\/pre>\n<p>Now you could notice the issue is resolved and you could run the ansible ad-hoc commands and playbook without any hitch<\/p>\n<p>Cheers!.<\/p>\n<p>A K S A R A V<\/p>\n","protected":false},"excerpt":{"rendered":"<p>While building VMs with Vagrant and trying to run ansible-playbook with them over SSH connection.\u00a0 We get exceptions like Failed to connect to the host via ssh: Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password The execution and the error would like something similar to the below. This post presumes that you are using the[&#8230;]<\/p>\n","protected":false},"author":1,"featured_media":1390,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"_et_pb_use_builder":"","_et_pb_old_content":"","_et_gb_content_width":""},"categories":[98,99],"tags":[],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v14.9 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>Vagrant Private key - Ansible SSH Permission Denied - How to resolve.<\/title>\n<meta name=\"description\" content=\"How to resolve Ansible &quot;Failed to connect to the host via ssh: Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password) error while using Vagrant private key to make SSH connection. ansible_ssh_private_key_file variable is mapped to vagrant private key file ~\/.vagrant.d\/insecure_private_key file.\" \/>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-private-key-ansible-ssh-permission-denied-resolve-how\/\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"Vagrant Private key - Ansible SSH Permission Denied - How to resolve.\" \/>\n<meta property=\"og:description\" content=\"How to resolve Ansible &quot;Failed to connect to the host via ssh: Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password) error while using Vagrant private key to make SSH connection. ansible_ssh_private_key_file variable is mapped to vagrant private key file ~\/.vagrant.d\/insecure_private_key file.\" \/>\n<meta property=\"og:url\" content=\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-private-key-ansible-ssh-permission-denied-resolve-how\/\" \/>\n<meta property=\"og:site_name\" content=\"Middleware Inventory\" \/>\n<meta property=\"article:publisher\" content=\"http:\/\/www.facebook.com\/devopsjunc\" \/>\n<meta property=\"article:published_time\" content=\"2018-07-01T20:57:22+00:00\" \/>\n<meta property=\"article:modified_time\" content=\"2018-07-20T19:35:30+00:00\" \/>\n<meta property=\"og:image\" content=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screen-Shot-2018-07-02-at-2.26.20-AM.png\" \/>\n\t<meta property=\"og:image:width\" content=\"1009\" \/>\n\t<meta property=\"og:image:height\" content=\"493\" \/>\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\n<meta name=\"twitter:creator\" content=\"@mwinventory\" \/>\n<meta name=\"twitter:site\" content=\"@mwinventory\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"Organization\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\",\"name\":\"Middleware Inventory\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"sameAs\":[\"http:\/\/www.facebook.com\/devopsjunc\",\"https:\/\/www.youtube.com\/channel\/UCRuqBFM6ioWwviNJkgOjeWw\",\"https:\/\/twitter.com\/mwinventory\"],\"logo\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/09\/Screenshot-2020-09-18-at-3.49.40-AM.jpg\",\"width\":300,\"height\":107,\"caption\":\"Middleware Inventory\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\"}},{\"@type\":\"WebSite\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"name\":\"Devops Junction\",\"description\":\"An inventory of [i]nformation, Middleware and much more.\",\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":\"https:\/\/www.middlewareinventory.com\/?s={search_term_string}\",\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-private-key-ansible-ssh-permission-denied-resolve-how\/#primaryimage\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screen-Shot-2018-07-02-at-2.26.20-AM.png\",\"width\":1009,\"height\":493},{\"@type\":\"WebPage\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-private-key-ansible-ssh-permission-denied-resolve-how\/#webpage\",\"url\":\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-private-key-ansible-ssh-permission-denied-resolve-how\/\",\"name\":\"Vagrant Private key - Ansible SSH Permission Denied - How to resolve.\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\"},\"primaryImageOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-private-key-ansible-ssh-permission-denied-resolve-how\/#primaryimage\"},\"datePublished\":\"2018-07-01T20:57:22+00:00\",\"dateModified\":\"2018-07-20T19:35:30+00:00\",\"description\":\"How to resolve Ansible \\\"Failed to connect to the host via ssh: Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password) error while using Vagrant private key to make SSH connection. ansible_ssh_private_key_file variable is mapped to vagrant private key file ~\/.vagrant.d\/insecure_private_key file.\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-private-key-ansible-ssh-permission-denied-resolve-how\/\"]}]},{\"@type\":\"Article\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-private-key-ansible-ssh-permission-denied-resolve-how\/#article\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-private-key-ansible-ssh-permission-denied-resolve-how\/#webpage\"},\"author\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\"},\"headline\":\"Vagrant Private key &#8211; Ansible SSH Permission Denied &#8211; How to resolve.\",\"datePublished\":\"2018-07-01T20:57:22+00:00\",\"dateModified\":\"2018-07-20T19:35:30+00:00\",\"mainEntityOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-private-key-ansible-ssh-permission-denied-resolve-how\/#webpage\"},\"commentCount\":1,\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-private-key-ansible-ssh-permission-denied-resolve-how\/#primaryimage\"},\"articleSection\":\"Ansible,Vagrant\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"CommentAction\",\"name\":\"Comment\",\"target\":[\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-private-key-ansible-ssh-permission-denied-resolve-how\/#respond\"]}]},{\"@type\":\"Person\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\",\"name\":\"Rumen Lishkov\",\"image\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#personlogo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/secure.gravatar.com\/avatar\/c22e4a54d67750291a9892531f94ffb3?s=96&d=mm&r=g\",\"caption\":\"Rumen Lishkov\"}}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","_links":{"self":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/1388"}],"collection":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/comments?post=1388"}],"version-history":[{"count":2,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/1388\/revisions"}],"predecessor-version":[{"id":1391,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/1388\/revisions\/1391"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media\/1390"}],"wp:attachment":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media?parent=1388"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/categories?post=1388"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/tags?post=1388"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}