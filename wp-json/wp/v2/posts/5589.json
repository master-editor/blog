{"id":5589,"date":"2020-07-31T12:47:13","date_gmt":"2020-07-31T07:17:13","guid":{"rendered":"https:\/\/www.middlewareinventory.com\/?p=5589"},"modified":"2022-06-16T15:37:37","modified_gmt":"2022-06-16T10:07:37","slug":"postfix-relay-office-365","status":"publish","type":"post","link":"https:\/\/www.middlewareinventory.com\/blog\/postfix-relay-office-365\/","title":{"rendered":"Postfix SMTP relay to Office 365 &#8211; Single and Multiple SMTP Servers"},"content":{"rendered":"<p>Postfix is a powerful opensource mail server with a lot of customization options available built-in. I recently had a requirement to set up an Organization-wide mail server to perform SMTP relay to Office365 and allow our Java, JS, Python applications to send emails from different office365 email ids based on the Subject (or) the sender details.<\/p>\n<p>Before we think about the multiple email IDs and sender-based relay in postfix. Let us cover the basic setup and send our test emails.<\/p>\n<p>I am going to split this article into four parts or subtopics<\/p>\n<ol>\n<li>Configuring Postfix SMTP relay to Office 365 and testing it with Single email ID\/Domain<\/li>\n<li>Configuration Postfix SMTP relay for multiple domains and sender-based relay<\/li>\n<li>Troubleshooting SMTP relay and Fixing Email Delivery Problems<\/li>\n<li>Check your email Score (or) Spam test result<\/li>\n<\/ol>\n<p>Before we proceed with these three steps I would like to take you on a quick tour around the three different connection methodologies you can have with Office365. Knowing which one you are using would help you to fix the problems faster when you run into one.<\/p>\n<p>&nbsp;<\/p>\n<h2><span style=\"color: #003366;\">Three types of Integration supported by <span style=\"color: #e31974;\">Office365<\/span>.<\/span><\/h2>\n<p>If you browse through the internet you would find numerous articles with different methods to set up SMTP relay from POSTFIX or to connect your application or device and relay your mails. So I am listing out the three different types of integrations we can do with Office365 to send emails.<\/p>\n<h3><strong>1. SMTP client submission<br \/>\n<\/strong><\/h3>\n<p>The client should be connected to the Server &#8220;smtp.office365.com&#8221; on port 587 and in this approach, we can send emails to internal and external recipients<\/p>\n<figure style=\"width: 611px\" class=\"wp-caption alignnone\"><img src=\"https:\/\/docs.microsoft.com\/en-us\/exchange\/exchangeonline\/media\/d5c5a7fa-aba4-4bf4-976f-4c7128fcab2d.png\" alt=\"Shows how a multifunction printer connects to Microsoft 365 or Office 365 using SMTP client submission.\" width=\"611\" height=\"420\" data-linktype=\"relative-path\" \/><figcaption class=\"wp-caption-text\">Image Credits to Microsoft<\/figcaption><\/figure>\n<h3><strong>2. Direct send<\/strong><\/h3>\n<p>In this method, we are connected to our Organization Mail Server hostname (MX) whose name ends with &#8220;mail.protection.outlook.com&#8221;<\/p>\n<p>In my case, <span id=\"lblResult\"><a href=\"https:\/\/mxtoolbox.com\/SuperTool.aspx?action=mx:gritfy.com#\">gritfy-com.mail.protection.outlook.com<\/a><\/span> is my mail server. to find out your organization&#8217;s mail server MX record use <a href=\"https:\/\/mxtoolbox.com\/\">https:\/\/mxtoolbox.com\/<\/a><\/p>\n<p>With this method, email cannot be sent to recipients outside your organization<\/p>\n<p><img src=\"https:\/\/docs.microsoft.com\/en-us\/exchange\/exchangeonline\/media\/cb07aae7-ca31-43a7-a468-74c293b37a66.png\" alt=\"Shows how a multifunction printer uses your Microsoft 365 or Office 365 MX endpoint to send email directly to recipients in your organization only.\" data-linktype=\"relative-path\" \/><\/p>\n<h3><strong>3. Office 365 SMTP relay ( Discussed in this Post )<br \/>\n<\/strong><\/h3>\n<p>In this method, we are connected to our Organization Mail Server hostname (MX) whose name ends with &#8220;mail.protection.outlook.com&#8221;<\/p>\n<p>There is a connector set up in Office 365 for emails sent from your organization&#8217;s mail server. In our case it is postfix.<\/p>\n<p>In this method, we can send mail to external recipients as well as internal organization.<\/p>\n<p><img src=\"https:\/\/docs.microsoft.com\/en-us\/exchange\/exchangeonline\/media\/258cb8b1-752d-47b8-91e9-a0176dfcfad4.png\" alt=\"Shows how a multifunction printer connects to Microsoft 365 or Office 365 using SMTP relay.\" data-linktype=\"relative-path\" \/><\/p>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<h2><span style=\"color: #003366;\">Simple <span style=\"color: #e31974;\">SMTP relay<\/span> with Postfix Office365<\/span><\/h2>\n<p>As shown in the preceding method 3, we are going to set up an SMTP relay with Connectors in Office365 and Postfix to send emails to internal and external recipients.<\/p>\n<p>Let us start from installing the postfix mail server in your Linux host.\u00a0 you have to choose your appropriate package manager like <code>yum<\/code> or <code>apt-get<\/code><\/p>\n<h3>Installing postfix mail server<\/h3>\n<p>In my case, it is CentOS so I am going with yum<\/p>\n<pre>yum install postfix<\/pre>\n<h3><\/h3>\n<h3>Update the Postfix configuration<\/h3>\n<p>If you goto the <code>\/etc\/postfix<\/code> directory and list the files, you would find a set of configuration files already present and we are going to update some of the configurations to make the SMTP relay work through the office365<\/p>\n<h4><strong>Updating Relay Host in postfix configuration<\/strong><\/h4>\n<p>the first file we are going to make changes is <code>main.cf<\/code> file and you have to find and update the parameter named <code>relay_host=<\/code> if it is commented, Uncomment it<\/p>\n<p>You are going to use your Organization MX Server endpoint in there with the port number 25, In my case it is<\/p>\n<pre>relayhost = [gritfy-com.mail.protection.outlook.com]:25<\/pre>\n<h4><\/h4>\n<h4><strong>Updating SMTP Outbound Relay configuration<\/strong><\/h4>\n<p>In the same <code>main.cf<\/code> file add the following lines at the end of the file, The configuration is to enable a Security using sasl_passwd file where we would be defining our email and password. We can also configure the outbound mail to be encrypted with TLS using <code>smtp_tls_security_level<\/code> option but in this post, we are going without TLS<\/p>\n<pre>smtp_sasl_auth_enable = yes\r\nsmtp_sasl_password_maps = hash:\/etc\/postfix\/sasl_passwd\r\nsmtp_sasl_security_options = noanonymous\t \t \r\nsmtp_tls_security_level = may\t \t \r\nheader_size_limit = 409600<\/pre>\n<p>So we have defined the <code>password_maps<\/code> file within the main.cf file but have not created it yet. so our next step is to create one and it should be on the <code>\/etc\/postfix<\/code> directory with the name <code>sasl_passwd<\/code><\/p>\n<p>&nbsp;<\/p>\n<h4><strong>Creating sasl_passwd file with Authentication info<\/strong><\/h4>\n<p>Create a new file named sasl_passwd under \/etc\/postfix and enter your Office365 account details.<\/p>\n<p>It is recommended that this account does not have admin privileges as the <code>sasl_passwd<\/code> file would contain this password as cleartext.<\/p>\n<p>Here is the content of my sasl_passwd file for your reference.<\/p>\n<pre>[gritfy-com.mail.protection.outlook.com]:25 username@gritfy.com:SecurePassword<\/pre>\n<p>Postfix reads the login info from the Database file so it is necessary that we should convert this file to a *.db format. In order to do that<\/p>\n<p>you can use the command<\/p>\n<pre>postmap \/etc\/postfix\/sasl_passwd<\/pre>\n<p>upon the successful execution of this command, you can see a new file would be created in the same name with <code>.db<\/code> extension<\/p>\n<p>By default, these files would have the global read permissions which let all logged-in user to the server read the files. to prevent it, you can consider setting up some file permissions like shown below. this would enable only owners to read and write the file and restrict all others<\/p>\n<pre>sudo chmod 0600 \/etc\/postfix\/sasl_passwd \/etc\/postfix\/sasl_passwd.db<\/pre>\n<p>Now we have configured the postfix mail server but since we are using the SMTP relay method of Office365 integration, we need to create our Office365 connector which requires Office365 Admin privileges.<\/p>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<h3>Creating\u00a0 Connector in Office365<\/h3>\n<p>To create a connector in Office365 you need to have Global Admin or Exchange Admin role.<\/p>\n<p>Login to Office365 Exchange Admin page and under <code>mail flow<\/code> option you would find an option named <code>connectors<\/code> click on it to create a new connector<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/07\/Screenshot-2020-07-27-at-3.59.53-AM.png\"><img class=\"alignnone size-full wp-image-5595\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/07\/Screenshot-2020-07-27-at-3.59.53-AM.png\" alt=\"\" width=\"2494\" height=\"1640\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/07\/Screenshot-2020-07-27-at-3.59.53-AM.png 2494w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/07\/Screenshot-2020-07-27-at-3.59.53-AM-300x197.png 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/07\/Screenshot-2020-07-27-at-3.59.53-AM-768x505.png 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/07\/Screenshot-2020-07-27-at-3.59.53-AM-1024x673.png 1024w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/07\/Screenshot-2020-07-27-at-3.59.53-AM-120x80.png 120w\" sizes=\"(max-width: 2494px) 100vw, 2494px\" \/><\/a><\/p>\n<p>Once you have clicked on the Connectors, you would be prompted few details where you need to either choose the Connector to allow the clients based on the Certificate or by the IP.<\/p>\n<p>In this post, we are going with the IP method where Office365 Connector would allow the client applications like Postfix to send emails when they are from a specific public IP address.<\/p>\n<p>So if you are implementing this in your Organization it is advised that you have a static public IP enabled for your Linux server. for AWS users it is even simple, as you can allocate an Elastic IP for your instance where you are setting this up.<\/p>\n<p>Take a look at this Screen record of me doing the same setup.<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/07\/ezgif.com-optimize.gif\"><img class=\"alignnone size-full wp-image-5596\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/07\/ezgif.com-optimize.gif\" alt=\"Office 365 Relay Postfix\" width=\"1396\" height=\"710\" \/><\/a><\/p>\n<p>&nbsp;<\/p>\n<h3>Updating SPF record with your public IP ( to avoid your email ending as SPAM )<\/h3>\n<p>All the steps we have done till now is enough to get your email going out from Postfix relay.<\/p>\n<p>We should do one more thing to save our emails getting ended up into the SPAM folder.<\/p>\n<p>If you are in the AWS world, you can do it easily in Route53. if you are in public providers like GoDaddy and Bluehost you need to find their own technical documentation on how to add this new SPF record.<\/p>\n<p>Basically our objective here is to add our public ipv4 IP to the SPF record. It would look something like this, you can keep adding many ipv4 records as you add more<\/p>\n<pre class=\"alert alert-success\">v=spf1 ip4:49.205.79.85 include:spf.protection.outlook.com -all<\/pre>\n<p>To create SPF records in the right syntax you can use <a href=\"https:\/\/mxtoolbox.com\/SPFRecordGenerator.aspx\">SPF record generator<\/a><\/p>\n<p>To validate your SPF record you can use this <a href=\"https:\/\/mxtoolbox.com\/SuperTool.aspx\">mxtoolbox supertool<\/a><\/p>\n<p>&nbsp;<\/p>\n<h3>Whitelist your Server URL in the office365<\/h3>\n<p>Also, you need to whitelist your Server IP for the Office365 to accept your connection request on port 25 and to honour your mail submission<\/p>\n<p>Exchange Admin Center -&gt; Connection Filter -&gt; Add Allowed IP Address<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/07\/Office365-ip-1.gif\"><img class=\"alignnone size-full wp-image-5603\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/07\/Office365-ip-1.gif\" alt=\"\" width=\"1610\" height=\"816\" \/><\/a><\/p>\n<p>If your IP is not whitelisted, You might see some errors like given below.<\/p>\n<pre>Jul 30 22:35:57 mwiapp01 postfix\/smtp[18821]: AC8A74078131: \r\nto=&lt;someemail@gmail.com&gt;, \r\nrelay=gritfy-com.mail.protection.outlook.com[104.47.100.36]:25, \r\ndelay=5.9, delays=0.09\/0.05\/4.1\/1.6, dsn=5.7.750, \r\nstatus=bounced (host gritfy-com.mail.protection.outlook.com[104.47.100.36] \r\nsaid: 550 5.7.750 Service unavailable. \r\nClient blocked from sending from unregistered domains. \r\nFor more information please go to http:\/\/go.microsoft.com\/fwlink\/?LinkId=526653. AS(800051) \r\n[MA1IND01FT006.eop-IND01.prod.protection.outlook.com] (in reply to end of DATA command))<\/pre>\n<p>&nbsp;<\/p>\n<h3>Restart Postfix and Send some email to test it<\/h3>\n<p>Now go back to the server and restart your postfix using your <code>systemctl<\/code> or <code>service<\/code> command and after validating the services are started. you can send yourself a test email to validate your setup<\/p>\n<pre>echo \"Some Email to Test\"|mailx -s \"Test Email\" -r username@gritfy.com someemail@gmail.com<\/pre>\n<p>If everything went well you should see your mail <code>status=sent<\/code> in your maillog usually located in <code>\/var\/log\/maillog<\/code><\/p>\n<pre>Jul 30 22:44:32 mwiapp01 postfix\/smtp[19253]: 60DAF4078131: \r\nto=&lt;someemail@gmail.com&gt;, \r\nrelay=gritfy-com.mail.protection.outlook.com[104.47.100.36]:25, \r\ndelay=7.2, delays=0.05\/0.03\/4\/3.1, dsn=2.6.0, \r\nstatus=sent (250 2.6.0 &lt;5f234d49.DY75T7s4TYaD7ECn%username@gritfy.com&gt; \r\n[InternalId=23136988825661, Hostname=MA1PR01MB3468.INDPRD01.PROD.OUTLOOK.COM] 8682 bytes in 0.311, 27.186 KB\/sec Queued mail for delivery)\r\nJul 30 22:44:32 mwiapp01 postfix\/qmgr[3774]: 60DAF4078131: removed<\/pre>\n<p>&nbsp;<\/p>\n<h2><span style=\"color: #003366;\">Multiple Domains and <span style=\"color: #e31974;\">Sender Based Relay<\/span> PostFIX\u00a0 Office365<\/span><\/h2>\n<p>You can have more than one relays in Postfix and configure postfix to choose the relay configuration and credentials based on the sender email ID<\/p>\n<p>For example, If you want to send emails from two different users on the same domain you can do that<\/p>\n<pre>username1@gritfy.com\r\nusername2@gritfy.com<\/pre>\n<p>or if you want to send emails from two different domains and email IDs you can do that too with postfix<\/p>\n<pre>username@gritfy.com\r\nusername@middlwareinventory.com<\/pre>\n<p>&nbsp;<\/p>\n<p>So How to achieve sender based SMTP relay in postfix<\/p>\n<p>If you are trying to use two different Office365 accounts you need to do all the same steps we did earlier, Since this post is about Office365 and postfix let me presume that the other account hosted by Office365 too.<\/p>\n<p>So you need to redo these steps on the other Email Domain as well. in my case it is <code>middlewareinventory.com<\/code> as I have already done these steps for <code>grify.com<\/code><\/p>\n<ol>\n<li>Create a Connector in Corresponding Office365 and allow the IP of your Server<\/li>\n<li>Whitelist your IP in Exchange Connection Filter<\/li>\n<li>Update your SPF record and add your Server IP where your Postfix is running<\/li>\n<\/ol>\n<p>I presume that you have done these steps flawlessly Let us skip to the postfix configuration section<\/p>\n<h3>Update the main.cf configuration of Postfix to Support Sender based relay<\/h3>\n<p>If you are following along from the Single SMTP relay and to this multiple smtp relay you need to update few values, If you are directly setting up sender based relay you can just copy and paste these values in your <code>\/etc\/postfix\/main.cf<\/code> file at the bottom<\/p>\n<pre>smtp_sasl_auth_enable = yes\r\nsmtp_sasl_password_maps = hash:\/etc\/postfix\/sasl_passwd_maps\r\nsmtp_sasl_security_options = noanonymous\r\nsmtp_tls_security_level = may\r\nheader_size_limit = 4096000\r\ninet_protocols = all\r\nsmtp_sender_dependent_authentication = yes\r\nsender_dependent_relayhost_maps = hash:\/etc\/postfix\/relay_by_sender<\/pre>\n<p>If you look at the configuration there are two files (maps) we need to create and place it on the server. First, let us create the <code>\/etc\/postfix\/relay_by_sender<\/code> file which is needed for the sender dependent relay in Postfix<\/p>\n<h3>Create a relay_by_sender file for Postfix and Keep the Mail Server (MX) details<\/h3>\n<p>Within the <code>relay_by_sender<\/code> file we need to paste the following content. Make sure you update these values with your mail server smart host (mail server) details.<\/p>\n<pre>username@gritfy.com [gritfy-com.mail.protection.outlook.com]:25\r\nusername@devopsjunction.com [devopsjunction.mail.protection.outlook.com]:25<\/pre>\n<p>Once you have saved the file in <code>\/etc\/postfix\/relay_by_sender<\/code> now you need to create a DB file for postfix to use it. using the postmap command<\/p>\n<pre>postmap \/etc\/postfix\/relay_by_sender<\/pre>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<h3>Create the Sasl_Passwd_maps file with relays and credentials<\/h3>\n<p>Now we need to provide credentials for both of these relays we have created. so create a file under <code>\/etc\/postfix<\/code> with the name <code>sasl_passwd_maps<\/code><\/p>\n<pre>[gritfy-com.mail.protection.outlook.com]:25 username@gritfy.com:MysecretPassword\r\n[devopsjunction.mail.protection.outlook.com]:25 username@devopsjunction.com:Password<\/pre>\n<p>and just like you did earlier you have to create the db file using postmap<\/p>\n<pre>postmap \/etc\/postfix\/sasl_passwd_maps<\/pre>\n<p>&nbsp;<\/p>\n<h3>Reload or the Restart the Postfix server and test the relays<\/h3>\n<p>Now you have made necessary changes for your sender based relays to work. So go ahead and restart\/reload your postfix server<\/p>\n<pre>service postfix reload(or)\r\nservice postfix restart<\/pre>\n<p>Send some test emails to validate if the mails are passing through the right relays<\/p>\n<p>To test the first sender with gritfy.com. Mention the sender address with <code>-r<\/code> while sending your email.<\/p>\n<pre>echo \"Some Email to Test\"|mailx -s \"Test Email\" -r username@gritfy.com someone@somecompany.com<\/pre>\n<p>To test the second sender with devopsjunction.com, update the sender address after <code>-r<\/code> and hit it<\/p>\n<pre>echo \"Some Email to Test\"|mailx -s \"Test Email\" -r username@devopsjunction.com someone@somecompany.com<\/pre>\n<p>to know which relay the email is going through and to see if it has been sent to the recipient or not. use the maillog usually located at <code>\/var\/log\/maillog<\/code><\/p>\n<pre>Jul 31 00:58:35 mwiapp01 postfix\/smtp[26151]: 28D5A4078131: \r\nto=&lt;someone@somecompany.com&gt;, \r\n<span style=\"color: #993300;\">relay=gritfy-com.mail.protection.outlook.com[104.47.100.36]:25<\/span>, \r\ndelay=7.8, delays=0.06\/0.05\/4.2\/3.5, dsn=2.6.0, \r\n<span style=\"color: #993300;\">status=sent<\/span> (250 2.6.0 &lt;5f236cb4.kaTYiINfdbNN2Gyr%username@gritfy.com&gt; [InternalId=22905060593379, Hostname=MAXPR01MB4031.INDPRD01.PROD.OUTLOOK.COM] 8684 bytes in 0.610, 13.883 KB\/sec Queued mail for delivery)\r\nJul 31 00:58:35 mwiapp01 postfix\/qmgr[25474]: 28D5A4078131: removed<\/pre>\n<p>So we have successfully testing Single and Multiple Sender Relay with Office365 and Postfix<\/p>\n<p>Now I want to give a few links for you to help you with your SMTP relay troubleshooting and to fix your setup issues.<\/p>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<h2><span style=\"color: #003366;\"><span style=\"color: #e31974;\">Troubleshooting<\/span> SMTP relay issues<\/span><\/h2>\n<p>There are few errors I have faced during the implementation of this setup and I found some articles on the internet to help me. I am listing them here for your reference.<\/p>\n<p>This type of SMTP relay is little complex but highly customizable and programmable and since you are connecting directly to MX server or Smart Host of Office365. There are lot of restrictions to identify and to ensure that you are not a Spammer.<\/p>\n<p>Like IP restrictions and blocks etc and the other issue could be SPF and IP whitelisting. So make sure you do everything discussed in this post without missing still if you are having issues, here are few links I can refer to you<\/p>\n<ol>\n<li>\u00a0<a href=\"https:\/\/docs.microsoft.com\/en-us\/exchange\/mail-flow-best-practices\/fix-issues-with-printers-scanners-and-lob-applications-that-send-email-using-off\">Microsoft article on Troubleshooting the SMTP relay<\/a><\/li>\n<li>\u00a0<a href=\"https:\/\/bobcares.com\/blog\/office-365-relay-access-denied-error\/\">Five possible root causes for Relay access denied and how to fix it<\/a><\/li>\n<li>\u00a0<a href=\"https:\/\/mxtoolbox.com\/blacklists.aspx\">IP blacklist checker and Email Delivery Problem finder<\/a><\/li>\n<\/ol>\n<p>&nbsp;<\/p>\n<h2>Testing the Score of your SMTP setup or Spam Test Result<\/h2>\n<p>I highly recommend testing your SMTP setup by sending email to the dynamic email ID generated by <a href=\"https:\/\/www.mail-tester.com\/\">https:\/\/www.mail-tester.com\/<\/a><\/p>\n<p>Visit the web page and copy the dynamic email ID shown on the screen and once the email is sent. Check your score. It would list out your configuration issues and Spammyness of your email with possible fixes<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/07\/Screenshot-2020-07-31-at-10.44.03-AM.png\"><img class=\"alignnone size-full wp-image-5606\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/07\/Screenshot-2020-07-31-at-10.44.03-AM.png\" alt=\"Postfix Office365 relay\" width=\"2322\" height=\"1960\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/07\/Screenshot-2020-07-31-at-10.44.03-AM.png 2322w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/07\/Screenshot-2020-07-31-at-10.44.03-AM-300x253.png 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/07\/Screenshot-2020-07-31-at-10.44.03-AM-768x648.png 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/07\/Screenshot-2020-07-31-at-10.44.03-AM-1024x864.png 1024w\" sizes=\"(max-width: 2322px) 100vw, 2322px\" \/><\/a><\/p>\n<p>&nbsp;<\/p>\n<p>I have prepared this article in a hope that it serves as a Single page of reference when you want to set up Postfix Office365 SMTP relay and troubleshoot it.\u00a0 Hope it helps.<\/p>\n<p>Ask me questions using comments<\/p>\n<p>Cheers<br \/>\nRumen Lishkov (\u0b9a\u0bb0\u0bb5\u0ba3\u0ba9\u0bcd \u0b85 \u0b95)<\/p>\n<div id=\"postfollow\">\r\n<a href='https:\/\/ko-fi.com\/O4O51FG7C' target='_blank'><img height='46' style='border:0px;height:46px;width: 186px' src='https:\/\/az743702.vo.msecnd.net\/cdn\/kofi3.png?v=2' border='0' alt='Buy Me a Coffee at ko-fi.com' \/><\/a>\r\n<p>Follow us on<a href=\"http:\/\/www.facebook.com\/middlewareinventory\">Facebook<\/a> or<a href=\"http:\/\/www.twitter.com\/mwinventory\">Twitter<\/a>\r\n<\/br>\r\nFor more practical videos and tutorials. <a href=\"https:\/\/www.youtube.com\/channel\/UCRuqBFM6ioWwviNJkgOjeWw?sub_confirmation=1\">Subscribe to our channel<\/a>\r\n<\/br>\r\nFollow me on Linkedin <a href=\"https:\/\/www.linkedin.com\/comm\/mynetwork\/discovery-see-all?usecase=PEOPLE_FOLLOWS&followMember=saravakmwinventory\">My Profile<\/a>\r\n<\/br>\r\n<\/i>For any Consultation or to hire us <a href=\"mailto:rumenlishkoff@gmail.com\"> rumenlishkoff@gmail.com<\/a>\r\n<\/br>\r\nIf you like this article. Show your Support! <a href=\"https:\/\/ko-fi.com\/middlewareinventory\">Buy me a Coffee.<\/a>\r\n<\/br>\r\n<\/p>\r\n<p style=\"color: palevioletred !important;\">Signup for Exclusive \"Subscriber-only\" Content<\/p>\r\n\n\t\t<div class=\"emaillist\">\n\t\t\t<form action=\"#\" method=\"post\" class=\"es_subscription_form es_shortcode_form\" id=\"es_subscription_form_1670577965\" data-source=\"ig-es\">\n\t\t\t\t\t\t\t\t<div class=\"es-field-wrap\"><label>Name*<br \/><input type=\"text\" name=\"name\" class=\"ig_es_form_field_name\" placeholder=\"\" value=\"\" required=\"required\" \/><\/label><\/div><div class=\"es-field-wrap\"><label>Email*<br \/><input class=\"es_required_field es_txt_email ig_es_form_field_email\" type=\"email\" name=\"email\" value=\"\" placeholder=\"\" required=\"required\" \/><\/label><\/div><input type=\"hidden\" name=\"lists[]\" value=\"1\" \/><input type=\"hidden\" name=\"form_id\" value=\"3\" \/>\n\t\t\t\t<input type=\"hidden\" name=\"es_email_page\" value=\"5589\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"es_email_page_url\" value=\"https:\/\/www.middlewareinventory.com\/blog\/postfix-relay-office-365\/\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"status\" value=\"Unconfirmed\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"es-subscribe\" id=\"es-subscribe\" value=\"7aebfb1a9b\"\/>\n\t\t\t\t<label style=\"position:absolute;top:-99999px;left:-99999px;z-index:-99;\"><input type=\"email\" name=\"es_hp_email\" class=\"es_required_field\" tabindex=\"-1\" autocomplete=\"-1\" value=\"\"\/><\/label>\n\t\t\t\t\t\t\t\t<input type=\"submit\" name=\"submit\" class=\"es_subscription_form_submit es_submit_button es_textbox_button\" id=\"es_subscription_form_submit_1670577965\" value=\"Subscribe\"\/>\n\n\t\t\t\t\n\t\t\t\t<span class=\"es_spinner_image\" id=\"spinner-image\"><img src=\"https:\/\/www.middlewareinventory.com\/wp-content\/plugins\/email-subscribers\/lite\/public\/images\/spinner.gif\" alt=\"Loading\"\/><\/span>\n\n\t\t\t<\/form>\n\n\t\t\t<span class=\"es_subscription_message\" id=\"es_subscription_message_1670577965\"><\/span>\n\t\t<\/div>\n\n\t\t\r\n<\/div>\r\n<hr>\n","protected":false},"excerpt":{"rendered":"<p>Postfix is a powerful opensource mail server with a lot of customization options available built-in. I recently had a requirement to set up an Organization-wide mail server to perform SMTP relay to Office365 and allow our Java, JS, Python applications to send emails from different office365 email ids based on[&#8230;]<\/p>\n","protected":false},"author":1,"featured_media":5608,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"_et_pb_use_builder":"","_et_pb_old_content":"","_et_gb_content_width":""},"categories":[396,7],"tags":[],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v14.9 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>Postfix SMTP relay to Office 365 - Single and Multiple SMTP Servers<\/title>\n<meta name=\"description\" content=\"Postfix relay Office365 setup for Single and Multiple domains, Connecting to Office365 SMTP servers with Postfix. Postfix SMTP relay to Office365 and Send emails from Linux Centos or Ubuntu. Sender based relay with multiple domains in Postfix Office365 Postfix Office365 SMTP connector how to setup. SMTP relay Postfix\" \/>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/www.middlewareinventory.com\/blog\/postfix-relay-office-365\/\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"Postfix SMTP relay to Office 365 - Single and Multiple SMTP Servers\" \/>\n<meta property=\"og:description\" content=\"Postfix relay Office365 setup for Single and Multiple domains, Connecting to Office365 SMTP servers with Postfix. Postfix SMTP relay to Office365 and Send emails from Linux Centos or Ubuntu. Sender based relay with multiple domains in Postfix Office365 Postfix Office365 SMTP connector how to setup. SMTP relay Postfix\" \/>\n<meta property=\"og:url\" content=\"https:\/\/www.middlewareinventory.com\/blog\/postfix-relay-office-365\/\" \/>\n<meta property=\"og:site_name\" content=\"Middleware Inventory\" \/>\n<meta property=\"article:publisher\" content=\"http:\/\/www.facebook.com\/devopsjunc\" \/>\n<meta property=\"article:published_time\" content=\"2020-07-31T07:17:13+00:00\" \/>\n<meta property=\"article:modified_time\" content=\"2022-06-16T10:07:37+00:00\" \/>\n<meta property=\"og:image\" content=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/07\/SMTP-Relay-0365.png\" \/>\n\t<meta property=\"og:image:width\" content=\"612\" \/>\n\t<meta property=\"og:image:height\" content=\"431\" \/>\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\n<meta name=\"twitter:creator\" content=\"@mwinventory\" \/>\n<meta name=\"twitter:site\" content=\"@mwinventory\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"Organization\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\",\"name\":\"Middleware Inventory\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"sameAs\":[\"http:\/\/www.facebook.com\/devopsjunc\",\"https:\/\/www.youtube.com\/channel\/UCRuqBFM6ioWwviNJkgOjeWw\",\"https:\/\/twitter.com\/mwinventory\"],\"logo\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/09\/Screenshot-2020-09-18-at-3.49.40-AM.jpg\",\"width\":300,\"height\":107,\"caption\":\"Middleware Inventory\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\"}},{\"@type\":\"WebSite\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"name\":\"Devops Junction\",\"description\":\"An inventory of [i]nformation, Middleware and much more.\",\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":\"https:\/\/www.middlewareinventory.com\/?s={search_term_string}\",\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/postfix-relay-office-365\/#primaryimage\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/07\/SMTP-Relay-0365.png\",\"width\":612,\"height\":431},{\"@type\":\"WebPage\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/postfix-relay-office-365\/#webpage\",\"url\":\"https:\/\/www.middlewareinventory.com\/blog\/postfix-relay-office-365\/\",\"name\":\"Postfix SMTP relay to Office 365 - Single and Multiple SMTP Servers\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\"},\"primaryImageOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/postfix-relay-office-365\/#primaryimage\"},\"datePublished\":\"2020-07-31T07:17:13+00:00\",\"dateModified\":\"2022-06-16T10:07:37+00:00\",\"description\":\"Postfix relay Office365 setup for Single and Multiple domains, Connecting to Office365 SMTP servers with Postfix. Postfix SMTP relay to Office365 and Send emails from Linux Centos or Ubuntu. Sender based relay with multiple domains in Postfix Office365 Postfix Office365 SMTP connector how to setup. SMTP relay Postfix\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/www.middlewareinventory.com\/blog\/postfix-relay-office-365\/\"]}]},{\"@type\":\"Article\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/postfix-relay-office-365\/#article\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/postfix-relay-office-365\/#webpage\"},\"author\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\"},\"headline\":\"Postfix SMTP relay to Office 365 &#8211; Single and Multiple SMTP Servers\",\"datePublished\":\"2020-07-31T07:17:13+00:00\",\"dateModified\":\"2022-06-16T10:07:37+00:00\",\"mainEntityOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/postfix-relay-office-365\/#webpage\"},\"commentCount\":0,\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/postfix-relay-office-365\/#primaryimage\"},\"articleSection\":\"Office365,Unix\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"CommentAction\",\"name\":\"Comment\",\"target\":[\"https:\/\/www.middlewareinventory.com\/blog\/postfix-relay-office-365\/#respond\"]}]},{\"@type\":\"Person\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\",\"name\":\"Rumen Lishkov\",\"image\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#personlogo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/secure.gravatar.com\/avatar\/c22e4a54d67750291a9892531f94ffb3?s=96&d=mm&r=g\",\"caption\":\"Rumen Lishkov\"}}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","_links":{"self":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/5589"}],"collection":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/comments?post=5589"}],"version-history":[{"count":15,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/5589\/revisions"}],"predecessor-version":[{"id":5615,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/5589\/revisions\/5615"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media\/5608"}],"wp:attachment":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media?parent=5589"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/categories?post=5589"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/tags?post=5589"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}