{"id":5138,"date":"2020-02-24T03:32:06","date_gmt":"2020-02-23T22:02:06","guid":{"rendered":"https:\/\/www.middlewareinventory.com\/?p=5138"},"modified":"2022-02-11T01:39:29","modified_gmt":"2022-02-10T20:09:29","slug":"ansible-apt-examples","status":"publish","type":"post","link":"https:\/\/www.middlewareinventory.com\/blog\/ansible-apt-examples\/","title":{"rendered":"Ansible apt module Examples  &#8211; install packages with apt | Devops Junction"},"content":{"rendered":"<div style=\"display: none;\"><\/div>\n<div style=\"display: none;\"><\/div>\n<p>Ansible APT Package manager is an Ubuntu equivalent for RedHat yum package manager. Just like all other ansible modules\u00a0<code>apt<\/code>\u00a0ansible module is built after one specific unix command of Debian\u00a0<code>apt-get<\/code><\/p>\n<p>It is always recommended to choose the modules rather using the raw unix commands over the shell module as it would bring more standard and fault tolerance to your Ansible Playbook<\/p>\n<p>So how to use ansible apt module in the playbook or as an ad hoc.<\/p>\n<p>Well!. this article is going to cover <strong>ansible apt<\/strong> module in detail with various examples.<\/p>\n<p>&nbsp;<\/p>\n<h2>Introduction to <span style=\"color: #d41565;\">ansible apt<\/span> module<\/h2>\n<p>Ansible apt module manages apt packages in Debian or Ubuntu systems.<\/p>\n<p>In typical Ubuntu machine, in order to install a package, you would execute the following command<\/p>\n<pre>apt install nginx<\/pre>\n<p>Same way here in ansible, the following playbook\/play would do that for you<\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; background: #232323; color: #e6e1dc;\"><span class=\"hljs-meta\" style=\"color: #9b859d;\">---<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\"> - name:<\/span> Playbook to install NGINX\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   hosts:<\/span> webservers\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   become:<\/span> <span class=\"hljs-literal\">true<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   tasks:<\/span> \r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">    - name:<\/span> Ansible apt install nginx\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">      apt:<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">        name:<\/span> nginx\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">        state:<\/span> present<\/pre>\n<p>Here is the quick screen snip of executing this playbook.<\/p>\n<p><script id=\"asciicast-z174bbxDY9oS1wB2pUYy08Zto\" src=\"https:\/\/asciinema.org\/a\/z174bbxDY9oS1wB2pUYy08Zto.js\" async><\/script><\/p>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<h2>The Difference between <span style=\"color: #d41565;\">apt<\/span> and <span style=\"color: #d41565;\">apt-get<\/span><\/h2>\n<p>Some of us including me would have most often referred ubuntu apt (aptitude) as <code>apt-get<\/code>\u00a0we use both <code>apt<\/code>\u00a0and <code>apt-get<\/code>\u00a0interchangeably<\/p>\n<p>The following statement from Debian blog would help us understand the difference between apt and apt-get<\/p>\n<blockquote><p><code>apt<\/code>\u00a0is a second command-line based front end provided by APT which overcomes some design mistakes of\u00a0<code>apt-get<\/code>.<\/p><\/blockquote>\n<p>Based on this, You can understand that the apt module is fairly advanced than its predecessor apt-get<\/p>\n<p>So apt could do everything and more what apt-get could possibly do.<\/p>\n<p>As far as Ansible apt module is concerned, it uses the apt command over apt-get and it could fall over to apt-get automatically in some cases where necessary.<\/p>\n<p>&nbsp;<\/p>\n<p><span style=\"font-size: 18pt;\"><strong>But, What If I want ansible to use apt-get over apt?<\/strong><\/span><\/p>\n<p>Well Ansible apt module supports apt-get commands as well and you could use instruct ansible apt module to use apt-get using a parameter named <code>force_apt_get<\/code><\/p>\n<p>The preceding playbook example can be rewritten like this with force_apt_get<\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; background: #232323; color: #e6e1dc;\"><span class=\"hljs-meta\" style=\"color: #9b859d;\">---<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\"> - name:<\/span> Ansible apt module examples\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   hosts:<\/span> web\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   become:<\/span> <span class=\"hljs-literal\">true<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   tasks:<\/span> \r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">    - name:<\/span> Ansible apt-get to get install nginx\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">      apt:<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">        name:<\/span> nginx\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">        state:<\/span> present\r\n<span style=\"color: #ffff00;\"><span class=\"hljs-attr\">        force_apt_get:<\/span> <span class=\"hljs-literal\">yes<\/span><\/span><\/pre>\n<p>&nbsp;<\/p>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<h2>The <span style=\"color: #e82e91;\">Ansible apt<\/span> Examples<\/h2>\n<p>We have collected some of the interesting and useful examples of Ansible apt module here.<\/p>\n<p>&nbsp;<\/p>\n<h3>How to install a Package with Ansible apt<\/h3>\n<p>We have already seen an example of how to install a package with ansible apt in the introduction.<\/p>\n<p>However, Here is one more playbook example that installs a Single Package or software named <code>apache2<\/code><\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; background: #232323; color: #e6e1dc;\"><span class=\"hljs-meta\" style=\"color: #9b859d;\">---<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\"> - name:<\/span> Playbook to install Apache\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   hosts:<\/span> webservers\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   become:<\/span> <span class=\"hljs-literal\">true<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   tasks:<\/span> \r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">    - name:<\/span> Ansible apt install Apache\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">      apt:<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">        name:<\/span> apache2\r\n<span style=\"color: #ffff00;\"><span class=\"hljs-attr\">        state:<\/span> present<\/span><\/pre>\n<p>here the <code>state: present<\/code>\u00a0would tell ansible to make it available and installed.<\/p>\n<p>&nbsp;<\/p>\n<h3>How to remove a Package with Ansible apt<\/h3>\n<p>To remove a package with Ansible apt. All you have to do use <code>state: absent<\/code>\u00a0along with the package name of your choice.<\/p>\n<p>Let us use the same playbook we have used for installation for example here with a little modification<\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; background: #232323; color: #e6e1dc;\"><span class=\"hljs-meta\" style=\"color: #9b859d;\">---<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\"> - name:<\/span> Playbook to install Apache\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   hosts:<\/span> webservers\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   become:<\/span> <span class=\"hljs-literal\">true<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   tasks:<\/span> \r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">    - name:<\/span> Ansible apt install Apache\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">      apt:<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">        name:<\/span> apache2\r\n<span style=\"color: #ffff00;\"><span class=\"hljs-attr\">        state:<\/span> absent<\/span><\/pre>\n<p>You can notice that all we had to change is the state<\/p>\n<p>&nbsp;<\/p>\n<h3>How to do an apt update with Ansible<\/h3>\n<p>In this section, we are going to see how to update the cache with ansible apt<\/p>\n<p>It is always recommended and a kind of best practice all the administrators would follow while installing a package. Just to make sure that they are getting the updated package from the Source and not the cached one on the local server.<\/p>\n<p>In order to update the local cache, we have to use <code>update_cache<\/code>\u00a0parameter in our playbook<\/p>\n<p>To put it in a perspective. Let&#8217;s suppose we want to install the latest OpenSSL version in our ubuntu server. these are the command we would execute in our server<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\" data-enlighter-theme=\"bootstrap4\" data-enlighter-linenumbers=\"false\">apt update\r\n\r\napt install openssl\r\n\r\n(or)\r\n\r\napt-get update\r\n\r\napt-get install openssl<\/pre>\n<p>&nbsp;<\/p>\n<p>With an ansible apt module, we can do the same by just adding <code>update_cache<\/code> parameter. Here is the playbook with update_cache which installs the latest version OpenSSL<\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; background: #232323; color: #e6e1dc;\"><span class=\"hljs-meta\" style=\"color: #9b859d;\">---<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\"> - name:<\/span> Ansible apt module examples\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   hosts:<\/span> web\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   become:<\/span> <span class=\"hljs-literal\">true<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   tasks:<\/span> \r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">    - name:<\/span> Ansible Update Cache and install openssl\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">      apt:<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">        name:<\/span> openssl\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">        state:<\/span> present\r\n<span style=\"color: #ffff00;\"><span class=\"hljs-attr\">        update_cache:<\/span> <span class=\"hljs-literal\">yes<\/span><\/span><\/pre>\n<p>&nbsp;<\/p>\n<h3>Update cache if it is older than a certain time<\/h3>\n<p>Sometimes updating the cache may not be necessary at all as it would have been updated only a few minutes or days before.<\/p>\n<p>So we can instruct Ansible to update the cache only if the current cache is older than a specific time. Mentioned in seconds.<\/p>\n<p>here is the playbook which updates the cache\u00a0 if the current cache is built 3600 seconds(1 hour) ago<\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; background: #232323; color: #e6e1dc;\"><span class=\"hljs-meta\" style=\"color: #9b859d;\">---<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\"> - name:<\/span> Ansible apt module examples\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   hosts:<\/span> web\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   become:<\/span> <span class=\"hljs-literal\">true<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   tasks:<\/span> \r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">    - name:<\/span> Ansible apt update cache if it is older than <span class=\"hljs-number\" style=\"color: #a5c261;\">1<\/span> hour\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">      register:<\/span> updatesys\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">      apt:<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">        update_cache:<\/span> <span class=\"hljs-literal\">yes<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">        cache_valid_time:<\/span> <span class=\"hljs-number\" style=\"color: #a5c261;\">3600<\/span><\/pre>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<h3>Upgrade a Single package or Software with ansible apt<\/h3>\n<p>Let us suppose we want to upgrade the OpenSSL version installed in our system and this is the command we would execute on our servers<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\" data-enlighter-theme=\"bootstrap4\" data-enlighter-linenumbers=\"false\"># Update the Cache\r\n\r\napt update\r\n\r\n# Upgrade the package openssl\r\n\r\napt upgrade openssl (or)\r\n\r\napt-get \u00a0update\r\n\r\napt-get upgrade openssl<\/pre>\n<p>&nbsp;<\/p>\n<p>With ansible apt module this is how it can be done<\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; background: #232323; color: #e6e1dc;\"><span class=\"hljs-meta\" style=\"color: #9b859d;\">---<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\"> - name:<\/span> Ansible apt module examples\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   hosts:<\/span> web\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   become:<\/span> <span class=\"hljs-literal\">true<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   tasks:<\/span> \r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">    - name:<\/span> Ansible Update Cache and upgrade openssl\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">      apt:<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">        name:<\/span> openssl\r\n<span style=\"color: #ffff00;\"><span class=\"hljs-attr\">        state:<\/span> latest<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">        update_cache:<\/span> <span class=\"hljs-literal\">yes<\/span>\r\n<\/pre>\n<p>If you have not noticed it already. the <code>state: latest<\/code> parameter would make sure that the package is upgraded and stay the latest.<\/p>\n<p>this is how we upgrade the package or tool with an ansible apt module.<\/p>\n<p>&nbsp;<\/p>\n<h3>Update &amp; Upgrade All the packages installed in OneGo<\/h3>\n<p>It is always recommended to upgrade the packages installed in our system to maintain system security and integrity.<\/p>\n<p>In Enterprises, this would be done every quarterly or even monthly during the scheduled patching.<\/p>\n<p>So how to update &amp; upgrade all the packages or tools installed Debian\/ubuntu<\/p>\n<h3><\/h3>\n<h3>Differentiate the Update and Upgrade<\/h3>\n<p><b>The update<\/b> is to update all the packages in the local repository, It is also known as updating the cache<\/p>\n<p><b>The upgrade<\/b> is to upgrade the packages installed on the system, you can think of this one as more of a Version Upgrade.<\/p>\n<p>&nbsp;<\/p>\n<p>These are the Linux commands we would execute in order to achieve this<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\" data-enlighter-theme=\"bootstrap4\" data-enlighter-linenumbers=\"false\"># Update the Cache \r\n\r\napt update\r\n\r\n# Upgrade all the packages installed \r\n\r\napt upgrade\r\n\r\n(or)\r\n\r\napt-get update\r\n\r\napt-get upgrade<\/pre>\n<p>&nbsp;<\/p>\n<p>here is the ansible-playbook to update and upgrade the packages in ubuntu<\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; background: #232323; color: #e6e1dc;\"><span class=\"hljs-meta\" style=\"color: #9b859d;\">---<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\"> - name:<\/span> Ansible apt module examples\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   hosts:<\/span> web\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   become:<\/span> <span class=\"hljs-literal\">true<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   tasks:<\/span> \r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">    - name:<\/span> Ansible Update Cache and Upgrade all Packages\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">      register:<\/span> updatesys\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">      apt:<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">        name:<\/span> <span class=\"hljs-string\" style=\"color: #a5c261;\">\"*\"<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">        state:<\/span> latest\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">        update_cache:<\/span> <span class=\"hljs-literal\">yes<\/span>\r\n\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">    - name:<\/span> Display the last line of the previous task to check the stats\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">      debug:<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">        msg:<\/span>  <span class=\"hljs-string\" style=\"color: #a5c261;\">\"<span class=\"hljs-template-variable\" style=\"color: #a5c261;\">{{updatesys.stdout_lines|last}}<\/span>\"<\/span>\r\n<\/pre>\n<p>&nbsp;<\/p>\n<p>This is the output our playbook would yield in already updated and up-to-date system<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-02-23-at-6.36.44-PM.png\"><img class=\"alignnone size-full wp-image-5149\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-02-23-at-6.36.44-PM.png\" alt=\"\" width=\"972\" height=\"394\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-02-23-at-6.36.44-PM.png 972w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-02-23-at-6.36.44-PM-300x122.png 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-02-23-at-6.36.44-PM-768x311.png 768w\" sizes=\"(max-width: 972px) 100vw, 972px\" \/><\/a><\/p>\n<p>You can notice that the last line is displaying the statistics of the packages upgraded, installed etc.<\/p>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<h3>How to install a list of packages in One Go with Ansible apt<\/h3>\n<p>So we have been so far installing a Single Package but when it comes to real-time server provisioning we would be installing N number of packages based on our requirements.<\/p>\n<p>So it is not wise to create plays for each package installation like we have been so far doing.<\/p>\n<p>The right approach to install multiple packages with ansible apt is to use ansible loops and iteration methods. A Simple Programming paradigm<\/p>\n<p>This is the playbook we are going to use to install \/ setup a LAMP (<strong>L<\/strong>inux<strong>A<\/strong>pache<strong>M<\/strong>ysql<strong>P<\/strong>hp) stack on our Debian\/Ubuntu server<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"yaml\" data-enlighter-theme=\"bootstrap4\" data-enlighter-linenumbers=\"false\">- name: Ansible apt module examples\r\n  hosts: web\r\n  become: yes\r\n  tasks:\r\n    - name: Ansible apt to install multiple packages - LAMP\r\n      register: updatesys\r\n      apt:\r\n        update_cache: yes\r\n        name:\r\n          - firewalld\r\n          - apache2\r\n          - mariadb-server\r\n          - php\r\n          - php-mysql\r\n        state: present\r\n<\/pre>\n<p>&nbsp;<\/p>\n<p>Here is the execution result of this playbook with Debug mode on<\/p>\n<p><script id=\"asciicast-oiZHQVHiFNFF8Si8tFWbMNf13\" src=\"https:\/\/asciinema.org\/a\/oiZHQVHiFNFF8Si8tFWbMNf13.js\" async><\/script><\/p>\n<p>&nbsp;<\/p>\n<h3>Install Specific version of a package with Ansible apt<\/h3>\n<p>Sometimes we would want to install a very specific version of a package or software for various reasons.<\/p>\n<p>let&#8217;s see how to specify the package version with ansible apt module.<\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; background: #232323; color: #e6e1dc;\"><span class=\"hljs-meta\" style=\"color: #9b859d;\">---<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\"> - name:<\/span> Ansible apt module examples\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   hosts:<\/span> web\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   become:<\/span> <span class=\"hljs-literal\">true<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   tasks:<\/span> \r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">    - name:<\/span> Ansible apt install tomcat Version <span class=\"hljs-number\" style=\"color: #a5c261;\">8.0<\/span><span class=\"hljs-number\" style=\"color: #a5c261;\">.32<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">      register:<\/span> updatesys\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">      apt:<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">        update_cache:<\/span> <span class=\"hljs-literal\">yes<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">        name:<\/span> tomcat8=<span style=\"color: #ffff00;\"><span class=\"hljs-number\">8.0<\/span><span class=\"hljs-number\">.32<\/span><span class=\"hljs-bullet\">-1<\/span>ubuntu1<span class=\"hljs-number\">.11<\/span><\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">        state:<\/span> present<\/pre>\n<p>The preceding playbook helps to install the tomcat version 8.0.32<\/p>\n<p>&nbsp;<\/p>\n<h3>Install a <code>.deb<\/code> file or package using ansible apt<\/h3>\n<p>ansible apt module can be used to install the .deb packages as well additionally ansible apt can download the file from remote URL and install it as well.<\/p>\n<p>So here is the playbook where we are trying to install a\u00a0<code>*.deb<\/code>\u00a0package. But the Source of these deb files are different.<\/p>\n<p>One is already downloaded and kept in \/tmp directory and another one is yet to be downloaded from the URL<\/p>\n<p>As mentioned earlier, Ansible apt can download the package automatically from the remote URL and install it without any manual intervention.<\/p>\n<p>here we are going to install filebeat using the deb file.<\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; background: #232323; color: #e6e1dc;\"><span class=\"hljs-meta\" style=\"color: #9b859d;\">---<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\"> - name:<\/span> Ansible apt module examples\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   hosts:<\/span> web\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   become:<\/span> <span class=\"hljs-literal\">true<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   tasks:<\/span> \r\n\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">    - name:<\/span> Ansible install filebeat deb file from local\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">      apt:<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">        deb:<\/span> \/tmp\/filebeat<span class=\"hljs-bullet\" style=\"color: #6d9cbe;\">-7.6<\/span><span class=\"hljs-number\" style=\"color: #a5c261;\">.0<\/span>-amd64.deb\r\n\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">    - name:<\/span> Ansible install filebeat deb file from url\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">      apt:<\/span> \r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">        deb:<\/span> https:\/\/artifacts.elastic.co\/downloads\/beats\/filebeat\/filebeat<span class=\"hljs-bullet\" style=\"color: #6d9cbe;\">-7.6<\/span><span class=\"hljs-number\" style=\"color: #a5c261;\">.0<\/span>-amd64.deb\r\n\r\n<\/pre>\n<p>&nbsp;<\/p>\n<h3>How to validate if a package is installed &#8211; Ansible apt<\/h3>\n<p>Sometimes you would want to validate if the package is installed or not without making any modifications to the system<\/p>\n<p>Though it can be done with Ansible apt module and <code>check_mode<\/code><\/p>\n<p>I would recommend using <code>package_facts<\/code>\u00a0module to validate if the package is installed or not.<\/p>\n<p>here is the sample playbook to validate if few packages are installed or not.<\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; background: #232323; color: #e6e1dc;\"><span class=\"hljs-meta\" style=\"color: #9b859d;\">---<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\"> - name:<\/span> Ansible validate if the packages are installed\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   hosts:<\/span> web\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   become:<\/span> <span class=\"hljs-literal\">true<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">   tasks:<\/span> \r\n\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">    - name:<\/span> Gather Package facts\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">      package_facts:<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">        manager:<\/span> auto\r\n    \r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">    - name:<\/span> Validating if the package is installed or not\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">      debug:<\/span> \r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">        msg:<\/span> <span class=\"hljs-string\" style=\"color: #a5c261;\">\"<span class=\"hljs-template-variable\" style=\"color: #a5c261;\">{{item}}<\/span> is installed\"<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">      when:<\/span> <span class=\"hljs-string\" style=\"color: #a5c261;\">'\"<span class=\"hljs-template-variable\" style=\"color: #a5c261;\">{{item}}<\/span>\" in ansible_facts.packages'<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">      with_items:<\/span>\r\n<span class=\"hljs-bullet\" style=\"color: #6d9cbe;\">        -<\/span> apache2\r\n<span class=\"hljs-bullet\" style=\"color: #6d9cbe;\">        -<\/span> nginx\r\n<span class=\"hljs-bullet\" style=\"color: #6d9cbe;\">        -<\/span> filebeat<\/pre>\n<p>Here is the output of this playbook.<\/p>\n<p>You can see that it prints only apache2 is installed,\u00a0 as the other two are not installed they were skipped<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-02-24-at-3.00.07-AM.png\"><img class=\"alignnone size-full wp-image-5154\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-02-24-at-3.00.07-AM.png\" alt=\"\" width=\"1007\" height=\"490\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-02-24-at-3.00.07-AM.png 1007w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-02-24-at-3.00.07-AM-300x146.png 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-02-24-at-3.00.07-AM-768x374.png 768w\" sizes=\"(max-width: 1007px) 100vw, 1007px\" \/><\/a><\/p>\n<p>&nbsp;<\/p>\n<h3>Clean up the useless Packages using ansible apt<\/h3>\n<p>To Clean up the useless packages from the system you can use ansible apt module like shown below.<\/p>\n<p>It clears the useless packages from cache and remove the dependency tools which are no longer required.<\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; background: #232323; color: #e6e1dc;\"><span class=\"hljs-attr\" style=\"color: #6d9cbe;\">- name:<\/span> Remove useless packages from the cache\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">  apt:<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">    autoclean:<\/span> <span class=\"hljs-literal\">yes<\/span>\r\n\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">- name:<\/span> Remove dependencies that are <span class=\"hljs-literal\">no<\/span> longer required\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">  apt:<\/span>\r\n<span class=\"hljs-attr\" style=\"color: #6d9cbe;\">    autoremove:<\/span> <span class=\"hljs-literal\">yes<\/span><\/pre>\n<p>&nbsp;<\/p>\n<h2>Conclusion<\/h2>\n<p>Hope the given examples of Ansible apt module helps you understand how to use ansible apt module for managing Debian packages.<\/p>\n<p>&nbsp;<\/p>\n<p>Cheers<br \/>\nRumen Lishkov<\/p>\n<div id=\"postfollow\">\r\n<a href='https:\/\/ko-fi.com\/O4O51FG7C' target='_blank'><img height='46' style='border:0px;height:46px;width: 186px' src='https:\/\/az743702.vo.msecnd.net\/cdn\/kofi3.png?v=2' border='0' alt='Buy Me a Coffee at ko-fi.com' \/><\/a>\r\n<p>Follow us on<a href=\"http:\/\/www.facebook.com\/middlewareinventory\">Facebook<\/a> or<a href=\"http:\/\/www.twitter.com\/mwinventory\">Twitter<\/a>\r\n<\/br>\r\nFor more practical videos and tutorials. <a href=\"https:\/\/www.youtube.com\/channel\/UCRuqBFM6ioWwviNJkgOjeWw?sub_confirmation=1\">Subscribe to our channel<\/a>\r\n<\/br>\r\nFollow me on Linkedin <a href=\"https:\/\/www.linkedin.com\/comm\/mynetwork\/discovery-see-all?usecase=PEOPLE_FOLLOWS&followMember=saravakmwinventory\">My Profile<\/a>\r\n<\/br>\r\n<\/i>For any Consultation or to hire us <a href=\"mailto:rumenlishkoff@gmail.com\"> rumenlishkoff@gmail.com<\/a>\r\n<\/br>\r\nIf you like this article. Show your Support! <a href=\"https:\/\/ko-fi.com\/middlewareinventory\">Buy me a Coffee.<\/a>\r\n<\/br>\r\n<\/p>\r\n<p style=\"color: palevioletred !important;\">Signup for Exclusive \"Subscriber-only\" Content<\/p>\r\n\n\t\t<div class=\"emaillist\">\n\t\t\t<form action=\"#\" method=\"post\" class=\"es_subscription_form es_shortcode_form\" id=\"es_subscription_form_1670577803\" data-source=\"ig-es\">\n\t\t\t\t\t\t\t\t<div class=\"es-field-wrap\"><label>Name*<br \/><input type=\"text\" name=\"name\" class=\"ig_es_form_field_name\" placeholder=\"\" value=\"\" required=\"required\" \/><\/label><\/div><div class=\"es-field-wrap\"><label>Email*<br \/><input class=\"es_required_field es_txt_email ig_es_form_field_email\" type=\"email\" name=\"email\" value=\"\" placeholder=\"\" required=\"required\" \/><\/label><\/div><input type=\"hidden\" name=\"lists[]\" value=\"1\" \/><input type=\"hidden\" name=\"form_id\" value=\"3\" \/>\n\t\t\t\t<input type=\"hidden\" name=\"es_email_page\" value=\"5138\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"es_email_page_url\" value=\"https:\/\/www.middlewareinventory.com\/blog\/ansible-apt-examples\/\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"status\" value=\"Unconfirmed\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"es-subscribe\" id=\"es-subscribe\" value=\"7aebfb1a9b\"\/>\n\t\t\t\t<label style=\"position:absolute;top:-99999px;left:-99999px;z-index:-99;\"><input type=\"email\" name=\"es_hp_email\" class=\"es_required_field\" tabindex=\"-1\" autocomplete=\"-1\" value=\"\"\/><\/label>\n\t\t\t\t\t\t\t\t<input type=\"submit\" name=\"submit\" class=\"es_subscription_form_submit es_submit_button es_textbox_button\" id=\"es_subscription_form_submit_1670577803\" value=\"Subscribe\"\/>\n\n\t\t\t\t\n\t\t\t\t<span class=\"es_spinner_image\" id=\"spinner-image\"><img src=\"https:\/\/www.middlewareinventory.com\/wp-content\/plugins\/email-subscribers\/lite\/public\/images\/spinner.gif\" alt=\"Loading\"\/><\/span>\n\n\t\t\t<\/form>\n\n\t\t\t<span class=\"es_subscription_message\" id=\"es_subscription_message_1670577803\"><\/span>\n\t\t<\/div>\n\n\t\t\r\n<\/div>\r\n<hr>\n","protected":false},"excerpt":{"rendered":"<p>Ansible APT Package manager is an Ubuntu equivalent for RedHat yum package manager. Just like all other ansible modules\u00a0apt\u00a0ansible module is built after one specific unix command of Debian\u00a0apt-get It is always recommended to choose the modules rather using the raw unix commands over the shell module as it would[&#8230;]<\/p>\n","protected":false},"author":1,"featured_media":5155,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"_et_pb_use_builder":"","_et_pb_old_content":"","_et_gb_content_width":""},"categories":[98],"tags":[442],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v14.9 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>Ansible apt module Examples - install packages with apt | Devops Junction<\/title>\n<meta name=\"description\" content=\"Ansible apt examples. Ansible apt install example. ansible apt update example. How to install package with ansible apt module. Ansible Ubuntu apt\" \/>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/www.middlewareinventory.com\/blog\/ansible-apt-examples\/\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"Ansible apt module Examples - install packages with apt | Devops Junction\" \/>\n<meta property=\"og:description\" content=\"Ansible apt examples. Ansible apt install example. ansible apt update example. How to install package with ansible apt module. Ansible Ubuntu apt\" \/>\n<meta property=\"og:url\" content=\"https:\/\/www.middlewareinventory.com\/blog\/ansible-apt-examples\/\" \/>\n<meta property=\"og:site_name\" content=\"Middleware Inventory\" \/>\n<meta property=\"article:publisher\" content=\"http:\/\/www.facebook.com\/devopsjunc\" \/>\n<meta property=\"article:published_time\" content=\"2020-02-23T22:02:06+00:00\" \/>\n<meta property=\"article:modified_time\" content=\"2022-02-10T20:09:29+00:00\" \/>\n<meta property=\"og:image\" content=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-02-24-at-3.19.26-AM.png\" \/>\n\t<meta property=\"og:image:width\" content=\"1438\" \/>\n\t<meta property=\"og:image:height\" content=\"751\" \/>\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\n<meta name=\"twitter:creator\" content=\"@mwinventory\" \/>\n<meta name=\"twitter:site\" content=\"@mwinventory\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"Organization\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\",\"name\":\"Middleware Inventory\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"sameAs\":[\"http:\/\/www.facebook.com\/devopsjunc\",\"https:\/\/www.youtube.com\/channel\/UCRuqBFM6ioWwviNJkgOjeWw\",\"https:\/\/twitter.com\/mwinventory\"],\"logo\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/09\/Screenshot-2020-09-18-at-3.49.40-AM.jpg\",\"width\":300,\"height\":107,\"caption\":\"Middleware Inventory\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\"}},{\"@type\":\"WebSite\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"name\":\"Devops Junction\",\"description\":\"An inventory of [i]nformation, Middleware and much more.\",\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":\"https:\/\/www.middlewareinventory.com\/?s={search_term_string}\",\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-apt-examples\/#primaryimage\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-02-24-at-3.19.26-AM.png\",\"width\":1438,\"height\":751,\"caption\":\"Ansible apt\"},{\"@type\":\"WebPage\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-apt-examples\/#webpage\",\"url\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-apt-examples\/\",\"name\":\"Ansible apt module Examples - install packages with apt | Devops Junction\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\"},\"primaryImageOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-apt-examples\/#primaryimage\"},\"datePublished\":\"2020-02-23T22:02:06+00:00\",\"dateModified\":\"2022-02-10T20:09:29+00:00\",\"description\":\"Ansible apt examples. Ansible apt install example. ansible apt update example. How to install package with ansible apt module. Ansible Ubuntu apt\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/www.middlewareinventory.com\/blog\/ansible-apt-examples\/\"]}]},{\"@type\":\"Article\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-apt-examples\/#article\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-apt-examples\/#webpage\"},\"author\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\"},\"headline\":\"Ansible apt module Examples &#8211; install packages with apt | Devops Junction\",\"datePublished\":\"2020-02-23T22:02:06+00:00\",\"dateModified\":\"2022-02-10T20:09:29+00:00\",\"mainEntityOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-apt-examples\/#webpage\"},\"commentCount\":1,\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-apt-examples\/#primaryimage\"},\"keywords\":\"apt update ansible\",\"articleSection\":\"Ansible\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"CommentAction\",\"name\":\"Comment\",\"target\":[\"https:\/\/www.middlewareinventory.com\/blog\/ansible-apt-examples\/#respond\"]}]},{\"@type\":\"Person\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\",\"name\":\"Rumen Lishkov\",\"image\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#personlogo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/secure.gravatar.com\/avatar\/c22e4a54d67750291a9892531f94ffb3?s=96&d=mm&r=g\",\"caption\":\"Rumen Lishkov\"}}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","_links":{"self":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/5138"}],"collection":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/comments?post=5138"}],"version-history":[{"count":5,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/5138\/revisions"}],"predecessor-version":[{"id":8134,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/5138\/revisions\/8134"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media\/5155"}],"wp:attachment":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media?parent=5138"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/categories?post=5138"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/tags?post=5138"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}