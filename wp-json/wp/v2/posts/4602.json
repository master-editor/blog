{"id":4602,"date":"2020-02-08T20:07:43","date_gmt":"2020-02-08T14:37:43","guid":{"rendered":"https:\/\/www.middlewareinventory.com\/?p=4602"},"modified":"2022-06-19T11:22:46","modified_gmt":"2022-06-19T05:52:46","slug":"aws-mfa-ssh-ec2-setup","status":"publish","type":"post","link":"https:\/\/www.middlewareinventory.com\/blog\/aws-mfa-ssh-ec2-setup\/","title":{"rendered":"Enabling Two Factor Authentication for EC2 SSH &#8211; AWS MFA Setup"},"content":{"rendered":"<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-09-16-at-12.08.42-PM.png\"><img class=\"alignnone size-full wp-image-5742\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-09-16-at-12.08.42-PM.png\" alt=\"\" width=\"3296\" height=\"1734\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-09-16-at-12.08.42-PM.png 3296w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-09-16-at-12.08.42-PM-300x158.png 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-09-16-at-12.08.42-PM-768x404.png 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-09-16-at-12.08.42-PM-1024x539.png 1024w\" sizes=\"(max-width: 3296px) 100vw, 3296px\" \/><\/a><\/p>\n<p>Security is always a big thing. Protecting your data is very crucial when there are lot of people out waiting for a chance to exploit.<\/p>\n<p>In Enterprise Infrastructure. We have various levels of security as follows<\/p>\n<ul>\n<li>Internet Firewall and Gateway<\/li>\n<li>Load balancer Restrictions and Constraints<\/li>\n<li>Inbound and OutBound Proxy Servers<\/li>\n<li>Dual Factor or Multi-Factor Authentication ( RSA \/ Duo \/ Google Auth)<\/li>\n<li>Fingerprint or Iris Scanner and what not.<\/li>\n<\/ul>\n<p>besides designing your application with no vulnerabilities and data leaks. A Good Enterprise has to protect their infrastructure as well, with those aforementioned methodologies.<\/p>\n<p>in this post, we are going to take up one of the key element of Enterprise Security which is <strong>Securing the SSH to the Servers<\/strong><\/p>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<h2><span style=\"color: #003366;\">Why <span style=\"color: #de1d81;\">SSH Security<\/span> is Important?<\/span><\/h2>\n<p>Whether it be an On-Prem or Cloud Server. Securing and monitoring your SSH is indispensable. Because SSH is directly connecting you to the server (Often with Special Privileges). A Single Mistake or a Chance would leave your enterprise Security and Confidential Data at Risk.<\/p>\n<p>What if your employee with Special Privileges (root) has set a basic password for his SSH and Some middle man has guessed it right.<\/p>\n<p><strong>Besides having Strong Password policies and implementing Key-based authentication<\/strong>. Most companies would solve this problem by adding one more level of security, often called as\u00a0 Multi-factor or <strong>Two-factor authentication.<\/strong><\/p>\n<p>&nbsp;<\/p>\n<h2><span style=\"color: #003366;\">What is <span style=\"color: #de1d81;\">Two-factor<\/span> Authentication (or) <span style=\"color: #de1d81;\">Multi-Factor<\/span> Authentication<\/span><\/h2>\n<p>If you are working in IT infra. There are chances you might have heard this term <code><code><\/code><\/code><a href=\"https:\/\/www.rsa.com\/en-us\/products\/rsa-securid-suite\">RSA Token<\/a> and seen some devices like this. Most often people wear it in their ID cards too.<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/12\/rsa-token.gif\"><img class=\"alignnone size-full wp-image-4603\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/12\/rsa-token.gif\" alt=\"\" width=\"500\" height=\"276\" \/><\/a><\/p>\n<p>These were the First Two-factor authentication devices I was aware of. We can call it as a Classic Two Factor Authentication Device.<\/p>\n<p>There would be a 6 digit random number designed to change every 30 seconds or so I suppose. To login to the Secured networks and Servers, we had to enter this Pin number or Code displayed on the device.<\/p>\n<p>This is a hardware-based Two-factor authentication device. There were other few hardware and Software-based two factor or multi-factor authentication devices as per my knowledge<\/p>\n<ol>\n<li><a href=\"https:\/\/www.entrustdatacard.com\/products\/categories\/sms-passcode\">Entrust SMS Passcode<\/a><\/li>\n<li><a href=\"https:\/\/www.yubico.com\/\">Yubi Key<\/a><\/li>\n<li><a href=\"https:\/\/duo.com\/\">Duo Authentication<\/a><\/li>\n<\/ol>\n<p>While all these being an Enterprise level advanced Two-factor authentication systems.<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/12\/GoogleAuth.png\"><img class=\"alignleft wp-image-4604 size-medium\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/12\/GoogleAuth-300x300.png\" alt=\"\" width=\"300\" height=\"300\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/12\/GoogleAuth-300x300.png 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/12\/GoogleAuth-150x150.png 150w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/12\/GoogleAuth.png 512w\" sizes=\"(max-width: 300px) 100vw, 300px\" \/><\/a>There are also opensource two-factor authentication systems available. While there are few products available in this slab.<\/p>\n<p><strong>Google Authenticator<\/strong> is a widely used Software-based Multi-Factor Authentication solution. It is same as RSA token working with Time-based One-time passcode strategy.<\/p>\n<p>While this is freely available and comes from the Trusted company. Most of the web applications, servers, enterprises are using this to provide additional security to the user.<\/p>\n<p>&nbsp;<\/p>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<p>By this time you might have figured out this article is going to use Google Authenticator as Multi-Factor authentication provider.<\/p>\n<p>With no further ado. Let us go to our objective.<\/p>\n<p>In this post, we are going to choose some secure approach of using a Single Server as our Gateway or Jump Server from where you can log in to the other servers in your infrastructure.<\/p>\n<p>&nbsp;<\/p>\n<h2><span style=\"color: #003366;\">How to setup <span style=\"color: #de1d81;\">Two Factor Authentication<\/span> for SSH in AWS <span style=\"color: #de1d81;\">EC2<\/span> &#8211; \u00a0AWS MFA Setup<\/span><\/h2>\n<ol>\n<li>Install EPEL Repo<\/li>\n<li>Install Google Authenticator on EC2 Instance<\/li>\n<li>Configure EC2 SSH to use Google Authentication module\n<ol>\n<li>Setup Google Authenticator module<\/li>\n<li>Configure Auth methods in SSHd config file<\/li>\n<\/ol>\n<\/li>\n<li>Configure Google Authenticator in Mobile &amp; EC2\n<ol>\n<li>Download and Install the GoogleAuthenticator in mobile<\/li>\n<li>Run Google Authenticator on EC2 and Get QR code<\/li>\n<li>Scan the Shown QR code in your Google Authenticator App<\/li>\n<li>Complete the Google Authenticator Setup in EC2<\/li>\n<\/ol>\n<\/li>\n<li>Restart SSH Services on the EC2 instance<\/li>\n<li>Login to the server and validate<\/li>\n<li>Video GUIDE of how to perform these steps<\/li>\n<\/ol>\n<p>&nbsp;<\/p>\n<h3>Step1:\u00a0\u00a0Install EPEL Repo on the EC2 instance<\/h3>\n<p>Google Authenticator is part of the EPEL repo and you should install the EPEL repo in your EC2 instance.<\/p>\n<p>In my case, I am using Amazon EC2 Instance (OS) and I can download my EPEL 7 and install like this<\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; color: #333333; background: #f8f8f8;\"><span class=\"hljs-attribute\" style=\"color: #e84d93; font-weight: 400;\">sudo<\/span> <span style=\"color: #e84d93;\">yum<\/span> install -y https:\/\/dl.fedoraproject.org\/pub\/epel\/epel-release-latest-7.noarch.rpm<\/pre>\n<p>&nbsp;<\/p>\n<h3>Step2:\u00a0\u00a0Install Google Authenticator on the EC2 instance<\/h3>\n<p>The following command would install the Google Authenticator.\u00a0 The package name may vary if your Operating system is different so you can perform a quick search using <code>yum search google<\/code>\u00a0to find the right package name<\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; color: #333333; background: #f8f8f8;\"><span class=\"hljs-attribute\" style=\"color: #e84d93; font-weight: 400;\">sudo yum<\/span> install google-authenticator.x86_64 -y<\/pre>\n<p>&nbsp;<\/p>\n<h3>Step3:\u00a0Configure EC2 SSH to use Google Authentication module<\/h3>\n<p>In this step, we are going to perform some file modifications and editing to install google authentication and to setup MFA in this EC2 instance.<\/p>\n<p><strong>Step3a: Update the <code>sshd<\/code>\u00a0PAM<\/strong>\u00a0<strong>and install Google authenticator module<\/strong><\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; color: #333333; background: #f8f8f8;\"><span class=\"hljs-attribute\" style=\"color: #e84d93; font-weight: 400;\">sudo<\/span> vi \/etc\/pam.d\/sshd<\/pre>\n<p>Add the following to the bottom of the file to use Google Authenticator. If there are service accounts or users who should be able to log in without MFA, add <code>nullok<\/code> at the end of the following statement. This will mean that users who don\u2019t run Google Authenticator initialization won\u2019t be asked for a\u00a0second authentication.<\/p>\n<p><code class=\" language-bash\">auth required pam_google_authenticator<span class=\"token punctuation\">.<\/span>so<\/code>\u00a0or<\/p>\n<p><code class=\" language-bash\">auth required pam_google_authenticator<span class=\"token punctuation\">.<\/span>so nullok<\/code><\/p>\n<p>Comment out the password requirement as we want to use only the key-based authentication.<\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; color: #333333; background: #f8f8f8;\"><span class=\"hljs-comment\" style=\"color: #999988; font-style: italic;\"><span style=\"color: #000000;\">#auth       substack     password-auth<\/span> <\/span><\/pre>\n<p>Don&#8217;t forget to Save the file.<\/p>\n<p>&nbsp;<\/p>\n<p><strong>Step3b: Update the <code>sshd<\/code>\u00a0configuration\u00a0<\/strong><\/p>\n<p>In this step we are going to tell <code>sshd<\/code>\u00a0that we have one more level of multifactor authentication for the user to login along with the Keybased auth.<\/p>\n<p>This step is to make <code>sshd<\/code>\u00a0daemon to prompt the user for the Verification Code.<\/p>\n<p>Edit the file as root<\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; color: #333333; background: #f8f8f8;\"><span class=\"hljs-attribute\" style=\"color: #e84d93; font-weight: 400;\">sudo<\/span> vi \/etc\/ssh\/sshd_config<\/pre>\n<p>&nbsp;<\/p>\n<p>Comment out the line which says ChallengeResponseAuthentication \u2018no\u2019 and uncomment the line which says \u2018yes\u2019.<\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; color: #333333; background: #f8f8f8;\"><span style=\"color: #000000;\"><span class=\"hljs-attribute\" style=\"font-weight: 400; color: #e84d93;\">ChallengeResponseAuthentication<\/span> yes<\/span>\r\n<span class=\"hljs-comment\" style=\"color: #000000; font-style: italic;\">#ChallengeResponseAuthentication no<\/span><\/pre>\n<p>Finally, we need to let <code>sshd<\/code>\u00a0daemon know that it should ask the user for an SSH key and a verification code<\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; color: #333333; background: #f8f8f8;\"><span class=\"hljs-attribute\" style=\"color: #e84d93; font-weight: 400;\">AuthenticationMethods<\/span> publickey,keyboard-interactive<\/pre>\n<p>Save the file.<\/p>\n<h3>Step4:\u00a0\u00a0Configure Google Authenticator<\/h3>\n<p>It has two phases or two levels of configuration.<\/p>\n<p><strong>Step4a) Install Google Authenticator<\/strong><\/p>\n<p>First task has to be done at your mobile where you need to download the <code>Google Authenticator<\/code>\u00a0App from play store or App store<\/p>\n<p><a href=\"https:\/\/play.google.com\/store\/apps\/details?id=com.google.android.apps.authenticator2&amp;hl=en_IN\">Get it from Playstore\u00a0<\/a><\/p>\n<p><a href=\"https:\/\/apps.apple.com\/in\/app\/google-authenticator\/id388497605\">Get it from App Store:\u00a0<\/a><\/p>\n<p>Once you have downloaded keep it ready and come back to the server to perform the next task.<\/p>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<p><strong>Step 4b) Run Google Authenticator on EC2 and Get QR code<\/strong><\/p>\n<p>Once you have the Google Authenticator installed in your mobile you are ready to perform the second phase of this configuration.<\/p>\n<p>the second phase should be performed at the ec2 server.<\/p>\n<blockquote><p><strong>\u00a0Note: <\/strong><\/p>\n<p>This step has to be executed as the user to whom you want to set the MFA or Multi factor authentication. <code>ec2-user<\/code>\u00a0or <code>root<\/code>\u00a0or <code>ubuntu<\/code>\u00a0 or even as your personal userid which you have created in this EC2 instance.<\/p>\n<p>&nbsp;<\/p><\/blockquote>\n<p>run the following command as the user of your choice in my case it is <code>ec2-user<\/code><\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; color: #333333; background: #f8f8f8;\"><span style=\"color: #000000;\">\u00a0<span class=\"hljs-attribute\" style=\"font-weight: 400;\">google<\/span>-authenticator<\/span><\/pre>\n<p>After the first question, it would show you the QR code and the Secret Key<\/p>\n<p>&nbsp;<\/p>\n<p><strong>Step 4c) Scan the Shown QR code in your Google Authenticator App<\/strong><\/p>\n<p>Now take your mobile and go to <code>Google Authenticator<\/code>\u00a0App and click on the <code>plus sign<\/code>\u00a0on the bottom right corner<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/AWSMFASetup-1.png\"><img class=\"alignnone size-full wp-image-5061\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/AWSMFASetup-1.png\" alt=\"\" width=\"490\" height=\"900\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/AWSMFASetup-1.png 490w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/AWSMFASetup-1-163x300.png 163w\" sizes=\"(max-width: 490px) 100vw, 490px\" \/><\/a><\/p>\n<p>Click on the Scan a barcode option<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-02-08-at-6.31.33-PM.png\"><img class=\"alignnone size-full wp-image-5062\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-02-08-at-6.31.33-PM.png\" alt=\"AWS MFA SETUP\" width=\"480\" height=\"886\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-02-08-at-6.31.33-PM.png 480w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-02-08-at-6.31.33-PM-163x300.png 163w\" sizes=\"(max-width: 480px) 100vw, 480px\" \/><\/a><\/p>\n<p>Scan the barcode<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-02-08-at-6.32.04-PM.png\"><img class=\"alignnone size-full wp-image-5063\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-02-08-at-6.32.04-PM.png\" alt=\"\" width=\"482\" height=\"1016\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-02-08-at-6.32.04-PM.png 482w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-02-08-at-6.32.04-PM-142x300.png 142w\" sizes=\"(max-width: 482px) 100vw, 482px\" \/><\/a><\/p>\n<p>Once it has been added come back to your terminal<\/p>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<p><strong>Step 4d) Complete the Google Authenticator Setup in EC2<\/strong><\/p>\n<p>Once you have crossed the QR code section, You would be prompted 4 more questions<\/p>\n<p>Here are my answers. (Refer the following snippet)<\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; color: #333333; background: #f8f8f8;\"><span class=\"hljs-string\" style=\"color: #dd1144;\">[ec2-user@ip-172-31-83-181 ~]<\/span># google-authenticator\r\n\r\nDo you want authentication tokens to be time-based (y\/n) y\u000b\r\n\r\n******* THERE WOULD BE A QR CODE DISPLAYED HERE ****\r\n \r\n\r\nYour new secret key is: 2IAROUZWA6ZRSRRR89ZLYNZUC2A\r\nYour verification code is <span class=\"hljs-number\" style=\"color: teal;\">601376<\/span>\r\nYour emergency scratch codes are:\r\n  <span class=\"hljs-number\" style=\"color: teal;\">85535499<\/span>\r\n  <span class=\"hljs-number\" style=\"color: teal;\">25397636<\/span>\r\n  <span class=\"hljs-number\" style=\"color: teal;\">98473698<\/span>\r\n  <span class=\"hljs-number\" style=\"color: teal;\">70322035<\/span>\r\n  <span class=\"hljs-number\" style=\"color: teal;\">60012461<\/span>\r\n\r\nDo you want me to update your <span class=\"hljs-string\" style=\"color: #dd1144;\">\"\/root\/.google_authenticator\"<\/span> file? (y\/n) y\r\n\r\nDo you want to disallow multiple uses of the same authentication\r\ntoken? This restricts you to one login about every 30s, but it increases\r\nyour chances to notice or even prevent man-in-the-middle attacks (y\/n) y\r\n\r\nBy default, a new token is generated every <span class=\"hljs-number\" style=\"color: teal;\">30<\/span> seconds by the mobile app.\r\nIn order to compensate for possible time-skew between the client and the server,\r\nwe allow an extra token before and after the current time. This allows for a\r\ntime skew of up to <span class=\"hljs-number\" style=\"color: teal;\">30<\/span> seconds between authentication server and client. If you\r\nexperience problems with poor time synchronization, you can increase the window\r\nfrom its default size of <span class=\"hljs-number\" style=\"color: teal;\">3<\/span> permitted codes (one previous code, the current\r\ncode, the next code) to <span class=\"hljs-number\" style=\"color: teal;\">17<\/span> permitted codes (the <span class=\"hljs-number\" style=\"color: teal;\">8<\/span> previous codes, the current\r\ncode, and the <span class=\"hljs-number\" style=\"color: teal;\">8<\/span> next codes). This will permit for a time skew of up to <span class=\"hljs-number\" style=\"color: teal;\">4<\/span> minutes\r\nbetween client and server.\r\nDo you want to do so? (y\/n) n\r\n\r\nIf the computer that you are logging into isn't hardened against brute-force\r\nlogin attempts, you can enable rate-limiting for the authentication module.\r\nBy default, this limits attackers to no more than <span class=\"hljs-number\" style=\"color: teal;\">3<\/span> login attempts every 30s.\r\nDo you want to enable rate-limiting? (y\/n) y\r\n<\/pre>\n<p>That&#8217;s it. You have successfully set up Google Authenticator with AWS EC2 instance<\/p>\n<p>&nbsp;<\/p>\n<h3>Step5:\u00a0 Restart SSH services\u00a0 on the EC2 server<\/h3>\n<p>Now as the last step in our endeavour, we need to restart the <code>sshd<\/code>\u00a0service as root<\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; color: #333333; background: #f8f8f8;\"><span style=\"color: #e84d93;\"><span class=\"hljs-attribute\" style=\"font-weight: 400;\">sudo<\/span> service<\/span> sshd restart<\/pre>\n<p>&nbsp;<\/p>\n<h3>Step6: SSH to validate the AWS MFA setup.<\/h3>\n<p>Now use the same way you used to login to the EC2 instance.<\/p>\n<p>If everything was done perfectly.\u00a0 you would be prompted for a verification code<\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; color: #333333; background: #f8f8f8;\">\u279c ~ <span class=\"hljs-attribute\" style=\"color: #e84d93; font-weight: 400;\">ssh<\/span> -i ~\/Downloads\/mykeypair.pem <span style=\"color: #e84d93;\">ec2-user<\/span>@3.95.13.122\r\n<span style=\"color: #003366;\"><span class=\"hljs-attribute\" style=\"font-weight: 400;\">Verification<\/span> code:<\/span><\/pre>\n<p>&nbsp;<\/p>\n<h2><span style=\"color: #003366;\">Video Guide &#8211; VLOG<\/span><\/h2>\n<div data-nosnippet>\n<div class=\"lyte-wrapper\" style=\"width:640px;max-width:100%;margin:5px;\"><div class=\"lyMe\" id=\"WYL_iOb6eZJqj-k\"><div id=\"lyte_iOb6eZJqj-k\" data-src=\"\/\/i.ytimg.com\/vi\/iOb6eZJqj-k\/hqdefault.jpg\" class=\"pL\"><div class=\"tC\"><div class=\"tT\"><\/div><\/div><div class=\"play\"><\/div><div class=\"ctrl\"><div class=\"Lctrl\"><\/div><div class=\"Rctrl\"><\/div><\/div><\/div><noscript><a href=\"https:\/\/youtu.be\/iOb6eZJqj-k\"><img src=\"https:\/\/i.ytimg.com\/vi\/iOb6eZJqj-k\/0.jpg\" alt=\"\" width=\"640\" height=\"340\" \/><br \/>Watch this video on YouTube<\/a><\/noscript><\/div><\/div><div class=\"lL\" style=\"max-width:100%;width:640px;margin:5px;\"><\/div>\n<\/div>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<h2><span style=\"color: #003366;\">Conclusion<\/span><\/h2>\n<p>In this post, we have successfully learnt how to setup AWS MFA and enable MFA (Multi-factor authentication) for SSH in aws ec2 server using Google Authenticator.<\/p>\n<p>Hope it helps.<\/p>\n<p>If you like this article share it among your peers.<\/p>\n<div id=\"postfollow\">\r\n<a href='https:\/\/ko-fi.com\/O4O51FG7C' target='_blank'><img height='46' style='border:0px;height:46px;width: 186px' src='https:\/\/az743702.vo.msecnd.net\/cdn\/kofi3.png?v=2' border='0' alt='Buy Me a Coffee at ko-fi.com' \/><\/a>\r\n<p>Follow us on<a href=\"http:\/\/www.facebook.com\/middlewareinventory\">Facebook<\/a> or<a href=\"http:\/\/www.twitter.com\/mwinventory\">Twitter<\/a>\r\n<\/br>\r\nFor more practical videos and tutorials. <a href=\"https:\/\/www.youtube.com\/channel\/UCRuqBFM6ioWwviNJkgOjeWw?sub_confirmation=1\">Subscribe to our channel<\/a>\r\n<\/br>\r\nFollow me on Linkedin <a href=\"https:\/\/www.linkedin.com\/comm\/mynetwork\/discovery-see-all?usecase=PEOPLE_FOLLOWS&followMember=saravakmwinventory\">My Profile<\/a>\r\n<\/br>\r\n<\/i>For any Consultation or to hire us <a href=\"mailto:rumenlishkoff@gmail.com\"> rumenlishkoff@gmail.com<\/a>\r\n<\/br>\r\nIf you like this article. Show your Support! <a href=\"https:\/\/ko-fi.com\/middlewareinventory\">Buy me a Coffee.<\/a>\r\n<\/br>\r\n<\/p>\r\n<p style=\"color: palevioletred !important;\">Signup for Exclusive \"Subscriber-only\" Content<\/p>\r\n\n\t\t<div class=\"emaillist\">\n\t\t\t<form action=\"#\" method=\"post\" class=\"es_subscription_form es_shortcode_form\" id=\"es_subscription_form_1670578314\" data-source=\"ig-es\">\n\t\t\t\t\t\t\t\t<div class=\"es-field-wrap\"><label>Name*<br \/><input type=\"text\" name=\"name\" class=\"ig_es_form_field_name\" placeholder=\"\" value=\"\" required=\"required\" \/><\/label><\/div><div class=\"es-field-wrap\"><label>Email*<br \/><input class=\"es_required_field es_txt_email ig_es_form_field_email\" type=\"email\" name=\"email\" value=\"\" placeholder=\"\" required=\"required\" \/><\/label><\/div><input type=\"hidden\" name=\"lists[]\" value=\"1\" \/><input type=\"hidden\" name=\"form_id\" value=\"3\" \/>\n\t\t\t\t<input type=\"hidden\" name=\"es_email_page\" value=\"4602\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"es_email_page_url\" value=\"https:\/\/www.middlewareinventory.com\/blog\/aws-mfa-ssh-ec2-setup\/\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"status\" value=\"Unconfirmed\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"es-subscribe\" id=\"es-subscribe\" value=\"7aebfb1a9b\"\/>\n\t\t\t\t<label style=\"position:absolute;top:-99999px;left:-99999px;z-index:-99;\"><input type=\"email\" name=\"es_hp_email\" class=\"es_required_field\" tabindex=\"-1\" autocomplete=\"-1\" value=\"\"\/><\/label>\n\t\t\t\t\t\t\t\t<input type=\"submit\" name=\"submit\" class=\"es_subscription_form_submit es_submit_button es_textbox_button\" id=\"es_subscription_form_submit_1670578314\" value=\"Subscribe\"\/>\n\n\t\t\t\t\n\t\t\t\t<span class=\"es_spinner_image\" id=\"spinner-image\"><img src=\"https:\/\/www.middlewareinventory.com\/wp-content\/plugins\/email-subscribers\/lite\/public\/images\/spinner.gif\" alt=\"Loading\"\/><\/span>\n\n\t\t\t<\/form>\n\n\t\t\t<span class=\"es_subscription_message\" id=\"es_subscription_message_1670578314\"><\/span>\n\t\t<\/div>\n\n\t\t\r\n<\/div>\r\n<hr>\n","protected":false},"excerpt":{"rendered":"<p>Security is always a big thing. Protecting your data is very crucial when there are lot of people out waiting for a chance to exploit. In Enterprise Infrastructure. We have various levels of security as follows Internet Firewall and Gateway Load balancer Restrictions and Constraints Inbound and OutBound Proxy Servers[&#8230;]<\/p>\n","protected":false},"author":1,"featured_media":5742,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"_et_pb_use_builder":"","_et_pb_old_content":"","_et_gb_content_width":""},"categories":[234],"tags":[],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v14.9 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>Enabling Two Factor Authentication for EC2 SSH - AWS MFA Setup<\/title>\n<meta name=\"description\" content=\"AWS MFA Setup -How to Secure your SSH Authentication to EC2 instance with Google Authenticator multi factor authentication(MFA). aws ec2 ssh mfa. AWS Google auth. AWS SSH MFA Configuration. SSH Security with AWS EC2. Configure Google Authenticator in Ec2 instance and how to securely SSH into your EC2 server with MFA.\" \/>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/www.middlewareinventory.com\/blog\/aws-mfa-ssh-ec2-setup\/\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"Enabling Two Factor Authentication for EC2 SSH - AWS MFA Setup\" \/>\n<meta property=\"og:description\" content=\"AWS MFA Setup -How to Secure your SSH Authentication to EC2 instance with Google Authenticator multi factor authentication(MFA). aws ec2 ssh mfa. AWS Google auth. AWS SSH MFA Configuration. SSH Security with AWS EC2. Configure Google Authenticator in Ec2 instance and how to securely SSH into your EC2 server with MFA.\" \/>\n<meta property=\"og:url\" content=\"https:\/\/www.middlewareinventory.com\/blog\/aws-mfa-ssh-ec2-setup\/\" \/>\n<meta property=\"og:site_name\" content=\"Middleware Inventory\" \/>\n<meta property=\"article:publisher\" content=\"http:\/\/www.facebook.com\/devopsjunc\" \/>\n<meta property=\"article:published_time\" content=\"2020-02-08T14:37:43+00:00\" \/>\n<meta property=\"article:modified_time\" content=\"2022-06-19T05:52:46+00:00\" \/>\n<meta property=\"og:image\" content=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-09-16-at-12.08.42-PM.png\" \/>\n\t<meta property=\"og:image:width\" content=\"3296\" \/>\n\t<meta property=\"og:image:height\" content=\"1734\" \/>\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\n<meta name=\"twitter:creator\" content=\"@mwinventory\" \/>\n<meta name=\"twitter:site\" content=\"@mwinventory\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"Organization\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\",\"name\":\"Middleware Inventory\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"sameAs\":[\"http:\/\/www.facebook.com\/devopsjunc\",\"https:\/\/www.youtube.com\/channel\/UCRuqBFM6ioWwviNJkgOjeWw\",\"https:\/\/twitter.com\/mwinventory\"],\"logo\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/09\/Screenshot-2020-09-18-at-3.49.40-AM.jpg\",\"width\":300,\"height\":107,\"caption\":\"Middleware Inventory\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\"}},{\"@type\":\"WebSite\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"name\":\"Devops Junction\",\"description\":\"An inventory of [i]nformation, Middleware and much more.\",\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":\"https:\/\/www.middlewareinventory.com\/?s={search_term_string}\",\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/aws-mfa-ssh-ec2-setup\/#primaryimage\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/02\/Screenshot-2020-09-16-at-12.08.42-PM.png\",\"width\":3296,\"height\":1734,\"caption\":\"AWS MFA\"},{\"@type\":\"WebPage\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/aws-mfa-ssh-ec2-setup\/#webpage\",\"url\":\"https:\/\/www.middlewareinventory.com\/blog\/aws-mfa-ssh-ec2-setup\/\",\"name\":\"Enabling Two Factor Authentication for EC2 SSH - AWS MFA Setup\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\"},\"primaryImageOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/aws-mfa-ssh-ec2-setup\/#primaryimage\"},\"datePublished\":\"2020-02-08T14:37:43+00:00\",\"dateModified\":\"2022-06-19T05:52:46+00:00\",\"description\":\"AWS MFA Setup -How to Secure your SSH Authentication to EC2 instance with Google Authenticator multi factor authentication(MFA). aws ec2 ssh mfa. AWS Google auth. AWS SSH MFA Configuration. SSH Security with AWS EC2. Configure Google Authenticator in Ec2 instance and how to securely SSH into your EC2 server with MFA.\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/www.middlewareinventory.com\/blog\/aws-mfa-ssh-ec2-setup\/\"]}]},{\"@type\":\"Article\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/aws-mfa-ssh-ec2-setup\/#article\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/aws-mfa-ssh-ec2-setup\/#webpage\"},\"author\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\"},\"headline\":\"Enabling Two Factor Authentication for EC2 SSH &#8211; AWS MFA Setup\",\"datePublished\":\"2020-02-08T14:37:43+00:00\",\"dateModified\":\"2022-06-19T05:52:46+00:00\",\"mainEntityOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/aws-mfa-ssh-ec2-setup\/#webpage\"},\"commentCount\":1,\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/aws-mfa-ssh-ec2-setup\/#primaryimage\"},\"articleSection\":\"AWS\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"CommentAction\",\"name\":\"Comment\",\"target\":[\"https:\/\/www.middlewareinventory.com\/blog\/aws-mfa-ssh-ec2-setup\/#respond\"]}]},{\"@type\":\"Person\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\",\"name\":\"Rumen Lishkov\",\"image\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#personlogo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/secure.gravatar.com\/avatar\/c22e4a54d67750291a9892531f94ffb3?s=96&d=mm&r=g\",\"caption\":\"Rumen Lishkov\"}}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","_links":{"self":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/4602"}],"collection":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/comments?post=4602"}],"version-history":[{"count":18,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/4602\/revisions"}],"predecessor-version":[{"id":5070,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/4602\/revisions\/5070"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media\/5742"}],"wp:attachment":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media?parent=4602"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/categories?post=4602"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/tags?post=4602"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}