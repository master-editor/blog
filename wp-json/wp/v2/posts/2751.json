{"id":2751,"date":"2019-01-13T11:35:04","date_gmt":"2019-01-13T06:05:04","guid":{"rendered":"https:\/\/www.middlewareinventory.com\/?p=2751"},"modified":"2022-06-19T11:31:25","modified_gmt":"2022-06-19T06:01:25","slug":"ansible-search-string-file-check-if-string-exists","status":"publish","type":"post","link":"https:\/\/www.middlewareinventory.com\/blog\/ansible-search-string-file-check-if-string-exists\/","title":{"rendered":"ansible search for string in file or check if string exists in file"},"content":{"rendered":"<p>The Objective of this post is to show how to search for a string in a file with ansible. ansible provides various ways to accomplish the same.\u00a0 We will cover,\u00a0 three major ways to search for a string in a file.<\/p>\n<ul>\n<li>Lineinfile module<\/li>\n<li>Using the Shell module and grep command<\/li>\n<li>Using the Shell module and cat command<\/li>\n<\/ul>\n<p>Both would work like a charm and the choice is yours.<\/p>\n<p>Let us proceed.<\/p>\n<p>&nbsp;<\/p>\n<h2>Search for a String in a file\u00a0using Ansible lineinfile module<\/h2>\n<p>Lineinfile module is built to validate whether or not a particular line(string) is available in the file but <strong>primarily designed to modify the file<\/strong> by adding or updating the line when the string is not found. It can also add or remove a line based on a condition.<\/p>\n<p>With little changes and other parameters, <strong>you can tweak lineinfile to not to modify or make changes, but just search<\/strong> for a string and fail or get success based on the result.<\/p>\n<blockquote><p>lineinfile can only work with a single line and if more occurrences of a Search String found, It always go\u00a0for the last matching String (or) the last occurrence. But this can be tweaked and modified using its own parameters like <em>firstmatch<\/em><strong>.\u00a0<\/strong>It\u00a0also has provide other customizing options\u00a0 <em>insert after<\/em> the matched string or <em>insert before<\/em>the match<\/p>\n<p>It also supports regular expressions using <em>regexp<\/em> parameters<\/p><\/blockquote>\n<p>In order to use lineinfile to just search with no modification, we should use an option called <strong>check mode\u00a0<\/strong>this is also known as\u00a0<strong>&#8220;Dry run&#8221;<\/strong><\/p>\n<h3><\/h3>\n<h3><strong>The Playbook to search a string using ansible lineinfile<\/strong><\/h3>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; background: #282a36; color: #f8f8f2;\"><span class=\"hljs-meta\" style=\"color: #6272a4;\">---<\/span>\r\n<span class=\"hljs-attr\">  - name:<\/span> Search String with lineinfile\r\n<span class=\"hljs-attr\">    hosts:<\/span> web\r\n\r\n<span class=\"hljs-attr\">    tasks:<\/span>\r\n<span class=\"hljs-attr\">      - name:<\/span> <span class=\"hljs-string\" style=\"color: #f1fa8c;\">\"Searching for a String\"<\/span>\r\n<span class=\"hljs-attr\">        become:<\/span> <span class=\"hljs-literal\" style=\"color: #8be9fd; font-weight: bold;\">yes<\/span>\r\n<span class=\"hljs-attr\">        become_user:<\/span> root\r\n<span class=\"hljs-attr\">        tags:<\/span> example1\r\n<span class=\"hljs-attr\">        lineinfile:<\/span>\r\n<span class=\"hljs-attr\">          path:<\/span> \/etc\/httpd\/conf\/httpd.conf\r\n<span class=\"hljs-attr\">          line:<\/span> <span class=\"hljs-string\" style=\"color: #f1fa8c;\">\"LogLevel debug\"<\/span>\r\n<span class=\"hljs-attr\">          state:<\/span> present\r\n<span class=\"hljs-attr\">        check_mode:<\/span> <span class=\"hljs-literal\" style=\"color: #8be9fd; font-weight: bold;\">yes<\/span>\r\n<span class=\"hljs-attr\">        register:<\/span> presence\r\n<span class=\"hljs-attr\">        failed_when:<\/span> presence is changed \r\n\r\n<span class=\"hljs-attr\">      - name:<\/span> <span class=\"hljs-string\" style=\"color: #f1fa8c;\">\"sample task in case the String present in the file\"<\/span>\r\n<span class=\"hljs-attr\">        debug:<\/span> msg=<span class=\"hljs-string\" style=\"color: #f1fa8c;\">\"DEBUG is enabled in Apache Log file\"<\/span>\r\n<span class=\"hljs-attr\">        when:<\/span> presence is not changed<\/pre>\n<p>The Playbook will fail when the string is not found and display some message when the String is present in the file.<\/p>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<h2>Search for a String in a file using the Shell module grep command<\/h2>\n<p>We can easily Search for a String in a file using the basic unix commands like grep and cat, executed over the Shell module. and in this example, we are going to use the grep command<\/p>\n<p>Based on the return code of grep command we are executing, the First task will either be changed or failed, the second task is designed only to GO ON when the first task is changed, which totally depends on the string availability.<\/p>\n<p>When the string is present the first task will be changed it will eventually trigger the second task, which supposed to run only when the string exists in the file.<\/p>\n<h3>The Playbook<\/h3>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; background: #282a36; color: #f8f8f2;\">---\r\n  - name: Search String <span class=\"hljs-keyword\" style=\"color: #8be9fd; font-weight: bold;\">with<\/span> lineinfile\r\n    hosts: web\r\n\r\n    tasks:\r\n      - name: <span class=\"hljs-string\" style=\"color: #f1fa8c;\">\"Searching for a String\"<\/span>\r\n        become: yes\r\n        become_user: root\r\n        register: presence\r\n        shell: <span class=\"hljs-string\" style=\"color: #f1fa8c;\">\"grep -i 'LogLevel debug' \/etc\/httpd\/conf\/httpd.conf\"<\/span>\r\n\r\n      - name: <span class=\"hljs-string\" style=\"color: #f1fa8c;\">\"sample task in case the String present in the file\"<\/span>\r\n        debug: msg=<span class=\"hljs-string\" style=\"color: #f1fa8c;\">\"DEBUG is enabled in Apache Log file\"<\/span>\r\n        when: presence <span class=\"hljs-keyword\" style=\"color: #8be9fd; font-weight: bold;\">is<\/span> changed<\/pre>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<h2>Search for a String in a file using shell module cat command<\/h2>\n<p>In this example, we are going to use the <strong>cat<\/strong> command to display the content of the file it will then be saved\u00a0into the register variable.<\/p>\n<p>In the second task which supposed to run only when the string is found, on the when condition we are going to do the Logical validation of finding a string using a <strong>string in register<\/strong><\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; background: #282a36; color: #f8f8f2;\">---\r\n  - name: Search String with lineinfile\r\n    hosts: web\r\n\r\n    tasks:\r\n      - name: <span class=\"hljs-string\" style=\"color: #f1fa8c;\">\"Searching for a String\"<\/span>\r\n        become: yes\r\n        become_user: root\r\n        register: contentofhttpdconf\r\n        shell: <span class=\"hljs-string\" style=\"color: #f1fa8c;\">\"cat \/etc\/httpd\/conf\/httpd.conf\"<\/span>\r\n\r\n      - name: <span class=\"hljs-string\" style=\"color: #f1fa8c;\">\"sample task in case the String present in the file\"<\/span>\r\n        when: '<span class=\"hljs-string\" style=\"color: #f1fa8c;\">\"LogLevel debug\"<\/span> in contentofhttpdconf.stdout'\r\n        debug: msg=<span class=\"hljs-string\" style=\"color: #f1fa8c;\">\"DEBUG is enabled in Apache Log file\"<\/span><\/pre>\n<p>&nbsp;<\/p>\n<p>These are the different ways to search for a string in a file in Ansible. Hope it helps<\/p>\n<p>Thanks,<\/p>\n<p>SaravAK<\/p>\n<div id=\"postfollow\">\r\n<a href='https:\/\/ko-fi.com\/O4O51FG7C' target='_blank'><img height='46' style='border:0px;height:46px;width: 186px' src='https:\/\/az743702.vo.msecnd.net\/cdn\/kofi3.png?v=2' border='0' alt='Buy Me a Coffee at ko-fi.com' \/><\/a>\r\n<p>Follow us on<a href=\"http:\/\/www.facebook.com\/middlewareinventory\">Facebook<\/a> or<a href=\"http:\/\/www.twitter.com\/mwinventory\">Twitter<\/a>\r\n<\/br>\r\nFor more practical videos and tutorials. <a href=\"https:\/\/www.youtube.com\/channel\/UCRuqBFM6ioWwviNJkgOjeWw?sub_confirmation=1\">Subscribe to our channel<\/a>\r\n<\/br>\r\nFollow me on Linkedin <a href=\"https:\/\/www.linkedin.com\/comm\/mynetwork\/discovery-see-all?usecase=PEOPLE_FOLLOWS&followMember=saravakmwinventory\">My Profile<\/a>\r\n<\/br>\r\n<\/i>For any Consultation or to hire us <a href=\"mailto:rumenlishkoff@gmail.com\"> rumenlishkoff@gmail.com<\/a>\r\n<\/br>\r\nIf you like this article. Show your Support! <a href=\"https:\/\/ko-fi.com\/middlewareinventory\">Buy me a Coffee.<\/a>\r\n<\/br>\r\n<\/p>\r\n<p style=\"color: palevioletred !important;\">Signup for Exclusive \"Subscriber-only\" Content<\/p>\r\n\n\t\t<div class=\"emaillist\">\n\t\t\t<form action=\"#\" method=\"post\" class=\"es_subscription_form es_shortcode_form\" id=\"es_subscription_form_1670578083\" data-source=\"ig-es\">\n\t\t\t\t\t\t\t\t<div class=\"es-field-wrap\"><label>Name*<br \/><input type=\"text\" name=\"name\" class=\"ig_es_form_field_name\" placeholder=\"\" value=\"\" required=\"required\" \/><\/label><\/div><div class=\"es-field-wrap\"><label>Email*<br \/><input class=\"es_required_field es_txt_email ig_es_form_field_email\" type=\"email\" name=\"email\" value=\"\" placeholder=\"\" required=\"required\" \/><\/label><\/div><input type=\"hidden\" name=\"lists[]\" value=\"1\" \/><input type=\"hidden\" name=\"form_id\" value=\"3\" \/>\n\t\t\t\t<input type=\"hidden\" name=\"es_email_page\" value=\"2751\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"es_email_page_url\" value=\"https:\/\/www.middlewareinventory.com\/blog\/ansible-search-string-file-check-if-string-exists\/\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"status\" value=\"Unconfirmed\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"es-subscribe\" id=\"es-subscribe\" value=\"7aebfb1a9b\"\/>\n\t\t\t\t<label style=\"position:absolute;top:-99999px;left:-99999px;z-index:-99;\"><input type=\"email\" name=\"es_hp_email\" class=\"es_required_field\" tabindex=\"-1\" autocomplete=\"-1\" value=\"\"\/><\/label>\n\t\t\t\t\t\t\t\t<input type=\"submit\" name=\"submit\" class=\"es_subscription_form_submit es_submit_button es_textbox_button\" id=\"es_subscription_form_submit_1670578083\" value=\"Subscribe\"\/>\n\n\t\t\t\t\n\t\t\t\t<span class=\"es_spinner_image\" id=\"spinner-image\"><img src=\"https:\/\/www.middlewareinventory.com\/wp-content\/plugins\/email-subscribers\/lite\/public\/images\/spinner.gif\" alt=\"Loading\"\/><\/span>\n\n\t\t\t<\/form>\n\n\t\t\t<span class=\"es_subscription_message\" id=\"es_subscription_message_1670578083\"><\/span>\n\t\t<\/div>\n\n\t\t\r\n<\/div>\r\n<hr>\n<p>&nbsp;<\/p>\n","protected":false},"excerpt":{"rendered":"<p>The Objective of this post is to show how to search for a string in a file with ansible. ansible provides various ways to accomplish the same.\u00a0 We will cover,\u00a0 three major ways to search for a string in a file. Lineinfile module Using the Shell module and grep command[&#8230;]<\/p>\n","protected":false},"author":1,"featured_media":2756,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"_et_pb_use_builder":"","_et_pb_old_content":"","_et_gb_content_width":""},"categories":[98],"tags":[167,165,166,163,164],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v14.9 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>ansible search for string in file or check if string exists in file<\/title>\n<meta name=\"description\" content=\"In this post, we are going to see the various methods to search for string in a file or in other words we are going to check if string exists in a file using ansible modules such as lineinfile and shell. the post provides three methods and playbooks. check for a string in the file before proceeding with the next task.\" \/>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/www.middlewareinventory.com\/blog\/ansible-search-string-file-check-if-string-exists\/\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"ansible search for string in file or check if string exists in file\" \/>\n<meta property=\"og:description\" content=\"In this post, we are going to see the various methods to search for string in a file or in other words we are going to check if string exists in a file using ansible modules such as lineinfile and shell. the post provides three methods and playbooks. check for a string in the file before proceeding with the next task.\" \/>\n<meta property=\"og:url\" content=\"https:\/\/www.middlewareinventory.com\/blog\/ansible-search-string-file-check-if-string-exists\/\" \/>\n<meta property=\"og:site_name\" content=\"Middleware Inventory\" \/>\n<meta property=\"article:publisher\" content=\"http:\/\/www.facebook.com\/devopsjunc\" \/>\n<meta property=\"article:published_time\" content=\"2019-01-13T06:05:04+00:00\" \/>\n<meta property=\"article:modified_time\" content=\"2022-06-19T06:01:25+00:00\" \/>\n<meta property=\"og:image\" content=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/01\/file_search.jpg\" \/>\n\t<meta property=\"og:image:width\" content=\"597\" \/>\n\t<meta property=\"og:image:height\" content=\"512\" \/>\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\n<meta name=\"twitter:creator\" content=\"@mwinventory\" \/>\n<meta name=\"twitter:site\" content=\"@mwinventory\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"Organization\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\",\"name\":\"Middleware Inventory\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"sameAs\":[\"http:\/\/www.facebook.com\/devopsjunc\",\"https:\/\/www.youtube.com\/channel\/UCRuqBFM6ioWwviNJkgOjeWw\",\"https:\/\/twitter.com\/mwinventory\"],\"logo\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/09\/Screenshot-2020-09-18-at-3.49.40-AM.jpg\",\"width\":300,\"height\":107,\"caption\":\"Middleware Inventory\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\"}},{\"@type\":\"WebSite\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"name\":\"Devops Junction\",\"description\":\"An inventory of [i]nformation, Middleware and much more.\",\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":\"https:\/\/www.middlewareinventory.com\/?s={search_term_string}\",\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-search-string-file-check-if-string-exists\/#primaryimage\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2019\/01\/file_search.jpg\",\"width\":597,\"height\":512},{\"@type\":\"WebPage\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-search-string-file-check-if-string-exists\/#webpage\",\"url\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-search-string-file-check-if-string-exists\/\",\"name\":\"ansible search for string in file or check if string exists in file\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\"},\"primaryImageOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-search-string-file-check-if-string-exists\/#primaryimage\"},\"datePublished\":\"2019-01-13T06:05:04+00:00\",\"dateModified\":\"2022-06-19T06:01:25+00:00\",\"description\":\"In this post, we are going to see the various methods to search for string in a file or in other words we are going to check if string exists in a file using ansible modules such as lineinfile and shell. the post provides three methods and playbooks. check for a string in the file before proceeding with the next task.\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/www.middlewareinventory.com\/blog\/ansible-search-string-file-check-if-string-exists\/\"]}]},{\"@type\":\"Article\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-search-string-file-check-if-string-exists\/#article\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-search-string-file-check-if-string-exists\/#webpage\"},\"author\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\"},\"headline\":\"ansible search for string in file or check if string exists in file\",\"datePublished\":\"2019-01-13T06:05:04+00:00\",\"dateModified\":\"2022-06-19T06:01:25+00:00\",\"mainEntityOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-search-string-file-check-if-string-exists\/#webpage\"},\"commentCount\":0,\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/ansible-search-string-file-check-if-string-exists\/#primaryimage\"},\"keywords\":\"ansible file string check,check if string present ansible,make sure the string is present in ansible file,search for string ansible,search string ansible\",\"articleSection\":\"Ansible\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"CommentAction\",\"name\":\"Comment\",\"target\":[\"https:\/\/www.middlewareinventory.com\/blog\/ansible-search-string-file-check-if-string-exists\/#respond\"]}]},{\"@type\":\"Person\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\",\"name\":\"Rumen Lishkov\",\"image\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#personlogo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/secure.gravatar.com\/avatar\/c22e4a54d67750291a9892531f94ffb3?s=96&d=mm&r=g\",\"caption\":\"Rumen Lishkov\"}}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","_links":{"self":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/2751"}],"collection":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/comments?post=2751"}],"version-history":[{"count":6,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/2751\/revisions"}],"predecessor-version":[{"id":5780,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/2751\/revisions\/5780"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media\/2756"}],"wp:attachment":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media?parent=2751"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/categories?post=2751"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/tags?post=2751"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}