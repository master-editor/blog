{"id":1435,"date":"2018-07-11T11:19:03","date_gmt":"2018-07-11T05:49:03","guid":{"rendered":"http:\/\/www.middlewareinventory.com\/?p=1435"},"modified":"2022-11-11T00:48:12","modified_gmt":"2022-11-10T19:18:12","slug":"vagrant-ansible-example","status":"publish","type":"post","link":"https:\/\/www.middlewareinventory.com\/blog\/vagrant-ansible-example\/","title":{"rendered":"Ansible Vagrant Example &#8211; Testing Ansible with Vagrant | Devops Junction"},"content":{"rendered":"<p>In this article, we are going to see how to use Vagrant to create a development of Virtual machines and start practising Ansible.<\/p>\n<p>This is A Beginner article for both Ansible and Vagrant.<\/p>\n<p>I remember the days where I used to struggle with\u00a0 Vmware workstation (or) virtual box to setup network configuration for my Virtual machines and banging my head to take the putty session to the Guest VM.<\/p>\n<p>Then I was introduced to Vagrant and am never going back!.<\/p>\n<p>On the other hand.\u00a0 Ansible is an innovative tool for automation and infrastructure and application management.<\/p>\n<p>A promise for the present and future.\u00a0\u00a0 In the DevOps sector (or) platform services sector or in any IT infrastructure sector you take,\u00a0 Ansible is an uprising and rapidly being adopted product.<\/p>\n<p>This post is going to be all about Vagrant and Ansible and How Ansible vagrant works together in Server Provisioning<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screenshot-2020-10-19-at-2.22.13-AM-scaled.jpg\"><img class=\"alignnone size-full wp-image-6253\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screenshot-2020-10-19-at-2.22.13-AM-scaled.jpg\" alt=\"Ansible Vagrant\" width=\"2560\" height=\"1440\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screenshot-2020-10-19-at-2.22.13-AM-scaled.jpg 2560w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screenshot-2020-10-19-at-2.22.13-AM-300x169.jpg 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screenshot-2020-10-19-at-2.22.13-AM-1024x576.jpg 1024w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screenshot-2020-10-19-at-2.22.13-AM-768x432.jpg 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screenshot-2020-10-19-at-2.22.13-AM-1536x864.jpg 1536w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screenshot-2020-10-19-at-2.22.13-AM-2048x1152.jpg 2048w\" sizes=\"(max-width: 2560px) 100vw, 2560px\" \/><\/a><\/p>\n<p>&nbsp;<\/p>\n<h2><strong>What is Vagrant<\/strong><\/h2>\n<p>According to Hashicorp. A company who developed vagrant. Vagrant is<\/p>\n<blockquote><p>Vagrant is a tool for building and managing virtual machine environments in a single workflow. With an easy-to-use workflow and focus on automation<\/p><\/blockquote>\n<p>In simple words.<\/p>\n<ol>\n<li>Vagrant is a server provisioning tool<\/li>\n<li>It uses virtualisation providers like Oracle Virtual box to create VMs<\/li>\n<li>It just provides an efficient way to demonstrate the VMs created in Oracle Virtual box\u00a0 (or) other virtualisation providers.<\/li>\n<li>Vagrant has its commands.<\/li>\n<li>Vagrant works as a layer on top of the Virtualization provider.<\/li>\n<li>It can also be considered as a Virtual machine management System<\/li>\n<li>You can create Virtual machines and provision them by typing few lines of code in a configuration file named <strong>&#8220;Vagrantfile.&#8221;<\/strong><\/li>\n<li>Vagrant is a minimal form of <strong>Infrastructure as Code <\/strong>concept and intended for development infrastructure building\/provisioning where\u00a0 <a href=\"https:\/\/www.terraform.io\/\"><strong>Terraform<\/strong><\/a> is a full-fledged IaC product from the same company (Hashicorp)\u00a0 is a leader in the IaC market.<\/li>\n<\/ol>\n<p>&nbsp;<\/p>\n<h2><strong>What is Ansible<\/strong><\/h2>\n<p>Ansible is an agentless Simple IT Automation software\/tool which helps to automate any Application Management, Configuration Management, Infrastructure management tasks.<\/p>\n<p>What makes Ansible a leader in IT Automation.<\/p>\n<div class=\"page\" title=\"Page 17\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<ol>\n<li><strong>Clear<\/strong> &#8211; Ansible uses a simple syntax (YAML) and is easy for anyone (developers, sysadmins, managers) to understand. APIs are simple and sensible.<\/li>\n<li><strong>Fast &#8211; <\/strong>Fast to learn, fast to setup \u2014especially considering you don\u2019t need to install extra agents or daemons on all your servers!<\/li>\n<li><strong>Complete<\/strong> &#8211; Ansible does three things in one and does them very well. Ansible\u2019s \u2018batteries included\u2019 approach means you have everything you need in one complete package.<\/li>\n<li><strong>Efficient<\/strong> &#8211; No extra software on your servers means more resources for your applications. Also, since Ansible modules work via JSON, Ansible is extensible with modules written in a programming language you already know.<\/li>\n<li>\n<div class=\"page\" title=\"Page 18\">\n<div class=\"layoutArea\">\n<div class=\"column\">\n<p><strong>Secure<\/strong>-AnsibleusesSSH, and requires no extra open ports or potentially &#8211; vulnerable daemons on your servers.<\/p>\n<\/div>\n<\/div>\n<\/div>\n<\/li>\n<\/ol>\n<\/div>\n<\/div>\n<\/div>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<p>Let&#8217;s go ahead and see how to install and configure Ansible and Vagrant.<\/p>\n<p>&nbsp;<\/p>\n<h2>Install Oracle Virtual Box<\/h2>\n<p>As said earlier, Vagrant works as a layer on top of virtualisation software aka hypervisor like\u00a0 Oracle Virtual box (or) Vmware workstation. Oracle Virtual box and Vagrant are widely used pair of choice.<\/p>\n<p><a href=\"https:\/\/www.virtualbox.org\/wiki\/Downloads\">https:\/\/www.virtualbox.org\/wiki\/Downloads<\/a><\/p>\n<p><strong>Note*:<\/strong> In this post, we have used <strong>Oracle Virtual box<\/strong> as a hypervisor (or) provider<\/p>\n<h2><\/h2>\n<h2>Install Vagrant<\/h2>\n<p>Vagrant can be downloaded and install in your Windows (or) Mac machines; you can also have it installed in Linux based operating systems.<\/p>\n<p><a href=\"https:\/\/www.vagrantup.com\/downloads.html\">https:\/\/www.vagrantup.com\/downloads.html<\/a><\/p>\n<p>Considering that you have installed the Oracle Virtual box and Vagrant. Let us walk into the magic of Vagrant, by creating our first VM.<\/p>\n<p>&nbsp;<\/p>\n<h2>Validate the Version of your Vagrant<\/h2>\n<p>Once you have installed Vagrant go to your command-line tool.<\/p>\n<p>cmd for windows, terminal for Mac. and enter the following command to make sure that the vagrant is installed properly<\/p>\n<pre>vagrant version<\/pre>\n<p>&nbsp;<\/p>\n<h2>Choose your Box ( Operating System )<\/h2>\n<p>In Vagrant operating system image is called as Box. Like any traditional VM creation strategy, for any VM creation, we must have an ISO package of the Operating system<\/p>\n<p>Unlike the traditional way of downloading the ISO images directly by your self from the vendor websites.<\/p>\n<p>Vagrant gives you an easy way or a platform to search and download the operating systems of your choice.<\/p>\n<p><a href=\"https:\/\/app.vagrantup.com\/boxes\/search?utf8=%E2%9C%93&amp;sort=downloads&amp;provider=&amp;q=\">Vagrant Cloud<\/a> is a repository of these Boxes (images), where you can discover various fresh operating systems (or) a complete ready to load an image with infrastructure like LAMP stack.<\/p>\n<p>Everything you might ever need is right there in the Vagrant cloud. If not, you do it on your own and upload it for other pioneers who gonna come in future.<\/p>\n<p><strong>Note*:<\/strong> For this post, I am taking a normal <strong>cent os 7 box <\/strong>named as <strong>&#8220;geerlingguy\/centos7&#8221;<\/strong><\/p>\n<h2><\/h2>\n<h2>How to download a new box in Vagrant<\/h2>\n<p>There are two\u00a0 methods to download a box to your local vagrant<\/p>\n<p><strong>Auto Download<\/strong><\/p>\n<p>You can note down the name of the box from the cloud like &#8220;geerlingguy\/centos7&#8221; and mention it as your box name in your <strong>Vagrantfile<\/strong><\/p>\n<p>When you are provisioning (or) bring up your VM for the first time with <code>vagrant up<\/code>command.\u00a0 Vagrant will check the availability of the box in local,<\/p>\n<p><strong>If the box mentioned in Vagrantfile is not available in local.\u00a0 It will try to download it from the Vagrant Cloud<\/strong><\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"ruby\" data-enlighter-theme=\"bootstrap4\">Vagrant.configure(\"2\") do |config|\r\n config.vm.box = \"geerlingguy\/centos7\"\r\nend<\/pre>\n<p>&nbsp;<\/p>\n<p><strong>Manual <\/strong><\/p>\n<p>You can also download the boxes and manage it using with vagrant command line. In order to download and add the box manually to your vagrant. just execute the following command.<\/p>\n<pre>vagrant box add geerlingguy\/centos7<\/pre>\n<p>&nbsp;<\/p>\n<p>To get a list of boxes downloaded and available in vagrant (local), use the following command<\/p>\n<pre>vagrant box list<\/pre>\n<p>&nbsp;<\/p>\n<blockquote><p><strong>Note*:<\/strong> There are various other commands in vagrant for box management and\u00a0 VM management etc.\u00a0 You can find the <strong>Vagrant command cheat sheet<\/strong> <a href=\"https:\/\/gist.github.com\/wpscholar\/a49594e2e2b918f4d0c4\">here<\/a><\/p><\/blockquote>\n<p>&nbsp;<\/p>\n<h2>Create your First Virtual Machine with Vagrant<\/h2>\n<p>As said earlier, Vagrant works based on a configuration file named <strong>&#8220;Vagrantfile&#8221; . <\/strong>This is written in ruby.<\/p>\n<p>To create a new VM, you must have the <strong>Vagrantfile<\/strong> ready with the proper configuration.\u00a0 To get a Vagrantfile, you could use the following command<\/p>\n<pre>vagrant init<\/pre>\n<p>This will result in creating a new file named &#8220;Vagrantfile&#8221; in the present working directory.<\/p>\n<p>If you open the Vagrantfile you could see tons of commented lines with only three uncommented lines.<\/p>\n<p>if you want to cut down that comments. you have to initialize the vagrant with <code>--minimal<\/code> parameter like shown below.<\/p>\n<pre>vagrant init &#8211; minimal<\/pre>\n<p>it would create a Vagrantfile with very minimal content as follows<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"ruby\" data-enlighter-theme=\"bootstrap4\">Vagrant.configure(\"2\") do |config| \r\n    config.vm.box = \"base\" \r\nend<\/pre>\n<p>&nbsp;<\/p>\n<p>but this is for <strong>default <\/strong>basic VM provisioning where the Virtual machine will be created with the basic minimal OS being provided by hashicorp.<\/p>\n<p>To initialize vagrant with a specific box (image) instead of the<strong> base. <\/strong>you have to execute the vagrant init along with the box name at the end.<\/p>\n<pre>vagrant init geerlingguy\/centos7<\/pre>\n<p>Though you mentioned the box name here.\u00a0 There would be no more changes in the content except in the line <code>config.vm.box = \"base\"<\/code>\u00a0 base would be replaced with the box name you had mentioned.<\/p>\n<p>So its time to write the Vagrantfile of our own with further cutomizations.<\/p>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<h2><\/h2>\n<h2>The configuration of our VM<\/h2>\n<p>Our requirement is to create a Virtual machine with the following configuration<\/p>\n<pre class=\"hljs\" style=\"display: block; overflow-x: auto; padding: 0.5em; background-color: #f0f0f0; color: #444444;\">-<span class=\"ruby\"> <span class=\"hljs-number\" style=\"color: #880000;\">1<\/span> GB of Physical Memory\r\n<\/span>-<span class=\"ruby\"> Cent OS <span class=\"hljs-number\" style=\"color: #880000;\">7<\/span> Operating System\r\n<\/span>-<span class=\"ruby\"> Apache webserver installed\r\n<\/span>-<span class=\"ruby\"> port forwarding Guest <span class=\"hljs-number\" style=\"color: #880000;\">80<\/span> -&gt; Host <span class=\"hljs-number\" style=\"color: #880000;\">8080<\/span>\r\n<\/span>-<span class=\"ruby\"> Shared directory between host <span class=\"hljs-keyword\" style=\"font-weight: bold;\">and<\/span> guest (vm)\r\n<\/span>-<span class=\"ruby\"> Ansible Provisioning<\/span><\/pre>\n<p>Let us create a Vagrantfile defining all of these requirement inside<\/p>\n<p>&nbsp;<\/p>\n<h2>The Vagrantfile for our VM<\/h2>\n<p>This is the Vagrantfile we need to accomplish all those requirements, I have defined all our requirement including ansible provisioning<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"ruby\" data-enlighter-theme=\"bootstrap4\" data-enlighter-linenumbers=\"false\"># -*- mode: ruby -*-\r\n# vi: set ft=ruby :\r\n\r\nVagrant.configure(\"2\") do |config|\r\n config.vm.box_check_update = \"false\"\r\n config.vm.provider \"virtualbox\" do |vb|\r\n   vb.memory = \"1024\"\r\n end\r\n\r\n config.vm.define \"webserver\" do |web|\r\n   web.vm.hostname = \"mwiws01\"\r\n   web.vm.box = \"geerlingguy\/centos7\"\r\n   web.vm.network :private_network, ip: \"192.168.10.10\"\r\n   web.vm.network \"forwarded_port\", guest: \"80\", host: \"8080\"\r\n   web.vm.synced_folder \"\/apps\/shared\", \"\/shared\"\r\n   #Provision the webserver with Ansible\r\n   web.vm.provision \"ansible\" do |ansible|\r\n     ansible.playbook=\"apache-playbook.yaml\"\r\n   end\r\n  end\r\nend<\/pre>\n<p>&nbsp;<\/p>\n<p>Let me explain what every line in the file does briefly<\/p>\n<p>As you could see, the <strong>Vagrantfile uses Ruby Syntax<\/strong> so if you are good at ruby you can easily understand the syntax of this file.<\/p>\n<p>However, knowledge of ruby is not mandatory to write and understand the Vagrantfile<\/p>\n<p>The following line loads the Vagrant API version 2 and assigns it to\u00a0 a variable named <strong>config<\/strong><\/p>\n<pre>Vagrant.configure(\"2\") do |config|<\/pre>\n<p><code>config<\/code> is the widely used variable name at this stage. So let&#8217;s go with the standards what vagrant follow so that we would be able to understand things much better<\/p>\n<pre>config.vm.box_check_update = \"false\"<\/pre>\n<p>the next line in the file is to disable the auto-update feature of the vagrant to read more about this feature go <a href=\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-up-command-gets-stuck-while-checking-box-up-to-date\/\">here<\/a><\/p>\n<p><strong>config.vm <\/strong>is the major namespace in Vagrant API<\/p>\n<p>There are other namespaces available as follows<\/p>\n<ul>\n<li>config.vm<\/li>\n<li>config.ssh<\/li>\n<li>config.winrm<\/li>\n<li>config.winssh<\/li>\n<li>config.vagrant<\/li>\n<\/ul>\n<p><strong>Note<\/strong>*: To know what each namespace is designated to do and what are the settings available in each namespace. Refer <a href=\"https:\/\/www.vagrantup.com\/docs\/vagrantfile\/machine_settings.html\">this<\/a> vagrant documentation<\/p>\n<pre>config.vm.provider \"virtualbox\" do |vb| \r\n   vb.memory = \"1024\" \r\nend<\/pre>\n<p>The preceding lines from Vagrantfile are there to define the provider we are going use for provisioning our VM. In our case it&#8217;s <strong>virtualbox<\/strong>.<\/p>\n<p><code>vb.memory<\/code> tells vagrant that, whichever\u00a0 VM we are going to define and create from this Vagrantfile will be having 1024mb of memory by default until it is overwritten by the VM specific configuration.<\/p>\n<p>Now we are going to define our Virtual machine-specific configuration, I have added a comment for each line to explain what they are doing.<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"ruby\" data-enlighter-theme=\"bootstrap4\" data-enlighter-linenumbers=\"false\"># Defining a New VM named webserver and assign to a variable named web \r\nconfig.vm.define \"webserver\" do |web| \r\n\r\n    # Set the hostname of the VM \r\n    web.vm.hostname = \"mwiws01\" \r\n     \r\n    # Set the box (OS) for the Virtual machine, we use centos7 \r\n    web.vm.box = \"geerlingguy\/centos7\" \r\n    \r\n    \r\n    # Define the network for your VM I chose private_network, you can use public_network as well. \r\n    web.vm.network :private_network, ip: \"192.168.10.10\" \r\n    \r\n    # Port forwarding configuration as per our requirement \r\n    web.vm.network \"forwarded_port\", guest: \"80\", host: \"8080\" \r\n    \r\n    # Creating a Shared Directory between host and guest VM \r\n    web.vm.synced_folder \"\/apps\/shared\", \"\/shared\" \r\n    \r\n    # Provision the webserver with Ansible, Execute the playbook \r\n    web.vm.provision \"ansible\" do |ansible| \r\n        \r\n    # Mention the fully qualified path and name of playbook. \r\n    # If no path mentioned, vagrant will take the base directory where Vagrantfile resides \r\n    ansible.playbook=\"apache-playbook.yaml\" \r\n    end \r\nend<\/pre>\n<p>&nbsp;<\/p>\n<p>&nbsp;<\/p>\n<h2><strong>Ansible playbook and its artifacts<\/strong><\/h2>\n<p>The Ansible playbook is written to perform various steps like Installing the Repository, Installing the Apache, Creating a Symlink, Creating a document root etc.<\/p>\n<p>The Major task our ansible playbook is going to do is that <em>to download the home page of www.middlewareinventory.com and keep it as a default HTML (index.html) page in our apache server<\/em><\/p>\n<blockquote><p>Note*:<\/p>\n<ul>\n<li>you can find the playbook and all the artifacts including the Vagrantfile in this\u00a0\u00a0<a href=\"https:\/\/github.com\/AKSarav\/Vagrant-Ansible-Project\">GITHUB<\/a> repository<\/li>\n<li>More detailed information on how this entire setup is working.\u00a0\u00a0<a href=\"https:\/\/www.youtube.com\/watch?v=Dt_BoHmevWc\">See the video<\/a> I have posted on our youtube channel<\/li>\n<\/ul>\n<\/blockquote>\n<p>&nbsp;<\/p>\n<p>Here is a one-line explanation of the files being used\u00a0 in this project<\/p>\n<p><a href=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screen-Shot-2018-07-10-at-5.14.05-PM.png\"><img class=\"alignnone size-full wp-image-1446\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screen-Shot-2018-07-10-at-5.14.05-PM.png\" alt=\"\" width=\"889\" height=\"195\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screen-Shot-2018-07-10-at-5.14.05-PM.png 889w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screen-Shot-2018-07-10-at-5.14.05-PM-300x66.png 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screen-Shot-2018-07-10-at-5.14.05-PM-768x168.png 768w\" sizes=\"(max-width: 889px) 100vw, 889px\" \/><\/a><\/p>\n<p>In a summary, this is what our ansible playbook does.<\/p>\n<ol>\n<li>\u00a0Load the variables file <strong>vars.yaml\u00a0<\/strong><\/li>\n<li>\u00a0Download and Install the EPEL release RPM ( from internet)<\/li>\n<li>\u00a0Install Apache HTTPD Webserver<\/li>\n<li>\u00a0Copy the template *.j2 (Jinja2) files to the destination after replacing the variables in J2 file with the corresponding values taken from our variables declaration file\u00a0vars.yaml<\/li>\n<li>\u00a0Create a Document root directory<\/li>\n<li>\u00a0Connect to the www.middlewareinventory.com and download the home page and save it as <strong>index.html\u00a0<\/strong>under document root ( Default page for our site)<\/li>\n<li>\u00a0Restart the Apache HTTPD process<\/li>\n<\/ol>\n<p>The preceding tasks would be executed in the order it was given, with this understanding. If you go and refer our playbook given below.\u00a0 You would be able to understand what each task is intended to do.<\/p>\n<p><strong>File Content is hidden by default. Click the <i class=\"fa fa-plus\"><\/i> Sign to enlarge\/shrink<\/strong><\/p>\n<p>&nbsp;<\/p>\n<details>\n<summary><i class=\"fa fa-plus\"><\/i> The Ansible Playbook<\/summary>\n<p><script src=\"https:\/\/gist.github.com\/AKSarav\/8dfb29c8bf99528b2ca8ecb1ed764e55.js\"><\/script><\/p>\n<\/details>\n<details>\n<summary><i class=\"fa fa-plus\"><\/i> The Variables file<\/summary>\n<p><script src=\"https:\/\/gist.github.com\/AKSarav\/1ff646acc7cd58b1b3e98bafdb7a73b1.js\"><\/script><\/p>\n<\/details>\n<details>\n<summary><i class=\"fa fa-plus\"><\/i> The Base HTTPD.conf template<\/summary>\n<p><script src=\"https:\/\/gist.github.com\/AKSarav\/6b1c9d6045c6eacf6508acefe617910f.js\"><\/script><\/p>\n<\/details>\n<details>\n<summary><i class=\"fa fa-plus\"><\/i> The Custom Virtualhost template<\/summary>\n<p><script src=\"https:\/\/gist.github.com\/AKSarav\/51f821bdcda6fcae2e375d378388df23.js\"><\/script><\/p>\n<\/details>\n<p>&nbsp;<\/p>\n<p>The templating process and J2 files make it possible to replace the domain name\/ server name at runtime. Having said that.\u00a0 If you want to build a virtualhost with a different server name all you have to do is to update the <strong>vars.yaml<\/strong> file.<\/p>\n<p>&nbsp;<\/p>\n<h2>Create the VM and Start the Server Provisioning &#8211; Vagrant ansible<\/h2>\n<p>To create the VM and start the server provisioning all you have to do is to enter the following command once you have all the files downloaded from the GITHUB repository.<\/p>\n<pre>vagrant up<\/pre>\n<p>&nbsp;<\/p>\n<p>vagrant up command should be used to start the VM as we are starting the VM for the first time it will automatically provision it.<\/p>\n<p>you can manually re-provision the VM at any time ( even after creating the VM)\u00a0 by executing the following command<\/p>\n<pre>vagrant provision<\/pre>\n<p>If you opt to <strong>just the start the VM and provision it later<\/strong>. you can explicitly mention Vagrant to skip provisioning with the following command.<\/p>\n<p>It will bring up the VM but not provision it, in other words, it will not execute our ansible playbook defined in <em>Vagrantfile<\/em><\/p>\n<pre>vagrant up &#8211; no-provision<\/pre>\n<p>In our case, we are going to create the VM\u00a0 with provisioning so\u00a0 we are using <strong>vagrant up<\/strong> command<\/p>\n<script async src=\"https:\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\r\n<ins class=\"adsbygoogle\"\r\n     style=\"display:block; text-align:center;\"\r\n     data-ad-layout=\"in-article\"\r\n     data-ad-format=\"fluid\"\r\n     data-ad-client=\"ca-pub-3398911159151128\"\r\n     data-ad-slot=\"1946393371\"><\/ins>\r\n<script>\r\n     (adsbygoogle = window.adsbygoogle || []).push({});\r\n<\/script>\n<p>&nbsp;<\/p>\n<h2><strong>The Execution Output of Vagrant ansible example ( 26 seconds )<\/strong><\/h2>\n<p>you can<a href=\"https:\/\/youtu.be\/nXyZRGVLo2A\"> click on this link<\/a> to see the execution output<\/p>\n<p><a href=\"https:\/\/youtu.be\/nXyZRGVLo2A\"><img class=\"alignnone size-full wp-image-6646\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screenshot-2021-01-19-at-3.12.58-PM.jpg\" alt=\"\" width=\"1031\" height=\"661\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screenshot-2021-01-19-at-3.12.58-PM.jpg 1031w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screenshot-2021-01-19-at-3.12.58-PM-300x192.jpg 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screenshot-2021-01-19-at-3.12.58-PM-1024x657.jpg 1024w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screenshot-2021-01-19-at-3.12.58-PM-768x492.jpg 768w\" sizes=\"(max-width: 1031px) 100vw, 1031px\" \/><\/a><\/p>\n<h2><\/h2>\n<h2>Vagrant Ansible In Action &#8211; VLOG<\/h2>\n<p><a href=\"https:\/\/www.youtube.com\/watch?v=Dt_BoHmevWc\">Click on this link to<\/a> check out the VLOG\/Screen recording of this playbook execution and explanation<\/p>\n<p><a href=\"https:\/\/www.youtube.com\/watch?v=Dt_BoHmevWc\"><img class=\"alignnone size-full wp-image-6645\" src=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screenshot-2021-01-19-at-2.57.20-PM.jpg\" alt=\"\" width=\"915\" height=\"658\" srcset=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screenshot-2021-01-19-at-2.57.20-PM.jpg 915w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screenshot-2021-01-19-at-2.57.20-PM-300x216.jpg 300w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screenshot-2021-01-19-at-2.57.20-PM-768x552.jpg 768w, https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screenshot-2021-01-19-at-2.57.20-PM-90x65.jpg 90w\" sizes=\"(max-width: 915px) 100vw, 915px\" \/><\/a><\/p>\n<p>&nbsp;<\/p>\n<h2><\/h2>\n<h2>Vagrantfile example with Multiple Virtual machines<\/h2>\n<p>Now, as you have gained some expertise on the ansible provisioning with vagrant.<\/p>\n<p>Now look at the following Vagrantfile which helps you create an entire Infrastructure like Application Server, Web Server, Database Server etc and all of them are going to be having the same Configuration and Base Image (OS)<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"ruby\" data-enlighter-theme=\"bootstrap4\" data-enlighter-linenumbers=\"false\"># -*- mode: ruby -*- \r\n# vi: set ft=ruby : \r\n\r\nVAGRANTFILE_API_VERSION = \"2\" \r\n\r\nVagrant.configure(VAGRANTFILE_API_VERSION) do|config| \r\n    config.ssh.insert_key = false \r\n    config.vm.provider :virtualbox do|vb| \r\n        vb.customize [\"modifyvm\", :id, \"--memory\", \"2048\"] \r\n    end \r\n    \r\n    #Web Server \r\n    config.vm.define \"web1\" do|web| \r\n        web.vm.hostname = \"mwiweb02\" \r\n        web.vm.box = \"geerlingguy\/centos7\" \r\n        web.vm.network \"public_network\", ip: \"192.168.43.14\" \r\n    end \r\n    \r\n    #Application Server1 \r\n    config.vm.define \"app1\" do|app| \r\n        app.vm.hostname = \"mwivmapp01\" \r\n        app.vm.box = \"geerlingguy\/centos7\" \r\n        app.vm.network \"public_network\", ip: \"192.168.43.11\" \r\n    end \r\n    \r\n    #Application Server2 \r\n    config.vm.define \"app2\" do|app| \r\n        app.vm.hostname = \"mwivmapp02\" \r\n        app.vm.box = \"geerlingguy\/centos7\" \r\n        app.vm.network \"public_network\", ip: \"192.168.43.12\" \r\n    end \r\n    \r\n    #Database Server \r\n    config.vm.define \"db\" do|db| \r\n        db.vm.hostname = \"mwisqldb01\" \r\n        db.vm.box = \"geerlingguy\/centos7\" \r\n        db.vm.network \"public_network\", ip: \"192.168.43.13\" \r\n    end \r\n    \r\n    config.vm.box_check_update = false \r\n    config.vbguest.auto_update = false \r\nend<\/pre>\n<p>&nbsp;<\/p>\n<p>The last two options are set to disable the auto-update feature of vagrant. You can remove it if you want your images to be updated automatically.<\/p>\n<p>Note*: image update would prevent you while booting up the virtual machine.\u00a0 In a development environment, I recommend disabling this feature so that you don&#8217;t get stuck in your fast adventure.<\/p>\n<p>That&#8217;s all of it.<\/p>\n<p>&nbsp;<\/p>\n<p>Please let me know your feedback in the comments field and ask me if there are any questions or clarifications.<\/p>\n<p>Rate this article [ratings]<\/p>\n<p>&nbsp;<\/p>\n<p>Cheers<br \/>\nRumen Lishkov<\/p>\n<div id=\"postfollow\">\r\n<a href='https:\/\/ko-fi.com\/O4O51FG7C' target='_blank'><img height='46' style='border:0px;height:46px;width: 186px' src='https:\/\/az743702.vo.msecnd.net\/cdn\/kofi3.png?v=2' border='0' alt='Buy Me a Coffee at ko-fi.com' \/><\/a>\r\n<p>Follow us on<a href=\"http:\/\/www.facebook.com\/middlewareinventory\">Facebook<\/a> or<a href=\"http:\/\/www.twitter.com\/mwinventory\">Twitter<\/a>\r\n<\/br>\r\nFor more practical videos and tutorials. <a href=\"https:\/\/www.youtube.com\/channel\/UCRuqBFM6ioWwviNJkgOjeWw?sub_confirmation=1\">Subscribe to our channel<\/a>\r\n<\/br>\r\nFollow me on Linkedin <a href=\"https:\/\/www.linkedin.com\/comm\/mynetwork\/discovery-see-all?usecase=PEOPLE_FOLLOWS&followMember=saravakmwinventory\">My Profile<\/a>\r\n<\/br>\r\n<\/i>For any Consultation or to hire us <a href=\"mailto:rumenlishkoff@gmail.com\"> rumenlishkoff@gmail.com<\/a>\r\n<\/br>\r\nIf you like this article. Show your Support! <a href=\"https:\/\/ko-fi.com\/middlewareinventory\">Buy me a Coffee.<\/a>\r\n<\/br>\r\n<\/p>\r\n<p style=\"color: palevioletred !important;\">Signup for Exclusive \"Subscriber-only\" Content<\/p>\r\n\n\t\t<div class=\"emaillist\">\n\t\t\t<form action=\"#\" method=\"post\" class=\"es_subscription_form es_shortcode_form\" id=\"es_subscription_form_1670577360\" data-source=\"ig-es\">\n\t\t\t\t\t\t\t\t<div class=\"es-field-wrap\"><label>Name*<br \/><input type=\"text\" name=\"name\" class=\"ig_es_form_field_name\" placeholder=\"\" value=\"\" required=\"required\" \/><\/label><\/div><div class=\"es-field-wrap\"><label>Email*<br \/><input class=\"es_required_field es_txt_email ig_es_form_field_email\" type=\"email\" name=\"email\" value=\"\" placeholder=\"\" required=\"required\" \/><\/label><\/div><input type=\"hidden\" name=\"lists[]\" value=\"1\" \/><input type=\"hidden\" name=\"form_id\" value=\"3\" \/>\n\t\t\t\t<input type=\"hidden\" name=\"es_email_page\" value=\"1435\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"es_email_page_url\" value=\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-ansible-example\/\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"status\" value=\"Unconfirmed\"\/>\n\t\t\t\t<input type=\"hidden\" name=\"es-subscribe\" id=\"es-subscribe\" value=\"7aebfb1a9b\"\/>\n\t\t\t\t<label style=\"position:absolute;top:-99999px;left:-99999px;z-index:-99;\"><input type=\"email\" name=\"es_hp_email\" class=\"es_required_field\" tabindex=\"-1\" autocomplete=\"-1\" value=\"\"\/><\/label>\n\t\t\t\t\t\t\t\t<input type=\"submit\" name=\"submit\" class=\"es_subscription_form_submit es_submit_button es_textbox_button\" id=\"es_subscription_form_submit_1670577360\" value=\"Subscribe\"\/>\n\n\t\t\t\t\n\t\t\t\t<span class=\"es_spinner_image\" id=\"spinner-image\"><img src=\"https:\/\/www.middlewareinventory.com\/wp-content\/plugins\/email-subscribers\/lite\/public\/images\/spinner.gif\" alt=\"Loading\"\/><\/span>\n\n\t\t\t<\/form>\n\n\t\t\t<span class=\"es_subscription_message\" id=\"es_subscription_message_1670577360\"><\/span>\n\t\t<\/div>\n\n\t\t\r\n<\/div>\r\n<hr>\n<p>&nbsp;<\/p>\n","protected":false},"excerpt":{"rendered":"<p>In this article, we are going to see how to use Vagrant to create a development of Virtual machines and start practising Ansible. This is A Beginner article for both Ansible and Vagrant. I remember the days where I used to struggle with\u00a0 Vmware workstation (or) virtual box to setup[&#8230;]<\/p>\n","protected":false},"author":1,"featured_media":6253,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"_et_pb_use_builder":"","_et_pb_old_content":"","_et_gb_content_width":""},"categories":[98,454,99],"tags":[113,109,110,111,107,108,112,114],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v14.9 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>Ansible Vagrant Example - Testing Ansible with Vagrant | Devops Junction<\/title>\n<meta name=\"description\" content=\"Vagrantfile example and an Introduction to Vagrant and ansible. A post with examples and video. Step by Step. vagrantfile example for a virtual box to perform, Vagrant provision example and how to use vagrant with oracle virtual box. How to install and configure vagrant and ansible. vagrantfile examples.\" \/>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-ansible-example\/\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"Ansible Vagrant Example - Testing Ansible with Vagrant | Devops Junction\" \/>\n<meta property=\"og:description\" content=\"Vagrantfile example and an Introduction to Vagrant and ansible. A post with examples and video. Step by Step. vagrantfile example for a virtual box to perform, Vagrant provision example and how to use vagrant with oracle virtual box. How to install and configure vagrant and ansible. vagrantfile examples.\" \/>\n<meta property=\"og:url\" content=\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-ansible-example\/\" \/>\n<meta property=\"og:site_name\" content=\"Middleware Inventory\" \/>\n<meta property=\"article:publisher\" content=\"http:\/\/www.facebook.com\/devopsjunc\" \/>\n<meta property=\"article:published_time\" content=\"2018-07-11T05:49:03+00:00\" \/>\n<meta property=\"article:modified_time\" content=\"2022-11-10T19:18:12+00:00\" \/>\n<meta property=\"og:image\" content=\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screenshot-2020-10-19-at-2.22.13-AM-scaled.jpg\" \/>\n\t<meta property=\"og:image:width\" content=\"2560\" \/>\n\t<meta property=\"og:image:height\" content=\"1440\" \/>\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\n<meta name=\"twitter:creator\" content=\"@mwinventory\" \/>\n<meta name=\"twitter:site\" content=\"@mwinventory\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"Organization\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\",\"name\":\"Middleware Inventory\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"sameAs\":[\"http:\/\/www.facebook.com\/devopsjunc\",\"https:\/\/www.youtube.com\/channel\/UCRuqBFM6ioWwviNJkgOjeWw\",\"https:\/\/twitter.com\/mwinventory\"],\"logo\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2020\/09\/Screenshot-2020-09-18-at-3.49.40-AM.jpg\",\"width\":300,\"height\":107,\"caption\":\"Middleware Inventory\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#logo\"}},{\"@type\":\"WebSite\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\",\"url\":\"https:\/\/www.middlewareinventory.com\/\",\"name\":\"Devops Junction\",\"description\":\"An inventory of [i]nformation, Middleware and much more.\",\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":\"https:\/\/www.middlewareinventory.com\/?s={search_term_string}\",\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-ansible-example\/#primaryimage\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.middlewareinventory.com\/wp-content\/uploads\/2018\/07\/Screenshot-2020-10-19-at-2.22.13-AM-scaled.jpg\",\"width\":2560,\"height\":1440,\"caption\":\"Ansible Vagrant\"},{\"@type\":\"WebPage\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-ansible-example\/#webpage\",\"url\":\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-ansible-example\/\",\"name\":\"Ansible Vagrant Example - Testing Ansible with Vagrant | Devops Junction\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#website\"},\"primaryImageOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-ansible-example\/#primaryimage\"},\"datePublished\":\"2018-07-11T05:49:03+00:00\",\"dateModified\":\"2022-11-10T19:18:12+00:00\",\"description\":\"Vagrantfile example and an Introduction to Vagrant and ansible. A post with examples and video. Step by Step. vagrantfile example for a virtual box to perform, Vagrant provision example and how to use vagrant with oracle virtual box. How to install and configure vagrant and ansible. vagrantfile examples.\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-ansible-example\/\"]}]},{\"@type\":\"Article\",\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-ansible-example\/#article\",\"isPartOf\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-ansible-example\/#webpage\"},\"author\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\"},\"headline\":\"Ansible Vagrant Example &#8211; Testing Ansible with Vagrant | Devops Junction\",\"datePublished\":\"2018-07-11T05:49:03+00:00\",\"dateModified\":\"2022-11-10T19:18:12+00:00\",\"mainEntityOfPage\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-ansible-example\/#webpage\"},\"commentCount\":0,\"publisher\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/#organization\"},\"image\":{\"@id\":\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-ansible-example\/#primaryimage\"},\"keywords\":\"Ansible server provisioning example,Beginners practical example guide for Vagrant and Ansible,How to provision apache webserver with Ansible,Server provisioning in Vagrant example,Server provisioning with Ansible and Vagrant,Vagrant and Ansible,Vagrant practical tutorial,Vagrant server provisioning example\",\"articleSection\":\"Ansible,DevOps_Beginner,Vagrant\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"CommentAction\",\"name\":\"Comment\",\"target\":[\"https:\/\/www.middlewareinventory.com\/blog\/vagrant-ansible-example\/#respond\"]}]},{\"@type\":\"Person\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#\/schema\/person\/050bf13e27b309d29d1bda45c4eb3147\",\"name\":\"Rumen Lishkov\",\"image\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.middlewareinventory.com\/#personlogo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/secure.gravatar.com\/avatar\/c22e4a54d67750291a9892531f94ffb3?s=96&d=mm&r=g\",\"caption\":\"Rumen Lishkov\"}}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","_links":{"self":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/1435"}],"collection":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/comments?post=1435"}],"version-history":[{"count":5,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/1435\/revisions"}],"predecessor-version":[{"id":8575,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/posts\/1435\/revisions\/8575"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media\/6253"}],"wp:attachment":[{"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/media?parent=1435"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/categories?post=1435"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.middlewareinventory.com\/wp-json\/wp\/v2\/tags?post=1435"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}